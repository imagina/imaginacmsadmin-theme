"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[8173],{78173:(e,t,s)=>{s.r(t),s.d(t,{default:()=>q});var a=s(61758),r=s(58790);const o={id:"componentCrudIndex"},l={class:"backend-page"},i={class:"relative-position col-12"},n={slot:"top"},d={class:"table-top-left col-12 col-md-4 col-xl-3"},m={class:"q-title text-primary ellipsis"},h={class:"table-top-right col-12 col-md-8 col-xl-9 text-right"};function c(e,t,s,c,u,p){const g=(0,a.g2)("q-btn"),b=(0,a.g2)("q-table"),f=(0,a.g2)("inner-loading");return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.Lk)("div",l,[(0,a.Lk)("div",i,[(0,a.bF)(b,{class:"box-table",title:u.form.title,rows:u.table.data,columns:u.table.columns,"row-key":"name"},{default:(0,a.k6)((()=>[(0,a.Lk)("template",n,[(0,a.Lk)("div",d,[(0,a.Lk)("div",m,[(0,a.Lk)("span",null,(0,r.v_)(u.form.title),1)])]),(0,a.Lk)("div",h,[(0,a.Q3)("",!0),(0,a.bF)(g,{onClick:t[1]||(t[1]=e=>p.getLeads(!0)),icon:"fas fa-sync-alt",color:"info",class:"q-ml-xs"})])])])),_:1},8,["title","rows","columns"]),(0,a.bF)(f,{visible:u.loading},null,8,["visible"])])])])}var u=s(99526)["A"];const p={data(){return{loading:!1,form:{title:""},leads:[],table:{columns:[],data:[]}}},created(){this.getLeads(),this.getFields(),this.getForm()},methods:{getForm(){this.loading=!0;let e={refresh:!0,params:{}};this.$crud.show("apiRoutes.qform.forms",this.$route.params.id,e).then((e=>{this.form=e.data,this.loading=!1})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"})}))}))},getFields(){this.loading=!0;let e={refresh:!0,params:{filter:{formId:this.$route.params.id}}};this.$crud.index("apiRoutes.qform.fields",e).then((e=>{this.loading=!1,this.table.columns=this.orderColumnsForTable(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"})}))}))},orderColumnsForTable(e){return e.map((e=>({name:e.name,field:e.name,label:e.label,align:"center"})))},getLeads(e=!1){let t={refresh:!0,params:{filter:{formId:this.$route.params.id}}};this.loading=!0,this.$crud.index("apiRoutes.qform.leads",t).then((e=>{this.leads=e.data,this.table.data=this.orderDataForTable(e.data),this.loading=!1})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.loading=!1,console.error(e),this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"})}))}))},orderDataForTable(e){let t=e.map((e=>"object"==typeof e.values?e.values:JSON.parse(e.values))),s=[...t];for(let a in t)for(let e in t[a])s[a][t[a][e].name]=t[a][e].model;return s},forceDownload(){let e=`${u("apiRoutes.qform.leads")}?filter={"formId":${this.$route.params.id},"export":"true"}`;window.open(e,"_blank")}}};var g=s(12807),b=s(18383),f=s(69001),$=s(98582),k=s.n($);const v=(0,g.A)(p,[["render",c]]),q=v;k()(p,"components",{QTable:b.A,QBtn:f.A})}}]);