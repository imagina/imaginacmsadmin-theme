"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[7148],{73585:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var s=a(61758);const i={class:"box box-auto-height q-mb-md"},l={id:"contentEvents",class:"box relative-position"};function r(e,t,r,n,c,o){const d=(0,s.g2)("page-actions"),h=(0,s.g2)("crud"),u=(0,s.g2)("calendar"),p=(0,s.g2)("inner-loading");return(0,s.uX)(),(0,s.CE)("div",{id:"pageEvents",key:c.pageId},[(0,s.Lk)("div",i,[(0,s.bF)(d,{"extra-actions":["new","search"],title:e.$tr(e.$route.meta.title),onRefresh:t[0]||(t[0]=e=>o.getData(!0)),onSearch:t[1]||(t[1]=e=>{c.search=e,o.getData()}),onNew:t[2]||(t[2]=t=>e.$refs.eventCrud.create())},null,8,["title"])]),(0,s.Lk)("div",l,[(0,s.bF)(h,{"crud-data":a.e(9633).then(a.bind(a,19633)),type:"form-only",ref:"eventCrud",onCreated:t[3]||(t[3]=e=>o.getData(!0)),onUpdated:t[4]||(t[4]=e=>o.getData(!0))},null,8,["crud-data"]),(0,s.bF)(u,{"events-data":c.eventsData,"event-actions":c.eventActions},null,8,["events-data","event-actions"]),(0,s.bF)(p,{visible:c.loading},null,8,["visible"])])])}a(10239),a(94580);var n=a(69033),c=a(71915);const o={beforeUnmount(){c.Bt.off("page.data.refresh")},props:{},components:{calendar:n.A},watch:{},validations(){return{}},mounted(){this.$nextTick((function(){this.init()}))},data(){return{pageId:this.$uid(),loading:!1,eventsData:[],search:null,eventActions:[{label:this.$tr("isite.cms.label.update"),icon:"fas fa-pen",color:"green",callBack:e=>this.$refs.eventCrud.update(e)}]}},computed:{dynamicFields(){return{search:{value:null,type:"search"}}}},methods:{async init(){this.setFilters(),this.getData(),c.Bt.on("page.data.refresh",(()=>{this.pageId=this.$uid(),this.getData(!0)})),c.Bt.emit("setMobileMainAction",{icon:"fas fa-plus",color:"green",callBack:()=>this.$refs.eventCrud.create()})},setFilters(){this.$filter.setFilter({name:this.$route.name,fields:{categoryId:{value:null,type:"treeSelect",props:{label:this.$tr("isite.cms.label.category")},loadOptions:{apiRoute:"apiRoutes.qevent.categories"}},departmentId:{value:null,type:"treeSelect",props:{label:this.$tr("isite.cms.label.department")},loadOptions:{apiRoute:"apiRoutes.quser.departments"}},status:{value:"1",type:"select",props:{label:this.$tr("isite.cms.form.status"),clearable:!0,options:[{label:this.$tr("isite.cms.label.enabled"),value:"1"},{label:this.$tr("isite.cms.label.disabled"),value:"0"}]}}},callBack:()=>this.getData(!0)})},async getData(e=!1){this.loading=!0,this.eventsData=[],await Promise.all([this.getEvents(e),this.getUsersBirthday(e)]),this.loading=!1},getEvents(e=!1){return new Promise(((t,a)=>{let s={refresh:e,params:{include:"department,category",filter:{...this.$filter.values||{},search:this.search}}};this.$crud.index("apiRoutes.qevent.events",s).then((e=>{e.data.forEach((e=>{this.eventsData.push({id:e.id,title:`${parseInt(e.status)?"":this.$tr("isite.cms.label.cancelled")} ${e.title}`,color:parseInt(e.status)?e.category&&e.category.options.color||"#26a69a":"#e57373",icon:parseInt(e.status)?"fas fa-calendar":"fas fa-calendar-times",image:e?.mediaFiles?.mainimage.mediumThumb,date:e.date,mainDetails:[{title:this.$tr("isite.cms.label.category"),icon:"fas fa-calendar-check",value:e.category.title},{title:this.$tr("isite.cms.label.department"),icon:"fas fa-users",value:e.department.title}],extraDetails:[{title:this.$tr("isite.cms.label.category"),icon:"fas fa-calendar-check",value:e.category.title},{title:this.$tr("isite.cms.label.department"),icon:"fas fa-users",value:e.department.title},{value:e.description}]})})),t(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{t(!0)}))}))}))},getUsersBirthday(e=!1){return new Promise(((t,a)=>{let s={refresh:e};this.$crud.index("apiRoutes.quser.usersBirthday",s).then((e=>{e.data.forEach((e=>{this.eventsData.push({title:e.fullName,color:"#e57373",icon:"fas fa-birthday-cake",date:e.birthday,mainDetails:[{title:this.$tr("isite.cms.label.category"),icon:"fas fa-calendar-check",value:this.$tr("isite.cms.label.birthday")},{title:this.$tr("isite.cms.label.department"),icon:"fas fa-users",value:this.$tr("isite.cms.label.birthday")}],extraDetails:[{title:this.$tr("isite.cms.label.category"),icon:"fas fa-calendar-check",value:this.$tr("isite.cms.label.birthday")},{title:this.$tr("isite.cms.label.department"),icon:"fas fa-users",value:this.$tr("isite.cms.label.birthday")}]})})),t(e.data)})).then((e=>{this.$apiResponse.handleError(e,(()=>{t(!1)}))}))}))}}};var d=a(12807);const h=(0,d.A)(o,[["render",r]]),u=h}}]);