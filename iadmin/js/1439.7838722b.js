"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[1439],{63381:(t,e,a)=>{a.r(e),a.d(e,{default:()=>X});var o=a(61758),n=a(58790);const s={id:"appointmentIndexPage"},i={id:"appointmentIndexPageContent"},r={class:"box relative-position"},p={key:0,class:"row justify-between"},m={class:"box-title"},l={key:2},d={class:"text-center"},c=["innerHTML"],u={class:"row q-gutter-x-md justify-center full-width"};function g(t,e,a,g,h,f){const b=(0,o.g2)("q-icon"),v=(0,o.g2)("q-item-label"),k=(0,o.g2)("q-item-section"),q=(0,o.g2)("q-item"),x=(0,o.g2)("q-list"),y=(0,o.g2)("q-btn-dropdown"),$=(0,o.g2)("q-toolbar-title"),A=(0,o.g2)("q-btn"),F=(0,o.g2)("q-toolbar"),I=(0,o.g2)("dynamic-form"),E=(0,o.g2)("q-card-section"),Q=(0,o.g2)("q-card"),w=(0,o.g2)("q-dialog"),C=(0,o.g2)("q-separator"),_=(0,o.g2)("advance-chat"),L=(0,o.g2)("inner-loading"),R=(0,o.gN)("close-popup");return(0,o.uX)(),(0,o.CE)("div",s,[(0,o.Lk)("div",i,[(0,o.Lk)("div",r,[h.appointment?((0,o.uX)(),(0,o.CE)("div",p,[(0,o.Lk)("div",m,[(0,o.bF)(b,{name:"fas fa-calendar-check"}),(0,o.eW)(" "+(0,n.v_)(h.appointment.category.title),1)]),f.appointmentActions.length?((0,o.uX)(),(0,o.Wv)(y,{key:0,flat:"",color:"blue-grey","dropdown-icon":"fas fa-ellipsis-v",round:"",unelevated:""},{default:(0,o.k6)((()=>[(0,o.bF)(x,null,{default:(0,o.k6)((()=>[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(f.appointmentActions,((t,e)=>(0,o.bo)(((0,o.uX)(),(0,o.Wv)(q,{key:e,clickable:"",onClick:e=>t.action()},{default:(0,o.k6)((()=>[(0,o.bF)(k,null,{default:(0,o.k6)((()=>[(0,o.bF)(v,null,{default:(0,o.k6)((()=>[(0,o.eW)((0,n.v_)(t.title),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])),[[R]]))),128))])),_:1})])),_:1})):(0,o.Q3)("",!0)])):(0,o.Q3)("",!0),f.formErrorId?((0,o.uX)(),(0,o.Wv)(w,{key:1,modelValue:h.modalReportError,"onUpdate:modelValue":e[1]||(e[1]=t=>h.modalReportError=t),persistent:""},{default:(0,o.k6)((()=>[(0,o.bF)(Q,{id:"dialogInformation",class:"bg-grey-1"},{default:(0,o.k6)((()=>[(0,o.bF)(F,{class:"bg-primary text-white"},{default:(0,o.k6)((()=>[(0,o.bF)($,null,{default:(0,o.k6)((()=>[(0,o.Lk)("label",null,(0,n.v_)(t.$tr("iappointment.cms.message.reportError")),1)])),_:1}),(0,o.bo)((0,o.bF)(A,{flat:"",icon:"fas fa-times"},null,512),[[R]])])),_:1}),(0,o.bF)(E,{class:"relative-position col-12"},{default:(0,o.k6)((()=>[(0,o.bF)(I,{"form-id":f.formErrorId,onSent:e[0]||(e[0]=t=>h.modalReportError=!1),"send-to":{apiRoute:"apiRoutes.qform.leads",extraData:{formId:f.formErrorId}}},null,8,["form-id","send-to"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):(0,o.Q3)("",!0),(0,o.bF)(C,{class:"q-mt-sm q-mb-md"}),"message"==f.process.name?((0,o.uX)(),(0,o.CE)("div",l,[(0,o.Lk)("div",d,[(0,o.bF)(b,{name:f.process.message.icon,color:f.process.message.color,size:"40px",class:"q-mb-md"},null,8,["name","color"]),(0,o.Lk)("div",{innerHTML:f.process.message.text,class:"q-mb-md"},null,8,c),(0,o.Lk)("div",u,[4==f.process.status?((0,o.uX)(),(0,o.Wv)(A,{key:0,label:t.$tr("iappointment.cms.message.resumAppointment"),rounded:"",unelevated:"",color:"amber","no-caps":"",padding:"xs md",onClick:e[2]||(e[2]=t=>f.updateAppointmentStatus(1))},null,8,["label"])):(0,o.Q3)("",!0),(0,o.bF)(A,{label:t.$tr("iappointment.cms.message.appointmentList"),rounded:"",unelevated:"",color:"green","no-caps":"",to:{name:"qappointment.main.appointments.index"},padding:"xs md"},null,8,["label","to"])])])])):(0,o.Q3)("",!0),"form"==f.process.name?((0,o.uX)(),(0,o.Wv)(I,(0,o.v6)({key:3,modelValue:h.form,"onUpdate:modelValue":e[3]||(e[3]=t=>h.form=t),onSubmit:f.sendForm},2==f.process.status?f.formProps.appointment:f.formProps.rating),null,16,["modelValue","onSubmit"])):(0,o.Q3)("",!0),"chat"==f.process.name?((0,o.uX)(),(0,o.Wv)(_,(0,o.v6)({key:4,height:"calc(100vh - 280px)"},f.chatProps),null,16)):(0,o.Q3)("",!0),(0,o.bF)(L,{visible:h.loading},null,8,["visible"])])])])}a(10239);var h=a(78319),f=a(71915);const b={beforeUnmount(){f.Bt.off("page.data.refresh"),f.Bt.off("iappointment.appoinment.was.changed")},props:{},components:{advanceChat:h.A},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,modalReportError:!1,appointment:!1,form:{}}},computed:{formErrorId(){return this.$getSetting("iappointment::errorFormRelated")},appointmentActions(){let t=[];return this.formErrorId&&t.push({name:"reportError",title:this.$tr("iappointment.cms.message.reportError"),action:t=>{this.modalReportError=!0}}),t},process(){let t=this.appointment.fields||[],e=parseInt(this.appointment.statusId||0),a={0:"message",1:"message",2:"form",3:"chat",4:"message",5:"message",6:t.find((t=>"rating"==t.name))?"message":"form"},o={0:{text:this.$tr("isite.cms.message.notFound"),icon:"fa-light fa-plug-circle-xmark",color:"red"},1:{text:this.$tr("iappointment.cms.message.assigningMessage"),icon:"fas fa-user-clock",color:"primary"},4:{text:this.$tr("iappointment.cms.message.abandonedMessage"),icon:"fas fa-user-lock",color:"amber"},5:{text:this.$tr("iappointment.cms.message.expiredMessage"),icon:"fas fa-user-clock",color:"red"},6:{text:this.$tr("iappointment.cms.message.completedMessage"),icon:"fas fa-user-check",color:"green"}};return{status:e,name:a[e],message:o[e]}},formProps(){return{appointment:{formId:!!this.appointment&&this.appointment.category.formId,ref:"appointmentForm"},rating:{ref:"appointmentForm",title:this.$tr("isite.cms.message.rateYour",{name:this.appointment?this.appointment.category.title:""}),blocks:[{fields:{rating:{value:1,type:"rating",colClass:"col-12",required:!0,props:{label:this.$tr("isite.cms.label.rating")}},ratingComments:{value:null,type:"input",colClass:"col-12",props:{label:`${this.$tr("isite.cms.label.comment")}...`,type:"textarea",rows:"3"}}}}]}}},chatProps(){return{roomId:!(!this.appointment||!this.appointment.conversation)&&this.appointment.conversation.id,ref:"appointmentChat",loadRooms:!(!this.appointment||!this.appointment.conversation)}},appointmentData(){this.$clone(this.appointment);return response}},methods:{async init(){this.listenEvents(),await this.getData()},listenEvents(){f.Bt.on("page.data.refresh",(()=>{this.getData(!0)})),f.Bt.on("iappointment.appoinment.was.changed",(t=>{this.getData(!0)}))},getData(t=!1){return new Promise(((t,e)=>{this.loading=!0;let a={refresh:!0,params:{include:"category,conversation,fields"}};this.$crud.show("apiRoutes.qappointment.appointments",this.$route.params.id,a).then((e=>{this.appointment=e.data,this.loading=!1,t(e.data)})).catch((t=>{this.$apiResponse.handleError(t,(()=>{this.loading=!1,e(t)}))}))}))},updateAppointmentStatus(t=!1){return new Promise(((e,a)=>{if(!t||!this.appointment)return a(!1);let o={statusId:t};this.$crud.update("apiRoutes.qappointment.appointments",this.appointment.id,o).then((t=>{this.getData(),e(t.data)})).catch((t=>{a(t)}))}))},sendForm(){return new Promise(((t,e)=>{this.loading=!0;let a={appointmentId:this.$route.params.id,...this.form};this.$crud.create("apiRoutes.qappointment.appointmentLeads",a).then((t=>{this.$refs.appointmentForm.reset(),this.form={},this.getData()})).catch((t=>{this.loading=!1}))}))}}};var v=a(12807),k=a(24609),q=a(74434),x=a(54514),y=a(75329),$=a(63418),A=a(35779),F=a(57201),I=a(97569),E=a(79351),Q=a(56769),w=a(69001),C=a(27066),_=a(37015),L=a(62769),R=a(98582),P=a.n(R);const D=(0,v.A)(b,[["render",g]]),X=D;P()(b,"components",{QIcon:k.A,QBtnDropdown:q.A,QList:x.A,QItem:y.A,QItemSection:$.A,QItemLabel:A.A,QDialog:F.A,QCard:I.A,QToolbar:E.A,QToolbarTitle:Q.A,QBtn:w.A,QCardSection:C.A,QSeparator:_.A}),P()(b,"directives",{ClosePopup:L.A})}}]);