"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[7464],{37464:(e,t,l)=>{l.r(t),l.d(t,{default:()=>le});var s=l(92444),i=l(74044),o=l(264);const a={id:"formBlockPage"},n={class:"box box-auto-height q-mb-md"},m={class:"relative-position"},c={class:"row q-col-gutter-md"},r={class:"box"},d={class:"row justify-between items-center q-mb-md"},u={class:"box-title text-primary"},h={class:"row q-gutter-x-sm"},p={id:"iframe-container"},b=["height"],f=["action"],g=["innerHTML"],k={class:"box box-auto-height"},y={class:"box-title text-primary q-mb-md"},v={class:"text-right"},C={key:0,class:"box box-auto-height q-mb-md"},$={class:"row q-col-gutter-x-md"},T={class:"box-title text-primary q-mb-md"},A={key:0,class:"col-12"},q={class:"col-12 no-child-box"},w={key:1,class:"box box-auto-height no-child-box q-mb-md"},B={key:0,class:"q-mb-md"},E={class:"text-primary q-mb-md"},F={class:"row justify-between items-center"},x={class:"text-center q-mb-md"},Q={class:"box box-auto-height text-right"},S={key:1,class:"q-pa-md"};function D(e,t,l,D,N,I){const z=(0,s.E1)("page-actions"),O=(0,s.E1)("q-btn"),V=(0,s.E1)("dynamic-field"),W=(0,s.E1)("file-list-component"),K=(0,s.E1)("q-scroll-area"),j=(0,s.E1)("dynamic-form"),U=(0,s.E1)("q-tooltip"),_=(0,s.E1)("q-tab"),M=(0,s.E1)("q-tabs"),R=(0,s.E1)("q-btn-toggle"),P=(0,s.E1)("q-separator"),L=(0,s.E1)("q-item-label"),H=(0,s.E1)("q-item-section"),Y=(0,s.E1)("q-item"),G=(0,s.E1)("q-list"),J=(0,s.E1)("q-btn-dropdown"),X=(0,s.E1)("q-form"),Z=(0,s.E1)("inner-loading"),ee=(0,s.E1)("master-modal"),te=(0,s.iS)("close-popup");return(0,s.Wz)(),(0,s.An)("div",a,[(0,s.QD)("div",n,[(0,s.K2)(z,{title:e.$tr(e.$route.meta.title)},null,8,["title"])]),(0,s.QD)("div",m,[(0,s.QD)("div",c,[I.showFormAttributes?((0,s.Wz)(),(0,s.An)("div",{key:0,class:(0,i.WN)(N.colClassContent)},[(0,s.QD)("div",r,[(0,s.QD)("div",d,[(0,s.QD)("div",u,(0,i.WA)(e.$tr("isite.cms.message.preview")),1),(0,s.QD)("div",h,[(0,s.K2)(O,{icon:"col"==N.colClassContent?"fa-thin fa-maximize":"fa-thin fa-minimize",onClick:t[0]||(t[0]=e=>N.colClassContent="col"==N.colClassContent?"col-12":"col"),unelevated:"",outline:"",color:"grey-8",size:"sm",padding:"10px",rounded:""},null,8,["icon"])])]),(0,s.QD)("div",p,[(0,s.QD)("iframe",{name:"sample-iframe",frameborder:"0",width:"100%",height:N.windowHeigh-320+"px"},null,8,b),(0,s.QD)("form",{name:"form-iframe",id:"form-iframe",method:"post",target:"sample-iframe",action:`${N.baseUrl}/api/ibuilder/v1/block/preview`},[((0,s.Wz)(!0),(0,s.An)(s.ae,null,(0,s.mi)(N.inputsForm,(e=>((0,s.Wz)(),(0,s.An)("div",{innerHTML:e.outerHTML},null,8,g)))),256))],8,f)])])],2)):(0,s.g1)("",!0),N.isClient?((0,s.Wz)(),(0,s.An)("div",{key:1,class:(0,i.WN)(N.colClassContent)},[(0,s.K2)(K,{style:(0,i.MN)(`height: ${N.windowHeigh-253}px; width: 100%;`)},{default:(0,s.Ql)((()=>[(0,s.QD)("div",k,[(0,s.QD)("div",y,(0,i.WA)(e.$tr("ibuilder.cms.sidebar.adminTemplates")),1),(0,s.K2)(V,{field:I.formFields.client.helpText},null,8,["field"]),((0,s.Wz)(),(0,s.Az)(W,{key:N.fileListKey,modelValue:N.templatesAsFiles,"onUpdate:modelValue":t[1]||(t[1]=e=>N.templatesAsFiles=e),allowSelect:1,gridColClass:"col-6 col-md-4",onSelected:t[2]||(t[2]=e=>I.setNewPreviewTemplate(e))},null,8,["modelValue"])),(0,s.wt)((0,s.QD)("div",v,[(0,s.K2)(O,{unelevated:"",rounded:"","no-caps":"",type:"submit",class:"q-mr-sm",label:e.$tr("isite.cms.label.discardChanges"),color:"blue-grey-3",onClick:I.discardTemplateChanges},null,8,["label","onClick"]),(0,s.K2)(O,{unelevated:"",rounded:"","no-caps":"",type:"submit",label:e.$tr("isite.cms.label.apply"),color:"primary",onClick:t[3]||(t[3]=()=>I.submitTemplates(!0))},null,8,["label"])],512),[[o.Ub,!!N.modalTemplates.selected]])])])),_:1},8,["style"])],2)):((0,s.Wz)(),(0,s.An)("div",{key:2,class:(0,i.WN)(N.colClassContent)},[(0,s.K2)(K,{style:(0,i.MN)(`height: ${N.windowHeigh-253}px; width: 100%;`)},{default:(0,s.Ql)((()=>[(0,s.K2)(X,{autocorrect:"off",autocomplete:"off",ref:"formContent",onSubmit:I.submitData,onValidationError:t[9]||(t[9]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,s.Ql)((()=>[(0,s.K2)(j,{modelValue:N.formBlock,"onUpdate:modelValue":t[4]||(t[4]=e=>N.formBlock=e),blocks:I.formFields.block,ref:"mainForm",formType:"grid","no-actions":"","no-reset-with-blocks-update":""},null,8,["modelValue","blocks"]),I.contentfieldsconfig.show?((0,s.Wz)(),(0,s.An)("div",C,[(0,s.QD)("div",$,[(0,s.QD)("div",T,(0,i.WA)(I.formFields.entity.title),1),I.contentfieldsconfig.content.length?((0,s.Wz)(),(0,s.An)("div",A,[((0,s.Wz)(!0),(0,s.An)(s.ae,null,(0,s.mi)(I.formFields.entity.fields,((e,t)=>((0,s.Wz)(),(0,s.An)("div",{key:t,class:(0,i.WN)(e.colClass||e.columns||"col-12 col-md-6")},[void 0===e.vIf||e.vIf?((0,s.Wz)(),(0,s.Az)(V,{modelValue:N.formEntity[e.name||t],"onUpdate:modelValue":l=>N.formEntity[e.name||t]=l,key:t,field:e,"item-id":N.blockId},null,8,["modelValue","onUpdate:modelValue","field","item-id"])):(0,s.g1)("",!0)],2)))),128))])):(0,s.g1)("",!0),(0,s.QD)("div",q,[I.contentfieldsconfig.contentFields.length?((0,s.Wz)(),(0,s.Az)(j,{key:0,"box-style":!1,modelValue:N.formContentFields,"onUpdate:modelValue":t[5]||(t[5]=e=>N.formContentFields=e),blocks:I.contentfieldsconfig.contentFields,ref:"formContentFields",formType:"grid","no-actions":""},null,8,["modelValue","blocks"])):(0,s.g1)("",!0)])])])):(0,s.g1)("",!0),I.showFormAttributes?((0,s.Wz)(),(0,s.An)("div",w,[N.elementSelected?((0,s.Wz)(),(0,s.An)("div",B,[(0,s.QD)("div",E,[(0,s.QD)("div",F,[(0,s.QD)("b",null,(0,i.WA)(e.$trp("isite.cms.label.attribute")),1),(0,s.K2)(O,{icon:"fa-light fa-code-compare",color:"green",round:"",class:"btn-middle",unelevated:"",outline:"",onClick:I.getTemplates},{default:(0,s.Ql)((()=>[(0,s.K2)(U,null,{default:(0,s.Ql)((()=>[(0,s.mY)((0,i.WA)(e.$trp("isite.cms.label.template")),1)])),_:1})])),_:1},8,["onClick"])])]),(0,s.K2)(M,{modelValue:N.elementSelected,"onUpdate:modelValue":t[6]||(t[6]=e=>N.elementSelected=e),dense:"",class:"bg-grey-2 text-grey-8 q-mb-md",align:"justify","active-bg-color":"info","indicator-color":"grey-2","active-color":"white"},{default:(0,s.Ql)((()=>[((0,s.Wz)(!0),(0,s.An)(s.ae,null,(0,s.mi)(I.selectedBlock.block.elements,((e,t)=>((0,s.Wz)(),(0,s.Az)(_,{key:t,name:e.systemName,label:e.title},null,8,["name","label"])))),128))])),_:1},8,["modelValue"]),((0,s.Wz)(!0),(0,s.An)(s.ae,null,(0,s.mi)(I.selectedBlock.block.elements,((e,t)=>(0,s.wt)(((0,s.Wz)(),(0,s.An)("div",{key:t,class:"q-pa-none"},[(0,s.QD)("div",x,[(0,s.K2)(R,{modelValue:N.statusChildBlocks[e.name],"onUpdate:modelValue":t=>N.statusChildBlocks[e.name]=t,class:"my-custom-toggle","no-caps":"",rounded:"",unelevated:"","toggle-color":"green",color:"grey-3","text-color":"green",options:[{label:`${e.title} (On)`,value:!0},{label:`${e.title} (Off)`,value:!1}]},null,8,["modelValue","onUpdate:modelValue","options"])]),(0,s.wt)((0,s.QD)("div",null,[(0,s.K2)(P,{class:"q-mb-md"}),(0,s.K2)(j,{modelValue:N.formAttributes[e.name],"onUpdate:modelValue":t=>N.formAttributes[e.name]=t,blocks:e.attributes,formType:"collapsible"},null,8,["modelValue","onUpdate:modelValue","blocks"])],512),[[o.Ub,N.statusChildBlocks[e.name]]])])),[[o.Ub,N.elementSelected==e.systemName]]))),128))])):(0,s.g1)("",!0)])):(0,s.g1)("",!0),(0,s.QD)("div",Q,[N.blockId?((0,s.Wz)(),(0,s.An)("div",S,[(0,s.K2)(J,{split:"",color:"green","content-class":"bg-green text-white",rounded:"",label:e.$tr("isite.cms.label.save"),onClick:t[8]||(t[8]=()=>I.submitData())},{default:(0,s.Ql)((()=>[(0,s.K2)(G,{class:"q-pl-sm"},{default:(0,s.Ql)((()=>[(0,s.wt)(((0,s.Wz)(),(0,s.Az)(Y,{clickable:""},{default:(0,s.Ql)((()=>[(0,s.K2)(H,null,{default:(0,s.Ql)((()=>[(0,s.K2)(L,{onClick:t[7]||(t[7]=()=>I.saveAndExit())},{default:(0,s.Ql)((()=>[(0,s.mY)((0,i.WA)(e.$tr("isite.cms.message.saveAndReturn")),1)])),_:1})])),_:1})])),_:1})),[[te]])])),_:1})])),_:1},8,["label"])])):((0,s.Wz)(),(0,s.Az)(O,{key:0,unelevated:"",rounded:"","no-caps":"",type:"submit",label:e.$tr("isite.cms.label.save"),color:"primary"},null,8,["label"]))])])),_:1},8,["onSubmit"])])),_:1},8,["style"])],2))]),(0,s.K2)(Z,{visible:N.loading},null,8,["visible"])]),(0,s.K2)(ee,(0,s.Gu)({modelValue:N.modalTemplates.show,"onUpdate:modelValue":t[12]||(t[12]=e=>N.modalTemplates.show=e)},I.modalTemplatesAttributes),{default:(0,s.Ql)((()=>[(0,s.K2)(W,{modelValue:N.templatesAsFiles,"onUpdate:modelValue":t[10]||(t[10]=e=>N.templatesAsFiles=e),allowSelect:1,gridColClass:"col-6 col-md-3",onSelected:t[11]||(t[11]=e=>N.modalTemplates.selected=e[0]||null)},null,8,["modelValue"])])),_:1},16,["modelValue"])])}l(23816);var N=l(98724),I=l(8932),z=l(18528)["c"];const O={beforeUnmount(){I.kN.off("page.data.refresh")},props:{},components:{fileListComponent:N.c},watch:{"formBlock.componentName"(){this.formEntity={},this.formAttributes={},this.elementSelected=null,this.statusChildBlocks={}},"formEntity.type"(){this.formEntity.id=null,this.formEntity.params={filter:{},take:12}},getBlockRequestData(){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout((()=>{this.getIframe()}),500)},"selectedBlock.block"(e){e&&this.isClient&&this.getTemplates()}},mounted(){this.$nextTick((function(){this.init()}))},created(){"client"===this.$route.meta.viewType&&(this.isClient=!0)},data(){return{isValidForm:null,languageOptions:this.$store.getters["qsiteApp/getSelectedLocalesSelect"],loading:!1,blockId:this.$route.params.id,configData:{},elementSelected:null,formBlock:{},formEntity:{},formContentFields:{},formAttributes:{},notToSnakeCase:["component","entity","attributes"],colClassContent:"col",windowHeigh:window.innerHeight,modalTemplates:{show:!1,loading:!1,selected:null},templates:[],templatesAsFiles:[],statusChildBlocks:{},inputsForm:[],baseUrl:this.$store.state.qsiteApp.baseUrl,timeout:null,isClient:!1,previusTemplateSelected:null,removeSelectedFile:!1,fileListKey:this.$uid()}},computed:{settings(){return{templatesBaseUrl:this.$getSetting("ibuilder::blockTemplatesUrl")}},formFields(){return{block:[{name:"main",fields:{helpText:{type:"banner",colClass:"col-12",props:{message:"Selecciona un 'Nombre de Sistema' unico que identifique el bloque y luego el componente que quieres perzonalizar..."}},internalTitle:{isTranslatable:!0,type:"input",required:!0,colClass:"col-12 col-md-4",props:{label:this.$tr("isite.cms.form.title")+"*",rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]}},systemName:{type:"input",required:!0,colClass:"col-12 col-md-4",props:{label:this.$tr("isite.cms.form.systemName")+"*"}},componentName:{type:"select",required:!0,colClass:"col-12 col-md-4",props:{label:this.$tr("isite.cms.label.block")+"*",options:Object.values(this.blocks).filter((e=>!e.internal)).map((e=>({label:e.title,value:e.systemName}))),readonly:!!this.blockId}},mediasSingle:{value:{},type:"media",colClass:"col-12",fieldItemId:this.blockId||null,props:{label:this.$tr("isite.cms.message.preview"),zone:"internalimage",entity:"Modules\\Ibuilder\\Entities\\Block",entityId:null}}}}],entity:{title:this.$trp("isite.cms.label.content"),fields:{helpText:{type:"banner",colClass:"col-12",props:{message:"Configura aquí el contenido del componente..."}},type:{type:"select",require:!0,colClass:this.formEntity.type&&!this.loadOptionsContent?"col-12":null,props:{label:`${this.$tr("isite.cms.label.entity")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")],options:this.selectedBlock?.block.content||[]}},id:{type:"select",require:!0,vIf:!!this.loadOptionsContent,props:{label:`${this.$tr("isite.cms.label.record")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]},loadOptions:this.loadOptionsContent},params:{type:"json",require:!0,colClass:"col-12",vIf:!(!this.formEntity.type||this.loadOptionsContent),props:{label:this.$trp("isite.cms.label.filter"),rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]}}}},client:{helpText:{type:"banner",props:{message:"Selecciona la plantilla que más te guste para cambiar la manera en que se ve está sección en tu sitio WEB."}}}}},blocks(){var e={};return Object.values(this.configData).filter((e=>e)).forEach((t=>{Array.isArray(t)||Object.keys(t).forEach((l=>{var s=[];s=Object.values(t[l].attributes).map(((e,t)=>({...e,name:t}))),e[l]={...t[l],content:t[l].content||[],attributes:s}}))})),Object.values(e).forEach((t=>{var l=[{name:"componentAttributes",systemName:t.systemName,title:t.title,attributes:t.attributes}],s=t.childBlocks||{};"x-ibuilder::block"==t.systemName||s.mainBlock||(s={mainblock:"x-ibuilder::block",...s}),Object.keys(s).forEach((t=>{var i=Object.values(e).find((e=>e.systemName==s[t]));i&&l.push({name:t,systemName:s[t],title:i.title,attributes:i.attributes,contentFields:i.contentFields||{}})})),t.elements=this.$clone(l)})),e},selectedBlock(){const e=Object.values(this.blocks).find((e=>e.systemName==this.formBlock.componentName));var t=null;return e&&(t={block:e,elementsOptions:Object.values(e.elements).map((e=>({label:e.title,value:e.systemName})))},setTimeout((()=>{this.elementSelected=Object.values(e.elements)[0].systemName,Object.values(t.block.elements).forEach((e=>{this.statusChildBlocks[e.name]=!0}))}),100)),t},loadOptionsContent(){let e=null;return this.selectedBlock&&(e=this.selectedBlock.block.content.find((e=>{if(e.value==this.formEntity.type)return e}))),e?.loadOptions||null},contentfieldsconfig(){let e={show:!1,content:[],contentFields:[]};const t={content:[],contentFields:{},...this.selectedBlock?.block||{}};var l=Object.values(t.elements||{}).map((e=>e.contentFields||{})).reduce(((e,t)=>({...e,...t})),{});if(t.content.length||Object.keys(t.contentFields).length){const s=Object.keys(t.contentFields).length?Object.values(t.contentFields):[];e={show:!0,content:t.content,contentFields:[{fields:[{name:"blockTitle",type:"input",colClass:"col-12",isTranslatable:!0,props:{label:this.$tr("isite.cms.form.title")}},{name:"blockSubtitle",type:"input",colClass:"col-12",isTranslatable:!0,props:{label:this.$tr("isite.cms.label.subtitle")}},...s.map(((e,t)=>({...e,fieldItemId:this.blockId,name:e.name||t}))),...Object.values(l),{name:"mediasSingle",value:{},type:"media",colClass:"col-12",fieldItemId:this.blockId,props:{label:this.$tr("isite.cms.label.backgroundImage"),zone:"blockbgimage",entity:"Modules\\Ibuilder\\Entities\\Block",entityId:null}}]}]}}return e},showFormAttributes(){let e=!0;this.selectedBlock||(e=!1);const t=this.selectedBlock?.block.content||[];if(t.length){const l=t.find((e=>e.value==this.formEntity.type));l||(e=!1),l&&l.loadOptions&&!this.formEntity.id&&(e=!1)}return e},getBodyParams(){const e={systemName:this.formBlock?.componentName,nameSpace:this.selectedBlock?.block?.nameSpace},t=this.formEntity,l={...this.formAttributes,componentAttributes:{...this.formAttributes.componentAttributes||{},...this.formContentFields,...this.formContentFields[this.$store.state.qsiteApp.defaultLocale]||{}}};return{component:e,entity:t,attributes:l}},getBlockRequestData(){const e=this.$clone({...this.formBlock,component:{nameSpace:this.selectedBlock?.block?.nameSpace||"",systemName:this.selectedBlock?.block?.systemName||""},...this.formContentFields,entity:{type:null,id:null,params:{},...this.formEntity},attributes:this.formAttributes,mediasSingle:this.$clone({...this.formContentFields.medias_single||this.formContentFields.mediasSingle||{},...this.formBlock.mediasSingle||this.formBlock.medias_ingle||{}}),mediasMulti:this.$clone({...this.formContentFields.medias_multi||this.formContentFields.mediasMulti||{},...this.formBlock.medias_multi||this.formBlock.mediasMulti||{}})});return this.languageOptions.forEach((t=>{e[t.value]={...this.formContentFields[t.value],internalTitle:this.formBlock[t.value]?.internalTitle}})),e.attributes.componentAttributes={...e.attributes.componentAttributes,mediasSingle:e.mediasSingle,mediasMulti:e.mediasMulti},delete e.componentName,delete e.helpText,delete e.medias_single,delete e.medias_multi,Object.keys(this.statusChildBlocks).forEach((t=>{this.statusChildBlocks[t]||(e.attributes[t]={})})),e},modalTemplatesAttributes(){return{loading:this.modalTemplates.loading,customPosition:!0,title:`${this.$trp("isite.cms.label.template")} | ${this.selectedBlock?this.selectedBlock.block.title:""}`,actions:[{props:{label:`${this.$tr("isite.cms.label.apply")}: ${this.modalTemplates.selected?.filename||""}`,color:"green",rounded:!0,icon:"fal fa-fill-drip",disable:!this.modalTemplates.selected},action:()=>{this.formAttributes=this.$clone(this.modalTemplates.selected.attributes),this.modalTemplates.show=!1}}]}}},methods:{init(){this.getData(),I.kN.on("page.data.refresh",this.getData)},async getData(){this.loading=!0,await Promise.all([this.getModuleBlocks()]),await this.getBlockData(),this.loading=!1},getModuleBlocks(){return new Promise(((e,t)=>{let l={refresh:!0,params:{filter:{allTranslations:!0,configNameByModule:"blocks"}}};this.$crud.index("apiRoutes.qsite.configs",l).then((t=>{this.configData=t.data,e(t.data)})).catch((t=>{this.$apiResponse.handleError(t,(()=>{e(null)}))}))}))},getTemplates(){return new Promise(((e,t)=>{if(!this.settings.templatesBaseUrl)return e(!0);this.isClient||(this.modalTemplates={show:!0,loading:!0,selected:null}),this.templates=[],this.templatesAsFiles=[];const l=`${this.settings.templatesBaseUrl}/api${z("apiRoutes.qbuilder.blocks")}`;this.$axios.get(l).then((t=>{this.templates=this.$clone(t.data.data.filter((e=>{if(e.component.systemName==this.selectedBlock.block.systemName)return e}))),this.templatesAsFiles=this.$clone(this.templates.map((e=>({...e.mediaFiles.internalimage,isImage:!0,filename:e.internalTitle,id:e.id,attributes:e.attributes})))).filter((e=>this.blockId!=e.id)),this.modalTemplates.loading=!1,e(t)})).catch((e=>{this.modalTemplates.loading=!1,t(e.response)}))}))},getBlockData(){return new Promise(((e,t)=>{if(!this.blockId)return e(null);let l={refresh:!0,params:{filter:{allTranslations:!0},include:"fields"}};this.$crud.show("apiRoutes.qbuilder.blocks",this.blockId,l).then((t=>{this.formBlock=this.$clone({...t.data,componentName:t.data.component.systemName}),setTimeout((()=>{this.formEntity=this.$clone(t.data.entity),setTimeout((()=>{this.formEntity.params=t.data.entity.params,this.formEntity.id=t.data.entity.id,this.formContentFields=this.$clone(t.data);const e=t.data.attributes;Object.keys(e).forEach((t=>{void 0==e[t]||Array.isArray(e[t])?this.statusChildBlocks[t]=!1:this.formAttributes[t]=e[t]})),this.previusTemplateSelected=this.$clone(this.formAttributes)}),500)}),500),e(t.data)})).catch((t=>{this.$apiResponse.handleError(t,(()=>{e(null)}))}))}))},getIframe(){if(this.showFormAttributes){let e=[];const t=this.getBodyParams;Object.keys(t).forEach((l=>{const s=document.createElement("input");s.name=l,s.value=JSON.stringify(t[l]),s.type="hidden",e.push(s)})),this.inputsForm=e,this.$nextTick((()=>{const e=Object.getPrototypeOf(document.forms["form-iframe"]).submit;e.call(document.forms["form-iframe"])}))}},setNewPreviewTemplate(e){e.length>0?this.modalTemplates.selected=e[0]||null:this.modalTemplates.selected=this.$clone({attributes:{...this.previusTemplateSelected}}),this.formAttributes=this.$clone(this.modalTemplates.selected.attributes),this.submitTemplates()},discardTemplateChanges(){this.modalTemplates.selected=null,this.fileListKey=this.$uid(),this.formAttributes=this.$clone(this.previusTemplateSelected),this.submitTemplates()},async submitData(e){if(this.$refs.mainForm&&(this.isValidForm=await this.$refs.mainForm.validateCompleteForm()),this.isValidForm){const t=this.getBlockRequestData;this.blockId?this.updateBlock(t,e):this.createBlock(t)}else this.$alert.error(this.$tr("isite.cms.message.formInvalid"))},async saveAndExit(){await this.submitData(!0)},submitTemplates(e=!1){this.getIframe(),e&&this.submitData()},createBlock(e){return new Promise((t=>{this.loading=!0;const l={notToSnakeCase:this.notToSnakeCase};this.$crud.create("apiRoutes.qbuilder.blocks",e,l).then((e=>{this.$router.push({name:"qbuilder.admin.blocks.index"}),this.loading=!1})).catch((e=>{this.loading=!1}))}))},updateBlock(e,t){return new Promise((l=>{this.loading=!0;const s={notToSnakeCase:this.notToSnakeCase};this.$crud.update("apiRoutes.qbuilder.blocks",this.blockId,e,s).then((e=>{this.isClient&&this.$route.query.redirect&&(window.location.href=this.$route.query.redirect),t&&this.$router.push({name:"qbuilder.admin.blocks.index"}),this.loading=!1})).catch((e=>{this.loading=!1}))}))}}};var V=l(68716),W=l(99140),K=l(94380),j=l(14288),U=l(90111),_=l(38788),M=l(7628),R=l(15344),P=l(70880),L=l(82764),H=l(99588),Y=l(84884),G=l(11032),J=l(2992),X=l(81020),Z=l(95252),ee=l.n(Z);const te=(0,V.c)(O,[["render",D]]),le=te;ee()(O,"components",{QBtn:W.c,QScrollArea:K.c,QForm:j.c,QTooltip:U.c,QTabs:_.c,QTab:M.c,QBtnToggle:R.c,QSeparator:P.c,QBtnDropdown:L.c,QList:H.c,QItem:Y.c,QItemSection:G.c,QItemLabel:J.c}),ee()(O,"directives",{ClosePopup:X.c})}}]);