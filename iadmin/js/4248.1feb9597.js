"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[4248],{24248:(e,n,t)=>{t.r(n),t.d(n,{default:()=>m});var i=t(92444),r={class:"row"};function a(e,n,t,a,c,o){var l=(0,i.E1)("dynamic-field"),s=(0,i.E1)("inner-loading");return(0,i.Wz)(),(0,i.An)("div",null,[(0,i.QD)("div",r,[e.loading?(0,i.g1)("",!0):((0,i.Wz)(),(0,i.Az)(l,{key:0,modelValue:e.map,"onUpdate:modelValue":n[0]||(n[0]=function(n){return e.map=n}),class:"q-mb-md col-12",field:e.mapField},null,8,["modelValue","field"]))]),(0,i.K2)(s,{visible:e.loading},null,8,["visible"])])}var c=t(75836),o=t(20584);const l={getDevices:function(){return new Promise((function(e,n){o.c.index("apiRoutes.qtelemetry.devices",{refresh:!0}).then((function(n){e(n.data)})).catch((function(e){return n(e)}))}))}};var s=t(58088),u=t(8932),d=function(){return d=Object.assign||function(e){for(var n,t=1,i=arguments.length;t<i;t++)for(var r in n=arguments[t],n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e},d.apply(this,arguments)};function f(e,n){var t={},r=(0,c.cB)({loading:!1,map:null,devices:[],mapField:{value:null,type:"positionMarkerMap",help:{description:u._s.tr("icommerce.cms.form.mapHelp")},props:{label:"".concat(u._s.tr("isite.cms.label.search"),"..."),readOnly:!0,markers:!0,height:"80vh"}}}),a={},o={init:function(){r.loading=!0,o.getDevices().then((function(e){o.setMarkers(),r.loading=!1}))},setMarkers:function(){r.map=r.devices.map((function(e){return{lat:e.lat,lng:e.lng,title:e.title,loadingLabel:u._s.tr("isite.cms.label.loading"),onClick:function(){return o.getLastRecord(e)}}}))},getLastRecord:function(e){return new Promise((function(n,t){var i={filter:{deviceId:e.id}};s.c.getSensors(i).then((function(t){var i=t,r={filter:{deviceId:e.id},orderBy:{field:"id",way:"desc"},take:1};s.c.getRecords(r).then((function(e){var t;0==e.length&&n("-");var r=e[0],a="<b>".concat(null===(t=null===r||void 0===r?void 0:r.device)||void 0===t?void 0:t.title,"</b>")||0,c="";i.length&&i.forEach((function(e){if(null===r||void 0===r?void 0:r.logs){var n=r.logs.find((function(n){return n.sensorId==e.id}));n&&(c="".concat(c," ").concat(e.title,": ").concat(n.value,"</br>"))}})),n("".concat(a,"<p>").concat(c,"</p>"))}))}))}))},getDevices:function(){return new Promise((function(e,n){l.getDevices().then((function(n){r.devices=n,e(n)}))}))}};return(0,i.u2)((function(){o.init()})),d(d(d(d({},t),(0,c.kx)(r)),a),o)}const v=(0,i._M)({setup:function(e,n){var t=n.emit;return f(e,t)}});var p=t(68716);const g=(0,p.c)(v,[["render",a]]),m=g}}]);