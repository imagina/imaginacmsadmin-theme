"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[7536],{87636:(e,t,i)=>{i.r(t),i.d(t,{default:()=>vt});var l=i(92444),o=i(264),n=i(74044);const a={class:"row"},s={class:"col-xs-12 col-sm-12 col-md-6 q-mb-sm"},r={class:"q-px-md"},c={class:"tw-w-full row q-my-md items-center justify-end"},d={class:"row justify-center q-mx-sm"},m={class:"cursor-pointer row items-center"},u={class:"text-blue-grey",style:{"line-height":"1"}},f={class:"text-caption",style:{"line-height":"1"}},p={style:{width:"240px"}};function h(e,t,h,g,b,v){const y=(0,l.E1)("q-tab"),w=(0,l.E1)("q-tabs"),D=(0,l.E1)("q-tooltip"),Q=(0,l.E1)("q-btn"),k=(0,l.E1)("q-icon"),$=(0,l.E1)("dynamic-field"),x=(0,l.E1)("q-popup-edit"),q=(0,l.E1)("dynamicList"),M=(0,l.E1)("taskComponent"),C=(0,l.E1)("master-modal"),R=(0,l.E1)("crud"),A=(0,l.E1)("timeLogsComponent"),T=(0,l.E1)("inner-loading");return(0,l.Wz)(),(0,l.An)("div",null,[(0,l.QD)("div",a,[(0,l.wt)((0,l.QD)("div",s,[(0,l.K2)(w,{modelValue:b.tabModel,"onUpdate:modelValue":t[0]||(t[0]=e=>b.tabModel=e),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left","no-caps":"","narrow-indicator":"",style:{"align-items":"center"}},{default:(0,l.Ql)((()=>[((0,l.Wz)(!0),(0,l.An)(l.ae,null,(0,l.mi)(b.tabs,((e,t)=>((0,l.Wz)(),(0,l.Az)(y,{key:t,name:e.value,label:e.label},null,8,["name","label"])))),128))])),_:1},8,["modelValue"])],512),[[o.Ub,!1]])]),(0,l.QD)("div",r,[b.tabModel==b.tabs[0].value?((0,l.Wz)(),(0,l.Az)(q,{key:0,ref:"dynamicList",listConfig:b.listConfig,onNew:t[6]||(t[6]=()=>e.$refs.crudComponent.create())},{"top-table":(0,l.Ql)((()=>[(0,l.QD)("div",c,[(0,l.K2)(Q,{"text-color":"primary",style:{border:"1px solid rgba(0, 13, 71, 0.15)"},class:"q-mr-sm btn-small",icon:"fa-regular fa-chevron-left",dense:"",rounded:"",unelevated:"",onClick:t[1]||(t[1]=e=>v.goToPrevious()),padding:"8px"},{default:(0,l.Ql)((()=>[(0,l.K2)(D,{anchor:"bottom middle",self:"top middle"},{default:(0,l.Ql)((()=>[(0,l.mY)((0,n.WA)(e.$tr("itask.cms.previousWeek")),1)])),_:1})])),_:1}),(0,l.QD)("div",d,[(0,l.QD)("div",m,[(0,l.K2)(k,{name:"fal fa-calendar-range",color:"amber",class:"q-mr-sm",size:"23px"}),(0,l.QD)("div",u,[(0,l.QD)("div",f,(0,n.WA)(e.$tr("isite.cms.label.date")),1),(0,l.mY)(" "+(0,n.WA)(v.dynamicListTitle),1)])]),(0,l.K2)(D,null,{default:(0,l.Ql)((()=>[(0,l.mY)((0,n.WA)(e.$tr("isite.cms.label.edit")),1)])),_:1}),(0,l.K2)(x,{ref:"titleModal",modelValue:b.dateRangeFilter.value,"onUpdate:modelValue":t[4]||(t[4]=e=>b.dateRangeFilter.value=e),"transition-show":"fade-in","transition-hide":"fade-out",cover:!1,anchor:"bottom start"},{default:(0,l.Ql)((()=>[(0,l.QD)("div",p,[(0,l.K2)($,{modelValue:b.dateRangeFilter.value,"onUpdate:modelValue":[t[2]||(t[2]=e=>b.dateRangeFilter.value=e),t[3]||(t[3]=e=>v.setDateRange(e))],field:b.dateRangeFilter},null,8,["modelValue","field"])])])),_:1},8,["modelValue"])]),(0,l.K2)(Q,{"text-color":"primary",style:{border:"1px solid rgba(0, 13, 71, 0.15)"},class:"q-ml-sm btn-small",icon:"fa-regular fa-chevron-right",dense:"",rounded:"",unelevated:"",onClick:t[5]||(t[5]=e=>v.goToNext()),padding:"8px"},{default:(0,l.Ql)((()=>[(0,l.K2)(D,{anchor:"bottom middle",self:"top middle"},{default:(0,l.Ql)((()=>[(0,l.mY)((0,n.WA)(e.$tr("itask.cms.nextWeek")),1)])),_:1})])),_:1})])])),_:1},8,["listConfig"])):(0,l.g1)("",!0)]),(0,l.K2)(C,{modelValue:b.selectedRow.showModal,"onUpdate:modelValue":t[11]||(t[11]=e=>b.selectedRow.showModal=e),title:`Task : ${b.selectedRow.row?.id}`,"custom-position":"",onHide:t[12]||(t[12]=e=>b.selectedRow.showModal=!1)},{default:(0,l.Ql)((()=>[(0,l.K2)(M,{row:b.selectedRow.row,onOnClose:t[7]||(t[7]=e=>b.selectedRow.showModal=!1),onOnUpdate:t[8]||(t[8]=e=>v.onUpdate(e)),onOnDelete:t[9]||(t[9]=e=>v.onDelete(e)),onOpenTimeLogsModal:t[10]||(t[10]=e=>v.openTimeLogsModal(e))},null,8,["row"])])),_:1},8,["modelValue","title"]),(0,l.K2)(R,{ref:"crudComponent",type:null,"crud-data":i.e(5684).then(i.bind(i,95684)),onCreated:t[13]||(t[13]=e=>v.refreshDynamicList()),onUpdated:t[14]||(t[14]=e=>v.refreshDynamicList()),onDeleted:t[15]||(t[15]=e=>v.refreshDynamicList())},null,8,["crud-data"]),(0,l.K2)(C,{modelValue:b.selectedRow.timeLogsModal,"onUpdate:modelValue":t[18]||(t[18]=e=>b.selectedRow.timeLogsModal=e),title:e.$tr("itask.cms.timeLogs.title"),width:"460px",onHide:t[19]||(t[19]=e=>b.selectedRow.timeLogsModal=!1)},{default:(0,l.Ql)((()=>[(0,l.K2)(A,{row:b.selectedRow.row,onCloseModal:t[16]||(t[16]=e=>b.selectedRow.timeLogsModal=!1),onReloadRow:t[17]||(t[17]=e=>v.reloadRow(e))},null,8,["row"])])),_:1},8,["modelValue","title"]),(0,l.K2)(T,{visible:b.loading},null,8,["visible"])])}var g=i(86288),b={class:"q-mb-md"},v={class:"row q-gutter-x-md items-center"},y={class:"q-gutter-y-xs"},w={class:"q-gutter-y-xs"},D={class:"q-gutter-y-xs"},Q={class:"q-py-md"},k={class:"time-logs-format"},$={key:0,class:"q-mt-sm"},x={class:"text-weight-medium"};function q(e,t,i,o,a,s){var r,c=(0,l.E1)("dynamic-field"),d=(0,l.E1)("q-btn"),m=(0,l.E1)("q-separator"),u=(0,l.E1)("q-item-label"),f=(0,l.E1)("q-item-section"),p=(0,l.E1)("q-item"),h=(0,l.E1)("q-list"),g=(0,l.E1)("q-scroll-area"),q=(0,l.E1)("inner-loading");return(0,l.Wz)(),(0,l.An)("div",null,[(0,l.QD)("div",b,[(0,l.QD)("p",null,(0,n.WA)(e.$tr("itask.cms.timeLogs.total"))+" : "+(0,n.WA)(e.row.totalFormatedTimelogsDuration),1)]),(0,l.QD)("div",v,[(0,l.QD)("div",y,[(0,l.QD)("p",null,(0,n.WA)(e.$tr("itask.cms.timeLogs.startDate")),1),(0,l.K2)(c,{modelValue:e.dateModel,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.dateModel=t}),field:e.dateField,style:{width:"160px"}},null,8,["modelValue","field"])]),(0,l.QD)("div",w,[(0,l.QD)("p",null,(0,n.WA)(e.$tr("itask.cms.timeLogs.timeSpent")),1),(0,l.K2)(c,{modelValue:e.timeSpentModel,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.timeSpentModel=t}),field:e.timeSpentField,style:{width:"160px"}},null,8,["modelValue","field"])]),(0,l.QD)("div",D,[(0,l.K2)(d,{label:e.$tr("isite.cms.label.save"),rounded:"","no-caps":"",unelevated:"",color:"primary",onClick:t[2]||(t[2]=function(){return e.createTimeLog()}),disable:e.disableButton},null,8,["label","disable"])])]),(0,l.QD)("div",Q,[(0,l.QD)("p",null,(0,n.WA)(e.$tr("itask.cms.timeLogs.format.title")),1),(0,l.QD)("ul",k,[(0,l.QD)("li",null,(0,n.WA)(e.$tr("itask.cms.timeLogs.format.weeks")),1),(0,l.QD)("li",null,(0,n.WA)(e.$tr("itask.cms.timeLogs.format.days")),1),(0,l.QD)("li",null,(0,n.WA)(e.$tr("itask.cms.timeLogs.format.hours")),1),(0,l.QD)("li",null,(0,n.WA)(e.$tr("itask.cms.timeLogs.format.minutes")),1)])]),(null===(r=e.row.timelogs)||void 0===r?void 0:r.length)?((0,l.Wz)(),(0,l.An)("div",$,[(0,l.K2)(m,{class:"q-my-sm"}),(0,l.K2)(g,{style:{height:"220px"},visible:""},{default:(0,l.Ql)((function(){return[(0,l.K2)(h,null,{default:(0,l.Ql)((function(){return[((0,l.Wz)(!0),(0,l.An)(l.ae,null,(0,l.mi)(e.row.timelogs,(function(t,i){return(0,l.Wz)(),(0,l.Az)(p,{key:i},{default:(0,l.Ql)((function(){return[(0,l.K2)(f,null,{default:(0,l.Ql)((function(){return[(0,l.K2)(u,{class:"q-gutter-x-xs"},{default:(0,l.Ql)((function(){return[(0,l.QD)("span",x,(0,n.WA)(e.createdBy(t)),1),(0,l.QD)("span",null,(0,n.WA)(t.formatedTimeSpent),1)]})),_:2},1024),(0,l.K2)(u,{caption:"",lines:"1"},{default:(0,l.Ql)((function(){return[(0,l.mY)((0,n.WA)(e.$trd(t.createdAt)),1)]})),_:2},1024)]})),_:2},1024),(0,l.K2)(f,{side:"",top:""},{default:(0,l.Ql)((function(){return[(0,l.K2)(u,{caption:""},{default:(0,l.Ql)((function(){return[(0,l.K2)(d,{label:e.$tr("isite.cms.label.delete"),onClick:function(i){return e.deleteTimeLog(t)},rounded:"","no-caps":"",unelevated:"",dense:"",color:"grey-3","text-color":"grey-8",class:"q-px-md"},null,8,["label","onClick"])]})),_:2},1024)]})),_:2},1024)]})),_:2},1024)})),128))]})),_:1})]})),_:1})])):(0,l.g1)("",!0),(0,l.K2)(q,{visible:e.loading},null,8,["visible"])])}var M=i(75836),C=i(20584);const R={createItem:function(e,t,i){return void 0===i&&(i={params:{}}),new Promise((function(l,o){C.c.create(e,t,i).then((function(e){l(e)})).catch((function(e){return o(e)}))}))},deleteItem:function(e,t){return new Promise((function(i,l){C.c.delete(e,t,{}).then((function(e){i(e)})).catch((function(e){return l(e)}))}))}};var A=i(8932),T=i(49456),W=i.n(T),L=function(){return L=Object.assign||function(e){for(var t,i=1,l=arguments.length;i<l;i++)for(var o in t=arguments[i],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},L.apply(this,arguments)},E=function(e,t,i,l){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,n){function a(e){try{r(l.next(e))}catch(t){n(t)}}function s(e){try{r(l["throw"](e))}catch(t){n(t)}}function r(e){e.done?i(e.value):o(e.value).then(a,s)}r((l=l.apply(e,t||[])).next())}))},I=function(e,t){var i,l,o,n,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(e){return function(t){return r([e,t])}}function r(s){if(i)throw new TypeError("Generator is already executing.");while(n&&(n=0,s[0]&&(a=0)),a)try{if(i=1,l&&(o=2&s[0]?l["return"]:s[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,s[1])).done)return o;switch(l=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,l=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(r){s=[6,r],l=0}finally{i=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};function K(e,t){var i="YYYY/MM/DD",o="apiRoutes.qtask.timelogs",n={},a=(0,M.cB)({loading:!1,dateModel:null,dateField:{value:W()().format(i),type:"date"},timeSpentModel:null,timeSpentField:{type:"timeSpent",props:{unit:"minutes"}}}),s={disableButton:(0,l.S6)((function(){return null==a.timeSpentModel||""==a.timeSpentModel}))},r={init:function(){},createTimeLog:function(){var t={taskId:e.row.id,timeSpent:a.timeSpentModel,createdAt:a.dateModel?a.dateModel:W()().format(i)};a.loading=!0,R.createItem(o,t).then((function(e){a.timeSpentModel=null,a.loading=!1,A.Qb.info({message:A._s.tr("isite.cms.message.recordCreated")}),r.reloadRow()}))},deleteTimeLog:function(e){var t=this;A.Qb.error({mode:"modal",title:"ID: ".concat(e.id),message:A._s.tr("isite.cms.message.deleteRecord"),actions:[{label:A._s.tr("isite.cms.label.cancel"),color:"grey"},{label:A._s.tr("isite.cms.label.delete"),color:"red",handler:function(){return E(t,void 0,void 0,(function(){return I(this,(function(t){return a.loading=!0,R.deleteItem(o,e.id).then((function(e){r.reloadRow(),a.loading=!1})),[2]}))}))}}]})},reloadRow:function(){t("reloadRow",e.row)},createdBy:function(e){var t;return(null===(t=e.creator)||void 0===t?void 0:t.firstName)?"".concat(e.creator.firstName," ").concat(e.creator.lastName):e.creator.email}};return(0,l.u2)((function(){r.init()})),L(L(L(L({},n),(0,M.kx)(a)),s),r)}const _=(0,l._M)({props:{row:{default:{}}},setup:function(e,t){var i=t.emit;return K(e,i)}});var P=i(68716),S=i(99140),z=i(70880),O=i(94380),V=i(99588),F=i(84884),N=i(11032),B=i(2992),U=i(95252),Y=i.n(U);const j=(0,P.c)(_,[["render",q]]),H=j;Y()(_,"components",{QBtn:S.c,QSeparator:z.c,QScrollArea:O.c,QList:V.c,QItem:F.c,QItemSection:N.c,QItemLabel:B.c});var G={class:"row q-col-gutter-x-md"},J={class:"col-12 col-md-8"},X={style:{"min-height":"230px",height:"100%"}},Z={class:"text-h6"},ee={class:"q-my-md"},te={class:"text-subtitle2 text-weight-bold"},ie=["innerHTML"],le={class:"flex justify-start text-caption"},oe={class:"q-mt-md"},ne={class:"col-12 col-md-4"},ae={class:"q-mb-md task-details q-pa-sm"},se={class:"text-subtitle2 text-weight-bold"},re={class:"q-my-xs q-col-gutter-y-sm"},ce={class:"row"},de={class:"col-5"},me={class:"col-7"},ue={class:"row"},fe={class:"col-5"},pe={class:"col-7"},he={class:"row"},ge={class:"col-5"},be={class:"col-7"},ve={class:"row"},ye={class:"col-5"},we={class:"col-7"},De={class:"row"},Qe={class:"col-5"},ke={class:"col-7"},$e={class:"row"},xe={class:"col-5"},qe={class:"col-7"},Me={class:"row"},Ce={class:"col-5"},Re={class:"col-7"},Ae={class:"row"},Te={class:"col-5"},We={class:"col-7"},Le={class:"q-my-md"},Ee={class:"text-subtitle2 text-weight-bold"},Ie={class:"flex justify-end items-center"};function Ke(e,t,i,o,a,s){var r=(0,l.E1)("comments-component"),c=(0,l.E1)("q-scroll-area"),d=(0,l.E1)("q-btn");return(0,l.Wz)(),(0,l.An)("div",G,[(0,l.QD)("div",J,[(0,l.K2)(c,{style:{height:"calc(100vh - 173px)"},visible:"",class:"q-pa-md"},{default:(0,l.Ql)((function(){return[(0,l.QD)("div",X,[(0,l.QD)("div",null,[(0,l.QD)("span",Z,(0,n.WA)(e.row.title),1)]),(0,l.QD)("div",ee,[(0,l.QD)("span",te,(0,n.WA)(e.$tr("isite.cms.form.description"))+": ",1),(0,l.QD)("div",{class:"q-my-xs",innerHTML:e.row.description},null,8,ie)])]),(0,l.QD)("div",le,[(0,l.QD)("span",null,(0,n.WA)(e.$trd(e.row.updatedAt,{type:"long"})),1)]),(0,l.QD)("div",oe,[(0,l.K2)(r,{commentableId:Number(e.row.id),field:{type:"html"},commentableType:"Modules\\Itask\\Entities\\Task"},null,8,["commentableId"])])]})),_:1})]),(0,l.QD)("div",ne,[(0,l.QD)("div",ae,[(0,l.QD)("span",se,(0,n.WA)(e.$tr("isite.cms.details")),1),(0,l.QD)("div",re,[(0,l.QD)("div",ce,[(0,l.QD)("div",de,(0,n.WA)(e.$tr("isite.cms.form.category"))+" : ",1),(0,l.QD)("div",me,(0,n.WA)(e.row.category.title),1)]),(0,l.QD)("div",ue,[(0,l.QD)("div",fe,(0,n.WA)(e.$tr("isite.cms.form.status"))+" : ",1),(0,l.QD)("div",pe,(0,n.WA)(e.row.status.title),1)]),(0,l.QD)("div",he,[(0,l.QD)("div",ge,(0,n.WA)(e.$tr("itask.cms.form.priority"))+" : ",1),(0,l.QD)("div",be,(0,n.WA)(e.row.priority.title),1)]),(0,l.QD)("div",ve,[(0,l.QD)("div",ye,(0,n.WA)(e.$tr("itask.cms.form.assigned"))+": ",1),(0,l.QD)("div",we,(0,n.WA)(e.assignedTo),1)]),(0,l.QD)("div",De,[(0,l.QD)("div",Qe,(0,n.WA)(e.$tr("itask.cms.form.estimatedTime"))+": ",1),(0,l.QD)("div",ke,(0,n.WA)(e.row.formatedEstimatedTime),1)]),(0,l.QD)("div",$e,[(0,l.QD)("div",xe,(0,n.WA)(e.$tr("itask.cms.duration"))+": ",1),(0,l.QD)("div",qe,(0,n.WA)(e.row.duration),1)]),(0,l.QD)("div",Me,[(0,l.QD)("div",Ce,(0,n.WA)(e.$tr("isite.cms.form.startDate"))+": ",1),(0,l.QD)("div",Re,(0,n.WA)(e.row.startDate),1)]),(0,l.QD)("div",Ae,[(0,l.QD)("div",Te,(0,n.WA)(e.$tr("isite.cms.form.endDate"))+": ",1),(0,l.QD)("div",We,(0,n.WA)(e.row.endDate),1)])]),(0,l.QD)("div",Le,[(0,l.QD)("div",null,[(0,l.QD)("span",Ee,(0,n.WA)(e.$tr("itask.cms.timeLogs.title"))+": ",1)]),(0,l.QD)("div",null,[(0,l.K2)(d,{"text-color":"primary",unelevated:"","no-caps":"",rounded:"",label:"".concat(e.row.totalFormatedTimelogsDuration),onClick:t[0]||(t[0]=function(t){return e.$emit("openTimeLogsModal",e.row)})},null,8,["label"])])]),(0,l.QD)("div",Ie,[(0,l.K2)(d,{label:e.$tr("isite.cms.label.edit"),onClick:t[1]||(t[1]=function(){e.$emit("onUpdate",e.row),e.$emit("close")}),rounded:"","no-caps":"",unelevated:""},null,8,["label"]),(0,l.K2)(d,{label:e.$tr("isite.cms.label.delete"),onClick:t[2]||(t[2]=function(t){return e.$emit("onDelete",e.row)}),"no-caps":"",unelevated:"",class:"q-ml-sm"},null,8,["label"])])])])])}var _e={key:0,id:"comments"},Pe={class:"text-subtitle2 text-weight-bold q-my-md"},Se=["src"],ze={class:"row"},Oe={class:"col-10 flex justify-start items-center"},Ve={class:"col-2 flex justify-end"},Fe=["innerHTML"],Ne={key:0,class:"q-my-sm"},Be={class:"flex justify-end items-start"},Ue={class:"q-mt-md"};function Ye(e,t,i,a,s,r){var c=(0,l.E1)("q-avatar"),d=(0,l.E1)("q-item-section"),m=(0,l.E1)("btn-menu"),u=(0,l.E1)("q-item-label"),f=(0,l.E1)("dynamic-field"),p=(0,l.E1)("q-btn"),h=(0,l.E1)("q-item"),g=(0,l.E1)("q-list"),b=(0,l.E1)("inner-loading");return e.hasPermission.index?((0,l.Wz)(),(0,l.An)("div",_e,[(0,l.QD)("div",Pe,(0,n.WA)(e.$tc("isite.cms.form.comment",2)),1),e.comments.length?((0,l.Wz)(),(0,l.Az)(g,{key:0,separator:"",padding:""},{default:(0,l.Ql)((function(){return[((0,l.Wz)(!0),(0,l.An)(l.ae,null,(0,l.mi)(e.comments,(function(i,a){return(0,l.Wz)(),(0,l.Az)(h,{key:a},{default:(0,l.Ql)((function(){return[(0,l.K2)(d,{top:"",avatar:""},{default:(0,l.Ql)((function(){return[(0,l.K2)(c,null,{default:(0,l.Ql)((function(){return[(0,l.QD)("img",{src:"".concat(e.profileImage(i)),style:{width:"32px",height:"32px"}},null,8,Se)]})),_:2},1024)]})),_:2},1024),(0,l.K2)(d,null,{default:(0,l.Ql)((function(){return[(0,l.K2)(u,{caption:""},{default:(0,l.Ql)((function(){return[(0,l.QD)("div",ze,[(0,l.QD)("div",Oe,[(0,l.QD)("span",null,(0,n.WA)(e.createdBy(i)),1)]),(0,l.QD)("div",Ve,[(0,l.K2)(m,{actions:e.actions,"action-data":i},null,8,["actions","action-data"])])])]})),_:2},1024),(0,l.K2)(u,null,{default:(0,l.Ql)((function(){return[(0,l.K2)(o.Ox,{name:"slide-fade"},{default:(0,l.Ql)((function(){return[(null===i||void 0===i?void 0:i.edit)?((0,l.Wz)(),(0,l.Az)(f,{key:0,class:"q-my-md",modelValue:e.updateCommentModel,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.updateCommentModel=t}),field:e.field},null,8,["modelValue","field"])):(0,l.g1)("",!0)]})),_:2},1024),(null===i||void 0===i?void 0:i.edit)?(0,l.g1)("",!0):((0,l.Wz)(),(0,l.An)("div",{key:0,innerHTML:i.comment},null,8,Fe))]})),_:2},1024),(0,l.K2)(u,{caption:""},{default:(0,l.Ql)((function(){return[(null===i||void 0===i?void 0:i.edit)?(0,l.g1)("",!0):((0,l.Wz)(),(0,l.An)("div",Ne,(0,n.WA)(e.$trd(i.updatedAt,{type:"long"})),1))]})),_:2},1024),(null===i||void 0===i?void 0:i.edit)?((0,l.Wz)(),(0,l.Az)(u,{key:0,class:"q-mb-md"},{default:(0,l.Ql)((function(){return[(0,l.QD)("div",Be,[(0,l.K2)(p,{label:e.$tr("isite.cms.label.update"),"no-caps":"",unelevated:"",color:"primary",rounded:"",onClick:function(t){return e.updateComment(i)}},null,8,["label","onClick"]),(0,l.K2)(p,{label:e.$tr("isite.cms.label.cancel"),"no-caps":"",unelevated:"",rounded:"",class:"q-ml-sm",onClick:function(t){return e.resetEdit(i)}},null,8,["label","onClick"])])]})),_:2},1024)):(0,l.g1)("",!0)]})),_:2},1024)]})),_:2},1024)})),128))]})),_:1})):(0,l.g1)("",!0),(0,l.QD)("div",Ue,[e.hasPermission.create?((0,l.Wz)(),(0,l.Az)(f,{key:0,modelValue:e.newCommentModel,"onUpdate:modelValue":[t[1]||(t[1]=function(t){return e.newCommentModel=t}),t[2]||(t[2]=function(t){return e.resetEdit()})],class:"q-mb-md",field:e.field},null,8,["modelValue","field"])):(0,l.g1)("",!0),e.hasPermission.create?((0,l.Wz)(),(0,l.Az)(p,{key:1,label:e.$tr("isite.cms.label.save"),onClick:t[3]||(t[3]=function(t){return e.createComment()}),"no-caps":"",unelevated:"",rounded:"",color:"primary",disable:e.disableButton},null,8,["label","disable"])):(0,l.g1)("",!0)]),(0,l.K2)(b,{visible:e.loading},null,8,["visible"])])):(0,l.g1)("",!0)}var je="apiRoutes.qcomment.comments",He="icomments.comments";const Ge={getCommentsList:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t={}),new Promise((function(i,l){var o={refresh:e,params:t};C.c.index(je,o).then((function(e){i(e)})).catch((function(e){return l(e)}))}))},createComment:function(e,t){return void 0===t&&(t={}),new Promise((function(i,l){C.c.create(je,e,t).then((function(e){i(e)})).catch((function(e){return l(e)}))}))},showComment:function(e,t){return void 0===t&&(t={}),new Promise((function(i,l){C.c.show(je,e,{params:t,refresh:!0}).then((function(e){i(e)})).catch((function(e){return l(e)}))}))},updateComment:function(e,t,i){return void 0===i&&(i={params:{}}),new Promise((function(l,o){C.c.update(je,e,t,i).then((function(e){l(e)})).catch((function(e){return o(e)}))}))},deleteComment:function(e,t){return void 0===t&&(t={}),new Promise((function(i,l){C.c.delete(je,e,t).then((function(e){i(!0)})).catch((function(e){return l(e)}))}))}};var Je=i(33112),Xe=i.n(Je),Ze=function(){return Ze=Object.assign||function(e){for(var t,i=1,l=arguments.length;i<l;i++)for(var o in t=arguments[i],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Ze.apply(this,arguments)},et=function(e,t,i,l){function o(e){return e instanceof i?e:new i((function(t){t(e)}))}return new(i||(i=Promise))((function(i,n){function a(e){try{r(l.next(e))}catch(t){n(t)}}function s(e){try{r(l["throw"](e))}catch(t){n(t)}}function r(e){e.done?i(e.value):o(e.value).then(a,s)}r((l=l.apply(e,t||[])).next())}))},tt=function(e,t){var i,l,o,n,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(e){return function(t){return r([e,t])}}function r(s){if(i)throw new TypeError("Generator is already executing.");while(n&&(n=0,s[0]&&(a=0)),a)try{if(i=1,l&&(o=2&s[0]?l["return"]:s[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,s[1])).done)return o;switch(l=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,l=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(o=a.trys,!(o=o.length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(r){s=[6,r],l=0}finally{i=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};function it(e,t){(0,l._S)().appContext.config.globalProperties;var i={},o=(0,M.cB)({loading:!1,comments:[],newCommentModel:null,updateCommentModel:null}),n={hasPermission:(0,l.S6)((function(){return{create:A.is.hasAccess("".concat(He,".create")),index:A.is.hasAccess("".concat(He,".index")),edit:A.is.hasAccess("".concat(He,".edit")),destroy:A.is.hasAccess("".concat(He,".destroy"))}})),disableButton:(0,l.S6)((function(){return null==o.newCommentModel||""==o.newCommentModel})),paramsRequest:(0,l.S6)((function(){return{filter:{commentableType:e.commentableType,commentableId:e.commentableId},include:"userProfile"}})),actions:(0,l.S6)((function(){var e=[],t={icon:"fa-light fa-pencil",name:"edit",label:A._s.tr("isite.cms.label.edit"),action:function(e){a.editComment(e)}},i={icon:"fa-light fa-trash-can",name:"delete",label:A._s.tr("isite.cms.label.delete"),action:function(e){a.deleteComment(e)}};return n.hasPermission.value.edit&&e.push(t),n.hasPermission.value.destroy&&e.push(i),e}))},a={init:function(){n.hasPermission.value.index&&a.getCommentsList()},createdBy:function(e){var t;return(null===e||void 0===e?void 0:e.userProfile)?(null===(t=e.userProfile)||void 0===t?void 0:t.firstName)?"".concat(e.userProfile.firstName," ").concat(e.userProfile.lastName):e.userProfile.email:""},profileImage:function(e){var t,i;return(null===e||void 0===e?void 0:e.userProfile)&&(null===(t=e.userProfile)||void 0===t?void 0:t.mainImage)?null===(i=e.userProfile)||void 0===i?void 0:i.mainImage:Xe()},getCommentsList:function(){o.loading=!0,Ge.getCommentsList(!0,n.paramsRequest.value).then((function(e){o.loading=!1,(null===e||void 0===e?void 0:e.data)&&(o.comments=e.data,o.comments.forEach((function(e){e.edit=!1})))})).catch((function(e){o.loading=!1,console.log("error on getCommentsList: ".concat(e))}))},createComment:function(){o.loading=!0;var t={comment:o.newCommentModel,commentableType:e.commentableType,commentableId:e.commentableId};Ge.createComment(t).then((function(e){o.loading=!1,(null===e||void 0===e?void 0:e.data)&&(o.newCommentModel=null,a.getCommentsList())})).catch((function(e){o.loading=!1,console.log("error on createComment: ".concat(e))}))},resetEdit:function(){o.updateCommentModel=null,o.comments.forEach((function(e){e.edit=!1}))},editComment:function(e){a.resetEdit(),o.comments.find((function(t){t.id==e.id&&(t.edit=!0,o.updateCommentModel=t.comment)}))},updateComment:function(t){o.loading=!0;var i={comment:o.updateCommentModel,commentableType:e.commentableType,commentableId:e.commentableId};Ge.updateComment(t.id,i).then((function(e){(null===e||void 0===e?void 0:e.data)&&(o.updateCommentModel=null,Ge.showComment(t.id,n.paramsRequest.value).then((function(e){if(null===e||void 0===e?void 0:e.data){var i=o.comments.findIndex((function(e){return e.id==t.id}));o.comments[i]=e.data,o.comments[i]["edit"]=!1,o.loading=!1}})))})).catch((function(e){o.loading=!1,console.log("error on updateComment: ".concat(e))}))},deleteComment:function(e){var t=this;A.Qb.error({mode:"modal",title:"ID: ".concat(e.id),message:A._s.tr("isite.cms.message.deleteRecord"),actions:[{label:A._s.tr("isite.cms.label.cancel"),color:"grey"},{label:A._s.tr("isite.cms.label.delete"),color:"red",handler:function(){return et(t,void 0,void 0,(function(){return tt(this,(function(t){return o.loading=!0,Ge.deleteComment(e.id).then((function(e){a.getCommentsList(),o.loading=!1})),[2]}))}))}}]})}};return(0,l.u2)((function(){a.init()})),Ze(Ze(Ze(Ze(Ze({},i),(0,M.kx)(o)),n),a),{store:A.is})}const lt=(0,l._M)({props:{commentableId:{type:Number,required:!0},commentableType:{type:String},field:{default:{type:"input",props:{label:""}}}},components:{},setup:function(e,t){var i=t.emit;return it(e,i)}});var ot=i(11252);const nt=(0,P.c)(lt,[["render",Ye]]),at=nt;Y()(lt,"components",{QList:V.c,QItem:F.c,QItemSection:N.c,QAvatar:ot.c,QItemLabel:B.c,QBtn:S.c});const st=(0,l._M)({props:{row:{default:{}}},components:{commentsComponent:at},computed:{assignedTo:function(){var e,t;return this.row.assignedTo&&((null===(e=this.row.assignedTo)||void 0===e?void 0:e.firstName)||(null===(t=this.row.assignedTo)||void 0===t?void 0:t.lastName))?"".concat(this.row.assignedTo.firstName," ").concat(this.row.assignedTo.lastName):"-"}},methods:{}}),rt=(0,P.c)(st,[["render",Ke]]),ct=rt;Y()(st,"components",{QScrollArea:O.c,QBtn:S.c});const dt="YYYY/MM/DD",mt={props:{},components:{dynamicList:g.c,timeLogsComponent:H,taskComponent:ct},watch:{},mounted(){this.$nextTick((function(){}))},data(){return{selectedRow:{timeLogsModal:!1,showModal:!1,row:null},tabs:[{value:"table",label:"Table"},{value:"backlog",label:"Backlog"}],tabModel:"table",date:{from:W()().startOf("week").format(dt),to:W()().endOf("week").format(dt),title:this.$tr("itask.cms.week")},dateRangeFilter:{value:{type:"customRange",from:W()().startOf("week").format(dt),to:W()().endOf("week").format(dt)},type:"dateRange",props:{label:"Date",clearable:!1,removeTime:!0,autoClose:!0}},loading:!1,listConfig:{apiRoute:"apiRoutes.qtask.tasks",permission:"itask.tasks",pageActions:{extraActions:["search","new"]},read:{title:this.$tr("itask.cms.taskManagement"),tableProps:{dense:!0},columns:[{name:"id",label:this.$tr("isite.cms.form.id"),field:"id",style:"",onClick:(e,t)=>this.openShowModal(t)},{name:"title",label:this.$tr("isite.cms.form.title"),field:"title",align:"rigth",style:"max-width: 250px",onClick:(e,t)=>this.openShowModal(t)},{name:"category",label:this.$tr("isite.cms.form.category"),align:"left",field:"category",style:"max-width : 250px",format:e=>e&&e?.title?e.title:"-",dynamicField:{value:null,type:"select",name:"categoryId",props:{label:this.$tr("isite.cms.form.category"),useInput:!0,rules:[e=>!!e?.length||this.$tr("isite.cms.message.fieldRequired")]},loadOptions:{apiRoute:"apiRoutes.qtask.categories",select:{label:"title",id:e=>`${e.id}`}}}},{name:"assignedTo",label:this.$tr("itask.cms.form.assigned"),field:"assignedTo",align:"left",format:e=>e&&(e.firstName||e.lastName)?`${e.firstName} ${e.lastName}`:"-",dynamicField:{value:[],type:"select",name:"assignedToId",props:{label:this.$tr("itask.cms.form.assigned"),useInput:!0,clearable:!0,rules:[e=>!!e?.length||this.$tr("isite.cms.message.fieldRequired")]},loadOptions:{apiRoute:"apiRoutes.quser.users",select:{label:"email",id:e=>`${e.id}`}}}},{name:"startDate",label:this.$tr("isite.cms.form.startDate"),field:"startDate",align:"center",style:"padding: 0 5px",contentType:e=>({template:"date",props:{date:e.startDate,expirationDate:W()()}}),dynamicField:{value:"",type:"date",props:{label:this.$tr("isite.cms.form.startDate")}}},{name:"endDate",label:this.$tr("isite.cms.form.endDate"),field:"endDate",align:"center",style:"padding: 0 5px",contentType:e=>({template:"date",props:{date:e.endDate,expirationDate:W()()}}),dynamicField:{value:"",type:"date",props:{label:this.$tr("isite.cms.form.endDate")}}},{name:"duration",label:this.$tr("itask.cms.duration"),field:"duration",align:"left",format:e=>e||"-"},{name:"status",label:this.$tr("isite.cms.form.status"),field:"status",align:"center",style:"padding: 0 0 0 5px",contentType:e=>({template:"colorCell",props:{label:e.status.title,color:e.status.color,icon:e.status.icon}}),dynamicField:{type:"select",name:"statusId",props:{label:this.$tr("isite.cms.form.status"),useInput:!0,rules:[e=>!!e?.length||this.$tr("isite.cms.message.fieldRequired")]},loadOptions:{apiRoute:"apiRoutes.qtask.statuses",select:{label:"title",id:e=>`${e.id}`}}}},{name:"priority",label:this.$tr("itask.cms.form.priority"),field:"priority",align:"center",style:"padding: 0 5px 0 0",contentType:e=>({template:"colorCell",props:{label:e.priority.title,color:e.priority.color,icon:e.priority.icon}}),dynamicField:{value:[],type:"select",name:"priorityId",props:{label:this.$tr("itask.cms.form.priority"),useInput:!0,rules:[e=>!!e?.length||this.$tr("isite.cms.message.fieldRequired")]},loadOptions:{apiRoute:"apiRoutes.qtask.priorities",select:{label:"title",id:e=>`${e.id}`}}}},{name:"estimatedTime",label:this.$tr("itask.cms.form.estimatedTime"),field:"formatedEstimatedTime",align:"left",format:(e,t)=>t?.formatedEstimatedTime?t.formatedEstimatedTime:"-",dynamicField:{value:"",name:"estimatedTime",type:"timeSpent",props:{label:this.$tr("itask.cms.form.estimatedTime"),unit:"minutes"}}},{name:"totalFormatedTimelogsDuration",label:this.$tr("itask.cms.timeLogs.title"),field:"totalFormatedTimelogsDuration",align:"left",format:e=>e||"-",onClick:(e,t)=>{this.openTimeLogsModal(t)}},{name:"actions",label:this.$tr("isite.cms.form.actions"),align:"center"}],requestParams:{include:"category,status,priority,timelogs.creator,assignedTo",filter:{rangeDate:{from:W()().startOf("week").format(dt),to:W()().endOf("week").format(dt)}}},filters:{assignedToId:{value:[],type:"select",props:{label:this.$tr("itask.cms.form.assigned"),useInput:!0,clearable:!0,rules:[e=>!!e?.length||this.$tr("isite.cms.message.fieldRequired")]},loadOptions:{apiRoute:"apiRoutes.quser.users",select:{label:"email",id:e=>`${e.id}`},filterByQuery:!0}},categoryId:{value:[],type:"select",props:{label:this.$tr("isite.cms.form.category"),useInput:!0,clearable:!0,rules:[e=>!!e?.length||this.$tr("isite.cms.message.fieldRequired")]},loadOptions:{apiRoute:"apiRoutes.qtask.categories",filterByQuery:!0,select:{label:"title",id:e=>`${e.id}`}}},priorityId:{value:[],type:"select",props:{label:this.$tr("itask.cms.form.priority"),useInput:!0,clearable:!0,rules:[e=>!!e?.length||this.$tr("isite.cms.message.fieldRequired")]},loadOptions:{apiRoute:"apiRoutes.qtask.priorities",select:{label:"title",id:e=>`${e.id}`}}},statusId:{value:[],type:"select",props:{label:this.$tr("isite.cms.form.status"),useInput:!0,clearable:!0,rules:[e=>!!e?.length||this.$tr("isite.cms.message.fieldRequired")]},loadOptions:{apiRoute:"apiRoutes.qtask.statuses",select:{label:"title",id:e=>`${e.id}`}}}},help:{title:this.$tr("itask.cms.taskManagement"),description:this.$tr("itask.cms.taskManagement")}},beforeUpdate:({val:e,row:t})=>new Promise(((i,l)=>{""==t.description&&l(),W()(t.startDate).format(dt)>W()(t.endDate).format(dt)?(this.$alert.error({message:this.$tr("itask.cms.date.error")}),l()):i(e)})),actions:[{icon:"fa-light fa-timer",name:"addTimelog",label:this.$tr("itask.cms.timeLogs.title"),action:e=>{this.openTimeLogsModal(e)}},{icon:"fa-light fa-eye",name:"edit",label:this.$tr("isite.cms.label.show"),action:e=>{this.openShowModal(e)}},{icon:"fa-light fa-pencil",name:"edit",label:this.$tr("isite.cms.label.edit"),action:e=>{this.onUpdate(e)}},{icon:"fa-light fa-trash-can",name:"delete",label:this.$tr("isite.cms.label.delete"),action:e=>{this.onDelete(e)}}]}}},computed:{dynamicListTitle(){const e=W()(new Date(this.date.from)).format("MMM Do"),t=W()(new Date(this.date.to)).format("MMM Do");return`${this.date.title}:  ${e} - ${t}`}},methods:{init(){},setDate(e,t,i){this.date={from:e,to:t,title:i},this.dateRangeFilter.value={type:"customRange",from:e,to:t},this.listConfig.read.requestParams.filter["rangeDate"]=this.date,this.$refs.dynamicList.updateFilter("rangeDate",this.date),this.refreshDynamicList()},refreshDynamicList(){(this.selectedRow.showModal||this.selectedRow.timeLogsModal)&&(this.selectedRow.timeLogsModal=!1,this.selectedRow.showModal=!1,this.selectedRow.row=null),this.$refs.dynamicList.getData({page:1},!0)},goToPrevious(){const e=W()(new Date(this.date.from)).subtract(1,"weeks").startOf("week").format(dt),t=W()(new Date(this.date.from)).subtract(1,"weeks").endOf("week").format(dt),i=this.$tr("itask.cms.week");this.setDate(e,t,i)},goToNext(){const e=W()(new Date(this.date.from)).add(1,"weeks").startOf("week").format(dt),t=W()(new Date(this.date.to)).add(1,"weeks").endOf("week").format(dt),i=this.$tr("itask.cms.week");this.setDate(e,t,i)},setDateRange(e){if(null!=e&&e?.from&&e?.to){const t=W()(new Date(e.from)).format(dt),i=W()(new Date(e.to)).format(dt);t==this.date.from&&i==this.date.to||(this.setDate(t,i,e.label),this.$refs.titleModal.hide())}},openTimeLogsModal(e){this.selectedRow.row=e,this.selectedRow.timeLogsModal=!0},async reloadRow(e){const t=await this.$refs.dynamicList.reloadRow(e);this.selectedRow.row=t},openShowModal(e){this.selectedRow.row=e,this.selectedRow.showModal=!0},onUpdate(e){this.$refs.crudComponent.update(e)},onDelete(e){this.$refs.crudComponent.delete(e)}}};var ut=i(38788),ft=i(7628),pt=i(90111),ht=i(58120),gt=i(86742);const bt=(0,P.c)(mt,[["render",h]]),vt=bt;Y()(mt,"components",{QTabs:ut.c,QTab:ft.c,QBtn:S.c,QTooltip:pt.c,QIcon:ht.c,QPopupEdit:gt.c})}}]);