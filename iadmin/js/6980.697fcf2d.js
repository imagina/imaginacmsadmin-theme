"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[6980],{96980:(e,t,i)=>{i.r(t),i.d(t,{default:()=>q});var s=i(92444),n=i(74044);const a={id:"mySubscriptionsPage"},r={id:"content",class:"relative-position"},l={class:"box box-auto-height q-mb-md"},c={key:0,id:"otherPlans",class:"box box-auto-height"},o={class:"row q-col-gutter-md"},d={class:"plan-card"},p={class:"plan-card__name"},u=["innerHTML"],h={class:"plan-card__bottom row justify-between items-center"},m={class:"plan-card__price"},g={class:"plan-card__price text-caption"},b={key:0,class:"plan-card__label-current bg-green text-white q-pa-sm"},v={key:1,class:"box row items-center justify-center"};function $(e,t,i,$,D,f){const y=(0,s.E1)("page-actions"),_=(0,s.E1)("q-separator"),Q=(0,s.E1)("q-btn"),w=(0,s.E1)("not-result"),k=(0,s.E1)("inner-loading");return(0,s.Wz)(),(0,s.An)("div",a,[(0,s.QD)("div",r,[(0,s.QD)("div",l,[(0,s.K2)(y,{title:e.$tr(e.$route.meta.title),onRefresh:t[0]||(t[0]=e=>f.getData(!0))},null,8,["title"])]),D.plans.length?((0,s.Wz)(),(0,s.An)("div",c,[(0,s.QD)("div",o,[((0,s.Wz)(!0),(0,s.An)(s.ae,null,(0,s.mi)(f.plansData,((t,i)=>((0,s.Wz)(),(0,s.An)("div",{key:i,class:"col-12 col-md-4"},[(0,s.QD)("div",d,[(0,s.QD)("div",p,(0,n.WA)(t.name),1),(0,s.QD)("div",{class:"plan-card__description",innerHTML:t.description},null,8,u),(0,s.K2)(_,{inset:""}),(0,s.QD)("div",h,[(0,s.QD)("div",null,[(0,s.QD)("div",m,[(0,s.QD)("b",null,(0,n.WA)(t.priceFormat),1)]),(0,s.QD)("div",g,(0,n.WA)(t.frequency),1)]),(0,s.QD)("div",null,[t.current?((0,s.Wz)(),(0,s.An)("div",b," ยก"+(0,n.WA)(e.$tr("isite.cms.label.currentPlan"))+"! ",1)):((0,s.Wz)(),(0,s.Az)(Q,{key:1,label:e.$tr("isite.cms.label.select"),rounded:"",color:"green",unelevated:"",outline:"","no-caps":"",size:"12px",onClick:e=>f.buySubscription(t)},null,8,["label","onClick"]))])])])])))),128))])])):D.loading?(0,s.g1)("",!0):((0,s.Wz)(),(0,s.An)("div",v,[(0,s.K2)(w)])),(0,s.K2)(k,{visible:D.loading},null,8,["visible"])])])}const D={props:{},components:{},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,subscription:null,plans:[]}},computed:{plansData(){let e=this.$clone(this.plans),t=this.$clone(this.subscription);return e=e.map((e=>({id:e.id,name:e.name,description:e.description,price:e.product?.price||0,priceFormat:e.priceFormat,frequency:e.frequency}))),e.sort((function(e,t){return e.price>t.price?1:e.price<t.price?-1:0})),t&&t.planId&&this.$clone(e).forEach(((i,s)=>{parseInt(i.id)==parseInt(t.planId)&&e.unshift({...e.splice(s,1)[0],current:!0})})),e}},methods:{init(){this.getData()},async getData(e=!1){this.loading=!0,await Promise.all([this.getSubscription(e),this.getPlans(e)]),this.loading=!1},getSubscription(e=!1){return new Promise(((t,i)=>{let s=this.$store.state.quserAuth.userId,n={refresh:e,params:{filter:{field:"entity_id",entity:"Modules\\User\\Entities\\Sentinel\\User"}}};this.$crud.show("apiRoutes.qplan.subscriptions",s,n).then((e=>{this.subscription=e.data,t(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{t(e)}))}))}))},getPlans(e=!1){return new Promise(((t,i)=>{this.loading=!0;let s={refresh:e,params:{include:"product"}};this.$crud.index("apiRoutes.qplan.plans",s).then((e=>{this.plans=e.data,t(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{t(e)}))}))}))},buySubscription(e){return new Promise((t=>{this.loading=!0;let i={planId:e.id};this.$crud.create("apiRoutes.qplan.buy",i).then((e=>{this.$alert.info({message:`${this.$tr("isite.cms.message.recordCreated")}`}),this.getData(!0),e.data&&e.data.redirectTo&&this.$helper.openExternalURL(e.data.redirectTo,!0),this.loading=!1,t(e.data)})).catch((e=>{this.$alert.error({message:`${this.$tr("isite.cms.message.recordNoCreated")}`}),this.loading=!1,t(e)}))}))}}};var f=i(68716),y=i(70880),_=i(99140),Q=i(95252),w=i.n(Q);const k=(0,f.c)(D,[["render",$]]),q=k;w()(D,"components",{QSeparator:y.c,QBtn:_.c})}}]);