(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[996],{96230:(e,t,a)=>{"use strict";a.d(t,{A:()=>u});a(10239);var s=a(51143);class i{getMenu(e,t){const a=[];if(e&&t)return e.map((e=>{let s=t.find((({id:t})=>t==e.pageId));a.push({id:e.id,parentId:e.parentId,title:e.title,icon:e.icon,name:s?s.options.name:null,permission:s?s.options.permission:null,activated:!!parseInt(e.status)&&(!s||s.status)})})),s.A.builTree(a)}}const o=new i,l=o;var r=a(65375),n=a(46107);class c{constructor(){this.sidebar={},this.modules=r.A.modules,this.pages=n.A,this.addDefaultItems(),"iadmin"==r.A.mode&&this.loadModulesSidebar({name:"adminSidebar"}),"ipanel"==r.A.mode&&this.loadModulesSidebar({name:"panelSidebar"}),this.orderSidebar()}addDefaultItems(){this.pages.mainapp&&(this.sidebar["app"]=this.pages.mainapp.home||{})}loadModulesSidebar(e={}){this.modules.forEach((t=>{let s=!1;try{s=a(16453)(`./${t}/_config/${e.name}`).default}catch(i){}s&&s.length&&s.forEach(((e,a)=>{this.sidebar[`${t}${a?a+1:""}`]=e}))}));let t=!1;try{t=a(49607)(`./${e.name}`).default}catch(s){}t&&t.length&&t.forEach(((e,t)=>{this.sidebar[`${name}${t?t+1:""}`]=e}))}orderSidebar(){let e={},t={};Object.keys(this.sidebar).forEach((a=>{let s=this.sidebar[a];"app.home"==s.name||s.children?e[a]=s:t[a]=s})),this.sidebar={...e,...t}}}const d=new c,m=(d.sidebar,Object.values(d.sidebar)),u={created(){this.menu=l.getMenu(this.$clone(this.$store.getters["qsiteApp/getMenu"]),this.$clone(this.$store.state.qsiteApp.pages))},data(){return{menu:[],menuTranslatable:!1,menuLocal:m}},computed:{menuSelect(){return this.menuTranslatable=!0,this.menuTranslatable?this.menuLocal:this.menu}}}},17085:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var s=a(11824);function i(){var e=this.$route.meta&&this.$route.meta.title?this.$route.meta.title:"";this.$route.meta&&this.$route.meta.headerTitle&&(e=this.$route.meta.headerTitle);var t=this.$getSetting("core::site-name"),s=this.$getSetting("core::site-description"),i=this.$store.getters["qsiteApp/getSettingMediaByName"]("isite::favicon"),o=i.id?i.path:a(66689);return{title:"".concat(this.$tr(e)," | ").concat(t),meta:{description:{name:"description",content:s||t}},link:{icon:{rel:"icon",href:o}}}}const o=(0,s.A)(i)},38932:(e,t,a)=>{"use strict";a.d(t,{A:()=>o});var s=a(717),i=function(){return i=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++)for(var i in t=arguments[a],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)};const o={getNotifications:function(e){return new Promise((function(t,a){s.A.index("apiRoutes.qnotification.notifications",e).then((function(e){t(e)})).catch((function(e){console.log(e),t(e)}))}))},getSources:function(){return new Promise((function(e,t){var a={refresh:!0,params:{filter:{allTranslations:!0,configNameByModule:"config.notificationSource"}}};s.A.index("apiRoutes.qsite.configs",a).then((function(t){for(var a=[],s=0,o=Object.entries(t.data);s<o.length;s++){var l=o[s],r=l[0],n=l[1];null!=n&&(a=i(i({},a),t.data[r]))}e(a)})).catch((function(t){console.log(t),e(t)}))}))},markAllAsRead:function(){return new Promise((function(e,t){s.A.put("apiRoutes.qnotification.markAllAsRead",{}).then((function(t){e(t)})).catch((function(t){console.log(t),e(t)}))}))},markAsRead:function(e){return new Promise((function(t,a){s.A.update("apiRoutes.qnotification.markRead",e,{}).then((function(e){t(!0)})).catch((function(e){console.log(e),t(e)}))}))}}},85331:(e,t,a)=>{"use strict";a.d(t,{A:()=>b});var s=a(61758),i=a(58790);const o={class:"box"};function l(e,t,a,l,r,n){const c=(0,s.g2)("q-item-label"),d=(0,s.g2)("file-list"),m=(0,s.g2)("q-item-section"),u=(0,s.g2)("q-item"),p=(0,s.g2)("q-list"),h=(0,s.g2)("master-modal");return(0,s.uX)(),(0,s.Wv)(h,{modelValue:r.modal.show,"onUpdate:modelValue":t[0]||(t[0]=e=>r.modal.show=e),loading:r.modal.loading,title:r.modal.title,"custom-position":""},{default:(0,s.k6)((()=>[(0,s.Lk)("div",o,[(0,s.bF)(p,{separator:"",dense:""},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(r.modal.data,((e,t)=>((0,s.uX)(),(0,s.Wv)(u,{key:t,style:{padding:"8px 0"}},{default:(0,s.k6)((()=>[(0,s.bF)(m,null,{default:(0,s.k6)((()=>["media"!=e.fieldType?((0,s.uX)(),(0,s.Wv)(c,{key:0},{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(e.label),1)])),_:2},1024)):(0,s.Q3)("",!0),"media"==e.fieldType?((0,s.uX)(),(0,s.Wv)(c,{key:1},{default:(0,s.k6)((()=>[(0,s.bF)(d,{modelValue:e.value,"onUpdate:modelValue":t=>e.value=t,"grid-col-class":"col-12","hide-header":""},null,8,["modelValue","onUpdate:modelValue"])])),_:2},1024)):((0,s.uX)(),(0,s.Wv)(c,{key:2,caption:"",innerHTML:e.value},null,8,["innerHTML"]))])),_:2},1024)])),_:2},1024)))),128))])),_:1})])])),_:1},8,["modelValue","loading","title"])}a(10239);var r=a(15409);const n={components:{fileList:r.A},data(){return{modal:{loading:!1,show:!1,title:null,data:[]}}},computed:{},methods:{async showBidData(e){this.modal={title:`${this.$tr("iauctions.cms.bid")} Id: ${e.id}`,show:!0,data:[{label:this.$tr("iauctions.cms.auction"),value:e.auction.title},{label:this.$tr("isite.cms.label.provider"),value:e.provider?`${e.provider.firstName} ${e.provider.lastName}`:"-"},{label:this.$tr("isite.cms.form.status"),value:e.statusName},{label:this.$tr("isite.cms.label.amount"),value:this.$trn(e.amount)},{label:this.$tr("isite.cms.label.winner"),value:parseInt(e.winner)?this.$tr("isite.cms.label.yes"):this.$tr("isite.cms.label.no")},{label:this.$tr("iauctions.cms.description"),value:e.description},{label:this.$tr("isite.cms.form.createdAt"),value:this.$trd(e.createdAt,{type:"long"})},{label:this.$tr("isite.cms.form.updatedAt"),value:this.$trd(e.updatedAt,{type:"long"})}]};let t=!!(e.auction&&e.auction.category&&e.auction.category.bidFormId)&&e.auction.category.bidFormId;if(t){this.modal.loading=!0;let a={};e.fields.forEach((e=>a[e.name]=e.value));let s=this.$clone(e.files||[]),i={refresh:!0,params:{include:"fields"}};this.$crud.show("apiRoutes.qform.forms",t,i).then((e=>{this.$clone(e.data.fields).forEach((e=>{let t=e.dynamicField?.type||"input",i=a[this.$helper.convertStringToSnakeCase(e.name)],o="media"!=t?null:s.find((t=>t.zone==(e.dynamicField.props.zone||"mainimage")));this.modal.data.push({...e,label:e.label.replace("*",""),value:"media"!=t?null==i?"-":i:o?[{id:this.$uid(),...o,filename:e.label}]:[],fieldType:t})})),this.modal.loading=!1})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.modal.loading=!1}))}))}}}};var c=a(12807),d=a(54514),m=a(75329),u=a(63418),p=a(35779),h=a(98582),g=a.n(h);const f=(0,c.A)(n,[["render",l]]),b=f;g()(n,"components",{QList:d.A,QItem:m.A,QItemSection:u.A,QItemLabel:p.A})},33360:(e,t,a)=>{"use strict";a.d(t,{A:()=>w});var s=a(61758),i=a(58790);const o={key:0,class:"row relative-position"},l={class:"col-12 q-mb-md"},r={key:0,class:"col-7 q-gutter-y-md"},n={key:1,class:"col-5 q-gutter-y-md"},c={class:"input-title"},d={class:"col-12 text-right"};function m(e,t,a,m,u,p){const h=(0,s.g2)("locales"),g=(0,s.g2)("q-input"),f=(0,s.g2)("q-editor"),b=(0,s.g2)("q-select"),v=(0,s.g2)("mediaForm"),y=(0,s.g2)("q-btn"),$=(0,s.g2)("q-form"),k=(0,s.g2)("inner-loading");return u.success?((0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",l,[(0,s.bF)(h,{modelValue:u.locale,"onUpdate:modelValue":t[0]||(t[0]=e=>u.locale=e),ref:"localeComponent",form:e.$refs.formContent},null,8,["modelValue","form"])]),(0,s.bF)($,{onSubmit:t[12]||(t[12]=e=>u.itemId?p.updateItem():p.createItem()),ref:"formContent",class:"row q-col-gutter-x-md full-width",autocomplete:"off",onValidationError:t[13]||(t[13]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,s.k6)((()=>[u.locale.success?((0,s.uX)(),(0,s.CE)("div",r,[(0,s.bF)(g,{label:`${e.$tr("isite.cms.form.title")} (${u.locale.language}) `,type:"text",modelValue:u.locale.formTemplate.title,"onUpdate:modelValue":t[1]||(t[1]=e=>u.locale.formTemplate.title=e),outlined:"",dense:""},null,8,["label","modelValue"]),(0,s.bF)(g,{label:`${e.$tr("isite.cms.form.caption")} (${u.locale.language}) `,type:"text",outlined:"",dense:"",modelValue:u.locale.formTemplate.caption,"onUpdate:modelValue":t[2]||(t[2]=e=>u.locale.formTemplate.caption=e)},null,8,["label","modelValue"]),(0,s.bF)(g,{label:"URI ("+u.locale.language+")",outlined:"",dense:"",type:"text",modelValue:u.locale.formTemplate.uri,"onUpdate:modelValue":t[3]||(t[3]=e=>u.locale.formTemplate.uri=e)},null,8,["label","modelValue"]),(0,s.bF)(g,{label:"URL ("+u.locale.language+")",type:"text",modelValue:u.locale.formTemplate.url,"onUpdate:modelValue":t[4]||(t[4]=e=>u.locale.formTemplate.url=e),outlined:"",dense:""},null,8,["label","modelValue"]),(0,s.bF)(g,{label:`${e.$tr("isite.cms.form.image")} URL (${u.locale.language}) `,type:"text",outlined:"",dense:"",modelValue:u.locale.formTemplate.externalImageUrl,"onUpdate:modelValue":t[5]||(t[5]=e=>u.locale.formTemplate.externalImageUrl=e)},null,8,["label","modelValue"]),(0,s.bF)(f,{label:`${e.$tr("isite.cms.form.description")} (${u.locale.language}) `,modelValue:u.locale.formTemplate.customHtml,"onUpdate:modelValue":t[6]||(t[6]=e=>u.locale.formTemplate.customHtml=e),style:{width:"100%"}},null,8,["label","modelValue"])])):(0,s.Q3)("",!0),u.locale.success?((0,s.uX)(),(0,s.CE)("div",n,[p.canManageRecordMaster?((0,s.uX)(),(0,s.Wv)(b,{key:0,modelValue:u.locale.formTemplate.options.masterRecord,"onUpdate:modelValue":t[7]||(t[7]=e=>u.locale.formTemplate.options.masterRecord=e),label:e.$tr("isite.cms.form.masterRecord"),outlined:"",dense:"","emit-value":"","map-options":"",options:[{label:this.$tr("isite.cms.label.yes"),value:1},{label:this.$tr("isite.cms.label.no"),value:0}]},null,8,["modelValue","label","options"])):(0,s.Q3)("",!0),(0,s.bF)(b,{label:`${e.$tr("isite.cms.form.status")} (${u.locale.language})`,modelValue:u.locale.formTemplate.active,"onUpdate:modelValue":t[8]||(t[8]=e=>u.locale.formTemplate.active=e),outlined:"",dense:"","emit-value":"","map-options":"",options:[{label:e.$tr("isite.cms.label.enabled"),value:!0},{label:e.$tr("isite.cms.label.disabled"),value:!1}]},null,8,["label","modelValue","options"]),(0,s.bF)(b,{label:`${e.$tr("isite.cms.form.option")}`,modelValue:u.locale.formTemplate.target,"onUpdate:modelValue":t[9]||(t[9]=e=>u.locale.formTemplate.target=e),"emit-value":"","map-options":"",outlined:"",dense:"",options:[{value:"_self",label:"Same tab"},{value:"_blank",label:"New tab"}]},null,8,["label","modelValue"]),(0,s.bF)(b,{label:`${e.$tr("isite.cms.form.type")}`,modelValue:u.locale.formTemplate.type,"onUpdate:modelValue":t[10]||(t[10]=e=>u.locale.formTemplate.type=e),"emit-value":"","map-options":"",outlined:"",dense:"",options:[{value:"auto",label:"Auto"},{value:"360",label:"360"},{value:"video",label:"Video"},{value:"image",label:"Image"}]},null,8,["label","modelValue"]),(0,s.Lk)("div",c,(0,i.v_)(`${e.$tr("isite.cms.form.image")}`),1),((0,s.uX)(),(0,s.Wv)(v,{entity:"Modules\\Slider\\Entities\\Slide","entity-id":u.itemId?u.itemId:"",modelValue:u.locale.formTemplate.mediasSingle,"onUpdate:modelValue":t[11]||(t[11]=e=>u.locale.formTemplate.mediasSingle=e),zone:"slideimage",key:u.mediaKey},null,8,["entity-id","modelValue"]))])):(0,s.Q3)("",!0),(0,s.Lk)("div",d,[u.itemId?((0,s.uX)(),(0,s.Wv)(y,{key:0,color:"green",loading:u.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.update"),type:"submit",rounded:""},null,8,["loading","label"])):((0,s.uX)(),(0,s.Wv)(y,{key:1,color:"green",loading:u.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.create"),type:"submit",rounded:""},null,8,["loading","label"]))])])),_:1},512),(0,s.bF)(k,{visible:u.loading},null,8,["visible"])])):(0,s.Q3)("",!0)}a(10239);var u=a(99205);const p={components:{mediaForm:u.A},watch:{$route(e,t){this.initForm()}},mounted(){this.$nextTick((()=>{this.initForm()}))},data(){return{locale:{},loading:!1,success:!1,itemId:!1,mediaKey:this.$uid()}},computed:{dataLocale(){return{fields:{positionId:this.$route.params.positionId,target:null,type:"auto",mediasSingle:{},externalImageUrl:"",options:{masterRecord:0}},fieldsTranslatable:{title:"",caption:"",active:!0,url:"",uri:"",customHtml:""}}},canManageRecordMaster(){let e=!0;return this.$route.params.positionId.id&&!this.$hasAccess("isite.master.records.edit")&&(e=!1),this.$route.params.positionId.id||this.$hasAccess("isite.master.records.create")||(e=!1),e}},methods:{async initForm(){this.loading=!0,this.success=!1,this.locale=this.$clone(this.dataLocale),this.itemId=this.$route.params.id,this.locale.success&&this.$refs.localeComponent.vReset(),await this.getData(),this.success=!0,this.loading=!1},getData(){return new Promise(((e,t)=>{const a=this.$clone(this.itemId);if(a){let s="apiRoutes.qbanner.banners",i={refresh:!0,params:{filter:{allTranslations:!0}}};this.$crud.show(s,a,i).then((t=>{this.orderDataItemToLocale(t.data),e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1,t(!1)}))}))}else e(!0)}))},orderDataItemToLocale(e){let t=this.$clone(e);this.locale.form=this.$clone(t)},async createItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qbanner.banners";this.$crud.create(e,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordCreated")} ID: ${e.data.id}`}),this.$router.push({name:"qbanner.admin.sliders.show",params:{id:this.$route.params.positionId}}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoCreated"),pos:"bottom"})}))}},async updateItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qbanner.banners";this.$crud.update(e,this.itemId,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},getDataForm(){let e=this.locale.form;for(var t in e){let a=e[t];null!=a&&void 0!=a||delete e[t]}return e.selectable=JSON.stringify(e.selectable),e}}};var h=a(12807),g=a(21565),f=a(78020),b=a(94192),v=a(833),y=a(69001),$=a(98582),k=a.n($);const I=(0,h.A)(p,[["render",m]]),w=I;k()(p,"components",{QForm:g.A,QInput:f.A,QEditor:b.A,QSelect:v.A,QBtn:y.A})},78319:(e,t,a)=>{"use strict";a.d(t,{A:()=>Q});var s=a(61758),i=a(58790);const o={id:"advanceChatComponent"},l={id:"advanceChatComponentContent",class:"relative-position"},r={class:"row"},n={style:{width:"300px"}},c={class:"row q-pa-sm justify-between"},d=(0,s.Lk)("label",{class:"text-h5 cursor-pointer"},"+",-1),m={key:0,class:"row justify-center q-my-md"},u=["src"],p={class:"row justify-center q-my-md"},h={class:"col"},g=["room-id","rooms","messages","height","current-user-id","load-first-room","username-options","menu-actions","messages-loaded","message-actions","show-add-room","show-reaction-emojis","scroll-distance","single-room","accepted-files"];function f(e,t,a,f,b,v){const y=(0,s.g2)("dynamic-field"),$=(0,s.g2)("q-btn"),k=(0,s.g2)("q-spinner-dots"),I=(0,s.g2)("q-avatar"),w=(0,s.g2)("q-item-section"),q=(0,s.g2)("q-item-label"),C=(0,s.g2)("q-icon"),F=(0,s.g2)("q-badge"),A=(0,s.g2)("q-item"),T=(0,s.g2)("q-infinite-scroll"),x=(0,s.g2)("dynamic-form"),V=(0,s.g2)("master-modal");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",l,[(0,s.Lk)("div",r,[(0,s.Lk)("div",n,[(0,s.Lk)("div",c,[(0,s.bF)(y,{modelValue:b.roomsPagination.search,"onUpdate:modelValue":[t[0]||(t[0]=e=>b.roomsPagination.search=e),v.handleSearch],field:v.dynamicfields.search},null,8,["modelValue","field","onUpdate:modelValue"]),(0,s.bF)($,{color:"primary",round:"",unelevated:"",onClick:t[1]||(t[1]=e=>b.modalNewRoom.show=!0)},{default:(0,s.k6)((()=>[d])),_:1})]),(0,s.Lk)("div",{ref:"listRoomsContent",style:(0,i.Tr)(`max-height: calc(${a.height} - 58px); overflow-y: scroll`)},[!v.rooms.length&&b.loading.rooms?((0,s.uX)(),(0,s.CE)("div",m,[(0,s.bF)(k,{color:"primary",size:"40px"})])):(0,s.Q3)("",!0),(0,s.bF)(T,{onLoad:t[2]||(t[2]=(e,t)=>v.getRooms({index:e,done:t})),offset:50,"scroll-target":e.$refs.listRoomsContent,ref:"infiniteScroll",debounce:"300"},{loading:(0,s.k6)((()=>[(0,s.Lk)("div",p,[(0,s.bF)(k,{color:"primary",size:"40px"})])])),default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(v.rooms,((e,t)=>((0,s.uX)(),(0,s.Wv)(A,{key:t,class:"q-pl-sm",clickable:"",onClick:t=>b.openRoomId=e.roomId,focused:b.openRoomId==e.roomId},{default:(0,s.k6)((()=>[(0,s.bF)(w,{top:"",avatar:"",class:"q-pr-sm",style:{"min-width":"48px","max-width":"48px"}},{default:(0,s.k6)((()=>[(0,s.bF)(I,null,{default:(0,s.k6)((()=>[(0,s.Lk)("img",{src:e.avatar},null,8,u)])),_:2},1024)])),_:2},1024),(0,s.bF)(w,null,{default:(0,s.k6)((()=>[(0,s.bF)(q,{class:"text-body2 text-blue-grey text-weight-bold",lines:"1"},{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(e.roomName),1)])),_:2},1024),e.phone?((0,s.uX)(),(0,s.Wv)(q,{key:0,caption:"",class:"text-blue-grey"},{default:(0,s.k6)((()=>[(0,s.bF)(C,{name:"fa-light fa-phone",class:"q-mr-xs"}),(0,s.eW)(" "+(0,i.v_)(e.phone),1)])),_:2},1024)):(0,s.Q3)("",!0),(0,s.bF)(q,{caption:"",lines:"1"},{default:(0,s.k6)((()=>[(0,s.bF)(C,{name:"fa-light fa-message",class:"q-mr-xs"}),(0,s.eW)(" "+(0,i.v_)(e.lastMessage.content),1)])),_:2},1024)])),_:2},1024),(0,s.bF)(w,{side:"",top:""},{default:(0,s.k6)((()=>[(0,s.bF)(q,{caption:""},{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(e.lastMessage.timestamp),1)])),_:2},1024),e.unreadCount?((0,s.uX)(),(0,s.Wv)(F,{key:0,color:"primary",class:"q-mt-sm","text-color":"white",label:e.unreadCount},null,8,["label"])):(0,s.Q3)("",!0)])),_:2},1024)])),_:2},1032,["onClick","focused"])))),128))])),_:1},8,["scroll-target"])],4)]),(0,s.Lk)("div",h,[(0,s.Lk)("vue-advanced-chat",{"room-id":b.openRoomId,rooms:v.rooms,messages:v.messages,height:v.chatProps["height"],"current-user-id":v.chatProps["current-user-id"],"rooms-loaded":!0,"load-first-room":v.chatProps["load-first-room"],"username-options":v.chatProps["username-options"],"menu-actions":v.chatProps["menu-actions"],"messages-loaded":v.chatProps["messages-loaded"],"message-actions":v.chatProps["message-actions"],"show-add-room":v.chatProps["show-add-room"],"show-reaction-emojis":v.chatProps["show-reaction-emojis"],"scroll-distance":v.chatProps["scroll-distance"],"single-room":v.chatProps["single-room"],"accepted-files":v.chatProps["accepted-files"],onSendMessage:t[3]||(t[3]=e=>v.sendMessage(e.detail[0])),onAddRoom:t[4]||(t[4]=e=>b.modalNewRoom.show=!0),onMenuActionHandler:t[5]||(t[5]=(...e)=>v.menuActionHandler&&v.menuActionHandler(...e)),onOpenFile:t[6]||(t[6]=({message:t})=>e.$helper.openExternalURL(t.files[0].url,!0)),onFetchMessages:t[7]||(t[7]=e=>v.getMessages(e.detail[0])),onFetchMoreRooms:t[8]||(t[8]=e=>v.getRooms(e.detail[0])),onOpenFailedMessage:t[9]||(t[9]=(...e)=>v.showError&&v.showError(...e))},null,40,g)])]),(0,s.bF)(V,{modelValue:b.modalNewRoom.show,"onUpdate:modelValue":t[12]||(t[12]=e=>b.modalNewRoom.show=e),loading:b.modalNewRoom.loading,title:`${e.$tr("isite.cms.label.new")} ${e.$tr("isite.cms.label.chat")}`},{default:(0,s.k6)((()=>[(0,s.Lk)("div",null,[(0,s.bF)(y,{modelValue:b.newRoom.type,"onUpdate:modelValue":t[10]||(t[10]=e=>b.newRoom.type=e),field:v.fieldsToNewRooms.type},null,8,["modelValue","field"]),v.fieldsToNewRooms.blocks[b.newRoom.type]?((0,s.uX)(),(0,s.Wv)(x,{key:0,modelValue:b.newRoom.form,"onUpdate:modelValue":t[11]||(t[11]=e=>b.newRoom.form=e),blocks:v.fieldsToNewRooms.blocks[b.newRoom.type],"default-col-class":"col-12",onSubmit:v.createRoom},null,8,["modelValue","blocks","onSubmit"])):(0,s.Q3)("",!0)])])),_:1},8,["modelValue","loading","title"])])])}a(10239);var b=a(8683),v=a(71915);const y={beforeUnmount(){v.Bt.off("inotification.chat.message")},props:{accept:{default:".pdf, .xlsx, .docx, .pptx, .mp4, .mp3, .jpg, image/*"},roomId:{default:!1},roomsId:{default:!1},allowCreateChat:{default:!1},allowProviders:{type:Boolean,defualt:!1},height:{default:"600px"},advancedProps:{default:!1},loadRooms:{default:!0}},emits:["room-opened"],watch:{roomId(){this.getRooms()},roomsId(){this.getRooms()},openRoomId(e){this.$emit("room-opened",e)}},mounted(){this.$nextTick((function(){this.init()}))},data(){return{conversations:[],conversationMessages:[],openRoomId:null,chatPagination:{page:0,perPage:50,lastPage:-1},loading:{rooms:!1,messages:!1},search:{userId:null,userList:[]},modalNewRoom:{show:!1,loading:!1},newRoom:{type:"user",form:{userId:null,providerType:null,providerId:null,firstName:null,lastName:null}},providers:{whatsapp:{image:`${this.$store.state.qsiteApp.baseUrl}/modules/isite/img/logos/whatsapp.jpg`}},roomsPagination:{search:null,page:0,perPage:20,total:0}}},computed:{acceptFiles(){if("images"==this.accept)return".jpg, image/*";if("documents"==this.accept)return".pdf, .xlsx, .docx, .pptx";if("media"==this.accept)return".mp4, .mp3, .jpg, image/*";let e=this.$store.state.qsiteApp.configs.Media;return this.$clone(e?e["allowed-types"]:this.accept)},chatProps(){let e={"current-user-id":this.$store.state.quserAuth.userId,"loading-rooms":this.loading.rooms,"rooms-loaded":!0,"show-reaction-emojis":!1,"messages-loaded":this.chatPagination.page==this.chatPagination.lastPage,"load-first-room":!1,"single-room":!0,"show-add-room":this.allowCreateChat,"message-actions":JSON.stringify([{name:"replyMessage",title:"Reply"}]),"accepted-files":this.acceptFiles,height:this.height,"menu-actions":[],"username-options":JSON.stringify({minUsers:1,currentUser:!1}),"scroll-distance":10,...this.advancedProps||{}};return e},rooms(){let e=[],t=this.$clone(this.conversations);return t.sort(((e,t)=>new Date(t.updatedAt)-new Date(e.updatedAt))),t.forEach((t=>{var a=t?.userConversation?.mainImage;Object.keys(this.providers).includes(t.entityType)&&a.includes("default.")&&(a=this.providers[t.providerType].image);let s={roomId:t.id.toString(),roomName:this.conversationExternalData(t).title,avatar:a,unreadCount:t.unreadMessagesCount||!1,messageActions:!1,phone:"whatsapp"==t.entityType?t.entityId:null,lastMessage:!!t.lastMessage&&{content:t.lastMessage.body||"",senderId:t.lastMessage.userId,timestamp:this.$date.getHumanCalendar(t.updatedAt)},users:t.users.map((e=>({_id:e.id,username:e.fullName,avatar:e?.mainImage,status:{lastChanged:!!Object.keys(this.providers).includes(t.entityType)&&`(${t.entityType})`}})))};e.push(s)})),this.$clone(e)},messages(){let e=[],t=this.$clone(this.conversationMessages).reverse(),a=t.length?this.conversations.find((e=>e.id==t[0].conversationId)):null,s=a?this.conversationExternalData(a).externalUsers.map((e=>e.id)):[],i=s.includes(this.$store.state.quserAuth.userId)?"external":"internal";return t.forEach((t=>{if(!e.find((e=>e._id==t.id))){let o=s.includes(t.user.id)?"external":"internal",l=!!a&&o==i;if(t.replyTo&&(t.replyMessage={_id:t.replyTo.id,content:t.replyTo.body||"",sender_id:t.replyTo.userId,file:!!t.replyTo.attachment&&{name:t.replyTo.attachment.filename,size:t.replyTo.attachment.filesize,type:t.replyTo.attachment.mimetype,extension:`.${t.replyTo.attachment.extension}`,url:t.replyTo.attachment.path,audio:"mp3"==t.replyTo.attachment.extension}}),t.attachment&&(t.file={id:t.attached,name:t.attachment.filename,size:t.attachment.filesize,type:t.attachment.mimetype,extension:`.${t.attachment.extension}`,url:t.attachment.path,audio:"mp3"==t.attachment.extension}),t.status>=5){let a={_id:t.id+"_",content:t.statusName||"",date:this.$trd(t.createdAt),senderId:l?this.$store.state.quserAuth.userId:t.user.id,system:!0,frontId:t.frontId||!1};e.push(a)}let r="";t.status&&(r=t.status<5?t.statusName:"No enviado");let n={_id:t.id,content:t.body||"",senderId:l?this.$store.state.quserAuth.userId:t.user.id,username:t.user.fullName,avatar:t.user?.mainImage,date:this.$trd(t.createdAt),failure:t.status>=5,timestamp:`${r} ${this.$trd(t.createdAt,{type:"time"})}`,files:t.file?Array.isArray(t.file)?t.file:[t.file]:[],replyMessage:t.replyMessage||!1,seen:3===t.status,errorMessage:t.status>=5?t.statusName:"",frontId:t.frontId||!1};e.push(n)}})),this.$clone(e)},fieldsToNewRooms(){return{type:{value:"user",type:"select",props:{label:this.$tr("isite.cms.form.type"),vIf:this.allowProviders,options:[{label:this.$tr("isite.cms.label.user"),value:"user"},{label:this.$tr("isite.cms.label.provider"),value:"provider"}]}},blocks:{user:[{fields:{userId:{value:null,type:"select",required:!0,props:{label:this.$tr("isite.cms.label.user")+"*"},loadOptions:{apiRoute:"apiRoutes.quser.users",select:{label:"fullName",id:"id"},filterByQuery:!0}}}}],provider:[{fields:{providerType:{value:null,type:"select",required:!0,props:{label:this.$tr("isite.cms.label.provider")+"*"},loadOptions:{delayed:()=>new Promise((e=>{this.$crud.index("apiRoutes.qnotification.providers",{refresh:!0}).then((t=>{e(t.data.filter((e=>{if(e.data&&parseInt(e.data.status||"0")&&parseInt(e.data.fields?.canCreateConversation||"0"))return e})).map((e=>({label:e.name,value:e.systemName}))))})).catch((t=>{this.$apiResponse.handleError(t,(()=>{e([])}))}))}))}},providerId:{value:null,type:"input",required:!0,props:{label:this.$tr("isite.cms.label.contact")+"*"}},firstName:{value:null,type:"input",props:{label:this.$tr("isite.cms.form.firstName")}},lastName:{value:null,type:"input",props:{label:this.$tr("isite.cms.form.lastName")}}}}]}}},dynamicfields(){return{search:{type:"search",props:{icon:null,clearable:!1}}}}},methods:{init(){(0,b.k)(),this.listenEvents(),this.getRooms()},listenEvents(){v.Bt.on("inotification.chat.message",(e=>{e.data&&this.pushMessage(e.data)}))},getRooms(e={}){return new Promise(((t,a)=>{if(this.loadRooms){e={index:1,done:null,search:null,roomId:this.roomsId,...e},this.loading.rooms=!0,this.rooms.map((e=>e.roomId)).includes(this.openRoomId)||(this.openRoomId=null);let a={refresh:!0,params:{include:"users,lastMessage,conversationUsers",filter:{ids:this.$clone(this.roomsId)}}};e.roomId?this.$crud.show("apiRoutes.qchat.conversations",e.roomId,a).then((e=>{this.orderConversationData([e.data]),this.openRoomId=this.conversations[0].id,this.loading.rooms=!1,t(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.loading.rooms=!1,t(e)}))})):1==e.index||this.conversations.length<this.roomsPagination.total?(a.params={...a.params,page:e.search?1:e.index,take:this.roomsPagination.perPage,filter:{...a.params.filter,search:this.roomsPagination.search}},this.$crud.index("apiRoutes.qchat.conversations",a).then((a=>{this.orderConversationData(a.data,1!=a.meta.page.currentPage),this.roomsPagination.total=a.meta.page.total,this.roomsPagination.page=a.meta.page.currentPage,this.loading.rooms=!1,this.openRoomFromUrl(),t(a.data),e.done&&e.done()})).catch((a=>{this.$apiResponse.handleError(a,(()=>{this.loading.rooms=!1,t(a),e.done&&e.done()}))}))):this.$refs.infiniteScroll.stop()}}))},orderConversationData(e,t=!0){e.forEach((e=>{e.userConversation={...e.conversationUsers.find((e=>e.userId!=this.$store.state.quserAuth.userId)),...e.users.find((e=>e.id!=this.$store.state.quserAuth.userId))},e.authUserConversation={...e.conversationUsers.find((e=>e.userId==this.$store.state.quserAuth.userId)),...e.users.find((e=>e.id==this.$store.state.quserAuth.userId))},e.unreadMessagesCount=parseInt(e.authUserConversation.unreadMessagesCount)})),t&&(e=this.$array.mergeUniqueBy([...this.conversations,...e],"id")),this.conversations=e},getMessages({options:e}){return new Promise(((t,a)=>{this.loading.messages=!0,e&&e.reset&&(this.conversationMessages=[],this.chatPagination.page=0,this.chatPagination.lastPage=-1);let s=this.openRoomId,i=this.conversations.findIndex((e=>e.id==s));this.conversations[i].unreadMessagesCount=!1;let o={refresh:!0,params:{page:this.chatPagination.page+1,take:this.chatPagination.perPage,filter:{conversationId:s},include:"user,replyTo"}};this.$crud.index("apiRoutes.qchat.messages",o).then((a=>{e&&e.reset&&(this.conversationMessages=[]),this.conversationMessages=this.$clone([...this.conversationMessages,...a.data]),this.chatPagination.lastPage=a.meta.page.lastPage,this.chatPagination.page=a.meta.page.currentPage,this.loading.messages=!1,t(a.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.loading.messages=!1,t(e)}))}))}))},sendMessage({content:e,roomId:t,files:a,replyMessage:s}){return new Promise((async(i,o)=>{if(a)a.forEach(((s,i)=>{let o={body:i==a.length-1?e:"",frontId:this.$uid(),file:{name:s.name,size:s.size,type:s.extension||s.type,extension:`.${s.extension||s.type}`,url:s.url||s.localUrl,audio:!!s.audio,duration:s.duration||0}};this.pushMessage(o),this.uploadMessage({...o,roomId:t,file:{...o.file,blob:s.blob}})}));else{let a={body:e,frontId:this.$uid(),...s?{replyMessage:s}:{}};this.pushMessage(a),this.uploadMessage({...a,roomId:t})}}))},uploadMessage(e){return new Promise((async(t,a)=>{let s={frontId:e.frontId,conversationId:e.roomId,body:e.body||"",userId:this.$store.state.quserAuth.userId,replyToId:e.replyMessage?e.replyMessage._id:null};if(e.attached&&(s.mediasSingle={attachment:e.attached},s.attached=e.attached),e.file){let{file:t}=e,a=await this.$helper.getBase64(t.blob),i=await this.$helper.urlToFile(a,t.audio?t.name:`${t.name}.${t.extension}`,t.type),o=new FormData;o.append("parent_id",0),o.append("file",i),o.append("disk","privatemedia");let l=await this.$crud.post("apiRoutes.qmedia.files",o);l&&l.data&&(s.mediasSingle={attachment:l.data.id},s.attached=l.data.id)}this.$crud.create("apiRoutes.qchat.messages",s).then((e=>{let a=this.conversationMessages.findIndex((t=>t.frontId==e.data.frontId));-1!=a&&(this.conversationMessages[a].id=e.data.id,this.conversationMessages[a].attachment=e.data.attachment||!1),t(e)})).catch((e=>a(e)))}))},pushMessage(e){let t=e.conversation?e.conversation.id:this.openRoomId,a=!!t&&this.conversations.findIndex((e=>e.id==t)),s=a>=0&&this.conversations[a],i={id:this.$uid(),user:e.userId&&s?s.users.find((t=>t.id==e.userId)):this.$store.state.quserAuth.userData,createdAt:this.$moment().format("YYYY-MM-DD HH:mm:ss"),updatedAt:this.$moment().format("YYYY-MM-DD HH:mm:ss"),...e};!s&&e.conversation&&this.orderConversationData([...this.conversations,{...e.conversation,lastMessage:i}]),s&&(this.conversations[a].updatedAt=this.$moment().format("YYYY-MM-DD HH:mm:ss"),this.conversations[a].lastMessage=i,e.conversation&&e.conversation.id!=this.openRoomId&&(this.conversations[a].unreadMessagesCount+=1)),e.conversation&&e.conversation.id!=this.openRoomId||this.conversationMessages.unshift(i),this.playSound(e)},playSound(e){e.conversation&&e.conversation.id!=this.openRoomId?this.$helper.playSound({url:`${this.$store.state.qsiteApp.baseUrl}/modules/ichat/audio/sound_chat_notification.mp3`}):e.userId&&e.userId!=this.$store.state.quserAuth.userId&&this.$helper.playSound({url:`${this.$store.state.qsiteApp.baseUrl}/modules/ichat/audio/sound_message_notification.mp3`,volume:.2})},createRoom(){return new Promise(((e,t)=>{let a=null,s=null;if("user"==this.newRoom.type&&this.newRoom.form.userId){const i=this.newRoom.form.userId;if(i==this.chatProps["current-user-id"])return this.modalNewRoom.loading=!1,this.$alert.error(this.$tr("isite.cms.message.errorRequest")),t(!1);let o=this.conversations.find((e=>!!e.users.find((e=>e.id==i))&&e));if(o)return this.modalNewRoom={show:!1,loading:!1},this.openRoomId=o.id,e(o);a="apiRoutes.qchat.conversations",s={users:[i,this.chatProps["current-user-id"]]}}else a="apiRoutes.qchat.providerConversations",s={provider:this.newRoom.form.providerType,conversationId:this.newRoom.form.providerId,firstName:this.newRoom.form.firstName,lastName:this.newRoom.form.lastName};a&&s&&(this.modalNewRoom.loading=!0,this.$crud.create(a,s).then((async t=>{await this.getRooms(!0),this.openRoomId=t.data.id||t.data.conversation?.id,this.newRoom.form={userId:null,providerType:null,providerId:null,firstName:null,lastName:null},this.modalNewRoom={show:!1,loading:!1},e(t.data)})).catch((e=>{this.modalNewRoom={show:!1,loading:!1},t(e)})))}))},menuActionHandler({roomId:e,action:t}){t.action&&t.action({roomId:e,action:t})},async handleSearch(e){this.$refs.listRoomsContent.scrollTop=0,this.$refs.infiniteScroll.reset(),this.$refs.infiniteScroll.resume(),this.conversations=[],await this.getRooms({search:e}),this.$refs.infiniteScroll.setIndex(1)},conversationExternalData(e){let t=this.$getSetting("ichat::externalRoles")??[],a=this.$getSetting("core::site-name"),s=this.$store.state.quserAuth.userId,i=e.users.filter((e=>{let a=e.roles.map((e=>e.id));return this.$array.hasCommonElement(a,t)||!a.length}));return{title:i.map((e=>e.id)).includes(s)?a:(i.length?i:e.users).map((e=>e.fullName)).join(", "),externalUsers:i}},showError({roomId:e,message:t}){this.$alert.warning({mode:"modal",title:this.$trp("ichat.cms.message.couldNotSend"),message:`<div>${this.$tr("isite.cms.label.error")}: ${t.errorMessage}</div>`,actions:[{label:this.$tr("isite.cms.label.close"),color:"grey-5"},{label:this.$tr("ichat.cms.label.resend"),color:"primary",handler:()=>{const a={...t,roomId:e,body:t.content,attached:t.files[0]?.id};this.conversationMessages=this.conversationMessages.filter((e=>e.id!==t._id)),this.pushMessage(a),this.uploadMessage(a).then((e=>{this.$crud.delete("apiRoutes.qchat.messages",t._id)}))}}]})},openRoomFromUrl(){setTimeout((()=>{let e=this.$route.query.conversationId;if(e){let t=this.conversations.find((t=>t.id==e));t?this.openRoomId=t.id:this.getRooms({roomId:e})}}),200)}}};var $=a(12807),k=a(69001),I=a(90211),w=a(55530),q=a(75329),C=a(63418),F=a(53581),A=a(35779),T=a(24609),x=a(44031),V=a(98582),R=a.n(V);const L=(0,$.A)(y,[["render",f]]),Q=L;R()(y,"components",{QBtn:k.A,QSpinnerDots:I.A,QInfiniteScroll:w.A,QItem:q.A,QItemSection:C.A,QAvatar:F.A,QItemLabel:A.A,QIcon:T.A,QBadge:x.A})},41421:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>Q});var s=a(61758),i=a(58790);const o={class:"row gutter-x-sm relative-position q-mb-lg"},l={key:0,class:"col-12"},r={class:"row"},n={class:"col-12 q-mb-md"},c={key:0,class:"col-12"},d={class:"row q-col-gutter-md"},m={class:"col-12"},u={key:0,class:"row q-col-gutter-xs"},p={class:"col-8 col-md-10"},h={class:"col-4 col-md-2"},g={key:1,class:"relative-position"},f={class:"input-title"},b={class:"col-12 text-right"};function v(e,t,a,v,y,$){const k=(0,s.g2)("locales"),I=(0,s.g2)("q-input"),w=(0,s.g2)("q-select"),q=(0,s.g2)("q-color"),C=(0,s.g2)("q-popup-proxy"),F=(0,s.g2)("q-icon"),A=(0,s.g2)("q-chip"),T=(0,s.g2)("upload-media"),x=(0,s.g2)("q-btn"),V=(0,s.g2)("q-form"),R=(0,s.g2)("inner-loading");return(0,s.uX)(),(0,s.CE)("div",o,[y.success?((0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",r,[(0,s.Lk)("div",n,[(0,s.bF)(k,{modelValue:y.locale,"onUpdate:modelValue":t[0]||(t[0]=e=>y.locale=e),ref:"localeComponent",form:e.$refs.formContent},null,8,["modelValue","form"])]),(0,s.bF)(V,{onSubmit:t[6]||(t[6]=e=>y.itemId?$.updateItem():$.createItem()),ref:"formContent",class:"row q-col-gutter-x-sm full-width",autocomplete:"off",onValidationError:t[7]||(t[7]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,s.k6)((()=>[y.locale.success?((0,s.uX)(),(0,s.CE)("div",c,[(0,s.Lk)("div",d,[(0,s.Lk)("div",m,[(0,s.bF)(I,{outlined:"",dense:"",modelValue:y.locale.formTemplate.description,"onUpdate:modelValue":t[1]||(t[1]=e=>y.locale.formTemplate.description=e),rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("isite.cms.form.description")} (${y.locale.language})*`},null,8,["modelValue","rules","label"]),(0,s.bF)(w,{outlined:"",dense:"",modelValue:y.locale.formTemplate.options.type,"onUpdate:modelValue":t[2]||(t[2]=e=>y.locale.formTemplate.options.type=e),rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("isite.cms.form.type")} *`,options:y.typeOptions,"map-options":"","emit-value":""},null,8,["modelValue","rules","label","options"]),3==y.locale.form.options.type?((0,s.uX)(),(0,s.CE)("div",u,[(0,s.Lk)("div",p,[(0,s.bF)(I,{outlined:"",dense:"",modelValue:y.locale.formTemplate.options.color,"onUpdate:modelValue":t[4]||(t[4]=e=>y.locale.formTemplate.options.color=e),rules:["anyColor"],label:`${e.$tr("icommerce.cms.form.color")} *`},{append:(0,s.k6)((()=>[(0,s.bF)(F,{name:"colorize",class:"cursor-pointer"},{default:(0,s.k6)((()=>[(0,s.bF)(C,{"transition-show":"scale","transition-hide":"scale"},{default:(0,s.k6)((()=>[(0,s.bF)(q,{modelValue:y.locale.formTemplate.options.color,"onUpdate:modelValue":t[3]||(t[3]=e=>y.locale.formTemplate.options.color=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["modelValue","label"])]),(0,s.Lk)("div",h,[(0,s.bF)(A,{class:"full-width no-border-radius q-ma-none",style:(0,i.Tr)("height: 40px;background-color: "+y.locale.formTemplate.options.color)},null,8,["style"])])])):(0,s.Q3)("",!0),2==y.locale.form.options.type?((0,s.uX)(),(0,s.CE)("div",g,[(0,s.Lk)("div",f,(0,i.v_)(e.$tr("isite.cms.form.image")),1),(0,s.bF)(T,{modelValue:y.locale.formTemplate.mediasSingle,"onUpdate:modelValue":t[5]||(t[5]=e=>y.locale.formTemplate.mediasSingle=e),entity:"Modules\\Icommerce\\Entities\\OptionValue","entity-id":y.itemId||null,zone:"mainimage"},null,8,["modelValue","entity-id"])])):(0,s.Q3)("",!0)])])])):(0,s.Q3)("",!0),(0,s.Lk)("div",b,[(0,s.bF)(x,{color:"green",loading:y.loading,icon:"fas fa-edit",label:y.itemId?e.$tr("isite.cms.label.update"):e.$tr("isite.cms.label.create"),type:"submit",rounded:""},null,8,["loading","label"])])])),_:1},512)])])):(0,s.Q3)("",!0),(0,s.bF)(R,{visible:y.loading},null,8,["visible"])])}a(10239);var y=a(99205);const $={emits:["updated"],components:{uploadMedia:y.A},watch:{$route(e,t){this.initForm()},id(){this.initForm()}},mounted(){this.$nextTick((function(){this.initForm()}))},validations(){return this.getObjectValidation()},data(){return{locale:{},loading:!1,success:!1,users:[],itemId:!1,optionValues:[],pages:[],typeOptions:[{label:this.$tr("isite.cms.label.text"),value:1},{label:this.$tr("isite.cms.label.image"),value:2},{label:this.$tr("icommerce.cms.form.color"),value:3}]}},computed:{dataLocale(){return{fields:{optionId:this.optionId||this.$route.params.optionId,sortOrder:1,options:{type:1,color:"#000000"},mediasSingle:{},mediasMulti:{}},fieldsTranslatable:{description:""}}}},props:{optionId:{default:0},id:{default:0}},methods:{async initForm(){this.loading=!0,this.success=!1,this.locale=this.$clone(this.dataLocale),0==this.id?this.itemId=this.$route.params.id||0:this.itemId=this.id>-1?this.id:0,this.locale.success&&this.$refs.localeComponent.vReset(),await this.getData(),this.getoptionValues(),this.success=!0,this.loading=!1},getData(){return new Promise(((e,t)=>{const a=this.$clone(this.itemId);if(a>0){let s="apiRoutes.qcommerce.optionValues",i={refresh:!0,params:{filter:{allTranslations:!0}}};this.$crud.show(s,a,i).then((t=>{this.orderDataItemToLocale(t.data),e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest")}),this.loading=!1,t(!1)}))}))}else e(!0)}))},orderDataItemToLocale(e){let t=this.$clone(e);this.locale.form=this.$clone(t)},async createItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qcommerce.optionValues";this.$crud.create(e,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordCreated")} ID: ${e.data.id}`}),this.$route.params.optionId&&this.$router.push({name:"qcommerce.admin.options.edit",params:{id:this.$route.params.optionId}}),this.$emit("updated")})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoCreated")})}))}},async updateItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qcommerce.optionValues";this.$crud.update(e,this.itemId,this.getDataForm()).then((e=>{this.$emit("updated"),this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")})}))}},getDataForm(){let e=this.locale.form;for(var t in e){let a=e[t];null!=a&&void 0!=a||delete e[t]}return e.selectable=JSON.stringify(e.selectable),e},getoptionValues(){return new Promise(((e,t)=>{let a="apiRoutes.qcommerce.optionValues",s={refresh:!0,params:{filter:{allTranslations:!0,optionId:this.$route.params.optionId||this.optionId}}};this.$crud.index(a,s).then((t=>{this.optionValues=this.$array.tree(t.data),e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error("Failed: "+e,"bottom"),t(!0)}))}))}))},arrayUnique(e){return e.filter(((e,t,a)=>a.findIndex((t=>JSON.stringify(t)===JSON.stringify(e)))===t))}}};var k=a(12807),I=a(21565),w=a(78020),q=a(833),C=a(24609),F=a(87308),A=a(71339),T=a(88141),x=a(69001),V=a(98582),R=a.n(V);const L=(0,k.A)($,[["render",v]]),Q=L;R()($,"components",{QForm:I.A,QInput:w.A,QSelect:q.A,QIcon:C.A,QPopupProxy:F.A,QColor:A.A,QChip:T.A,QBtn:x.A})},8e3:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>F});var s=a(61758);const i={id:"pageId",class:"q-layout-page layout-padding location-form"},o={class:"relative-position q-mb-lg backend-page"},l={key:0,class:"box"},r={class:"col-12"},n={class:"row q-col-gutter-md"},c={class:"col-12 col-md-6"},d={class:"col-12 col-md-6"},m={class:"col-12"},u={class:"row q-col-gutter-md"},p={class:"col-12 col-sm-6"},h={class:"col-12 col-sm-6"};function g(e,t,g,f,b,v){const y=(0,s.g2)("locales"),$=(0,s.g2)("q-input"),k=(0,s.g2)("crud"),I=(0,s.g2)("q-btn"),w=(0,s.g2)("q-page-sticky"),q=(0,s.g2)("q-form"),C=(0,s.g2)("inner-loading");return(0,s.uX)(),(0,s.CE)("div",i,[(0,s.Lk)("div",o,[b.success?((0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",r,[(0,s.bF)(y,{modelValue:b.locale,"onUpdate:modelValue":t[0]||(t[0]=e=>b.locale=e),ref:"localeComponent",form:e.$refs.formContent},null,8,["modelValue","form"])]),b.locale.success?((0,s.uX)(),(0,s.Wv)(q,{key:0,autocorrect:"off",autocomplete:"off",ref:"formContent",class:"full-width q-my-sm",onSubmit:t[6]||(t[6]=e=>b.itemId?v.updateItem():v.createItem()),onValidationError:t[7]||(t[7]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,s.k6)((()=>[(0,s.Lk)("div",n,[(0,s.Lk)("div",c,[(0,s.bF)($,{outlined:"",dense:"",modelValue:b.locale.formTemplate.name,"onUpdate:modelValue":t[1]||(t[1]=e=>b.locale.formTemplate.name=e),label:`${e.$tr("isite.cms.form.name")} (${b.locale.language})*`,rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","rules"])]),(0,s.Lk)("div",d,[(0,s.bF)($,{outlined:"",dense:"",modelValue:b.locale.formTemplate.code,"onUpdate:modelValue":t[2]||(t[2]=e=>b.locale.formTemplate.code=e),label:`${e.$tr("ilocations.cms.form.code")} (${b.locale.language})*`,rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","rules"])]),(0,s.Lk)("div",m,[(0,s.Lk)("div",u,[(0,s.Lk)("div",p,[(0,s.bF)(k,{ref:"countries","crud-data":a.e(6259).then(a.bind(a,6259)),modelValue:b.locale.formTemplate.countryId,"onUpdate:modelValue":[t[3]||(t[3]=e=>b.locale.formTemplate.countryId=e),t[4]||(t[4]=()=>{b.locale.formTemplate.countryId&&e.$refs.provinces.init()})],type:"select","crud-props":{label:`${e.$tr("ilocations.cms.form.country")} *`,clearable:!0,rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},config:{options:{label:"name",value:"id"}}},null,8,["crud-data","modelValue","crud-props"])]),(0,s.Lk)("div",h,[(0,s.bF)(k,{ref:"provinces","crud-data":a.e(6533).then(a.bind(a,76533)),modelValue:b.locale.formTemplate.provinceId,"onUpdate:modelValue":t[5]||(t[5]=e=>b.locale.formTemplate.provinceId=e),type:"select","crud-props":{label:`${e.$tr("ilocations.cms.form.province")} *`,clearable:!0,rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},config:{options:{label:"name",value:"id"},requestParams:{filter:{country:b.locale.formTemplate.countryId}}}},null,8,["crud-data","modelValue","crud-props","config"])])])])]),(0,s.bF)(w,{position:"bottom-right",offset:[18,18]},{default:(0,s.k6)((()=>[e.$route.params.id?((0,s.uX)(),(0,s.Wv)(I,{key:0,color:"positive",loading:b.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.update"),type:"submit"},null,8,["loading","label"])):((0,s.uX)(),(0,s.Wv)(I,{key:1,color:"positive",loading:b.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.create"),type:"submit"},null,8,["loading","label"]))])),_:1})])),_:1},512)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.bF)(C,{visible:b.loading},null,8,["visible"])])])}a(10239);const f={components:{},watch:{$route(e,t){this.initForm(!0)}},mounted(){this.$nextTick((function(){this.initForm()}))},data(){return{locale:{},loading:!1,countryLoading:!1,provinceLoading:!1,success:!1,itemId:!1}},props:{id:{default:null}},computed:{dataLocale(){return{fields:{code:"",countryId:null,provinceId:null},fieldsTranslatable:{name:""}}}},methods:{async initForm(e=!1){this.loading=!0,this.success=!1,this.locale=this.$clone(this.dataLocale),this.itemId=null!==this.id?this.id:this.$route.params.id,this.locale.success&&this.$refs.localeComponent.vReset(),await this.getData(e),this.success=!0,this.loading=!1},getData(e=!1){return new Promise(((t,a)=>{const s=this.$clone(this.itemId);if(s){let i="apiRoutes.qlocations.cities",o={refresh:e,params:{include:"province,country",filter:{allTranslations:!0}}};this.$crud.show(i,s,o).then((e=>{this.orderDataItemToLocale(e.data),this.locale.form.provinceId=parseInt(e.data.provinceId),this.getProvinces(),t(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1,a(!1)}))}))}else t(!0)}))},orderDataItemToLocale(e){let t=this.$clone(e);this.locale.form=this.$clone(t)},async updateItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qlocations.cities";this.$crud.update(e,this.itemId,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.$router.push({name:"qlocations.admin.cities.index"}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},async createItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qlocations.cities";this.$crud.create(e,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordCreated")}`}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},getDataForm(){let e=this.locale.form;for(var t in e){let a=e[t];null!=a&&void 0!=a||delete e[t]}return e.selectable=JSON.stringify(e.selectable),e}}};var b=a(12807),v=a(83333),y=a(21565),$=a(78020),k=a(70918),I=a(69001),w=a(98582),q=a.n(w);const C=(0,b.A)(f,[["render",g]]),F=C;q()(f,"components",{QLayout:v.A,QForm:y.A,QInput:$.A,QPageSticky:k.A,QBtn:I.A})},49696:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>_});var s=a(61758),i=a(58790);const o={id:"pageId",class:"q-layout-page layout-padding location-form"},l={class:"relative-position q-mb-lg backend-page"},r={key:0,class:"box"},n={class:"col-12"},c={class:"row q-col-gutter-md"},d={class:"col-12 col-md-6"},m={class:"col-12 col-md-6"},u={class:"col-12 col-md-6"},p={class:"col-12 col-md-6"},h={class:"row q-col-gutter-md"},g={class:"col-8 col-md-10"},f={class:"col-4 col-md-2 text-right"};function b(e,t,b,v,y,$){const k=(0,s.g2)("locales"),I=(0,s.g2)("q-input"),w=(0,s.g2)("crud"),q=(0,s.g2)("q-tooltip"),C=(0,s.g2)("q-btn"),F=(0,s.g2)("q-page-sticky"),A=(0,s.g2)("q-form"),T=(0,s.g2)("inner-loading"),x=(0,s.g2)("q-toolbar-title"),V=(0,s.g2)("q-toolbar"),R=(0,s.g2)("cityForm"),L=(0,s.g2)("q-card-section"),Q=(0,s.g2)("q-card"),M=(0,s.g2)("q-dialog"),S=(0,s.gN)("close-popup");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",l,[y.success?((0,s.uX)(),(0,s.CE)("div",r,[(0,s.Lk)("div",n,[(0,s.bF)(k,{modelValue:y.locale,"onUpdate:modelValue":t[0]||(t[0]=e=>y.locale=e),ref:"localeComponent",form:e.$refs.formContent},null,8,["modelValue","form"])]),y.locale.success?((0,s.uX)(),(0,s.Wv)(A,{key:0,autocorrect:"off",autocomplete:"off",ref:"formContent",class:"full-width q-my-sm",onSubmit:t[8]||(t[8]=e=>y.itemId?$.updateItem():$.createItem()),onValidationError:t[9]||(t[9]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,s.k6)((()=>[(0,s.Lk)("div",c,[(0,s.Lk)("div",d,[(0,s.bF)(I,{outlined:"",dense:"",modelValue:y.locale.formTemplate.name,"onUpdate:modelValue":t[1]||(t[1]=e=>y.locale.formTemplate.name=e),label:`${e.$tr("isite.cms.form.name")} (${y.locale.language})*`,rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","rules"])]),(0,s.Lk)("div",m,[(0,s.bF)(w,{ref:"countries","crud-data":a.e(6259).then(a.bind(a,6259)),modelValue:y.locale.formTemplate.countryId,"onUpdate:modelValue":[t[2]||(t[2]=e=>y.locale.formTemplate.countryId=e),t[3]||(t[3]=()=>{y.locale.formTemplate.countryId&&e.$refs.provinces.init()})],type:"select","crud-props":{label:`${e.$tr("ilocations.cms.form.country")} *`,clearable:!0,rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},config:{options:{label:"name",value:"id"}}},null,8,["crud-data","modelValue","crud-props"])]),(0,s.Lk)("div",u,[(0,s.bF)(w,{ref:"provinces","crud-data":a.e(6533).then(a.bind(a,76533)),modelValue:y.locale.formTemplate.provinceId,"onUpdate:modelValue":[t[4]||(t[4]=e=>y.locale.formTemplate.provinceId=e),t[5]||(t[5]=()=>{y.locale.formTemplate.provinceId&&e.$refs.cities.init()})],type:"select","crud-props":{label:`${e.$tr("ilocations.cms.form.province")} *`,clearable:!0,rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},config:{options:{label:"name",value:"id"},requestParams:{filter:{country:y.locale.formTemplate.countryId}}}},null,8,["crud-data","modelValue","crud-props","config"])]),(0,s.Lk)("div",p,[(0,s.Lk)("div",h,[(0,s.Lk)("div",g,[(0,s.bF)(w,{ref:"cities","crud-data":a.e(4143).then(a.bind(a,84143)),modelValue:y.locale.formTemplate.cityId,"onUpdate:modelValue":t[6]||(t[6]=e=>y.locale.formTemplate.cityId=e),type:"select","crud-props":{label:`${e.$tr("ilocations.cms.form.city")} *`,clearable:!0,rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},"custom-data":{create:!1},config:{options:{label:"name",value:"id"},requestParams:{filter:{province_id:y.locale.formTemplate.provinceId}}}},null,8,["crud-data","modelValue","crud-props","config"])]),(0,s.Lk)("div",f,[(0,s.bF)(C,{size:"sm",class:"btn-small",color:"green",icon:"fas fa-plus",onClick:t[7]||(t[7]=e=>y.showCityCreate=!0)},{default:(0,s.k6)((()=>[(0,s.bF)(q,{offset:[10,10]},{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(e.$tr("ilocations.cms.newCity")),1)])),_:1})])),_:1})])])])]),(0,s.bF)(F,{position:"bottom-right",offset:[18,18]},{default:(0,s.k6)((()=>[e.$route.params.id?((0,s.uX)(),(0,s.Wv)(C,{key:0,color:"green",loading:y.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.update"),type:"submit"},null,8,["loading","label"])):((0,s.uX)(),(0,s.Wv)(C,{key:1,color:"green",loading:y.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.create"),type:"submit"},null,8,["loading","label"]))])),_:1})])),_:1},512)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.bF)(T,{visible:y.loading},null,8,["visible"])]),y.showCityCreate?((0,s.uX)(),(0,s.Wv)(M,{key:0,"content-class":"modal-form-crud",modelValue:y.showCityCreate,"onUpdate:modelValue":t[10]||(t[10]=e=>y.showCityCreate=e),onHide:e.getCities,"no-esc-dismiss":"","no-backdrop-dismiss":""},{default:(0,s.k6)((()=>[(0,s.bF)(Q,{class:"bg-grey-1 backend-page row",style:{"max-width":"80vw!important"}},{default:(0,s.k6)((()=>[(0,s.bF)(V,{class:"bg-primary text-white"},{default:(0,s.k6)((()=>[(0,s.bF)(x,null,{default:(0,s.k6)((()=>[(0,s.Lk)("label",null,(0,i.v_)(e.$tr("ilocations.cms.newCity")),1)])),_:1}),(0,s.bo)((0,s.bF)(C,{flat:"",icon:"fas fa-times"},null,512),[[S]])])),_:1}),(0,s.bF)(L,{class:"relative-position col-12"},{default:(0,s.k6)((()=>[(0,s.bF)(R,{id:!1})])),_:1})])),_:1})])),_:1},8,["modelValue","onHide"])):(0,s.Q3)("",!0)])}a(10239);var v=a(8e3);const y={components:{cityForm:v["default"]},watch:{$route(e,t){this.initForm()}},mounted(){this.$nextTick((function(){this.initForm()}))},data(){return{locale:{},loading:!1,success:!1,itemId:!1,showCityCreate:!1}},props:{id:{default:null}},computed:{dataLocale(){return{fields:{code:"",countryId:null,provinceId:null,cityId:null},fieldsTranslatable:{name:""}}}},methods:{async initForm(){this.loading=!0,this.success=!1,this.locale=this.$clone(this.dataLocale),this.itemId=null!==this.id?this.id:this.$route.params.id,this.locale.success&&this.$refs.localeComponent.vReset(),this.getCountries(),await this.getData(),this.success=!0,this.loading=!1},getData(){return new Promise(((e,t)=>{const a=this.$clone(this.itemId);if(a){let s="apiRoutes.qlocations.neighborhoods",i={refresh:!0,params:{include:"city",filter:{allTranslations:!0}}};this.$crud.show(s,a,i).then((t=>{this.orderDataItemToLocale(t.data),this.locale.form.countryId=parseInt(t.data.city.countryId),this.locale.form.provinceId=parseInt(t.data.city.provinceId),this.locale.form.cityId=parseInt(t.data.cityId),this.getProvinces(),this.getCities(),e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1,t(!1)}))}))}else e(!0)}))},orderDataItemToLocale(e){let t=this.$clone(e);this.locale.form=this.$clone(t)},async updateItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qlocations.neighborhoods";this.$crud.update(e,this.itemId,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},async createItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qlocations.neighborhoods";this.$crud.create(e,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordCreated")}`}),this.$router.push({name:"qlocations.admin.neighborhoods.index"}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},getDataForm(){let e=this.locale.form;for(var t in e){let a=e[t];null!=a&&void 0!=a||delete e[t]}return e.selectable=JSON.stringify(e.selectable),e}}};var $=a(12807),k=a(83333),I=a(21565),w=a(78020),q=a(69001),C=a(78151),F=a(70918),A=a(57201),T=a(97569),x=a(79351),V=a(56769),R=a(27066),L=a(62769),Q=a(98582),M=a.n(Q);const S=(0,$.A)(y,[["render",b]]),_=S;M()(y,"components",{QLayout:k.A,QForm:I.A,QInput:w.A,QBtn:q.A,QTooltip:C.A,QPageSticky:F.A,QDialog:A.A,QCard:T.A,QToolbar:x.A,QToolbarTitle:V.A,QCardSection:R.A}),M()(y,"directives",{ClosePopup:L.A})},99474:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>F});var s=a(61758),i=a(58790);const o={id:"pageId",class:"q-layout-page layout-padding"},l={class:"relative-position q-mb-lg backend-page"},r={key:0,class:"box"},n={class:"col-12"},c={class:"row q-col-gutter-md"},d={class:"col-12"},m={class:"input-title"},u={class:"col-12"};function p(e,t,a,p,h,g){const f=(0,s.g2)("locales"),b=(0,s.g2)("q-input"),v=(0,s.g2)("q-editor"),y=(0,s.g2)("q-field"),$=(0,s.g2)("dynamic-field"),k=(0,s.g2)("q-btn"),I=(0,s.g2)("q-page-sticky"),w=(0,s.g2)("q-form"),q=(0,s.g2)("inner-loading");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",l,[h.success?((0,s.uX)(),(0,s.CE)("div",r,[(0,s.Lk)("div",n,[(0,s.bF)(f,{modelValue:h.locale,"onUpdate:modelValue":t[0]||(t[0]=e=>h.locale=e),ref:"localeComponent",form:e.$refs.formContent},null,8,["modelValue","form"])]),h.locale.success?((0,s.uX)(),(0,s.Wv)(w,{key:0,autocorrect:"off",autocomplete:"off",ref:"formContent",class:"full-width q-my-sm",onSubmit:t[6]||(t[6]=e=>h.itemId?g.updateItem():g.createItem()),onValidationError:t[7]||(t[7]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,s.k6)((()=>[(0,s.Lk)("div",c,[(0,s.Lk)("div",d,[(0,s.bF)(b,{outlined:"",dense:"",modelValue:h.locale.formTemplate.name,"onUpdate:modelValue":t[1]||(t[1]=e=>h.locale.formTemplate.name=e),label:`${e.$tr("isite.cms.form.name")} (${h.locale.language})*`,rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","rules"]),(0,s.Lk)("div",m,(0,i.v_)(`${e.$tr("isite.cms.form.description")} (${h.locale.language})*`),1),(0,s.bF)(y,{borderless:"",modelValue:h.locale.formTemplate.description,"onUpdate:modelValue":t[3]||(t[3]=e=>h.locale.formTemplate.description=e),rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},{default:(0,s.k6)((()=>[(0,s.bF)(v,{class:"full-width",modelValue:h.locale.formTemplate.description,"onUpdate:modelValue":t[2]||(t[2]=e=>h.locale.formTemplate.description=e)},null,8,["modelValue"])])),_:1},8,["modelValue","rules"])]),(0,s.Lk)("div",u,[(0,s.bF)($,{modelValue:h.modelMap,"onUpdate:modelValue":[t[4]||(t[4]=e=>h.modelMap=e),t[5]||(t[5]=e=>h.locale.formTemplate.points=e.points)],class:"q-mb-md",field:h.mapField},null,8,["modelValue","field"])])]),(0,s.bF)(I,{position:"bottom-right",offset:[18,18]},{default:(0,s.k6)((()=>[e.$route.params.id?((0,s.uX)(),(0,s.Wv)(k,{key:0,color:"green",loading:h.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.update"),type:"submit"},null,8,["loading","label"])):((0,s.uX)(),(0,s.Wv)(k,{key:1,color:"green",loading:h.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.create"),type:"submit"},null,8,["loading","label"]))])),_:1})])),_:1},512)):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),(0,s.bF)(q,{visible:h.loading},null,8,["visible"])])])}a(10239);const h={components:{},mounted(){this.$nextTick((function(){this.initForm()}))},data(){return{locale:{fields:{points:[],options:{}},fieldsTranslatable:{name:"",description:""}},modelMap:{},loading:!1,success:!1,itemId:!1,mapField:{type:"positionMarkerMap",help:{description:this.$tr("icommerce.cms.form.mapHelp")},required:!1,isFakeField:!1,props:{polygonControls:!0}}}},props:{id:{default:null}},computed:{token(){this.$getSetting("isite::api-maps")}},methods:{async initForm(){this.loading=!0,this.success=!1,this.itemId=null!==this.id?this.id:this.$route.params.id,await this.getData(),this.success=!0,this.loading=!1},getData(){return new Promise(((e,t)=>{const a=this.$clone(this.itemId);if(a){let s="apiRoutes.qlocations.polygons",i={refresh:!0,params:{filter:{allTranslations:!0}}};this.$crud.show(s,a,i).then((t=>{this.locale.form=this.$clone(t.data),this.modelMap.points=this.$clone(t.data.points),e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1,t(!1)}))}))}else e(!0)}))},async updateItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qlocations.polygons";this.$crud.update(e,this.itemId,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},async createItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qlocations.polygons";this.$crud.create(e,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordCreated")}`}),this.$router.push({name:"qlocations.admin.polygons.index"}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},getDataForm(){let e=this.locale.form;for(var t in e){let a=e[t];null!=a&&void 0!=a||delete e[t]}return e}}};var g=a(12807),f=a(83333),b=a(21565),v=a(78020),y=a(51225),$=a(94192),k=a(70918),I=a(69001),w=a(98582),q=a.n(w);const C=(0,g.A)(h,[["render",p]]),F=C;q()(h,"components",{QLayout:f.A,QForm:b.A,QInput:v.A,QField:y.A,QEditor:$.A,QPageSticky:k.A,QBtn:I.A})},11743:(e,t,a)=>{"use strict";a.d(t,{A:()=>T});var s=a(61758),i=a(58790),o=a(29104),l={class:"tw-text-base tw-leading-4 text-weight-bold"},r=["innerHTML"],n={class:"tw-text-[13px] tw-leading-[13px] text-grey-7"},c={class:"notification-unread"};function d(e,t,a,d,m,u){var p=(0,s.g2)("q-icon"),h=(0,s.g2)("q-item-section"),g=(0,s.g2)("q-item-label"),f=(0,s.g2)("q-tooltip"),b=(0,s.g2)("q-badge"),v=(0,s.g2)("q-btn"),y=(0,s.g2)("q-item");return(0,s.uX)(),(0,s.Wv)(y,{clickable:"",dense:"",class:"q-pt-sm q-my-sm q-px-sm",onClick:t[1]||(t[1]=function(t){return e.openModal()})},{default:(0,s.k6)((function(){return[(0,s.bF)(h,{avatar:"",top:""},{default:(0,s.k6)((function(){return[(0,s.Lk)("div",{class:"flex flex-center notification-notification-icon-small tw-w-12 tw-h-12 tw-rounded-lg",style:(0,i.Tr)({backgroundColor:e.sourceData.backgroundColor})},[(0,s.bF)(p,{name:e.sourceData.icon,style:(0,i.Tr)({color:e.sourceData.color,fontSize:"20px"})},null,8,["name","style"])],4)]})),_:1}),(0,s.bF)(h,{top:""},{default:(0,s.k6)((function(){return[(0,s.bF)(g,{lines:"1",class:"tw-m-0 tw-mb-0.5"},{default:(0,s.k6)((function(){return[(0,s.Lk)("span",l,(0,i.v_)(e.notification.title),1)]})),_:1}),(0,s.bF)(g,{lines:"2",class:"tw-m-0 tw-mb-1"},{default:(0,s.k6)((function(){return[(0,s.Lk)("div",{class:"text-body2 tw-leading-[18px]",innerHTML:e.notification.message},null,8,r)]})),_:1}),(0,s.bF)(g,{caption:"",class:"no-margin"},{default:(0,s.k6)((function(){return[(0,s.Lk)("span",n,[(0,s.eW)((0,i.v_)(e.notification.timeAgo)+" ",1),(0,s.bF)(f,{anchor:"bottom end",self:"center right"},{default:(0,s.k6)((function(){return[(0,s.eW)((0,i.v_)(e.notification.createdAt),1)]})),_:1})])]})),_:1})]})),_:1}),(0,s.bF)(h,{side:"",top:""},{default:(0,s.k6)((function(){return[(0,s.Lk)("div",c,[e.isUnread?((0,s.uX)(),(0,s.Wv)(b,{key:0,color:e.notification.isImportant?"orange":"blue",rounded:""},null,8,["color"])):(0,s.Q3)("",!0),e.isUnread&&e.showMarkAsRead?((0,s.uX)(),(0,s.Wv)(v,{key:1,class:"notification-mark-as-read",rounded:"",dense:"",unelevated:"","no-caps":"",size:"md",onClick:t[0]||(t[0]=(0,o.D$)((function(t){return e.markAsReadHandler()}),["stop"])),label:e.$tr("notification.cms.markAsRead"),loading:e.loading},null,8,["label","loading"])):(0,s.Q3)("",!0)])]})),_:1})]})),_:1})}var m=a(38734),u=a(11492),p=a(38932),h=function(){return h=Object.assign||function(e){for(var t,a=1,s=arguments.length;a<s;a++)for(var i in t=arguments[a],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},h.apply(this,arguments)};function g(e,t){var a={},i=(0,m.Kh)({loading:!1,notification:e.itemNotification}),o={isUnread:(0,s.EW)((function(){return!i.notification.isRead})),sourceData:(0,s.EW)((function(){var t,a=e.sourceSettings[null===(t=e.itemNotification)||void 0===t?void 0:t.source]||{};return h({backgroundColor:"#D9D9D9",color:"#2196f3",icon:"fa-light fa-bell"},a)}))},l={markAsRead:function(){return i.notification.isRead=!0,t("read"),new Promise((function(e,t){p.A.markAsRead(i.notification.id).then((function(t){e(i.notification)})).catch((function(e){u.A.handleError(e,(function(){i.notification.isRead=!1,i.loading=!1}))}))}))},openModal:function(){t("openModal",i.notification),o.isUnread.value&&l.markAsRead()},markAsReadHandler:function(){i.loading=!0,l.markAsRead().then((function(){i.loading=!1}))}};return(0,s.sV)((function(){})),(0,s.wB)((function(){return e.itemNotification}),(function(e){i.notification=e})),h(h(h(h({},a),(0,m.QW)(i)),o),l)}const f=(0,s.pM)({props:{itemNotification:{default:{}},sourceSettings:{default:[]},showMarkAsRead:{default:!1}},components:{},emits:["read","openModal"],setup:function(e,t){var a=t.emit;return g(e,a)}});var b=a(12807),v=a(75329),y=a(63418),$=a(24609),k=a(35779),I=a(78151),w=a(44031),q=a(69001),C=a(98582),F=a.n(C);const A=(0,b.A)(f,[["render",d]]),T=A;F()(f,"components",{QItem:v.A,QItemSection:y.A,QIcon:$.A,QItemLabel:k.A,QTooltip:I.A,QBadge:w.A,QBtn:q.A})},69033:(e,t,a)=>{"use strict";a.d(t,{A:()=>H});var s=a(61758),i=a(58790);const o={id:"componentContent",class:"box relative-position",style:{padding:"0px"}},l={class:"row items-center"},r={class:"col-12"},n={key:0,class:"col-12"},c={class:"row items-center justify-center q-gutter-x-sm q-py-md"},d={id:"calendarContent"},m={class:"row q-py-md"},u=["onClick"],p={class:"event-icon row justify-center"},h={class:"event-description q-pb-sm q-px-sm"},g={class:"text-caption ellipsis"},f={class:"text-weight-bold"},b={class:"q-pa-sm row q-col-gutter-y-xs"},v=["onClick"],y={key:1,id:"eventListcontent"},$={class:"row"},k=["onClick"],I={class:"event-icon row justify-center"},w={class:"event-description q-pb-sm q-px-sm"},q={class:"text-caption ellipsis"},C={class:"text-weight-bold"},F={key:1,class:"box"},A={class:"text-left"};function T(e,t,a,T,x,V){const R=(0,s.g2)("q-btn-toggle"),L=(0,s.g2)("q-btn"),Q=(0,s.g2)("q-date"),M=(0,s.g2)("q-dialog"),S=(0,s.g2)("q-separator"),_=(0,s.g2)("q-avatar"),P=(0,s.g2)("q-icon"),D=(0,s.g2)("q-tooltip"),U=(0,s.g2)("q-calendar"),E=(0,s.g2)("q-item-section"),X=(0,s.g2)("q-item"),N=(0,s.g2)("q-list"),W=(0,s.g2)("master-modal"),z=(0,s.g2)("inner-loading");return(0,s.uX)(),(0,s.CE)("div",{id:"calendarComponent",key:x.componentId},[(0,s.Lk)("div",o,[(0,s.Lk)("div",l,[(0,s.Lk)("div",r,[(0,s.bF)(R,{modelValue:x.calendarType,"onUpdate:modelValue":t[0]||(t[0]=e=>x.calendarType=e),"no-caps":"",unelevated:"","toggle-color":"blue-grey",color:"white","text-color":"blue-grey",options:x.calendarTypeOptions,id:"btnCalendarType",size:"14px",padding:"md sm",spread:""},null,8,["modelValue","options"])]),"all"!=x.calendarType?((0,s.uX)(),(0,s.CE)("div",n,[(0,s.Lk)("div",c,["all"!=x.calendarType?((0,s.uX)(),(0,s.Wv)(L,{key:0,onClick:t[1]||(t[1]=t=>e.$refs.calendarComponent.prev()),icon:"fas fa-chevron-left",color:"blue-grey",round:"",unelevated:"",size:"sm",flat:""})):(0,s.Q3)("",!0),(0,s.Lk)("div",{class:"text-blue-grey text-weight-bold text-subtitle1 cursor-pointer",onClick:t[2]||(t[2]=e=>x.modalQDate=!0)},(0,i.v_)("day"==x.calendarType?e.$trd(x.calendarDate,{type:"small"}):e.$trd(x.calendarDate,{type:"month"}))+", "+(0,i.v_)(e.$trd(x.calendarDate,{type:"year"})),1),(0,s.bF)(M,{modelValue:x.modalQDate,"onUpdate:modelValue":t[5]||(t[5]=e=>x.modalQDate=e)},{default:(0,s.k6)((()=>[(0,s.bF)(Q,{modelValue:x.calendarDate,"onUpdate:modelValue":[t[3]||(t[3]=e=>x.calendarDate=e),t[4]||(t[4]=e=>x.modalQDate=!1)],mask:"YYYY-MM-DD"},null,8,["modelValue"])])),_:1},8,["modelValue"]),"all"!=x.calendarType?((0,s.uX)(),(0,s.Wv)(L,{key:1,onClick:t[6]||(t[6]=t=>e.$refs.calendarComponent.next()),icon:"fas fa-chevron-right",color:"blue-grey",round:"",unelevated:"",size:"sm",flat:""})):(0,s.Q3)("",!0)]),(0,s.bF)(S)])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",d,["all"!=x.calendarType?((0,s.uX)(),(0,s.Wv)(U,(0,s.v6)({key:0,id:"calendarComponent",modelValue:x.calendarDate,"onUpdate:modelValue":t[7]||(t[7]=e=>x.calendarDate=e)},V.propsCalendar[x.calendarType],{ref:"calendarComponent","no-scroll":""}),(0,s.eX)({day:(0,s.k6)((({timestamp:e})=>[(0,s.Lk)("div",b,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(V.getEventsList(e),((e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"event-content q-px-sm q-py-xs relative-position text-caption ellipsis",style:{margin:"0 !important"},onClick:t=>{x.modal.data=e,x.modal.show=!0}},[(0,s.bF)(_,{icon:e.icon,color:e.color,size:"sm","text-color":"white"},null,8,["icon","color"]),(0,s.eW)(" "+(0,i.v_)(e.time)+" - "+(0,i.v_)(e.title)+" ",1),(0,s.bF)(D,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(e.title),1)])),_:2},1024)],8,v)))),128))])])),_:2},["card"==V.propsCalendar[x.calendarType].type?{name:"day-body",fn:(0,s.k6)((({timestamp:e,timeStartPos:t,timeDurationHeight:a})=>[(0,s.Lk)("div",m,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(V.getEventsList(e),((e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,i.C4)(V.propsCalendar[x.calendarType].eventClass)},[(0,s.Lk)("div",{class:"event-content",onClick:t=>{x.modal.data=e,x.modal.show=!0}},[(0,s.Lk)("div",p,[(0,s.bF)(_,{icon:e.icon,color:e.color},null,8,["icon","color"])]),(0,s.Lk)("div",h,[(0,s.Lk)("div",g,(0,i.v_)(e.title),1),(0,s.Lk)("div",f,(0,i.v_)(e.time),1),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.mainDetails||[],((e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"text-caption ellipsis"},[e.icon?((0,s.uX)(),(0,s.Wv)(P,{key:0,name:e.icon},null,8,["name"])):(0,s.Q3)("",!0),(0,s.eW)(" "+(0,i.v_)(e.value),1)])))),128))])],8,u)],2)))),128))])])),key:"0"}:void 0]),1040,["modelValue"])):((0,s.uX)(),(0,s.CE)("div",y,[(0,s.Lk)("div",$,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(V.getEventsList(),((e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,i.C4)(V.propsCalendar[x.calendarType].eventClass)},[(0,s.Lk)("div",{class:"event-content",onClick:t=>{x.modal.data=e,x.modal.show=!0}},[(0,s.Lk)("div",I,[(0,s.bF)(_,{icon:e.icon,color:e.color},null,8,["icon","color"])]),(0,s.Lk)("div",w,[(0,s.Lk)("div",q,(0,i.v_)(e.title),1),(0,s.Lk)("div",C,(0,i.v_)(e.time),1),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(e.mainDetails||[],((e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"text-caption ellipsis"},[e.icon?((0,s.uX)(),(0,s.Wv)(P,{key:0,name:e.icon},null,8,["name"])):(0,s.Q3)("",!0),(0,s.eW)(" "+(0,i.v_)(e.value),1)])))),128))])],8,k)],2)))),128))])]))]),(0,s.bF)(W,{modelValue:x.modal.show,"onUpdate:modelValue":t[8]||(t[8]=e=>x.modal.show=e),"custom-position":"",actions:a.eventActions||[],loading:x.loading,title:e.$tr("isite.cms.label.event")+(x.modal.data.id?" ID: "+x.modal.data.id:"")},{default:(0,s.k6)((()=>[x.modal.data.card?((0,s.uX)(),(0,s.Wv)((0,s.$y)(x.modal.data.card.component),{key:0,row:x.modal.data.card.row},null,8,["row"])):((0,s.uX)(),(0,s.CE)("div",F,[(0,s.bF)(N,{separator:"",dense:""},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(x.modal.data.extraDetails,((e,t)=>((0,s.uX)(),(0,s.Wv)(X,{key:t,class:"q-px-none"},{default:(0,s.k6)((()=>[(0,s.bF)(E,null,{default:(0,s.k6)((()=>[(0,s.Lk)("div",A,[(0,s.bF)(P,{name:e.icon,color:"grey-7",class:"q-mr-sm",size:"sm"},null,8,["name"]),(0,s.eW)(" "+(0,i.v_)(e.title),1)])])),_:2},1024),(0,s.bF)(E,{side:"",innerHTML:e.value},null,8,["innerHTML"])])),_:2},1024)))),128))])),_:1})]))])),_:1},8,["modelValue","actions","loading","title"]),(0,s.bF)(z,{visible:x.loading},null,8,["visible"])])])}a(10239);var x=a(22717),V=a(71915);const R={components:{QCalendar:x.u7},props:{eventsData:{default:!1},eventActions:{default:!1}},mounted(){this.$nextTick((function(){this.init()}))},data(){return{componentId:this.$uid(),loading:!1,calendarType:"day",calendarTypeOptions:[{label:this.$tr("isite.cms.label.month"),value:"month",icon:"fas fa-calendar-alt"},{label:this.$tr("isite.cms.label.week"),value:"week",icon:"fas fa-calendar-week"},{label:this.$tr("isite.cms.label.day"),value:"day",icon:"fas fa-calendar-day"},{label:this.$tr("isite.cms.label.all"),value:"all",icon:"fas fa-list-alt"}],calendarDate:this.$moment().format("YYYY-MM-DD"),modalQDate:!1,modal:{show:!1,data:!1}}},computed:{propsCalendar(){return{month:{view:"month",mode:"month",style:"min-width: 1200px;",type:"badge"},week:{view:"week",eventClass:"col-12",style:"min-width: 1200px;",type:"card"},day:{view:"day",mode:"day",eventClass:"col-6 col-md-4 col-lg-3",type:"card"},all:{view:"all",eventClass:"col-6 col-md-4 col-lg-3",type:"card"}}}},methods:{init(){V.Bt.on("page.data.refresh",(()=>this.componentId=this.$uid()))},getEventsList(e=!1){let t=this.$clone(this.eventsData||[]),a=[];return t.forEach((t=>{let s=(0,x._U)(new Date(t.date)),i=`${s.date} ${s.time}`;e&&s.date!=e.date||a.push({...t,time:this.$trd(i,{type:"time"}),extraDetails:[{value:t.title},{title:this.$tr("isite.cms.label.date"),icon:"fas fa-calendar-day",value:this.$trd(s.date)},{title:this.$tr("isite.cms.label.time"),icon:"fas fa-clock",value:this.$trd(i,{type:"time"})},...t.extraDetails||[]]})})),a}}};var L=a(12807),Q=a(68408),M=a(69001),S=a(57201),_=a(73145),P=a(37015),D=a(53581),U=a(24609),E=a(78151),X=a(54514),N=a(75329),W=a(63418),z=a(98582),O=a.n(z);const B=(0,L.A)(R,[["render",T]]),H=B;O()(R,"components",{QBtnToggle:Q.A,QBtn:M.A,QDialog:S.A,QDate:_.A,QSeparator:P.A,QAvatar:D.A,QIcon:U.A,QTooltip:E.A,QList:X.A,QItem:N.A,QItemSection:W.A})},60149:(e,t,a)=>{"use strict";a.d(t,{A:()=>q});var s=a(61758),i=a(58790);const o={id:"cropperContent",class:"row items-center justify-center"},l={id:"topActions",class:"row q-gutter-x-xs"},r={key:1,id:"bottomActions",class:"row q-gutter-x-sm"},n=["onClick"];function c(e,t,a,c,d,m){const u=(0,s.g2)("vue-cropper"),p=(0,s.g2)("q-btn"),h=(0,s.g2)("q-icon"),g=(0,s.g2)("q-input"),f=(0,s.g2)("q-popup-edit"),b=(0,s.g2)("inner-loading"),v=(0,s.g2)("q-dialog"),y=(0,s.gN)("close-popup");return(0,s.uX)(),(0,s.Wv)(v,{id:"modalCropperComponent",modelValue:d.show,"onUpdate:modelValue":t[1]||(t[1]=e=>d.show=e),persistent:"",maximized:""},{default:(0,s.k6)((()=>[(0,s.Lk)("div",o,[d.imgSrc?((0,s.uX)(),(0,s.Wv)(u,(0,s.v6)({key:0},m.cropperProps,{ref:"cropper",onCrop:t[0]||(t[0]=e=>m.getCropperData())}),null,16)):(0,s.Q3)("",!0),(0,s.Lk)("div",l,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(m.cropperActions.top,((e,t)=>((0,s.uX)(),(0,s.Wv)(p,{key:t,round:"",flat:"",icon:e.icon,onClick:t=>e.action(),color:"white",size:"11px"},null,8,["icon","onClick"])))),128))]),d.information?((0,s.uX)(),(0,s.CE)("div",r,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(m.cropperActions.bottom,((e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:"btnActionCropper row items-center text-center",onClick:t=>!e.popupName&&e.action()},[(0,s.bF)(h,{name:e.icon,class:"q-mr-xs"},null,8,["name"]),(0,s.eW)(" "+(0,i.v_)(e.value)+" ",1),e.popupName?((0,s.uX)(),(0,s.Wv)(f,{key:0,modelValue:d.cropperSize[e.popupName],"onUpdate:modelValue":t=>d.cropperSize[e.popupName]=t,"auto-save":""},{default:(0,s.k6)((()=>[(0,s.bF)(g,{modelValue:d.cropperSize[e.popupName],"onUpdate:modelValue":[t=>d.cropperSize[e.popupName]=t,t=>e.action()],dense:"",autofocus:"",outlined:"",type:"number",label:e.label},{append:(0,s.k6)((()=>[(0,s.bo)((0,s.bF)(h,{name:e.icon,class:"cursor-pointer"},null,8,["name"]),[[y]])])),_:2},1032,["modelValue","onUpdate:modelValue","label"])])),_:2},1032,["modelValue","onUpdate:modelValue"])):(0,s.Q3)("",!0)],8,n)))),128))])):(0,s.Q3)("",!0),(0,s.bF)(b,{visible:d.loading},null,8,["visible"])])])),_:1},8,["modelValue"])}var d=a(54963),m=a(87663),u=a(71915);const p={beforeUnmount(){u.Bt.off("master.cropper.image")},mixins:[d.A],props:{props:{type:Object}},emits:["cropped","canceled"],components:{VueCropper:m.A},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,show:!1,scale:{y:1,x:1},information:!1,cropperSize:{width:100,height:100},imgSrc:!1,imgType:!1,callBack:!1,aspectRatio:NaN}},computed:{cropperProps(){return{ref:"cropper",autoCropArea:1,background:!1,toggleDragModeOnDblclick:!1,cropBoxResizable:!0,src:this.imgSrc,viewMode:1,containerStyle:{height:"92%",width:"96%","max-height":"92%","max-width":"96%"},aspectRatio:this.aspectRatio,...this.props||{}}},cropperActions(){return{top:[{icon:"fas fa-search-plus",action:()=>this.$refs.cropper.relativeZoom(.2)},{icon:"fas fa-search-minus",action:()=>this.$refs.cropper.relativeZoom(-.2)},{icon:"fas fa-undo-alt",action:()=>this.$refs.cropper.rotate(-45)},{icon:"fas fa-redo-alt",action:()=>this.$refs.cropper.rotate(45)},{icon:"fas fa-vector-square",action:()=>{let e=this.$refs.cropper.getImageData(),t=this.$refs.cropper.getData(),a=[1,.9,.8,.7],s=parseFloat((100*t.width/e.naturalWidth/100).toFixed(2)),i=a.indexOf(s)+1;i>a.length-1&&(i=0);let o={width:e.naturalWidth*a[i],height:e.naturalHeight*a[i]};this.$refs.cropper.setData({...o,x:(e.naturalWidth-o.width)/2,y:(e.naturalHeight-o.height)/2})}},{icon:"fas fa-arrows-alt-h",action:()=>{this.$refs.cropper.scaleY(-this.scale.y),this.scale.y=-this.scale.y}},{icon:"fas fa-arrows-alt-v",action:()=>{this.$refs.cropper.scaleX(-this.scale.x),this.scale.x=-this.scale.x}},{icon:"fas fa-reply",action:()=>this.$refs.cropper.reset()}],bottom:[{icon:"fas fa-ban",value:this.$tr("isite.cms.label.cancel"),action:()=>{this.cropImage(!1)}},{popupName:"width",icon:"fas fa-arrows-alt-h",value:`${this.information?this.information.cropper.width:""}px`,label:this.$tr("isite.cms.form.width"),action:()=>{this.$refs.cropper.setData({width:parseInt(this.cropperSize.width),height:parseInt(this.cropperSize.height)})}},{popupName:"height",icon:"fas fa-arrows-alt-v",value:`${this.information?this.information.cropper.height:""}px`,label:this.$tr("isite.cms.form.height"),action:()=>{this.$refs.cropper.setData({width:parseInt(this.cropperSize.width),height:parseInt(this.cropperSize.height)})}},{icon:"fas fa-save",value:this.$tr("isite.cms.label.save"),action:this.cropImage}]}}},methods:{init(){u.Bt.on("master.cropper.image",(e=>{e.src&&this.loadFile(e.src),e.type&&(this.imgType=this.$clone(e.type)),e.callBack&&(this.callBack=e.callBack),e.ratio&&(this.aspectRatio=this.parseRatio(e.ratio))}))},loadFile(e){this.show=!0,setTimeout((()=>this.imgSrc=this.$clone(e)),500)},getCropperData(){this.information={cropper:this.$refs.cropper.getData(!0),container:this.$refs.cropper.getContainerData(),image:this.$refs.cropper.getImageData()},this.cropperSize={width:parseInt(this.information.cropper.width),height:parseInt(this.information.cropper.height)}},cropImage(e=!0){if(e){this.loading=!0;let e=this.$refs.cropper.getCroppedCanvas().toDataURL(this.imgType),t={base64:e,size:parseInt(.75*e.replace(/=/g,"").length),height:this.information.cropper.height,width:this.information.cropper.width};this.$emit("cropped",t),this.callBack&&this.callBack(t)}else this.$emit("canceled"),this.callBack&&this.callBack(null);this.show=!1,this.imgSrc=!1,this.callBack=!1,this.imgType=!1,this.loading=!1}}};var h=a(12807),g=a(57201),f=a(69001),b=a(24609),v=a(67404),y=a(78020),$=a(62769),k=a(98582),I=a.n(k);const w=(0,h.A)(p,[["render",c]]),q=w;I()(p,"components",{QDialog:g.A,QBtn:f.A,QIcon:b.A,QPopupEdit:v.A,QInput:y.A}),I()(p,"directives",{ClosePopup:$.A})},7432:(e,t,a)=>{"use strict";a.d(t,{A:()=>Y});var s=a(61758),i=a(58790);const o={id:"quickCardComponent"},l={class:"box"},r={class:"box-title"},n={id:"contentQuickCard",class:"relative-position"},c={key:0,id:"itemsContent",class:"q-mb-md"},d={key:0,id:"itemsListV"},m={key:1,id:"itemsListH"},u={class:"row q-col-gutter-md"},p=["onClick"],h={class:"itemSide"},g={class:"itemInformation"},f={key:2,id:"itemsListRankin"},b={key:1,class:"text-center"},v={key:2},y={key:1},$={class:"tw-flex tw-items-end tw-justify-center tw-gap-6"},k={key:3},I={key:0,class:"tw-flex"},w={class:"text-center"},q=["innerHTML"],C={key:4},F={class:"text-center"};function A(e,t,a,A,T,x){const V=(0,s.g2)("q-icon"),R=(0,s.g2)("q-separator"),L=(0,s.g2)("q-item-section"),Q=(0,s.g2)("q-item-label"),M=(0,s.g2)("q-item"),S=(0,s.g2)("q-list"),_=(0,s.g2)("q-scroll-area"),P=(0,s.g2)("q-tooltip"),D=(0,s.g2)("q-chip"),U=(0,s.g2)("q-linear-progress"),E=(0,s.g2)("not-result"),X=(0,s.g2)("QCharts"),N=(0,s.g2)("q-skeleton"),W=(0,s.g2)("q-circular-progress"),z=(0,s.g2)("q-btn");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",l,[(0,s.Lk)("div",r,[x.cardParams.icon?((0,s.uX)(),(0,s.Wv)(V,{key:0,name:x.cardParams.icon,class:"q-mr-sm"},null,8,["name"])):(0,s.Q3)("",!0),(0,s.eW)(" "+(0,i.v_)(x.cardParams.title),1)]),(0,s.bF)(R,{class:"q-my-md"}),(0,s.Lk)("div",n,[T.loading?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",c,["list-v"==x.cardParams.type?((0,s.uX)(),(0,s.CE)("div",d,[(0,s.bF)(_,{style:{height:"260px",width:"100%"}},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(T.items,((e,t)=>((0,s.uX)(),(0,s.Wv)(S,{key:t},{default:(0,s.k6)((()=>[(0,s.bF)(M,{class:"q-px-none",onClick:t=>!!x.cardParams.itemAction&&x.cardParams.itemAction(e),clickable:!!x.cardParams.itemAction,"v-ripple":!!x.cardParams.itemAction},{default:(0,s.k6)((()=>[(0,s.bF)(L,{class:"sideItem",side:""},{default:(0,s.k6)((()=>[x.getInformation(e,"image")?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"itemImage img-as-bg",style:(0,i.Tr)(`background-image: url('${x.getInformation(e,"image")}')`)},null,4)):(0,s.Q3)("",!0),!x.getInformation(e,"image")&&x.cardParams.icon?((0,s.uX)(),(0,s.Wv)(V,{key:1,class:"itemIcon",name:x.cardParams.icon},null,8,["name"])):(0,s.Q3)("",!0)])),_:2},1024),(0,s.bF)(L,null,{default:(0,s.k6)((()=>[(0,s.bF)(Q,{caption:"",class:"ellipsis"},{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(x.getInformation(e,"text1")),1)])),_:2},1024),(0,s.bF)(Q,{class:"ellipsis text-grey-8 q-my-xs"},{default:(0,s.k6)((()=>[(0,s.Lk)("b",null,(0,i.v_)(x.getInformation(e,"text2")),1)])),_:2},1024),(0,s.bF)(Q,{caption:"",lines:"2"},{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(x.getInformation(e,"text3")),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick","clickable","v-ripple"])])),_:2},1024)))),128))])),_:1})])):(0,s.Q3)("",!0),"list-h"==x.cardParams.type?((0,s.uX)(),(0,s.CE)("div",m,[(0,s.Lk)("div",u,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(T.items,((e,t)=>((0,s.uX)(),(0,s.CE)("div",{key:t,class:(0,i.C4)("col-6 col-md-4 "+(x.cardParams.itemAction?"cursor-pointer":"")),onClick:t=>!!x.cardParams.itemAction&&x.cardParams.itemAction(e)},[(0,s.Lk)("div",h,[x.getInformation(e,"image")?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"itemImage img-as-bg",style:(0,i.Tr)(`background-image: url('${x.getInformation(e,"image")}')`)},null,4)):(0,s.Q3)("",!0),!x.getInformation(e,"image")&&x.cardParams.icon?((0,s.uX)(),(0,s.Wv)(V,{key:1,class:"itemIcon",name:x.cardParams.icon},null,8,["name"])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",g,[(0,s.bF)(Q,{caption:"",class:"ellipsis q-my-sm"},{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(x.getInformation(e,"text1")),1)])),_:2},1024),(0,s.bF)(Q,{class:"ellipsis-2-lines text-grey-8"},{default:(0,s.k6)((()=>[(0,s.Lk)("b",null,(0,i.v_)(x.getInformation(e,"text2")),1),(0,s.bF)(P,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(x.getInformation(e,"text2")),1)])),_:2},1024)])),_:2},1024)])],10,p)))),128))])])):(0,s.Q3)("",!0),"list-ranking"==x.cardParams.type?((0,s.uX)(),(0,s.CE)("div",f,[!T.loading&&T.items&&T.items.length?((0,s.uX)(),(0,s.Wv)(_,{key:0,style:{height:"350px"}},{default:(0,s.k6)((()=>[(0,s.bF)(S,{bordered:"",separator:""},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(T.items,((e,t)=>((0,s.uX)(),(0,s.Wv)(M,{key:t,class:"bg-grey-2"},{default:(0,s.k6)((()=>[(0,s.bF)(L,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(x.getInformation(e,"text1")),1)])),_:2},1024),(0,s.bF)(L,{side:""},{default:(0,s.k6)((()=>[(0,s.bF)(D,{label:x.getInformation(e,"text2"),color:"white","text-color":"blue-grey",class:"text-weight-bold"},null,8,["label"])])),_:2},1024),x.getInformation(e,"percentage")?((0,s.uX)(),(0,s.Wv)(U,{key:0,color:"green",value:x.getInformation(e,"percentage")},null,8,["value"])):(0,s.Q3)("",!0)])),_:2},1024)))),128))])),_:1})])),_:1})):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0)])),x.showNotResult?((0,s.uX)(),(0,s.CE)("div",b,[(0,s.bF)(E)])):(0,s.Q3)("",!0),"chart"===x.cardParams.type?((0,s.uX)(),(0,s.CE)("div",v,[T.loading||"object"!==typeof T.items?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(X,{key:0,chartsData:T.items},null,8,["chartsData"])),T.loading?((0,s.uX)(),(0,s.CE)("section",y,[(0,s.bF)(N,{type:"QChip",class:"tw-mb-4 tw-mx-auto"}),(0,s.Lk)("div",$,[(0,s.bF)(N,{animated:"",type:"rect",height:"220px",width:"75px"}),(0,s.bF)(N,{animated:"",type:"rect",height:"280px",width:"75px"}),(0,s.bF)(N,{animated:"",type:"rect",height:"250px",width:"75px"}),(0,s.bF)(N,{animated:"",type:"rect",height:"310px",width:"75px"}),(0,s.bF)(N,{animated:"",type:"rect",height:"350px",width:"75px"})])])):(0,s.Q3)("",!0)])):(0,s.Q3)("",!0),"percentage"===x.cardParams.type?((0,s.uX)(),(0,s.CE)("div",k,[T.loading||"object"!==typeof T.items?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",I,[(0,s.Lk)("div",w,[(0,s.bF)(W,{"show-value":"","font-size":"40px",value:T.items.value,size:"200px",thickness:.22,"track-color":"grey-3",class:"q-ma-md tw-text-center colorPercentage"},{default:(0,s.k6)((()=>[(0,s.eW)((0,i.v_)(T.items.value||0)+"% ",1)])),_:1},8,["value"])]),(0,s.Lk)("div",null,[(0,s.Lk)("p",{class:"tw-font-semibold tw-py-5 tw-text-base tw-text-justify tw-break-normal",innerHTML:T.items.description},null,8,q)])]))])):(0,s.Q3)("",!0),"custom"===x.cardParams.type?((0,s.uX)(),(0,s.CE)("div",C,[((0,s.uX)(),(0,s.Wv)((0,s.$y)(x.cardParams.component),{cardParams:{...x.cardParams},items:{...T.items},loading:T.loading},null,8,["cardParams","items","loading"]))])):(0,s.Q3)("",!0),(0,s.Lk)("div",F,[T.items.length&&x.cardParams.actionTo?((0,s.uX)(),(0,s.Wv)(z,{key:0,unelevated:"",label:e.$tr("isite.cms.label.showMore"),color:"primary",rounded:"",to:{name:x.cardParams.actionTo}},null,8,["label","to"])):(0,s.Q3)("",!0)]),T.loading&&"chart"!==x.cardParams.type?((0,s.uX)(),(0,s.Wv)(N,{key:5,type:"rect",height:"350px",width:"100%",class:"tw-mt-4"})):(0,s.Q3)("",!0)])])])}var T=a(63655),x=a(71915);const V={beforeUnmount(){x.Bt.off("page.data.refresh")},props:{params:{type:Object,default:!1}},components:{QCharts:T.A},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,items:[],filterValues:!1}},computed:{showNotResult(){return"custom"!==this.cardParams.type&&("percentage"!==this.cardParams.type&&"chart"!==this.cardParams.type||"object"!==typeof this.items?!this.items.length&&!this.loading:0===Object.keys(this.items).length&&!this.loading)},cardParams(){let e={type:"list-v",...this.params,requestParams:{take:"list-v"==this.params.type?10:6,page:1,...this.params.requestParams||{}}};return this.params.filters&&this.filterValues&&(e.requestParams.filter={...e.requestParams.filter||{},...this.filterValues}),e}},methods:{async init(){this.params.filters?this.setFilters():this.getData(),x.Bt.on("page.data.refresh",(()=>this.getData()))},getData(){return new Promise(((e,t)=>{this.loading=!0;let a={refresh:!0,params:this.cardParams.requestParams||{}};this.$crud.index(this.cardParams.apiRoute,a).then((t=>{this.items=t.data,this.loading=!1,e(t.data)})).catch((t=>{this.$apiResponse.handleError(t,(()=>{this.loading=!1,e(t)}))}))}))},setFilters(){return new Promise((async e=>{await this.$filter.setFilter({name:this.$route.name,fields:this.$clone(this.params.filters||{}),callBack:()=>{this.filterValues=this.$clone(this.$filter.values),this.getData()}}),e(!0)}))},getInformation(e,t){let a=this.cardParams.information||{};return a[t]?a[t].format?a[t].field?a[t].format(e[a[t].field]):a[t].format(e):e[a[t].field]:null}}};var R=a(12807),L=a(24609),Q=a(37015),M=a(19600),S=a(54514),_=a(75329),P=a(63418),D=a(35779),U=a(78151),E=a(88141),X=a(42876),N=a(27817),W=a(52048),z=a(69001),O=a(44029),B=a(98582),H=a.n(B);const j=(0,R.A)(V,[["render",A]]),Y=j;H()(V,"components",{QIcon:L.A,QSeparator:Q.A,QScrollArea:M.A,QList:S.A,QItem:_.A,QItemSection:P.A,QItemLabel:D.A,QTooltip:U.A,QChip:E.A,QLinearProgress:X.A,QSkeleton:N.Ay,QCircularProgress:W.A,QBtn:z.A}),H()(V,"directives",{Ripple:O.A})},15865:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>$});var s=a(61758),i=a(58790);const o={id:"organizationFormPage"},l={key:0,id:"pageContent"},r={class:"box box-auto-height q-mb-md"},n={id:"adminHomeActivities",class:"col-12 q-mb-md"},c={class:"relative-position"},d={key:1,class:"box box-auto-height text-center"},m={class:"q-py-md"};function u(e,t,a,u,p,h){const g=(0,s.g2)("page-actions"),f=(0,s.g2)("activities"),b=(0,s.g2)("dynamic-form"),v=(0,s.g2)("inner-loading"),y=(0,s.g2)("q-icon");return(0,s.uX)(),(0,s.CE)("div",o,[h.organizationIdLocal?((0,s.uX)(),(0,s.CE)("div",l,[(0,s.Lk)("div",r,[(0,s.bF)(g,{title:h.pageTitle,onRefresh:t[0]||(t[0]=e=>h.getData(!0))},null,8,["title"])]),(0,s.Lk)("div",n,[(0,s.bF)(f,{"system-name":"admin_home_actions",view:"cardImage"})]),(0,s.Lk)("div",c,[(0,s.bF)(b,{modelValue:p.form,"onUpdate:modelValue":t[1]||(t[1]=e=>p.form=e),blocks:h.blocks.blocks,"form-type":"grid",onSubmit:h.syncOrganization,"item-id":p.organization.id,"form-col-number":2},null,8,["modelValue","blocks","onSubmit","item-id"]),(0,s.bF)(v,{visible:p.loading},null,8,["visible"])])])):((0,s.uX)(),(0,s.CE)("div",d,[(0,s.Lk)("div",m,[(0,s.bF)(y,{name:"fal fa-crown",size:"40px",color:"primary",class:"q-mb-md"}),(0,s.Lk)("div",null,(0,i.v_)(e.$tr("isite.cms.messages.noOrganization"))+"...",1)])]))])}var p=a(91280);const h={beforeUnmount(){(0,p.A)().setValueLayoutList([])},props:{organizationId:{default:null}},components:{},watch:{"$route.params.id"(e){this.init()}},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,organization:!1,crudData:!1,form:{}}},computed:{blocks(){const e=(0,p.A)().getLayoutsList(),t={blocks:[{title:this.$tr("isite.cms.crudMySite.information.title"),help:{title:this.$tr("isite.cms.crudMySite.information.title"),description:this.$tr("isite.cms.crudMySite.information.description")},name:"information",fields:{title:{value:null,type:"input",isTranslatable:!0,required:!0,props:{label:`${this.$tr("isite.cms.form.name")}*`}},categoryId:{value:null,type:"treeSelect",required:!0,props:{label:`${this.$tr("isite.cms.label.category")}*`},loadOptions:{apiRoute:"apiRoutes.qsite.categories"}},description:{value:null,type:"html",isTranslatable:!0,colClass:"col-12",required:!0,props:{label:`${this.$tr("isite.cms.label.description")}*`}}}},{title:this.$tr("isite.cms.crudMySite.socialNetworks.title"),help:{title:this.$tr("isite.cms.crudMySite.socialNetworks.title"),description:this.$tr("isite.cms.crudMySite.socialNetworks.description")},name:"socialNetworks",fields:{email:{value:null,type:"input",isTranslatable:!0,props:{label:`${this.$tr("isite.cms.label.email")}`}},facebook:{value:null,type:"input",isTranslatable:!0,props:{label:`${this.$tr("isite.cms.label.facebook")}`}},instagram:{value:null,type:"input",isTranslatable:!0,props:{label:`${this.$tr("isite.cms.label.instagram")}`}},youtube:{value:null,type:"input",isTranslatable:!0,props:{label:`${this.$tr("isite.cms.label.youtube")}`}},phones:{value:null,type:"select",colClass:"col-12",isTranslatable:!0,props:{label:this.$tr("isite.cms.form.phone"),useInput:!0,useChips:!0,multiple:!0,hideDropdownIcon:!0,newValueMode:"add-unique"}},whatsapp1:{name:"whatsapp1",label:"Whatsapp #1",isTranslatable:!0,multiple:!0,children:{calling_code:{value:null,type:"select",colClass:"col-6",props:{label:this.$tr("isite.cms.label.codeCountry")},loadOptions:{apiRoute:"apiRoutes.qlocations.countries",select:{label:"name",id:"callingCode"}}},number:{value:null,type:"input",colClass:"col-6",props:{label:this.$tr("isite.cms.label.whatsappNumber"),type:"number"}},message:{value:null,type:"input",colClass:"col-12",props:{label:this.$tr("isite.cms.label.defaultMessage")}},label:{value:null,type:"input",colClass:"col-6",props:{label:"Etiqueta"}},iconLabel:{value:null,type:"input",colClass:"col-6",props:{label:this.$tr("isite.cms.form.icon")}}}},whatsapp2:{name:"whatsapp2",label:"Whatsapp #2",isTranslatable:!0,multiple:!0,children:{calling_code:{value:null,type:"select",colClass:"col-6",props:{label:this.$tr("isite.cms.label.codeCountry")},loadOptions:{apiRoute:"apiRoutes.qlocations.countries",select:{label:"name",id:"callingCode"}}},number:{value:null,type:"input",colClass:"col-6",props:{label:this.$tr("isite.cms.label.whatsappNumber"),type:"number"}},message:{value:null,type:"input",colClass:"col-12",props:{label:this.$tr("isite.cms.label.defaultMessage")}},label:{value:null,type:"input",colClass:"col-6",props:{label:"Etiqueta"}},iconLabel:{value:null,type:"input",colClass:"col-6",props:{label:this.$tr("isite.cms.form.icon")}}}}}},{title:this.$tr("isite.cms.crudMySite.media.title"),help:{title:this.$tr("isite.cms.crudMySite.media.title"),description:this.$tr("isite.cms.crudMySite.media.description")},name:"media",fields:{logo:{name:"mediasSingle",value:[],type:"media",colClass:"col-12",props:{label:"Logo",zone:"mainimage",entity:"Modules\\Isite\\Entities\\Organization",entityId:null,accept:"images"}}}},{title:this.$tr("isite.cms.crudMySite.colors.title"),help:{title:this.$tr("isite.cms.crudMySite.colors.title"),description:this.$tr("isite.cms.crudMySite.colors.description")},name:"colors",fields:{colorPrimary:{value:"#420b0b",type:"inputColor",isTranslatable:!0,props:{label:`${this.$tr("isite.cms.form.primaryColor")}*`}},colorSecondary:{value:"#8b2d2d",type:"inputColor",isTranslatable:!0,props:{label:`${this.$tr("isite.cms.form.secondaryColor")}*`}}}},{title:this.$tr("isite.cms.crudMySite.schedule.title"),help:{title:this.$tr("isite.cms.crudMySite.schedule.title"),description:this.$tr("isite.cms.crudMySite.schedule.description")},name:"schedule",fields:{schedule:{value:null,type:"schedulable",colClass:"col-12",props:{label:`${this.$tr("isite.cms.label.schedule")}*`}}}},{title:this.$tr("isite.cms.crudMySite.meta.title"),help:{title:this.$tr("isite.cms.crudMySite.meta.title"),description:this.$tr("isite.cms.crudMySite.meta.description")},name:"meta",fields:{tags:{value:[],type:"select",colClass:"col-12",props:{label:this.$trp("isite.cms.form.tag"),useInput:!0,useChips:!0,multiple:!0,hideDropdownIcon:!0,inputDebounce:"0",newValueMode:"add-unique"}}}},{...e,name:"layouts",title:this.$tr("isite.cms.crudMySite.layouts.title"),help:{title:this.$tr("isite.cms.crudMySite.layouts.title"),description:this.$tr("isite.cms.crudMySite.layouts.description")}},{title:this.$tr("isite.cms.crudMySite.location.title"),help:{title:this.$tr("isite.cms.crudMySite.location.title"),description:this.$tr("isite.cms.crudMySite.location.description")},name:"location",fields:{provinceId:{value:null,type:"select",isTranslatable:!0,colClass:"col-12",props:{label:this.$tr("isite.cms.form.province")},loadOptions:{apiRoute:"apiRoutes.qlocations.provinces",select:{label:"name",id:"id"},requestParams:{filter:{allTranslations:!0,country:48}},filterByQuery:!0}},cityId:{value:null,type:"select",isTranslatable:!0,colClass:"col-12",props:{label:this.$tr("isite.cms.form.city"),readonly:!1},loadOptions:{apiRoute:"apiRoutes.qlocations.cities",select:{label:"name",id:"id"},requestParams:{filter:{allTranslations:!0,country:48}},filterByQuery:!0}},address:{value:null,type:"input",colClass:"col-12",isTranslatable:!0,props:{label:this.$tr("isite.cms.form.address")}},map:{value:null,type:"positionMarkerMap",colClass:"col-12",isTranslatable:!0,props:{label:this.$tr("isite.cms.label.map")}}}}]};return t},pageTitle(){return this.$tr(this.$route.meta.title)},organizationIdLocal(){return this.$clone(this.organizationId||this.$route.params.id)}},methods:{init(){this.getData(!0)},getData(e=!1){return new Promise((async t=>{this.loading=!0;try{await Promise.all([this.getOrganizationData(e),(0,p.A)().getLayouts()]),await this.getSubscriptionData(!0,this.organization.userId)}catch(a){this.$alert.error({message:this.$tr("isite.cms.message.errorRequest")})}this.loading=!1}))},getOrganizationData(e=!1){return new Promise(((t,a)=>{if(!this.organizationIdLocal)return t(null);let s={refresh:e,params:{include:"fields,schedule.workTimes,tags",filter:{allTranslations:!0}}};this.$crud.show("apiRoutes.qsite.organizations",this.organizationIdLocal,s).then((e=>{this.organization=this.$clone(e.data),this.form=this.$clone(e.data),(0,p.A)().setSelectedLayout(e.data.layoutId),t(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{a(e)}))}))}))},syncOrganization(){return new Promise(((e,t)=>{const a=(0,p.A)().getSelectedLayout();a&&(this.form.layoutId=a,(0,p.A)().setSelectedLayout(a)),this.loading=!0,this.$crud.update("apiRoutes.qsite.organizations",this.organization.id,this.form).then((e=>{this.$alert.info({message:this.$tr("isite.cms.message.recordUpdated")}),this.loading=!1,(0,p.A)().setSelectedFile()})).catch((e=>{this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")}),this.loading=!1}))}))},getSubscriptionData(e=!1,t){return new Promise(((a,s)=>{if(!t)return a(null);let i={refresh:e,params:{include:"plan",filter:{field:"entity_id",entity:"Modules\\User\\Entities\\Sentinel\\User"}}};this.$crud.show("apiRoutes.qplan.subscriptions",t,i).then((e=>{const t=e?.data?.plan?.options?.layouts??[];this.filteredLayouts(t),a(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{s(e)}))}))}))},filteredLayouts(e=[]){const t=(0,p.A)(),a=t.getAllLayouts(),s=a.filter((t=>e.includes(t.systemName))),i=t.mapLayoutsList(s);t.setValueLayoutList(i)}}};var g=a(12807),f=a(24609),b=a(98582),v=a.n(b);const y=(0,g.A)(h,[["render",u]]),$=y;v()(h,"components",{QIcon:f.A})},57731:(e,t,a)=>{"use strict";a.d(t,{A:()=>w});var s=a(61758),i=a(58790);const o={key:0,class:"row relative-position"},l={class:"col-12 q-mb-md"},r={key:0,class:"col-7 q-gutter-y-md"},n={key:1,class:"col-5 q-gutter-y-md"},c={class:"input-title"},d={class:"col-12 text-right"};function m(e,t,a,m,u,p){const h=(0,s.g2)("locales"),g=(0,s.g2)("q-input"),f=(0,s.g2)("q-editor"),b=(0,s.g2)("q-select"),v=(0,s.g2)("mediaForm"),y=(0,s.g2)("q-btn"),$=(0,s.g2)("q-form"),k=(0,s.g2)("inner-loading");return u.success?((0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",l,[(0,s.bF)(h,{modelValue:u.locale,"onUpdate:modelValue":t[0]||(t[0]=e=>u.locale=e),ref:"localeComponent",form:e.$refs.formContent},null,8,["modelValue","form"])]),(0,s.bF)($,{onSubmit:t[12]||(t[12]=e=>u.itemId?p.updateItem():p.createItem()),ref:"formContent",class:"row q-col-gutter-x-md full-width",autocomplete:"off",onValidationError:t[13]||(t[13]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,s.k6)((()=>[u.locale.success?((0,s.uX)(),(0,s.CE)("div",r,[(0,s.bF)(g,{label:`${e.$tr("isite.cms.form.title")} (${u.locale.language}) `,type:"text",modelValue:u.locale.formTemplate.title,"onUpdate:modelValue":t[1]||(t[1]=e=>u.locale.formTemplate.title=e),outlined:"",dense:""},null,8,["label","modelValue"]),(0,s.bF)(g,{label:`${e.$tr("isite.cms.form.caption")} (${u.locale.language}) `,type:"text",outlined:"",dense:"",modelValue:u.locale.formTemplate.caption,"onUpdate:modelValue":t[2]||(t[2]=e=>u.locale.formTemplate.caption=e)},null,8,["label","modelValue"]),(0,s.bF)(g,{label:"URI ("+u.locale.language+")",outlined:"",dense:"",type:"text",modelValue:u.locale.formTemplate.uri,"onUpdate:modelValue":t[3]||(t[3]=e=>u.locale.formTemplate.uri=e)},null,8,["label","modelValue"]),(0,s.bF)(g,{label:"URL ("+u.locale.language+")",type:"text",modelValue:u.locale.formTemplate.url,"onUpdate:modelValue":t[4]||(t[4]=e=>u.locale.formTemplate.url=e),outlined:"",dense:""},null,8,["label","modelValue"]),(0,s.bF)(g,{label:`${e.$tr("isite.cms.form.image")} URL (${u.locale.language}) `,type:"text",outlined:"",dense:"",modelValue:u.locale.formTemplate.externalImageUrl,"onUpdate:modelValue":t[5]||(t[5]=e=>u.locale.formTemplate.externalImageUrl=e)},null,8,["label","modelValue"]),(0,s.bF)(f,{label:`${e.$tr("isite.cms.form.description")} (${u.locale.language}) `,modelValue:u.locale.formTemplate.customHtml,"onUpdate:modelValue":t[6]||(t[6]=e=>u.locale.formTemplate.customHtml=e),style:{width:"100%"}},null,8,["label","modelValue"])])):(0,s.Q3)("",!0),u.locale.success?((0,s.uX)(),(0,s.CE)("div",n,[p.canManageRecordMaster?((0,s.uX)(),(0,s.Wv)(b,{key:0,modelValue:u.locale.formTemplate.options.masterRecord,"onUpdate:modelValue":t[7]||(t[7]=e=>u.locale.formTemplate.options.masterRecord=e),label:e.$tr("isite.cms.form.masterRecord"),outlined:"",dense:"","emit-value":"","map-options":"",options:[{label:this.$tr("isite.cms.label.yes"),value:1},{label:this.$tr("isite.cms.label.no"),value:0}]},null,8,["modelValue","label","options"])):(0,s.Q3)("",!0),(0,s.bF)(b,{label:`${e.$tr("isite.cms.form.status")} (${u.locale.language})`,modelValue:u.locale.formTemplate.active,"onUpdate:modelValue":t[8]||(t[8]=e=>u.locale.formTemplate.active=e),outlined:"",dense:"","emit-value":"","map-options":"",options:[{label:e.$tr("isite.cms.label.enabled"),value:!0},{label:e.$tr("isite.cms.label.disabled"),value:!1}]},null,8,["label","modelValue","options"]),(0,s.bF)(b,{label:`${e.$tr("isite.cms.form.option")}`,modelValue:u.locale.formTemplate.target,"onUpdate:modelValue":t[9]||(t[9]=e=>u.locale.formTemplate.target=e),"emit-value":"","map-options":"",outlined:"",dense:"",options:[{value:"_self",label:"Same tab"},{value:"_blank",label:"New tab"}]},null,8,["label","modelValue"]),(0,s.bF)(b,{label:`${e.$tr("isite.cms.form.type")}`,modelValue:u.locale.formTemplate.type,"onUpdate:modelValue":t[10]||(t[10]=e=>u.locale.formTemplate.type=e),"emit-value":"","map-options":"",outlined:"",dense:"",options:[{value:"auto",label:"Auto"},{value:"360",label:"360"},{value:"video",label:"Video"},{value:"image",label:"Image"}]},null,8,["label","modelValue"]),(0,s.Lk)("div",c,(0,i.v_)(`${e.$tr("isite.cms.form.image")}`),1),((0,s.uX)(),(0,s.Wv)(v,{entity:"Modules\\Slider\\Entities\\Slide","entity-id":u.itemId?u.itemId:"",modelValue:u.locale.formTemplate.mediasSingle,"onUpdate:modelValue":t[11]||(t[11]=e=>u.locale.formTemplate.mediasSingle=e),zone:"slideimage",key:u.mediaKey},null,8,["entity-id","modelValue"]))])):(0,s.Q3)("",!0),(0,s.Lk)("div",d,[u.itemId?((0,s.uX)(),(0,s.Wv)(y,{key:0,color:"positive",loading:u.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.update"),type:"submit",rounded:""},null,8,["loading","label"])):((0,s.uX)(),(0,s.Wv)(y,{key:1,color:"positive",loading:u.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.create"),type:"submit",rounded:""},null,8,["loading","label"]))])])),_:1},512),(0,s.bF)(k,{visible:u.loading},null,8,["visible"])])):(0,s.Q3)("",!0)}a(10239);var u=a(99205);const p={components:{mediaForm:u.A},watch:{$route(e,t){this.initForm()}},mounted(){this.$nextTick((()=>{this.initForm()}))},data(){return{locale:{},loading:!1,success:!1,itemId:!1,mediaKey:this.$uid()}},computed:{dataLocale(){return{fields:{sliderId:this.$route.params.sliderId,target:null,type:"auto",mediasSingle:{},externalImageUrl:"",options:{masterRecord:0}},fieldsTranslatable:{title:"",caption:"",active:!0,url:"",uri:"",customHtml:""}}},canManageRecordMaster(){let e=!0;return this.$route.params.sliderId.id&&!this.$hasAccess("isite.master.records.edit")&&(e=!1),this.$route.params.sliderId.id||this.$hasAccess("isite.master.records.create")||(e=!1),e}},methods:{async initForm(){this.loading=!0,this.success=!1,this.locale=this.$clone(this.dataLocale),this.itemId=this.$route.params.id,this.locale.success&&this.$refs.localeComponent.vReset(),await this.getData(),this.success=!0,this.loading=!1},getData(){return new Promise(((e,t)=>{const a=this.$clone(this.itemId);if(a){let s="apiRoutes.qslider.slides",i={refresh:!0,params:{filter:{allTranslations:!0}}};this.$crud.show(s,a,i).then((t=>{this.orderDataItemToLocale(t.data),e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1,t(!1)}))}))}else e(!0)}))},orderDataItemToLocale(e){let t=this.$clone(e);this.locale.form=this.$clone(t)},async createItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qslider.slides";this.$crud.create(e,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordCreated")} ID: ${e.data.id}`}),this.$router.push({name:"qslider.admin.sliders.show",params:{id:this.$route.params.sliderId}}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoCreated"),pos:"bottom"})}))}},async updateItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qslider.slides";this.$crud.update(e,this.itemId,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},getDataForm(){let e=this.locale.form;for(var t in e){let a=e[t];null!=a&&void 0!=a||delete e[t]}return e.selectable=JSON.stringify(e.selectable),e}}};var h=a(12807),g=a(21565),f=a(78020),b=a(94192),v=a(833),y=a(69001),$=a(98582),k=a.n($);const I=(0,h.A)(p,[["render",m]]),w=I;k()(p,"components",{QForm:g.A,QInput:f.A,QEditor:b.A,QSelect:v.A,QBtn:y.A})},66689:(e,t,a)=>{e.exports=a.p+"img/favicon.004b103b.ico"}}]);