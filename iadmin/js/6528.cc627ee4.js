"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[6528],{96528:(e,t,l)=>{l.r(t),l.d(t,{default:()=>w});var a=l(92444),o=l(74044),s=l(264);const i={id:"pageId",class:"q-layout-page layout-padding"},r={class:"relative-position q-mb-lg backend-page"},m={class:"box"},d={class:"col-md-8"},u={class:"col-md-4"};function c(e,t,l,c,n,p){const f=(0,a.E1)("q-tooltip"),h=(0,a.E1)("q-btn"),g=(0,a.E1)("q-input"),b=(0,a.E1)("q-select"),$=(0,a.E1)("q-item-section"),y=(0,a.E1)("q-item"),V=(0,a.E1)("dynamic-field"),q=(0,a.E1)("q-icon"),v=(0,a.E1)("q-date"),D=(0,a.E1)("q-popup-proxy"),Q=(0,a.E1)("q-page-sticky"),K=(0,a.E1)("q-form"),R=(0,a.E1)("inner-loading");return(0,a.Wz)(),(0,a.An)("div",i,[(0,a.QD)("div",r,[(0,a.QD)("div",m,[(0,a.K2)(K,{onSubmit:t[22]||(t[22]=t=>e.$route.params.id?p.updateItem():p.createItem()),ref:"formContent",onValidationError:t[23]||(t[23]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid"))),class:"row q-col-gutter-x-md",autocomplete:"off"},{default:(0,a.Ql)((()=>[(0,a.QD)("div",d,[(0,a.K2)(g,{modelValue:n.form.code,"onUpdate:modelValue":t[1]||(t[1]=e=>n.form.code=e),type:"text",outlined:"",dense:"",label:e.$tr("icommerce.cms.form.code"),rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},{after:(0,a.Ql)((()=>[(0,a.K2)(h,{onClick:t[0]||(t[0]=e=>p.generateCoupon()),round:"",size:"sm",color:"primary",icon:"fas fa-qrcode"},{default:(0,a.Ql)((()=>[(0,a.K2)(f,null,{default:(0,a.Ql)((()=>[(0,a.mY)("Generate Code")])),_:1})])),_:1})])),_:1},8,["modelValue","label","rules"]),(0,a.K2)(b,{outlined:"",dense:"","bg-color":"white",modelValue:n.form.typeDiscount,"onUpdate:modelValue":t[2]||(t[2]=e=>n.form.typeDiscount=e),label:`${e.$tr("icommerce.cms.form.typeDiscount")}*`,style:{width:"100%"},"emit-value":"","map-options":"",options:[{label:this.$tr("icommerce.cms.options.fixedValue"),value:"0"},{label:this.$tr("icommerce.cms.options.percentage"),value:"1"}],rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","options","rules"]),(0,a.K2)(g,{modelValue:n.form.discount,"onUpdate:modelValue":t[3]||(t[3]=e=>n.form.discount=e),type:"number",outlined:"",dense:"",rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("icommerce.cms.form.discount")} *`},null,8,["modelValue","rules","label"]),(0,a.K2)(g,{modelValue:n.form.quantityTotal,"onUpdate:modelValue":t[4]||(t[4]=e=>n.form.quantityTotal=e),type:"number",outlined:"",dense:"",rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("icommerce.cms.form.quantityTotal")} *`},null,8,["modelValue","rules","label"]),(0,a.K2)(g,{modelValue:n.form.quantityTotalCustomer,"onUpdate:modelValue":t[5]||(t[5]=e=>n.form.quantityTotalCustomer=e),type:"number",outlined:"",dense:"",rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("icommerce.cms.form.quantityTotalCustomer")} *`},null,8,["modelValue","rules","label"]),(0,a.g1)("",!0),(0,a.K2)(b,{outlined:"",dense:"","bg-color":"white",modelValue:n.form.type,"onUpdate:modelValue":t[7]||(t[7]=e=>n.form.type=e),label:`${e.$tr("icommerce.cms.form.allOrder")}*`,style:{width:"100%"},"emit-value":"","map-options":"",options:[{label:this.$tr("isite.cms.label.no"),value:"0"},{label:this.$tr("isite.cms.label.yes"),value:"1"}],rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","options","rules"]),(0,a.wt)((0,a.QD)("div",null,[(0,a.K2)(b,{outlined:"",dense:"",modelValue:n.form.products,"onUpdate:modelValue":t[8]||(t[8]=e=>n.form.products=e),"use-input":"","emit-value":"","map-options":"","input-debounce":"800",options:n.productList,onFilter:p.getProducts,label:`${e.$trp("isite.cms.label.product")}`,multiple:"","use-chips":"",style:{width:"100%"},hint:`${e.$tr("icommerce.cms.form.productHint")}`},{"no-option":(0,a.Ql)((()=>[(0,a.K2)(y,null,{default:(0,a.Ql)((()=>[(0,a.K2)($,{class:"text-grey"},{default:(0,a.Ql)((()=>[(0,a.mY)((0,o.WA)(e.$tr("isite.cms.message.searchNotFound")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","options","onFilter","label","hint"]),(0,a.K2)(V,{field:p.dynamicFields.categories,modelValue:n.form.categories,"onUpdate:modelValue":t[9]||(t[9]=e=>n.form.categories=e)},null,8,["field","modelValue"]),(0,a.K2)(V,{field:p.dynamicFields.manufacturers,modelValue:n.form.manufacturers,"onUpdate:modelValue":t[10]||(t[10]=e=>n.form.manufacturers=e)},null,8,["field","modelValue"])],512),[[s.Ub,"0"==n.form.type]])]),(0,a.QD)("div",u,[(0,a.K2)(b,{outlined:"",dense:"","bg-color":"white",modelValue:n.form.status,"onUpdate:modelValue":t[11]||(t[11]=e=>n.form.status=e),rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("icommerce.cms.form.status")}*`,style:{width:"100%"},"emit-value":"","map-options":"",options:[{label:this.$tr("isite.cms.label.enabled"),value:"1"},{label:this.$tr("isite.cms.label.disabled"),value:"2"}]},null,8,["modelValue","rules","label","options"]),(0,a.K2)(g,{dense:"",mask:"date","bg-color":"white",modelValue:n.form.dateStart,"onUpdate:modelValue":t[14]||(t[14]=e=>n.form.dateStart=e),color:"primary",rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("icommerce.cms.form.dateStart")}*`,outlined:"",placeholder:"YYYY/MM/DD"},{append:(0,a.Ql)((()=>[(0,a.K2)(q,{name:"fas fa-calendar-day"}),(0,a.K2)(D,{ref:"qDateStart","transition-show":"scale","transition-hide":"scale"},{default:(0,a.Ql)((()=>[(0,a.K2)(v,{modelValue:n.form.dateStart,"onUpdate:modelValue":[t[12]||(t[12]=e=>n.form.dateStart=e),t[13]||(t[13]=t=>e.$refs.qDateStart.hide())]},null,8,["modelValue"])])),_:1},512)])),_:1},8,["modelValue","rules","label"]),(0,a.K2)(g,{dense:"",mask:"date","bg-color":"white",modelValue:n.form.dateEnd,"onUpdate:modelValue":t[17]||(t[17]=e=>n.form.dateEnd=e),color:"primary",rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("icommerce.cms.form.dateEnd")}*`,outlined:"",placeholder:"YYYY/MM/DD"},{append:(0,a.Ql)((()=>[(0,a.K2)(q,{name:"fas fa-calendar-day"}),(0,a.K2)(D,{ref:"qDateEnd","transition-show":"scale","transition-hide":"scale"},{default:(0,a.Ql)((()=>[(0,a.K2)(v,{modelValue:n.form.dateEnd,"onUpdate:modelValue":[t[15]||(t[15]=e=>n.form.dateEnd=e),t[16]||(t[16]=t=>e.$refs.qDateEnd.hide())]},null,8,["modelValue"])])),_:1},512)])),_:1},8,["modelValue","rules","label"]),(0,a.g1)("",!0),(0,a.K2)(b,{outlined:"",dense:"","bg-color":"white",modelValue:n.form.logged,"onUpdate:modelValue":t[19]||(t[19]=e=>n.form.logged=e),label:`${e.$tr("icommerce.cms.form.logged")}*`,style:{width:"100%"},"emit-value":"","map-options":"",options:[{label:this.$tr("isite.cms.label.yes"),value:"1"},{label:this.$tr("isite.cms.label.no"),value:"0"}],rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","options","rules"]),(0,a.K2)(V,{field:p.dynamicFields.includeDepartments,modelValue:n.form.includeDepartments,"onUpdate:modelValue":t[20]||(t[20]=e=>n.form.includeDepartments=e)},null,8,["field","modelValue"]),(0,a.K2)(V,{field:p.dynamicFields.excludeDepartments,modelValue:n.form.excludeDepartments,"onUpdate:modelValue":t[21]||(t[21]=e=>n.form.excludeDepartments=e)},null,8,["field","modelValue"])]),(0,a.K2)(Q,{position:"bottom-right",offset:[18,18]},{default:(0,a.Ql)((()=>[e.$route.params.id?((0,a.Wz)(),(0,a.Az)(h,{key:0,color:"green",loading:n.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.update"),type:"submit"},null,8,["loading","label"])):((0,a.Wz)(),(0,a.Az)(h,{key:1,color:"green",loading:n.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.create"),type:"submit"},null,8,["loading","label"]))])),_:1})])),_:1},512),(0,a.K2)(R,{visible:n.loading},null,8,["visible"])])])])}l(23816);var n=l(8932);const p={components:{},computed:{dynamicFields(){return{includeDepartments:{value:[0],type:"select",loadOptions:{apiRoute:"apiRoutes.quser.departments",select:{label:"title",id:"id"}},props:{clearable:!0,multiple:!0,label:`${this.$tr("icommerce.cms.form.customerGroup")}*`,options:[{label:"All",value:0}]}},excludeDepartments:{value:[],type:"select",loadOptions:{apiRoute:"apiRoutes.quser.departments",select:{label:"title",id:"id"}},props:{clearable:!0,multiple:!0,label:`${this.$tr("icommerce.cms.form.customerGroupExclude")}`}},categories:{value:[],type:"treeSelect",loadOptions:{apiRoute:"apiRoutes.qcommerce.categories",select:{label:"title",id:"id"}},props:{clearable:!0,multiple:!0,label:`${this.$trp("isite.cms.label.category")}`}},manufacturers:{value:[],type:"select",loadOptions:{apiRoute:"apiRoutes.qcommerce.manufacturers",select:{label:"name",id:"id"}},props:{clearable:!0,multiple:!0,useChips:!0,label:`${this.$trp("icommerce.cms.form.manufacturer")}`}}}}},data(){return{loading:!1,types:[],productList:[],form:{id:"",code:"",discount:"",type:"1",typeDiscount:null,logged:"0",shipping:"0",minimumOrderAmount:"0",quantityProducts:"0",dateStart:"",dateEnd:"",quantityTotal:"",quantityTotalCustomer:"",status:1,includeDepartments:[0],excludeDepartments:[],categories:[],products:[],manufacturers:[]}}},watch:{"form.type":function(e){}},mounted(){this.$nextTick((()=>{this.initForm(),n.kN.on("page.data.refresh",(()=>this.initForm()))}))},methods:{initForm(){this.$route.params.id&&this.getData()},getData(){this.loading=!0;let e={refresh:!0,params:{include:"categories,products,manufacturers"}};this.$crud.show("apiRoutes.qcommerce.coupons",this.$route.params.id,e).then((e=>{let t=this.$clone(e.data);for(let l in t)t[l]=Array.isArray(e.data[l])?e.data[l]:null!=e.data[l]?e.data[l].toString():null;Object.assign(this.form,{...t}),setTimeout((()=>{this.form.products&&this.form.products.length>0&&this.getProductsFromBack(),this.loading=!1}),1e3)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{console.error(e),this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1}))}))},getProducts(e,t,l){if(e.length<2)return l();let a={params:{take:100,filter:{search:e}}};this.$crud.index("apiRoutes.qcommerce.products",a).then((e=>{t((()=>{let t=this.$array.select(e.data,{label:"name",id:"id"});this.productList=this.$clone(t)}))})).catch((e=>{this.$apiResponse.handleError(e,(()=>{t((()=>{this.productList=[]}))}))}))},getProductsFromBack(){this.form.products=this.form.products.map((e=>e.id));let e={params:{take:100,filter:{ids:this.form.products}}};this.$crud.index("apiRoutes.qcommerce.products",e).then((e=>{let t=this.$array.select(e.data,{label:"name",id:"id"});this.productList=this.$clone(t)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.productList=[]}))}))},createItem(){this.loading=!0,this.$crud.create("apiRoutes.qcommerce.coupons",this.form).then((e=>{this.loading=!1,this.$router.push({name:"qcommerce.admin.coupons.index"}),this.$alert.success({message:`${this.$tr("isite.cms.message.recordCreated")} ID: ${e.data.id}`})})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoCreatde"),pos:"bottom"})}))},updateItem(){this.loading=!0,this.$crud.update("apiRoutes.qcommerce.coupons",this.form.id,this.form).then((e=>{this.loading=!1,this.$router.push({name:"qcommerce.admin.coupons.index"}),this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.initForm()})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))},generateCoupon(){this.form.code=this.makeCouponCode(20).toUpperCase()},makeCouponCode(e=10){let t="",l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=l.length;for(var o=0;o<e;o++)t+=l.charAt(Math.floor(Math.random()*a));return t}}};var f=l(68716),h=l(41628),g=l(14288),b=l(20540),$=l(99140),y=l(90111),V=l(36008),q=l(84884),v=l(11032),D=l(58120),Q=l(7120),K=l(59576),R=l(60352),E=l(95252),U=l.n(E);const k=(0,f.c)(p,[["render",c]]),w=k;U()(p,"components",{QLayout:h.c,QForm:g.c,QInput:b.c,QBtn:$.c,QTooltip:y.c,QSelect:V.c,QItem:q.c,QItemSection:v.c,QIcon:D.c,QPopupProxy:Q.c,QDate:K.c,QPageSticky:R.c})}}]);