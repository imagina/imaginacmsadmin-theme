"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[2404],{96004:(t,e,a)=>{a.r(e),a.d(e,{default:()=>P});var n=a(92444),o=a(74044);const s={id:"appointmentIndexPage"},i={id:"appointmentIndexPageContent"},r={class:"box relative-position"},l={key:0,class:"row justify-between"},p={class:"box-title"},m={key:2},c={class:"text-center"},d=["innerHTML"],u={class:"row q-gutter-x-md justify-center full-width"};function h(t,e,a,h,g,f){const b=(0,n.E1)("q-icon"),v=(0,n.E1)("q-item-label"),E=(0,n.E1)("q-item-section"),Q=(0,n.E1)("q-item"),k=(0,n.E1)("q-list"),q=(0,n.E1)("q-btn-dropdown"),x=(0,n.E1)("q-toolbar-title"),y=(0,n.E1)("q-btn"),$=(0,n.E1)("q-toolbar"),w=(0,n.E1)("dynamic-form"),I=(0,n.E1)("q-card-section"),A=(0,n.E1)("q-card"),z=(0,n.E1)("q-dialog"),D=(0,n.E1)("q-separator"),C=(0,n.E1)("advance-chat"),K=(0,n.E1)("inner-loading"),R=(0,n.iS)("close-popup");return(0,n.Wz)(),(0,n.An)("div",s,[(0,n.QD)("div",i,[(0,n.QD)("div",r,[g.appointment?((0,n.Wz)(),(0,n.An)("div",l,[(0,n.QD)("div",p,[(0,n.K2)(b,{name:"fas fa-calendar-check"}),(0,n.mY)(" "+(0,o.WA)(g.appointment.category.title),1)]),f.appointmentActions.length?((0,n.Wz)(),(0,n.Az)(q,{key:0,flat:"",color:"blue-grey","dropdown-icon":"fas fa-ellipsis-v",round:"",unelevated:""},{default:(0,n.Ql)((()=>[(0,n.K2)(k,null,{default:(0,n.Ql)((()=>[((0,n.Wz)(!0),(0,n.An)(n.ae,null,(0,n.mi)(f.appointmentActions,((t,e)=>(0,n.wt)(((0,n.Wz)(),(0,n.Az)(Q,{key:e,clickable:"",onClick:e=>t.action()},{default:(0,n.Ql)((()=>[(0,n.K2)(E,null,{default:(0,n.Ql)((()=>[(0,n.K2)(v,null,{default:(0,n.Ql)((()=>[(0,n.mY)((0,o.WA)(t.title),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])),[[R]]))),128))])),_:1})])),_:1})):(0,n.g1)("",!0)])):(0,n.g1)("",!0),f.formErrorId?((0,n.Wz)(),(0,n.Az)(z,{key:1,modelValue:g.modalReportError,"onUpdate:modelValue":e[1]||(e[1]=t=>g.modalReportError=t),persistent:""},{default:(0,n.Ql)((()=>[(0,n.K2)(A,{id:"dialogInformation",class:"bg-grey-1"},{default:(0,n.Ql)((()=>[(0,n.K2)($,{class:"bg-primary text-white"},{default:(0,n.Ql)((()=>[(0,n.K2)(x,null,{default:(0,n.Ql)((()=>[(0,n.QD)("label",null,(0,o.WA)(t.$tr("iappointment.cms.message.reportError")),1)])),_:1}),(0,n.wt)((0,n.K2)(y,{flat:"",icon:"fas fa-times"},null,512),[[R]])])),_:1}),(0,n.K2)(I,{class:"relative-position col-12"},{default:(0,n.Ql)((()=>[(0,n.K2)(w,{"form-id":f.formErrorId,onSent:e[0]||(e[0]=t=>g.modalReportError=!1),"send-to":{apiRoute:"apiRoutes.qform.leads",extraData:{formId:f.formErrorId}}},null,8,["form-id","send-to"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):(0,n.g1)("",!0),(0,n.K2)(D,{class:"q-mt-sm q-mb-md"}),"message"==f.process.name?((0,n.Wz)(),(0,n.An)("div",m,[(0,n.QD)("div",c,[(0,n.K2)(b,{name:f.process.message.icon,color:f.process.message.color,size:"40px",class:"q-mb-md"},null,8,["name","color"]),(0,n.QD)("div",{innerHTML:f.process.message.text,class:"q-mb-md"},null,8,d),(0,n.QD)("div",u,[4==f.process.status?((0,n.Wz)(),(0,n.Az)(y,{key:0,label:t.$tr("iappointment.cms.message.resumAppointment"),rounded:"",unelevated:"",color:"amber","no-caps":"",padding:"xs md",onClick:e[2]||(e[2]=t=>f.updateAppointmentStatus(1))},null,8,["label"])):(0,n.g1)("",!0),(0,n.K2)(y,{label:t.$tr("iappointment.cms.message.appointmentList"),rounded:"",unelevated:"",color:"green","no-caps":"",to:{name:"qappointment.main.appointments.index"},padding:"xs md"},null,8,["label","to"])])])])):(0,n.g1)("",!0),"form"==f.process.name?((0,n.Wz)(),(0,n.Az)(w,(0,n.Gu)({key:3,modelValue:g.form,"onUpdate:modelValue":e[3]||(e[3]=t=>g.form=t),onSubmit:f.sendForm},2==f.process.status?f.formProps.appointment:f.formProps.rating),null,16,["modelValue","onSubmit"])):(0,n.g1)("",!0),"chat"==f.process.name?((0,n.Wz)(),(0,n.Az)(C,(0,n.Gu)({key:4,height:"calc(100vh - 280px)"},f.chatProps),null,16)):(0,n.g1)("",!0),(0,n.K2)(K,{visible:g.loading},null,8,["visible"])])])])}a(23816);var g=a(19058),f=a(8932);const b={beforeUnmount(){f.kN.off("page.data.refresh"),f.kN.off("iappointment.appoinment.was.changed")},props:{},components:{advanceChat:g.c},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,modalReportError:!1,appointment:!1,form:{}}},computed:{formErrorId(){return this.$getSetting("iappointment::errorFormRelated")},appointmentActions(){let t=[];return this.formErrorId&&t.push({name:"reportError",title:this.$tr("iappointment.cms.message.reportError"),action:t=>{this.modalReportError=!0}}),t},process(){let t=this.appointment.fields||[],e=parseInt(this.appointment.statusId||0),a={0:"message",1:"message",2:"form",3:"chat",4:"message",5:"message",6:t.find((t=>"rating"==t.name))?"message":"form"},n={0:{text:this.$tr("isite.cms.message.notFound"),icon:"fa-light fa-plug-circle-xmark",color:"red"},1:{text:this.$tr("iappointment.cms.message.assigningMessage"),icon:"fas fa-user-clock",color:"primary"},4:{text:this.$tr("iappointment.cms.message.abandonedMessage"),icon:"fas fa-user-lock",color:"amber"},5:{text:this.$tr("iappointment.cms.message.expiredMessage"),icon:"fas fa-user-clock",color:"red"},6:{text:this.$tr("iappointment.cms.message.completedMessage"),icon:"fas fa-user-check",color:"green"}};return{status:e,name:a[e],message:n[e]}},formProps(){return{appointment:{formId:!!this.appointment&&this.appointment.category.formId,ref:"appointmentForm"},rating:{ref:"appointmentForm",title:this.$tr("isite.cms.message.rateYour",{name:this.appointment?this.appointment.category.title:""}),blocks:[{fields:{rating:{value:1,type:"rating",colClass:"col-12",required:!0,props:{label:this.$tr("isite.cms.label.rating")}},ratingComments:{value:null,type:"input",colClass:"col-12",props:{label:`${this.$tr("isite.cms.label.comment")}...`,type:"textarea",rows:"3"}}}}]}}},chatProps(){return{roomId:!(!this.appointment||!this.appointment.conversation)&&this.appointment.conversation.id,ref:"appointmentChat",loadRooms:!(!this.appointment||!this.appointment.conversation)}},appointmentData(){this.$clone(this.appointment);return response}},methods:{async init(){this.listenEvents(),await this.getData()},listenEvents(){f.kN.on("page.data.refresh",(()=>{this.getData(!0)})),f.kN.on("iappointment.appoinment.was.changed",(t=>{this.getData(!0)}))},getData(t=!1){return new Promise(((t,e)=>{this.loading=!0;let a={refresh:!0,params:{include:"category,conversation,fields"}};this.$crud.show("apiRoutes.qappointment.appointments",this.$route.params.id,a).then((e=>{this.appointment=e.data,this.loading=!1,t(e.data)})).catch((t=>{this.$apiResponse.handleError(t,(()=>{this.loading=!1,e(t)}))}))}))},updateAppointmentStatus(t=!1){return new Promise(((e,a)=>{if(!t||!this.appointment)return a(!1);let n={statusId:t};this.$crud.update("apiRoutes.qappointment.appointments",this.appointment.id,n).then((t=>{this.getData(),e(t.data)})).catch((t=>{a(t)}))}))},sendForm(){return new Promise(((t,e)=>{this.loading=!0;let a={appointmentId:this.$route.params.id,...this.form};this.$crud.create("apiRoutes.qappointment.appointmentLeads",a).then((t=>{this.$refs.appointmentForm.reset(),this.form={},this.getData()})).catch((t=>{this.loading=!1}))}))}}};var v=a(68716),E=a(58120),Q=a(82764),k=a(99588),q=a(84884),x=a(11032),y=a(2992),$=a(30852),w=a(70608),I=a(6536),A=a(36524),z=a(99140),D=a(71008),C=a(70880),K=a(81020),R=a(95252),W=a.n(R);const _=(0,v.c)(b,[["render",h]]),P=_;W()(b,"components",{QIcon:E.c,QBtnDropdown:Q.c,QList:k.c,QItem:q.c,QItemSection:x.c,QItemLabel:y.c,QDialog:$.c,QCard:w.c,QToolbar:I.c,QToolbarTitle:A.c,QBtn:z.c,QCardSection:D.c,QSeparator:C.c}),W()(b,"directives",{ClosePopup:K.c})}}]);