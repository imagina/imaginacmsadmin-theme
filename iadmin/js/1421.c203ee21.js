"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[1421],{91421:(t,e,s)=>{s.r(e),s.d(e,{default:()=>mt});var a=s(61758),i=s(58790);const o={id:"quotesFormPage"},r={id:"quoteFormContent",class:"relative-position"},l={class:"row q-col-gutter-md"},c={class:"col-4"},d={class:"box box-auto-height q-mb-md"},n={class:"row items-center"},m={class:"col box-title"},u={class:"col text-right"},p={class:"text-grey q-mr-sm"},h={key:0},g={class:"box box-auto-height q-mb-md"},b={class:"row items-center"},v={class:"col box-title"},$={class:"row items-center"},f={class:"col-7 text-caption text-blue-grey",style:{"line-height":"1"}},k={class:"col-5 text-right"},q={class:"box box-auto-height q-mb-md"},C={class:"row items-center"},x={class:"col box-title"},L={class:"row"},y={class:"col-6 text-blue-grey"},D={class:"col-6 text-right"},_=(0,a.Lk)("div",{class:"col-6 text-blue-grey"},"Total:",-1),P={class:"col-6 text-right"},F={id:"actionsSummary",class:"text-right"},w={key:1,class:"box box-auto-height text-center"},I={class:"q-mb-sm"},V={class:"col-8"};function O(t,e,s,O,A,Q){const E=(0,a.g2)("q-btn"),X=(0,a.g2)("q-separator"),R=(0,a.g2)("dynamic-form"),S=(0,a.g2)("master-modal"),T=(0,a.g2)("btn-menu"),B=(0,a.g2)("q-icon"),N=(0,a.g2)("crud"),U=(0,a.g2)("select-product-config"),W=(0,a.g2)("inner-loading");return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.Lk)("div",r,[(0,a.Lk)("div",l,[(0,a.Lk)("div",c,[(0,a.Lk)("div",d,[(0,a.Lk)("div",n,[(0,a.Lk)("div",m,(0,i.v_)(t.$tr("isite.cms.label.customer")),1),(0,a.Lk)("div",u,[(0,a.bF)(E,{icon:"fas fa-pen",onClick:e[0]||(e[0]=t=>A.modalCustomer=!0),color:"green",round:"",unelevated:"",class:"btn-small"})])]),(0,a.bF)(X,{class:"q-my-sm"}),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(A.form,((t,e)=>((0,a.uX)(),(0,a.CE)("div",{key:e,class:"row"},[(0,a.Lk)("label",p,(0,i.v_)(e)+":",1),(0,a.eW)(" "+(0,i.v_)(A.form[e]),1)])))),128)),(0,a.bF)(S,{modelValue:A.modalCustomer,"onUpdate:modelValue":e[3]||(e[3]=t=>A.modalCustomer=t),title:t.$tr("isite.cms.label.customer")},{default:(0,a.k6)((()=>[(0,a.bF)(R,{modelValue:A.form,"onUpdate:modelValue":e[1]||(e[1]=t=>A.form=t),"form-id":Q.settings.formId,"hide-title":"","hide-progress-bar":"",onSubmit:e[2]||(e[2]=t=>A.modalCustomer=!1),"default-col-class":"col-12"},null,8,["modelValue","form-id"])])),_:1},8,["modelValue","title"])]),A.cartData&&A.cartData.products.length?((0,a.uX)(),(0,a.CE)("div",h,[(0,a.Lk)("div",g,[(0,a.Lk)("div",b,[(0,a.Lk)("div",v,(0,i.v_)(t.$tr("isite.cms.label.quote"))+" | #"+(0,i.v_)(A.cartData.id),1)]),((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(A.cartData.products,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:s},[(0,a.bF)(X,{class:"q-my-sm"}),(0,a.Lk)("div",$,[(0,a.Lk)("div",f,(0,i.v_)(e.product.name),1),(0,a.Lk)("div",k,[(0,a.eW)(" $"+(0,i.v_)(t.$trn(e.total))+" ",1),(0,a.bF)(T,{class:"q-ml-md",actions:Q.itemQuoteActions(e)},null,8,["actions"])])])])))),128))]),(0,a.Lk)("div",q,[(0,a.Lk)("div",C,[(0,a.Lk)("div",x,(0,i.v_)(t.$tr("isite.cms.label.summary")),1)]),(0,a.bF)(X,{class:"q-my-sm"}),(0,a.Lk)("div",L,[(0,a.Lk)("div",y,(0,i.v_)(t.$tr("isite.cms.label.quantity"))+":",1),(0,a.Lk)("div",D,(0,i.v_)(A.cartData.products.length),1),_,(0,a.Lk)("div",P,"$"+(0,i.v_)(t.$trn(parseInt(A.cartData.total)||0)),1)]),(0,a.bF)(X,{class:"q-my-sm"}),(0,a.Lk)("div",F,[(0,a.bF)(E,{label:t.$tr("isite.cms.label.send"),color:"green",rounded:"",unelevated:"",onClick:Q.sendQuote},null,8,["label","onClick"])])])])):((0,a.uX)(),(0,a.CE)("div",w,[(0,a.Lk)("div",I,(0,i.v_)(t.$tr("icommerce.cms.message.addProductToQuote")),1),(0,a.bF)(B,{name:"fas fa-arrow-alt-circle-right",color:"cyan",size:"40px"})]))]),(0,a.Lk)("div",V,[(0,a.bF)(N,(0,i._B)((0,a.Ng)(Q.crudProductsProps)),null,16)])]),(0,a.bF)(U,{ref:"selectProductConfig"},null,512),(0,a.bF)(W,{visible:A.loading},null,8,["visible"])])])}s(10239);const A={key:0,class:"box q-mb-md box-auto-height"},Q={class:"box-title text-lowercase"},E={class:"row"},X={class:"col-6 text-blue-grey"},R={class:"col-6 text-right"},S={class:"col-6 text-blue-grey"},T={class:"col-6 text-right"},B=(0,a.Lk)("div",{class:"col-6 text-blue-grey"},"Total:",-1),N={class:"col-6 text-right"},U={key:1,class:"box"},W={class:"box-title"};function K(t,e,s,o,r,l){const c=(0,a.g2)("q-separator"),d=(0,a.g2)("q-checkbox"),n=(0,a.g2)("q-item-section"),m=(0,a.g2)("q-item"),u=(0,a.g2)("q-list"),p=(0,a.g2)("master-modal"),h=(0,a.gN)("ripple");return(0,a.uX)(),(0,a.Wv)(p,{id:"selectProductConfig",modelValue:r.modal,"onUpdate:modelValue":e[1]||(e[1]=t=>r.modal=t),title:t.$tr("icommerce.cms.message.productSetup"),loading:r.loading,actions:l.modalActions},{default:(0,a.k6)((()=>[r.productData?((0,a.uX)(),(0,a.CE)("div",A,[(0,a.Lk)("div",Q,(0,i.v_)(r.productData.name),1),(0,a.bF)(c,{class:"q-my-sm"}),(0,a.Lk)("div",E,[(0,a.Lk)("div",X,(0,i.v_)(t.$tr("isite.cms.label.price"))+":",1),(0,a.Lk)("div",R,"$"+(0,i.v_)(t.$trn(r.productData.price||0)),1),(0,a.Lk)("div",S,(0,i.v_)(t.$trp("isite.cms.label.option"))+":",1),(0,a.Lk)("div",T,"$"+(0,i.v_)(t.$trn(l.priceOptions)),1),B,(0,a.Lk)("div",N,"$"+(0,i.v_)(t.$trn(parseInt(r.productData.price)+parseInt(l.priceOptions)||0)),1)])])):(0,a.Q3)("",!0),r.productData?((0,a.uX)(),(0,a.CE)("div",U,[(0,a.Lk)("div",W,(0,i.v_)(t.$trp("isite.cms.label.option")),1),(0,a.bF)(c,{class:"q-mt-sm"}),(0,a.bF)(u,{class:"q-pa-none"},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(r.productData.optionValues,((s,o)=>(0,a.bo)(((0,a.uX)(),(0,a.Wv)(m,{key:o,clickable:"",class:"q-pl-none q-pr-sm"},{default:(0,a.k6)((()=>[(0,a.bF)(n,null,{default:(0,a.k6)((()=>[((0,a.uX)(),(0,a.Wv)(d,{modelValue:r.params.selectedOptions,"onUpdate:modelValue":e[0]||(e[0]=t=>r.params.selectedOptions=t),key:s.id,val:s.id,label:s.optionValue},null,8,["modelValue","val","label"]))])),_:2},1024),(0,a.bF)(n,{side:""},{default:(0,a.k6)((()=>[(0,a.eW)(" $"+(0,i.v_)(t.$trn(s.price)),1)])),_:2},1024)])),_:2},1024)),[[h]]))),128))])),_:1})])):(0,a.Q3)("",!0)])),_:1},8,["modelValue","title","loading","actions"])}const j={props:{},components:{},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,modal:!1,productData:!1,params:{productId:!1,selectedOptions:[],callBack:()=>{}}}},computed:{modalActions(){return[{props:{label:this.params.actionLabel||this.$tr("isite.cms.label.save"),color:"green"},action:()=>this.emitProductConfig()}]},priceOptions(){let t=0;return this.params.selectedOptions&&this.params.selectedOptions.length&&this.productData.optionValues.forEach((e=>{this.params.selectedOptions.includes(e.id)&&(t+=e.price)})),t}},methods:{init(){this.getData()},load(t){this.params=this.$clone({...this.params,...t}),this.getData(!0),this.modal=!0},getData(t=!1){if(this.params.productId)return new Promise(((e,s)=>{this.loading=!0;let a={refresh:t,params:{include:"optionValues"}};this.$crud.show("apiRoutes.qcommerce.products",this.params.productId,a).then((t=>{this.productData=t.data,this.productData&&this.productData.optionValues&&this.productData.optionValues.forEach((t=>{t.price||this.params.selectedOptions.push(this.$clone(t.id))})),this.loading=!1})).catch((t=>{this.$apiResponse.handleError(t,(()=>{this.loading=!1}))}))}))},reset(){this.productData=!1,this.params={productId:!1,selectedOptions:[],callBack:()=>{}}},emitProductConfig(){this.params.callBack({product:this.$clone(this.productData),options:this.params.selectedOptions.length?this.productData.optionValues.filter((t=>this.params.selectedOptions.includes(t.id))):[]}),this.reset(),this.modal=!1}}};var z=s(12807),G=s(37015),H=s(54514),J=s(75329),M=s(63418),Y=s(12225),Z=s(76100),tt=s(44029),et=s(98582),st=s.n(et);const at=(0,z.A)(j,[["render",K]]),it=at;st()(j,"components",{QSeparator:G.A,QList:H.A,QItem:J.A,QItemSection:M.A,QCheckbox:Y.A,QOptionGroup:Z.A}),st()(j,"directives",{Ripple:tt.A});var ot=s(71915);const rt={beforeUnmount(){ot.Bt.off("qcommerce.quote.addProduct")},props:{},components:{selectProductConfig:it},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,modalCustomer:!1,form:{},cartData:!1}},computed:{settings(){return{formId:this.$getSetting("icommerce::icommerceCartQuoteForm")}},crudProductsProps(){return{crudData:s.e(3427).then(s.bind(s,63427)),title:this.$trp("isite.cms.label.product"),customData:{create:!1,read:{showAs:"grid",allowToggleView:!1,grid:{component:()=>s.e(3976).then(s.bind(s,13976))},filters:{status:{value:"1"},stockStatus:{value:1},soonToSoldOut:{value:!1},withDiscount:{value:!1},categories:{value:null,type:"treeSelect",props:{label:`${this.$tr("isite.cms.form.category")}:`,clearable:!0},loadOptions:{apiRoute:"apiRoutes.qcommerce.categories"}},manufacturers:{value:null,type:"select",props:{label:`${this.$tr("icommerce.cms.form.manufacturer")}:`,clearable:!0},loadOptions:{apiRoute:"apiRoutes.qcommerce.manufacturers",select:{label:"name",id:"id"}}}}},update:!1,delete:!1}}}},methods:{async init(){Object.keys(this.form).length||(this.modalCustomer=!0),this.manageAddProduct(),this.getCart()},getCart(){return new Promise(((t,e)=>{this.loading=!0;let s={userId:this.$store.state.quserAuth.userId};this.$crud.create("apiRoutes.qcommerce.carts",s).then((t=>{this.cartData=t.data,this.loading=!1})).catch((t=>{this.loading=!1,e(t)}))}))},manageAddProduct(){ot.Bt.on("qcommerce.quote.addProduct",(t=>{this.$refs.selectProductConfig.load({productId:t.id,actionLabel:this.$tr("isite.cms.label.add"),callBack:t=>this.addProduct(t)})}))},itemQuoteActions(t){return[{icon:"fas fa-pen",color:"red",label:`${this.$tr("isite.cms.label.show")} / ${this.$tr("isite.cms.label.edit")}`,action:()=>{this.$refs.selectProductConfig.load({productId:t.product.id,selectedOptions:t.productOptionValues.map((t=>t.id)),callBack:e=>{this.loading=!0;let s={cartId:this.cartData.id,productId:e.product.id,quantity:1,productOptionValues:e.options,isCall:!0};this.$crud.update("apiRoutes.qcommerce.cartProducts",t.id,s).then((t=>{this.$alert.info({message:this.$tr("isite.cms.message.recordUpdated")}),this.getCart()})).catch((t=>{this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")}),this.loading=!1}))}})}},{icon:"fas fa-trash-alt",color:"red",label:this.$tr("isite.cms.label.delete"),action:()=>{this.loading=!0,this.$crud.delete("apiRoutes.qcommerce.cartProducts",t.id).then((t=>{this.$alert.info({message:this.$tr("isite.cms.message.recordDeleted")}),this.getCart()})).catch((t=>{this.$alert.error({message:this.$tr("isite.cms.message.recordNoDeleted")}),this.loading=!1}))}}]},addProduct(t){return new Promise(((e,s)=>{this.loading=!0;let a={cartId:this.cartData.id,productId:t.product.id,quantity:1,productOptionValues:t.options,isCall:!0};this.$crud.create("apiRoutes.qcommerce.cartProducts",a).then((t=>{this.$alert.info({message:`${this.$tr("isite.cms.message.recordCreated")}`}),this.getCart(),e(t.data)})).catch((t=>{this.$alert.error({message:`${this.$tr("isite.cms.message.recordNoCreated")}`}),this.loading=!1,s(t)}))}))},sendQuote(){return new Promise(((t,e)=>{if(!this.form.email)return this.modalCustomer=!0,t(!1);this.loading=!0;let s={cartId:this.cartData.id,type:"quote",firstName:this.form.first_name||"",lastName:this.form.last_name||"",email:this.form.email||"",telephone:this.form.telephone||"",options:{quoteForm:this.form}};this.$crud.create("apiRoutes.qcommerce.orders",s).then((t=>{this.$alert.info({message:`${this.$tr("isite.cms.message.recordCreated")}`}),this.$router.push({name:"qcommerce.admin.quotes.index"})})).catch((t=>{this.$alert.error({message:`${this.$tr("isite.cms.message.recordNoCreated")}`}),this.loading=!1}))}))}}};var lt=s(69001),ct=s(24609),dt=s(64082);const nt=(0,z.A)(rt,[["render",O]]),mt=nt;st()(rt,"components",{QBtn:lt.A,QSeparator:G.A,QIcon:ct.A,QTabPanels:dt.A})}}]);