"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[6900,728,4028],{20662:(e,o,l)=>{l.r(o),l.d(o,{default:()=>E});var t=l(92444),a=l(74044);const s={id:"pageId",class:"q-layout-page layout-padding location-form"},i={class:"relative-position q-mb-lg backend-page"},n={key:0,class:"box"},r={class:"col-12"},c={class:"row q-col-gutter-md"},d={class:"col-12"},m={class:"input-title"},u={class:"q-py-sm"},p={class:"text-right"},h={class:"row q-col-gutter-sm"},f={class:"col-3"},g={class:"col-3"},b={class:"col-4"},$={class:"col-2"};function v(e,o,l,v,z,y){const I=(0,t.E1)("locales"),q=(0,t.E1)("q-input"),V=(0,t.E1)("q-editor"),Q=(0,t.E1)("q-field"),T=(0,t.E1)("q-btn"),k=(0,t.E1)("dynamic-field"),D=(0,t.E1)("q-page-sticky"),C=(0,t.E1)("q-form"),w=(0,t.E1)("inner-loading");return(0,t.Wz)(),(0,t.An)("div",s,[(0,t.QD)("div",i,[z.success?((0,t.Wz)(),(0,t.An)("div",n,[(0,t.QD)("div",r,[(0,t.K2)(I,{modelValue:z.locale,"onUpdate:modelValue":o[0]||(o[0]=e=>z.locale=e),ref:"localeComponent",form:e.$refs.formContent},null,8,["modelValue","form"])]),z.locale.success?((0,t.Wz)(),(0,t.Az)(C,{key:0,autocorrect:"off",autocomplete:"off",ref:"formContent",class:"full-width q-my-sm",onSubmit:o[4]||(o[4]=e=>z.itemId?y.updateItem():y.createItem()),onValidationError:o[5]||(o[5]=o=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,t.Ql)((()=>[(0,t.QD)("div",c,[(0,t.QD)("div",d,[(0,t.K2)(q,{outlined:"",dense:"",modelValue:z.locale.formTemplate.name,"onUpdate:modelValue":o[1]||(o[1]=e=>z.locale.formTemplate.name=e),label:`${e.$tr("isite.cms.form.name")}*`,rules:[o=>!!o||e.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","rules"]),(0,t.QD)("div",m,(0,a.WA)(`${e.$tr("isite.cms.form.description")}*`),1),(0,t.K2)(Q,{borderless:"",modelValue:z.locale.formTemplate.description,"onUpdate:modelValue":o[3]||(o[3]=e=>z.locale.formTemplate.description=e),rules:[o=>!!o||e.$tr("isite.cms.message.fieldRequired")]},{default:(0,t.Ql)((()=>[(0,t.K2)(V,{class:"full-width",modelValue:z.locale.formTemplate.description,"onUpdate:modelValue":o[2]||(o[2]=e=>z.locale.formTemplate.description=e)},null,8,["modelValue"])])),_:1},8,["modelValue","rules"])])]),(0,t.QD)("div",u,[(0,t.QD)("div",p,[(0,t.K2)(T,{color:"positive",icon:"fas fa-plus",onClick:y.addGeozonables},null,8,["onClick"])]),((0,t.Wz)(!0),(0,t.An)(t.ae,null,(0,t.mi)(z.locale.form.zonesToGeozone,((o,l)=>((0,t.Wz)(),(0,t.An)("div",null,[(0,t.QD)("div",h,[(0,t.QD)("div",f,[(0,t.K2)(k,{modelValue:o.countryId,"onUpdate:modelValue":e=>o.countryId=e,field:{value:"",type:"select",loadOptions:{apiRoute:"apiRoutes.qlocations.countries",select:{label:"name",id:"id"}},props:{clearable:!0,label:`${e.$tr("ilocations.cms.form.country")}*`,rules:[o=>!!o||e.$tr("isite.cms.message.fieldRequired")]}}},null,8,["modelValue","onUpdate:modelValue","field"])]),(0,t.QD)("div",g,[o.countryId>0?((0,t.Wz)(),(0,t.Az)(k,{key:0,modelValue:o.provinceId,"onUpdate:modelValue":e=>o.provinceId=e,field:{value:"0",type:"select",loadOptions:{apiRoute:"apiRoutes.qlocations.provinces",requestParams:{filter:{country:o.countryId}},select:{label:"name",id:"id"}},props:{clearable:!0,label:`${e.$tr("ilocations.cms.form.province")}*`,options:[{label:e.$trp("isite.cms.label.all"),value:"0"}]}}},null,8,["modelValue","onUpdate:modelValue","field"])):(0,t.g1)("",!0)]),(0,t.QD)("div",b,[o.provinceId>0?((0,t.Wz)(),(0,t.Az)(k,{key:0,modelValue:o.cityId,"onUpdate:modelValue":e=>o.cityId=e,field:{value:"0",type:"select",loadOptions:{apiRoute:"apiRoutes.qlocations.cities",requestParams:{filter:{provinceId:o.provinceId}},select:{label:"name",id:"id"}},props:{clearable:!0,label:`${e.$tr("ilocations.cms.form.city")}*`,options:[{label:e.$trp("isite.cms.label.all"),value:"0"}]}}},null,8,["modelValue","onUpdate:modelValue","field"])):(0,t.g1)("",!0)]),(0,t.QD)("div",$,[(0,t.K2)(T,{color:"red",icon:"fas fa-trash",onClick:e=>y.deleteGeozonable(l)},null,8,["onClick"])])])])))),256))]),(0,t.K2)(D,{position:"bottom-right",offset:[18,18]},{default:(0,t.Ql)((()=>[e.$route.params.id?((0,t.Wz)(),(0,t.Az)(T,{key:0,color:"positive",loading:z.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.update"),type:"submit"},null,8,["loading","label"])):((0,t.Wz)(),(0,t.Az)(T,{key:1,color:"positive",loading:z.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.create"),type:"submit"},null,8,["loading","label"]))])),_:1})])),_:1},512)):(0,t.g1)("",!0)])):(0,t.g1)("",!0),(0,t.K2)(w,{visible:z.loading},null,8,["visible"])])])}l(23816);var z=l(74964),y=l(79792),I=l(8932);const q={components:{cityForm:z["default"],neighborhoodForm:y["default"]},watch:{$route(e,o){this.initForm()}},mounted(){this.$nextTick((function(){this.initForm(),I.kN.on("page.data.refresh",(()=>this.initForm()))}))},data(){return{locale:{},loading:!1,success:!1,itemId:!1,showCityCreate:!1,showPolygonCreate:!1,showNeighborhoodCreate:!1,geozonables:[]}},props:{id:{default:null}},computed:{dataLocale(){return{fields:{name:"",description:"",countries:[],provinces:[],cities:[],polygons:[],neighborhoods:[],zonesToGeozone:[]},fieldsTranslatable:{}}},defaultGeozonable(){return{countryId:"",provinceId:"0",cityId:"0"}}},methods:{async initForm(){this.loading=!0,this.success=!1,this.locale=this.$clone(this.dataLocale),this.itemId=null!==this.id?this.id:this.$route.params.id,this.locale.success&&this.$refs.localeComponent.vReset(),await this.getData(),this.success=!0,this.loading=!1},getData(){return new Promise(((e,o)=>{const l=this.$clone(this.itemId);if(l){let t="apiRoutes.qlocations.geozones",a={refresh:!0,params:{include:"zonesToGeozone,zonesToGeozone.province,zonesToGeozone.country,zonesToGeozone.city",filter:{allTranslations:!0}}};this.$crud.show(t,l,a).then((o=>{this.orderDataItemToLocale(o.data);this.$clone(o.data.zonesToGeozone);e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{console.error(e),this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1,o(!1)}))}))}else e(!0)}))},orderDataItemToLocale(e){let o=this.$clone(e);this.locale.form=this.$clone(o)},async updateItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qlocations.geozones";this.$crud.update(e,this.itemId,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},async createItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qlocations.geozones";this.$crud.create(e,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordCreated")}`}),this.$router.push({name:"qlocations.admin.geozones.index"}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},getDataForm(){let e=this.locale.form;for(var o in e){let l=e[o];null!=l&&void 0!=l||delete e[o]}return e.selectable=JSON.stringify(e.selectable),e},addGeozonables(){this.locale.form.zonesToGeozone.push(this.defaultGeozonable)},deleteGeozonable(e){this.locale.form.zonesToGeozone.splice(e,1)}}};var V=l(68716),Q=l(41628),T=l(14288),k=l(20540),D=l(69452),C=l(85664),w=l(99140),G=l(60352),R=l(95252),F=l.n(R);const U=(0,V.c)(q,[["render",v]]),E=U;F()(q,"components",{QLayout:Q.c,QForm:T.c,QInput:k.c,QField:D.c,QEditor:C.c,QBtn:w.c,QPageSticky:G.c})}}]);