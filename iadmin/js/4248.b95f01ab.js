"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[4248],{24248:(e,n,i)=>{i.r(n),i.d(n,{default:()=>g});var t=i(92444),c={class:"row"};function o(e,n,i,o,a,r){var l=(0,t.E1)("dynamic-field"),s=(0,t.E1)("inner-loading");return(0,t.Wz)(),(0,t.An)("div",null,[(0,t.QD)("div",c,[e.loading?(0,t.g1)("",!0):((0,t.Wz)(),(0,t.Az)(l,{key:0,modelValue:e.map,"onUpdate:modelValue":n[0]||(n[0]=function(n){return e.map=n}),class:"q-mb-md col-12",field:e.mapField},null,8,["modelValue","field"]))]),(0,t.K2)(s,{visible:e.loading},null,8,["visible"])])}var a=i(75836),r=i(20584);const l={getDevices:function(){return new Promise((function(e,n){var i={refresh:!0,params:{include:"sensors"}};r.c.index("apiRoutes.qtelemetry.devices",i).then((function(n){e(n.data)})).catch((function(e){return n(e)}))}))}};var s=i(58088),u=i(8932),d=function(){return d=Object.assign||function(e){for(var n,i=1,t=arguments.length;i<t;i++)for(var c in n=arguments[i],n)Object.prototype.hasOwnProperty.call(n,c)&&(e[c]=n[c]);return e},d.apply(this,arguments)};function f(e,n){var i={},c=(0,a.cB)({loading:!1,map:null,devices:[],mapField:{value:null,type:"positionMarkerMap",help:{description:u._s.tr("icommerce.cms.form.mapHelp")},props:{label:"".concat(u._s.tr("isite.cms.label.search"),"..."),readOnly:!0,markers:!0,height:"80vh"}}}),o={},r={init:function(){c.loading=!0,r.getDevices().then((function(e){r.setMarkers(),c.loading=!1}))},setMarkers:function(){c.map=c.devices.map((function(e){return{lat:e.lat,lng:e.lng,title:e.title,loadingLabel:u._s.tr("isite.cms.label.loading"),onClick:function(){return r.getLastRecord(e)}}}))},getLastRecord:function(e){return new Promise((function(n,i){var t={filter:{deviceId:e.id}};s.c.getSensors(t).then((function(i){var t=i,c={filter:{deviceId:e.id},orderBy:{field:"id",way:"desc"},take:1};s.c.getRecords(c).then((function(e){var i;0==e.length&&n("-");var c=e[0],o="<b>".concat(null===(i=null===c||void 0===c?void 0:c.device)||void 0===i?void 0:i.title,"</b>")||0,a="";t.length&&t.forEach((function(e){if(null===c||void 0===c?void 0:c.logs){var n=c.logs.find((function(n){return n.sensorId==e.id}));if(n){var i=e.title,t=e.options;t?(i=(null===t||void 0===t?void 0:t.prefix)?t.prefix:e.title,i=(null===t||void 0===t?void 0:t.suffix)?"".concat(i," : ").concat(n.value," ").concat(t.suffix):"".concat(i," : ").concat(n.value)):i="".concat(i," : ").concat(n.value),a="".concat(a," ").concat(i,"</br>")}}})),n("".concat(o,"<p>").concat(a,"</p>"))}))}))}))},getDevices:function(){return new Promise((function(e,n){l.getDevices().then((function(n){c.devices=n,e(n)}))}))}};return(0,t.u2)((function(){r.init()})),d(d(d(d({},i),(0,a.kx)(c)),o),r)}const v=(0,t._M)({setup:function(e,n){var i=n.emit;return f(e,i)}});var p=i(68716);const m=(0,p.c)(v,[["render",o]]),g=m}}]);