"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[2819],{42819:(e,t,o)=>{o.r(t),o.d(t,{default:()=>de});var l=o(61758);const i={id:"contentConfig",class:"row q-col-gutter-y-xl"},a={id:"contentProviders",class:"col-12"},s={class:"box box-auto-height q-mb-md"};function r(e,t,o,r,n,d){const m=(0,l.g2)("page-actions"),c=(0,l.g2)("providers"),u=((0,l.g2)("q-icon"),(0,l.g2)("q-separator"),(0,l.g2)("rules"),(0,l.g2)("q-page"));return(0,l.uX)(),(0,l.Wv)(u,{id:"notificationsConfigPage"},{default:(0,l.k6)((()=>[(0,l.Lk)("div",i,[(0,l.Lk)("div",a,[(0,l.Lk)("div",s,[(0,l.bF)(m,{title:e.$trp("isite.cms.label.provider")},null,8,["title"])]),(0,l.bF)(c)]),(0,l.Q3)("",!0)])])),_:1})}var n=o(58790);const d={id:"providersAdminPage"},m={id:"contentProviders",class:"relative-position"},c={class:"row q-col-gutter-md"};function u(e,t,o,i,a,s){const r=(0,l.g2)("q-icon"),u=(0,l.g2)("q-card-section"),p=(0,l.g2)("q-space"),v=(0,l.g2)("q-btn"),f=(0,l.g2)("q-card-actions"),h=(0,l.g2)("q-card"),b=(0,l.g2)("q-toolbar-title"),g=(0,l.g2)("q-toolbar"),k=(0,l.g2)("dynamic-field"),F=(0,l.g2)("q-form"),y=(0,l.g2)("inner-loading"),$=(0,l.g2)("q-dialog"),q=(0,l.gN)("close-popup");return(0,l.uX)(),(0,l.CE)("div",d,[(0,l.Lk)("div",m,[(0,l.Lk)("div",c,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.providers,((t,o)=>((0,l.uX)(),(0,l.CE)("div",{class:"col-12 col-sm-6 col-md-4 col-lg-3",key:o},[(0,l.bF)(h,{class:"my-card box box-auto-height",style:{padding:"0"}},{default:(0,l.k6)((()=>[(0,l.bF)(u,{class:"text-h5 text-white row items-center q-py-lg",style:(0,n.Tr)(`background-color: ${t.color}`)},{default:(0,l.k6)((()=>[(0,l.bF)(r,{name:t.icon,class:"q-mr-md"},null,8,["name"]),(0,l.Lk)("label",null,(0,n.v_)(t.name),1)])),_:2},1032,["style"]),(0,l.bF)(f,null,{default:(0,l.k6)((()=>[(0,l.Lk)("label",{class:(0,n.C4)(`text-${s.providerStatus(t).color}`)},(0,n.v_)(s.providerStatus(t).label),3),(0,l.bF)(p),(0,l.bF)(v,{outline:"",color:"primary",rounded:"",dense:"","no-caps":"",label:e.$tr("isite.cms.label.setup"),onClick:e=>(a.modal.provider=t,a.modal.show=!0)},null,8,["label","onClick"])])),_:2},1024)])),_:2},1024)])))),128))]),(0,l.bF)($,{modelValue:a.modal.show,"onUpdate:modelValue":t[5]||(t[5]=e=>a.modal.show=e),"no-esc-dismiss":"","no-backdrop-dismiss":"",onHide:t[6]||(t[6]=e=>a.modal.form={})},{default:(0,l.k6)((()=>[(0,l.bF)(h,{class:"bg-grey-1 backend-page row relative-position"},{default:(0,l.k6)((()=>[(0,l.bF)(g,{class:"text-white",style:(0,n.Tr)(`background-color: ${a.modal.provider.color}`)},{default:(0,l.k6)((()=>[(0,l.bF)(b,null,{default:(0,l.k6)((()=>[(0,l.bF)(r,{name:a.modal.provider.icon,class:"q-mr-md"},null,8,["name"]),(0,l.Lk)("label",null,(0,n.v_)(a.modal.provider.name),1)])),_:1}),(0,l.bo)((0,l.bF)(v,{flat:"",icon:"fas fa-times"},null,512),[[q]])])),_:1},8,["style"]),(0,l.bF)(u,{class:"relative-position col-12"},{default:(0,l.k6)((()=>[(0,l.bF)(F,{autocorrect:"off",autocomplete:"off",ref:"formProviderConfig",onSubmit:t[2]||(t[2]=e=>s.saveProviderConfig()),onValidationError:t[3]||(t[3]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(s.providerFields,((o,i)=>((0,l.uX)(),(0,l.CE)(l.FK,{key:i},[o?.isFakeField?((0,l.uX)(),(0,l.Wv)(k,{key:1,field:o,onEnter:t[1]||(t[1]=t=>e.$refs.formProviderConfig.submit()),modelValue:a.modal.form[s.getNameFakeField(o)][o.name||i],"onUpdate:modelValue":e=>a.modal.form[s.getNameFakeField(o)][o.name||i]=e},null,8,["field","modelValue","onUpdate:modelValue"])):((0,l.uX)(),(0,l.Wv)(k,{key:0,field:o,modelValue:a.modal.form[o.name||i],"onUpdate:modelValue":e=>a.modal.form[o.name||i]=e,onEnter:t[0]||(t[0]=t=>e.$refs.formProviderConfig.submit())},null,8,["field","modelValue","onUpdate:modelValue"]))],64)))),128))])),_:1},512)])),_:1}),(0,l.bF)(g,{class:"q-pa-md"},{default:(0,l.k6)((()=>[(0,l.bF)(b),(0,l.bF)(v,{icon:"fas fa-save",color:"positive",rounded:"",unelevated:"",label:e.$tr("isite.cms.label.save"),onClick:t[4]||(t[4]=t=>e.$refs.formProviderConfig.submit())},null,8,["label"])])),_:1}),(0,l.bF)(y,{visible:a.modal.loading},null,8,["visible"])])),_:1})])),_:1},8,["modelValue"]),(0,l.bF)(y,{visible:a.loading},null,8,["visible"])])])}var p=o(71915);const v={beforeUnmount(){p.Bt.off("page.data.refresh")},props:{},components:{},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,providers:[],modal:{show:!1,loading:!1,provider:!1,form:{}}}},computed:{providerFields(){let e=this.modal.provider.fields||{},t=this.modal.provider.data||{};for(var o in e){let l=e[o];if(l?.isFakeField){let i=this.getNameFakeField(l);this.modal.form[i]||(this.modal.form[i]={}),t[i]&&void 0!==t[i][o]&&(e[o].value=t[i][o])}else e[o].value=t[o]||l.value||null}return e}},methods:{init(){this.getProviders(),p.Bt.on("page.data.refresh",(()=>this.getProviders(!0)))},getProviders(e=!1){return new Promise(((t,o)=>{this.loading=!0;let l={refresh:e};this.$crud.index("apiRoutes.qnotification.providers",l).then((e=>{this.providers=e.data,this.loading=!1,t(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.loading=!1,o(e)}))}))}))},getNameFakeField(e){return"string"==typeof e?.isFakeField?e?.isFakeField:"options"},providerStatus(e){let t={color:"red",label:this.$tr("isite.cms.label.disabled")};return e&&e.data&&parseInt(e.data.status)&&(t={color:"green",label:this.$tr("isite.cms.label.enabled")}),t},saveProviderConfig(){this.modal.loading=!0;let e=this.$clone(this.modal.provider),t=this.$clone({...this.modal.form,systemName:e.systemName,name:e.name}),o=!(!e.data||!e.data.id)&&e.data.id;const l=()=>{this.getProviders(!0),this.modal.show=!1,this.modal.loading=!1};o?this.$crud.update("apiRoutes.qnotification.providers",o,t).then((e=>{l(),this.$alert.info({message:this.$tr("isite.cms.message.recordCreated")})})).catch((e=>{this.modal.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")})})):this.$crud.create("apiRoutes.qnotification.providers",t).then((e=>{l(),this.$alert.info({message:this.$tr("isite.cms.message.recordCreated")})})).catch((e=>{this.modal.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoCreated")})}))}}};var f=o(12807),h=o(97569),b=o(27066),g=o(24609),k=o(16334),F=o(31173),y=o(69001),$=o(57201),q=o(79351),C=o(56769),A=o(21565),V=o(62769),_=o(98582),E=o.n(_);const N=(0,f.A)(v,[["render",u]]),w=N;E()(v,"components",{QCard:h.A,QCardSection:b.A,QIcon:g.A,QCardActions:k.A,QSpace:F.A,QBtn:y.A,QDialog:$.A,QToolbar:q.A,QToolbarTitle:C.A,QForm:A.A}),E()(v,"directives",{ClosePopup:V.A});const P={id:"notificationsRulesComponent"},X={id:"contentRulesConfig"},x={key:0},Q={key:1},L={class:"row col-12 q-col-gutter-md"},R={class:"col-12"},U={class:"q-mb-sm"},I={class:"text-caption text-grey-8"},W={class:"q-gutter-sm q-mb-sm"},S={class:"col-12"},T={class:"q-mb-sm"},K={class:"text-caption text-grey-8"},D={class:"row col-12 q-col-gutter-md"},O={class:"text-caption"},B={class:"col-12"},j={class:"q-mb-sm"},M={class:"q-gutter-sm q-mb-sm"},z={class:"row col-12 q-col-gutter-md"};function H(e,t,i,a,s,r){const d=(0,l.g2)("crud"),m=(0,l.g2)("q-toolbar-title"),c=(0,l.g2)("q-btn"),u=(0,l.g2)("q-toolbar"),p=(0,l.g2)("dynamic-field"),v=(0,l.g2)("q-separator"),f=(0,l.g2)("q-checkbox"),h=(0,l.g2)("q-item-section"),b=(0,l.g2)("q-item"),g=(0,l.g2)("q-scroll-area"),k=(0,l.g2)("q-form"),F=(0,l.g2)("q-card-section"),y=(0,l.g2)("q-card"),$=(0,l.g2)("q-dialog"),q=(0,l.gN)("close-popup"),C=(0,l.gN)("ripple");return(0,l.uX)(),(0,l.CE)("div",P,[(0,l.Lk)("div",X,[(0,l.bF)(d,{"crud-data":o.e(5999).then(o.bind(o,45999)),onCreate:t[0]||(t[0]=e=>r.openForm()),onUpdate:r.openForm},null,8,["crud-data","onUpdate"])]),(0,l.bF)($,{id:"modalFormRulesConfig",class:"modal-form-notification-rules",modelValue:s.modal.show,"onUpdate:modelValue":t[6]||(t[6]=e=>s.modal.show=e),"no-esc-dismiss":"","no-backdrop-dismiss":"",onShow:t[7]||(t[7]=e=>r.resetModal())},{default:(0,l.k6)((()=>[(0,l.bF)(y,null,{default:(0,l.k6)((()=>[(0,l.bF)(u,{class:"bg-primary text-white"},{default:(0,l.k6)((()=>[(0,l.bF)(m,null,{default:(0,l.k6)((()=>[s.modal.item?((0,l.uX)(),(0,l.CE)("label",Q,(0,n.v_)(e.$tr("notification.cms.updateRule"))+" ID: "+(0,n.v_)(s.modal.item.id),1)):((0,l.uX)(),(0,l.CE)("label",x,(0,n.v_)(e.$tr("notification.cms.newRule")),1))])),_:1}),(0,l.bo)((0,l.bF)(c,{flat:"",icon:"fas fa-times"},null,512),[[q]])])),_:1}),(0,l.bF)(F,null,{default:(0,l.k6)((()=>[(0,l.bF)(k,{autocorrect:"off",autocomplete:"off",ref:"formRules",class:"row",onSubmit:t[2]||(t[2]=e=>s.modal.item?r.updateRule():r.createRule()),onValidationError:t[3]||(t[3]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,l.k6)((()=>[(0,l.Lk)("div",L,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.formFields,((e,t)=>((0,l.uX)(),(0,l.Wv)(p,{key:t,modelValue:s.form[e.name||t],"onUpdate:modelValue":o=>s.form[e.name||t]=o,field:e,class:"col-12 col-md-6"},null,8,["modelValue","onUpdate:modelValue","field"])))),128))]),(0,l.bF)(v,{class:"q-mb-md"}),(0,l.Lk)("div",R,[(0,l.Lk)("div",U,[(0,l.eW)((0,n.v_)(e.$tr("notification.cms.label.event"))+" ",1),(0,l.Lk)("div",I,(0,n.v_)(e.$tr("notification.cms.message.chooseEventCategory")),1)]),(0,l.Lk)("div",W,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.entitiesOptions,((e,t)=>((0,l.uX)(),(0,l.Wv)(c,{key:t,padding:"xs sm","no-caps":"",unelevated:"",label:e.label,onClick:t=>(s.form.entityName=e.value,s.form.eventPath=[]),color:s.form.entityName==e.value?"primary":"grey-7",outline:s.form.entityName!=e.value},null,8,["label","onClick","color","outline"])))),128))]),(0,l.bF)(g,{id:"eventsContent",style:{height:"100px",width:"100%"},visible:""},{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.eventsOptions,((e,o)=>(0,l.bo)(((0,l.uX)(),(0,l.Wv)(b,{key:o},{default:(0,l.k6)((()=>[(0,l.bF)(h,null,{default:(0,l.k6)((()=>[(0,l.bF)(f,{modelValue:s.form.eventPath,"onUpdate:modelValue":t[1]||(t[1]=e=>s.form.eventPath=e),val:e.value,label:e.label,size:"xs"},null,8,["modelValue","val","label"])])),_:2},1024)])),_:2},1024)),[[C]]))),128))])),_:1})]),(0,l.bF)(v,{class:"q-my-md"}),(0,l.Lk)("div",S,[(0,l.Lk)("div",T,[(0,l.eW)((0,n.v_)(e.$trp("notification.cms.label.condition"))+" ",1),(0,l.Lk)("div",K,(0,n.v_)(e.$tr("notification.cms.message.conditions")),1)]),(0,l.Lk)("div",D,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.conditionsFields,((e,t)=>((0,l.uX)(),(0,l.CE)("div",{class:"col-12 col-sm-6 col-md-3",key:t},[(0,l.Lk)("div",O,[(0,l.Lk)("b",null,(0,n.v_)(e.props?e.props.label:""),1)]),e.children?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(e.children,((o,i)=>((0,l.uX)(),(0,l.Wv)(p,{key:i,modelValue:s.form.conditions[e.name||t][o.name|i],"onUpdate:modelValue":l=>s.form.conditions[e.name||t][o.name|i]=l,field:o},null,8,["modelValue","onUpdate:modelValue","field"])))),128)):((0,l.uX)(),(0,l.Wv)(p,{key:0,field:e,modelValue:s.form.conditions[e.name||t],"onUpdate:modelValue":o=>s.form.conditions[e.name||t]=o},null,8,["field","modelValue","onUpdate:modelValue"]))])))),128))])]),(0,l.bF)(v,{class:"q-my-md"}),(0,l.Lk)("div",B,[(0,l.Lk)("div",j,(0,n.v_)(e.$trp("notification.cms.message.settingProviders")),1),(0,l.Lk)("div",M,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.providersOptions,((e,t)=>((0,l.uX)(),(0,l.Wv)(c,{key:t,padding:"xs sm","no-caps":"",unelevated:"",label:e.label,onClick:t=>s.form.providerName=e.value,color:s.form.providerName==e.value?"primary":"grey-7",outline:s.form.providerName!=e.value},null,8,["label","onClick","color","outline"])))),128))]),(0,l.Lk)("div",z,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(r.providersFields,((e,t)=>((0,l.uX)(),(0,l.Wv)(p,{key:t,field:e,modelValue:s.form.settings[s.form.providerName][e.name||t],"onUpdate:modelValue":o=>s.form.settings[s.form.providerName][e.name||t]=o,class:"col-12 col-md-6"},null,8,["field","modelValue","onUpdate:modelValue"])))),128))])])])),_:1},512)])),_:1}),(0,l.bF)(u,{class:"q-pa-md"},{default:(0,l.k6)((()=>[(0,l.bF)(m),s.modal.item?((0,l.uX)(),(0,l.Wv)(c,{key:1,label:e.$tr("isite.cms.label.update"),icon:"fas fa-pen",color:"positive",rounded:"",unelevated:"",onClick:t[5]||(t[5]=t=>e.$refs.formRules.submit())},null,8,["label"])):((0,l.uX)(),(0,l.Wv)(c,{key:0,icon:"fas fa-save",color:"positive",rounded:"",unelevated:"",label:e.$tr("isite.cms.label.save"),onClick:t[4]||(t[4]=t=>e.$refs.formRules.submit())},null,8,["label"]))])),_:1})])),_:1})])),_:1},8,["modelValue"])])}o(10239);const G={props:{},components:{},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,events:[],providers:[],modal:{item:!1,show:!1,loading:!1},form:{}}},computed:{defaultDataForm(){return this.$clone({name:null,status:!0,entityName:null,eventPath:[],conditions:{},settings:{},providerName:null})},formFields(){return{name:{value:null,type:"input",props:{label:`${this.$tr("isite.cms.form.name")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]}},status:{value:"1",type:"select",props:{label:`${this.$tr("isite.cms.form.status")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")],options:[{label:this.$tr("isite.cms.label.enabled"),value:"1"},{label:this.$tr("isite.cms.label.disabled"),value:"0"}]}}}},selectedEntity(){return!!this.form.entityName&&this.events.find((e=>e.entityName==this.form.entityName))},entitiesOptions(){return this.events.map((e=>({label:e.title,value:e.entityName})))},eventsOptions(){return this.selectedEntity?this.selectedEntity.events.map((e=>({label:e.title,value:e.path}))):[]},conditionsFields(){if(!this.selectedEntity)return{};for(var e in this.selectedEntity.conditions){let t=this.selectedEntity.conditions[e];t.children&&(this.form.conditions[e]={})}return this.selectedEntity.conditions},providersOptions(){let e=[];return Object.values(this.providers).forEach((t=>{e.push({label:t.name,value:t.systemName}),this.form.settings[t.systemName]={}})),e},providersFields(){if(!this.form.providerName)return[];let e=Object.values(this.providers).find((e=>e.systemName==this.form.providerName));return e?e.settings:[]}},methods:{init(){this.form=this.$clone(this.defaultDataForm),this.getData(),p.Bt.on("page.data.refresh",(()=>this.getData(!0)))},getData(e=!1){return new Promise((async(t,o)=>{this.loading=!0,await Promise.all([this.getEvents(e),this.getProviders(e)]),this.loading=!1}))},getEvents(e=!1){return new Promise(((t,o)=>{let l={refresh:e};this.$crud.index("apiRoutes.qnotification.rulesConfig",l).then((e=>{this.events=e.data,t(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{o(e)}))}))}))},getProviders(e=!1){return new Promise(((t,o)=>{let l={refresh:e};this.$crud.index("apiRoutes.qnotification.providers",l).then((e=>{this.providers=e.data,t(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{o(e)}))}))}))},resetModal(){this.modal.item=!1,this.form=this.$clone(this.defaultDataForm),this.form.entityName=this.events?this.events[0].entityName:null,this.form.providerName=this.providers?Object.values(this.providers)[0].systemName:null},openForm(e=!1){this.modal.item=e??!1,this.modal.show=!0},createRule(){},updateRule(){}}};var J=o(37015),Y=o(19600),Z=o(75329),ee=o(63418),te=o(12225),oe=o(83333),le=o(44029);const ie=(0,f.A)(G,[["render",H]]),ae=ie;E()(G,"components",{QDialog:$.A,QCard:h.A,QToolbar:q.A,QToolbarTitle:C.A,QBtn:y.A,QCardSection:b.A,QForm:A.A,QSeparator:J.A,QScrollArea:Y.A,QItem:Z.A,QItemSection:ee.A,QCheckbox:te.A,QLayout:oe.A}),E()(G,"directives",{ClosePopup:V.A,Ripple:le.A});const se={props:{},components:{providers:w,rules:ae},watch:{},mounted(){this.$nextTick((function(){}))},data(){return{}},computed:{},methods:{}};var re=o(33177);const ne=(0,f.A)(se,[["render",r]]),de=ne;E()(se,"components",{QPage:re.A,QIcon:g.A,QSeparator:J.A})}}]);