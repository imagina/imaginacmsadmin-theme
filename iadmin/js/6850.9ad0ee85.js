"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[6850],{76850:(e,t,s)=>{s.r(t),s.d(t,{default:()=>y});var i=s(61758);function a(e,t,s,a,l,n){const r=(0,i.g2)("crud-menu-item");return(0,i.uX)(),(0,i.Wv)(r,{ref:"crudMenuItem"},null,512)}var l=s(58790);const n={class:"box relative-position"},r={class:"row justify-end"},m={class:"col-12 q-mt-sm"};function u(e,t,a,u,o,d){const c=(0,i.g2)("q-icon"),h=(0,i.g2)("q-btn"),p=(0,i.g2)("crud"),f=(0,i.g2)("nestedMenuItems"),b=(0,i.g2)("inner-loading"),$=(0,i.g2)("master-modal");return(0,i.uX)(),(0,i.Wv)($,{modelValue:o.show,"onUpdate:modelValue":t[4]||(t[4]=e=>o.show=e),title:o.title,"custom-position":"",actions:o.actions,onHide:d.resetData},{default:(0,i.k6)((()=>[(0,i.Lk)("div",n,[(0,i.Lk)("div",r,[(0,i.bF)(h,{color:"green",class:"q-ml-xs q-mb-sm text-cente text-capitalize",unelevated:"",rounded:"",outline:"",onClick:t[0]||(t[0]=t=>e.$refs.crudMenuItems.create())},{default:(0,i.k6)((()=>[(0,i.bF)(c,{name:"fas fa-plus-circle",class:"q-mr-sm",size:"16px"}),(0,i.eW)(" "+(0,l.v_)(this.$tr("menu.cms.newItem")),1)])),_:1})]),(0,i.bF)(p,{"crud-data":s.e(6593).then(s.bind(s,96593)),type:"onlyUpdate",ref:"crudMenuItems",onCreated:t[1]||(t[1]=e=>d.getItems(!0)),onUpdated:t[2]||(t[2]=e=>d.getItems(!0)),onDeleted:t[3]||(t[3]=e=>d.getItems(!0)),"custom-data":d.customMenuItem},null,8,["crud-data","custom-data"]),(0,i.Lk)("div",m,[(0,i.bF)(f,{items:o.menuItems},null,8,["items"])]),(0,i.bF)(b,{visible:o.loading},null,8,["visible"])])])),_:1},8,["modelValue","title","actions","onHide"])}s(10239);var o=s(94867),d=s(71915);const c={name:"crudMenuItems",components:{nestedMenuItems:o.A},mounted(){this.$nextTick((()=>{d.Bt.on("updateMenuItems",this.handlerUpdateMenuItems)}))},data(){return{deleteApi:"apiRoutes.qmenu.menuItems",title:"-",loading:!1,menuId:null,show:!1,menuItems:[],actions:[{action:()=>this.updateOrder(),props:{label:this.$tr("isite.cms.label.save"),color:"green"}}]}},computed:{customMenuItem(){return{getDataForm:e=>new Promise(((t,s)=>{e.menuId=this.menuId,t(e)})),formRight:{parentId:{value:null,type:"treeSelect",props:{label:this.$tr("isite.cms.form.parent")},loadOptions:{apiRoute:"apiRoutes.qmenu.menuItems",refresh:!0,requestParams:{filter:{allTranslations:!0,menu:this.menuId}}}}}}}},methods:{openModal({show:e,title:t,menuId:s}){this.show=e,this.title=t,this.menuId=s,this.getItems(!0)},getItems(e=!1){this.loading=!0;let t=this.menuId,s={refresh:e,params:{include:"menuitems"}};this.$crud.show("apiRoutes.qmenu.menus",t,s).then((({data:e})=>{const t=this.setActions(e.menuitems);this.menuItems=this.arrayToTree(t),this.loading=!1})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")}),this.loading=!1}))}))},setActions(e){return e.map((e=>(e={...e,actions:[{name:"edit",icon:"fas fa-pen",label:this.$tr("isite.cms.label.edit"),action:()=>this.$refs.crudMenuItems.update(e)},{name:"delete",icon:"fas fa-trash-alt",label:this.$tr("isite.cms.label.delete"),action:()=>this.$refs.crudMenuItems.delete(e)}]},e)))},updateOrder(){let e=[];this.treeToArray(this.menuItems,e),this.loading=!0,this.$crud.create("apiRoutes.qmenu.menuItemsOrdener",{menuitems:e}).then((e=>{this.loading=!1,this.show=!1,this.getItems(),this.$alert.info({message:`${this.$tr("isite.cms.message.recordUpdated")}`})})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.errorRequest")})}))},arrayToTree(e,t=0){return e.filter((s=>{if(s.parentId==t)return s["children"]=this.arrayToTree(e,s.id)}))},treeToArray(e,t,s=null){let i=[...e];i.forEach(((e,i)=>{e.position=i,e.parentId=s,t.push(e),e.children.length&&this.treeToArray(e.children,t,e.id)}))},handlerUpdateMenuItems(e){this.getItems()},resetData(){this.title=null,this.menuId=null,this.menuItems=[]}}};var h=s(12807),p=s(69001),f=s(24609),b=s(98582),$=s.n(b);const I=(0,h.A)(c,[["render",u]]),g=I;$()(c,"components",{QBtn:p.A,QIcon:f.A});var v=s(99526)["A"];const M={name:"menuAdmin",components:{crudMenuItem:g},data(){return{modalTitle:this.$trp("isite.cms.label.item"),crudId:this.$uid()}},methods:{refreshData(){setTimeout((()=>{this.$refs.crudMenu&&this.$refs.crudMenu.getData(!0)}),100)}},computed:{crudData(){return{crudId:this.crudId,entityName:v("main.qmenu.entityNames.menu"),apiRoute:"apiRoutes.qmenu.menus",permission:"menu.menus",extraFormFields:"menu.crud-fields.menus",create:{title:this.$tr("menu.cms.newMenu")},read:{columns:[{name:"id",label:this.$tr("isite.cms.form.id"),field:"id"},{name:"title",label:this.$tr("isite.cms.form.title"),field:"title",align:"left"},{name:"name",label:this.$tr("isite.cms.form.name"),field:"name",align:"left"},{name:"status",label:this.$tr("isite.cms.form.status"),field:"status",align:"left",format:e=>e?this.$tr("isite.cms.label."+(parseInt(e)?"enabled":"disabled")):"-"},{name:"isDefault",label:this.$tr("isite.cms.form.default"),field:"isDefault",align:"left",format:e=>e?this.$tr("isite.cms.label."+(parseInt(e)?"yes":"no")):"-"},{name:"createdAt",label:this.$tr("isite.cms.form.createdAt"),field:"createdAt",format:e=>e?this.$trd(e):"-",align:"left"},{name:"actions",label:this.$tr("isite.cms.form.actions"),align:"right"}],filters:{status:{value:null,type:"select",props:{label:this.$tr("isite.cms.form.status"),options:[{label:this.$tr("isite.cms.label.enabled"),value:1},{label:this.$tr("isite.cms.label.disabled"),value:0}]}}},actions:[{icon:"fas fa-list-ol",color:"info",action:e=>{this.$refs.crudMenuItem.openModal({show:!0,title:`${this.modalTitle} | ${e.title}`,menuId:e.id})},label:this.modalTitle}]},update:{title:this.$tr("menu.cms.updateMenu")},delete:!0,formLeft:{title:{value:null,type:"input",isTranslatable:!0,props:{label:this.$tr("isite.cms.form.title"),rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]}},name:{value:null,type:"input",props:{label:this.$tr("isite.cms.form.name"),rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]}},status:{value:"1",type:"select",isTranslatable:!0,props:{label:this.$tr("isite.cms.form.status"),options:[{label:this.$tr("isite.cms.label.enabled"),value:"1"},{label:this.$tr("isite.cms.label.disabled"),value:"0"}]}},isDefault:{value:"0",type:"select",props:{label:this.$tr("isite.cms.form.default"),options:[{label:this.$tr("isite.cms.label.yes"),value:"1"},{label:this.$tr("isite.cms.label.no"),value:"0"}]}}}}},crudInfo(){return this.$store.state.qcrudComponent.component[this.crudId]||{}}}},q=(0,h.A)(M,[["render",a]]),y=q}}]);