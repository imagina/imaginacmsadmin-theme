"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[8492],{88492:(e,t,s)=>{s.r(t),s.d(t,{default:()=>N});var i=s(61758),a=s(58790);const l={id:"settingPage",class:"relative-position"},o={key:1,class:"row q-col-gutter-md"},r={class:"col-xs-12"},n={class:"box box-auto-height"},c={id:"menuContent",class:"col-12 col-md-3"},d={class:"box",style:{padding:"15px 0 !important"}},h={class:"text-primary text-subtitle1 row items-center q-mb-sm q-px-md"},u={class:"col-12 col-md-9"};function g(e,t,s,g,p,m){const S=(0,i.g2)("not-result"),f=(0,i.g2)("page-actions"),k=(0,i.g2)("q-icon"),b=(0,i.g2)("q-item-section"),y=(0,i.g2)("q-item"),$=(0,i.g2)("q-list"),q=(0,i.g2)("q-expansion-item"),E=(0,i.g2)("dynamic-form"),v=(0,i.g2)("inner-loading"),O=(0,i.gN)("ripple");return(0,i.uX)(),(0,i.CE)("div",l,[p.loading||p.dataSettings?((0,i.uX)(),(0,i.CE)("div",o,[(0,i.Lk)("div",r,[(0,i.Lk)("div",n,[(0,i.bF)(f,{title:m.pageTitle,onRefresh:m.getData},null,8,["title","onRefresh"])])]),(0,i.Lk)("div",c,[(0,i.Lk)("div",d,[(0,i.Lk)("div",h,[(0,i.bF)(k,{name:"fas fa-boxes",class:"q-mr-sm"}),(0,i.eW)(" "+(0,a.v_)(e.$trp("isite.cms.label.module")),1)]),(0,i.bF)($,{separator:""},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(p.settingsGroup,((e,t)=>((0,i.uX)(),(0,i.Wv)(q,{key:t,"expand-separator":"",label:m.getModuleData(t).title,"header-style":"min-height: 38px","header-class":"q-pr-sm q-pl-md "+(p.moduleSelected==t?"q-item--active":""),group:"menuSettings"},{default:(0,i.k6)((()=>[(0,i.bF)($,{separator:"",class:"q-pl-md"},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(p.settingsGroup[t],((e,s)=>((0,i.uX)(),(0,i.CE)(i.FK,{key:s},[Object.keys(e).length?(0,i.bo)(((0,i.uX)(),(0,i.Wv)(y,{key:0,clickable:"",active:p.groupSelected==s&&p.moduleSelected==t,class:"q-pl-sm q-pr-md",onClick:e=>m.openGroupSettings(t,s),dense:""},{default:(0,i.k6)((()=>[(0,i.bF)(b,null,{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(p.groupsName[t][s].title||p.groupsName[t][s]),1)])),_:2},1024),(0,i.bF)(b,{side:""},{default:(0,i.k6)((()=>[(0,i.eW)((0,a.v_)(Object.keys(e).length),1)])),_:2},1024)])),_:2},1032,["active","onClick"])),[[O]]):(0,i.Q3)("",!0)],64)))),128))])),_:2},1024)])),_:2},1032,["label","header-class"])))),128))])),_:1})])]),(0,i.Lk)("div",u,[p.loading?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.Wv)(E,{key:0,modelValue:p.form,"onUpdate:modelValue":t[0]||(t[0]=e=>p.form=e),blocks:[{fields:this.$clone(m.formFields)}],title:`${m.getModuleData(p.moduleSelected).title} - ${p.groupsName[p.moduleSelected][p.groupSelected].title||p.groupsName[p.moduleSelected][p.groupSelected]}`,onSubmit:t[1]||(t[1]=e=>m.saveSettings())},null,8,["modelValue","blocks","title"]))])])):((0,i.uX)(),(0,i.Wv)(S,{key:0,class:"q-my-md"})),(0,i.bF)(v,{visible:p.loading},null,8,["visible"])])}s(10239);const p={mounted(){this.$nextTick((async function(){this.init()}))},data(){return{loading:!1,form:{},locale:{fields:{},fieldsTranslatable:{}},dataSettings:!1,moduleSelected:!1,groupSelected:!1,settingsToEdit:[],deprecatedSettings:[],groupsName:{},allSiteSettings:this.$store.state.qsiteApp.settings,settingsGroup:{}}},computed:{pageTitle(){return this.$tr(this.$route.meta.title)},assignedSettings(){let e=this.$store.state.quserAuth.settings||{},t=e.assignedSettings||[];return Array.isArray(t)?t:[]},formFields(){let e={},t=Object.keys(this.settingsToEdit).length?this.$clone(this.settingsToEdit):this.$clone(this.moduleSelected?this.settingsGroup[this.moduleSelected][this.groupSelected]:[]);return Object.keys(t).forEach((s=>{let i=t[s];e[s]={...i,fieldItemId:this.getSettingId(i,s)}})),e}},methods:{async init(){await this.getData(),this.openSettingName()},getData(){return this.getColorContrast(),new Promise((async e=>{this.loading=!0;const t=await Promise.all([this.$store.dispatch("qsiteApp/GET_SITE_SETTINGS",{centralizedBrand:!1,setToSite:!1}),this.getSettingFields(),this.getDeprecatedSettings()]);this.setSettingsGroup(),this.setGroupsName(),this.allSiteSettings=this.$clone(t[0].siteSettings||[]),!this.moduleSelected&&this.dataSettings&&(this.moduleSelected=Object.keys(this.settingsGroup)[0],this.groupSelected||(this.groupSelected=Object.keys(this.settingsGroup[this.moduleSelected])[0])),this.$store.dispatch("qsiteApp/SET_SITE_COLORS"),this.setFormData(),this.loading=!1,e(!0)}))},getColorContrast(){const e=document.querySelector("#masterDrawers");if(!e)return!1;const t=getComputedStyle(e).getPropertyValue("--q-color-primary"),s=this.$helper.pickTextColor(t);e.style.setProperty("--q-color-contrast",s)},getSettingFields(){return new Promise(((e,t)=>{this.dataSettings=!1;let s={refresh:!0,params:{filter:{allTranslations:!0,configNameByModule:"settings-fields"}}};this.$crud.index("apiRoutes.qsite.configs",s).then((t=>{let s={};if(t.data)for(var i in t.data){let e=t.data[i];e&&Object.keys(e).length&&(s[i]=e)}Object.keys(s).length&&(this.dataSettings=s),e(t.data)})).catch((t=>{this.$apiResponse.handleError(error,(()=>{this.$alert.error(this.$tr("isite.cms.message.errorRequest")),e([])}))}))}))},getDeprecatedSettings(){return new Promise(((e,t)=>{let s={refresh:!0,params:{filter:{configName:"isite.deprecated-settings"}}};this.$crud.index("apiRoutes.qsite.configs",s).then((t=>{this.deprecatedSettings=this.$clone(t.data),e(t.data)})).catch((t=>{this.$apiResponse.handleError(error,(()=>{this.$alert.error(this.$tr("isite.cms.message.errorRequest")),e([])}))}))}))},setGroupsName(){let e=this.$clone(this.dataSettings);const t={};Object.keys(e).forEach((s=>{Object.keys(e[s]).forEach((i=>{let a=e[s][i];t[s]||(t[s]={}),t[s][a.groupName||"General"]=a.groupTitle||"General"}))})),this.groupsName=this.$clone(t)},setSettingsGroup(){let e=this.$clone(this.dataSettings),t={};Object.keys(e).forEach((s=>{t[s]={General:{}},Object.keys(e[s]).forEach((i=>{let a=e[s][i];t[s][a.groupName||"General"]||(t[s][a.groupName||"General"]={}),this.deprecatedSettings.includes(a.name)||this.deprecatedSettings.includes(a.fakeFieldName)||(t[s][a.groupName||"General"][i]=a)}))})),this.assignedSettings.length&&Object.keys(t).forEach((e=>{Object.keys(t[e]).forEach((s=>{Object.keys(t[e][s]).forEach((i=>{let a=t[e][s][i];this.assignedSettings.includes(a.fakeFieldName||a.name)||delete t[e][s][i]}))}))})),Object.keys(t).forEach((e=>{let s=!1;Object.keys(t[e]).forEach((i=>{Object.keys(t[e][i]).length&&(s=!0)})),s||delete t[e]})),this.settingsGroup=this.$clone(t)},setFormData(){let e={},t=this.$clone(this.allSiteSettings),s=(this.$clone(this.$store.state.qsiteApp.defaultLocale),this.$clone(this.$store.state.qsiteApp.selectedLocales));s.forEach((t=>e[t]={})),Object.values(this.formFields).forEach((i=>{let a=t.find((e=>e.name==(i.fakeFieldName||i.name)));i.isTranslatable?s.forEach((t=>{let s=a.translations?a.translations.find((e=>e.locale==t)):null;try{e[t][a.name]=s?JSON.parse(s.value):a.value}catch(i){e[t][a.name]=s?s.value:a.value}})):e[a.name]=a.value})),setTimeout((()=>this.form=this.$clone(e)),50)},getSettingId(e,t){let s=e.fakeFieldName||e.name||t,i=this.allSiteSettings.find((e=>e.name==s));return i?i.id:null},getDataForm(){let e=this.$clone(this.form),t=this.$clone(this.$store.state.qsiteApp.selectedLocales),s={};return Object.keys(e).forEach((i=>{-1==t.indexOf(i)?s[i]=e[i]:Object.keys(e[i]).forEach((t=>{s[t]||(s[t]={}),s[t][i]="string"==typeof e[i][t]?e[i][t]:JSON.stringify(e[i][t])}))})),s},saveSettings(){if(this.loading=!0,"Core"==this.moduleSelected){if(!this.form["core::locales"].length){const e=this.$store.getters["qsiteApp/getDefaultLocale"];this.form["core::locales"].push(e)}this.$store.dispatch("qsiteApp/SET_LOCALE",{locale:this.form["core::locales"][0]})}this.$crud.post("apiRoutes.qsite.settings",{attributes:this.getDataForm()}).then((async e=>{this.$alert.info(this.$tr("isite.cms.message.recordUpdated")),this.getColorContrast(),this.getData()})).catch((e=>{this.$alert.error(this.$tr("isite.cms.message.recordNoUpdated")),console.error("[UPDATE-SETTINGS]::error:",e),this.loading=!1}))},openSettingName(){let e=this.$route.query.module,t=this.$route.query.group,s=this.$route.query.settings,i=this.$clone(this.settingsGroup[this.$helper.toCapitalize(e||"")]);if(i){let a={};s&&(s=s.split(",").map((t=>`${e.toLowerCase()}::${t}`)),Object.keys(i||[]).forEach((e=>{Object.keys(i[e]).forEach((t=>{let l=i[e][t];(s.includes(l.name)||s.includes(l.fakeFieldName))&&(a[t]=l)}))}))),t=Object.keys(i).includes(t)?t:Object.keys(i).pop(),this.openGroupSettings(e,t,a)}},openGroupSettings(e,t,s=[]){this.moduleSelected=this.$helper.toCapitalize(e),this.groupSelected=t,this.settingsToEdit=s,this.setSettingsGroup(),this.setFormData()},getModuleData(e){let t=this.$store.state.qsiteApp.modules;return Object.values(t).find((t=>t.alias==e.toLowerCase()))}}};var m=s(12807),S=s(24609),f=s(54514),k=s(76986),b=s(75329),y=s(63418),$=s(71339),q=s(44029),E=s(98582),v=s.n(E);const O=(0,m.A)(p,[["render",g]]),N=O;v()(p,"components",{QIcon:S.A,QList:f.A,QExpansionItem:k.A,QItem:b.A,QItemSection:y.A,QColor:$.A}),v()(p,"directives",{Ripple:q.A})}}]);