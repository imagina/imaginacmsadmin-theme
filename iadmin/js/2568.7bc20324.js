"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[2568],{2568:(e,l,t)=>{t.r(l),t.d(l,{default:()=>V});var a=t(92444);const s={key:0,class:"row gutter-x-sm relative-position q-layout-page layout-padding q-mb-lg backend-page"},o={class:"col-12 box"},i={class:"row"},r={class:"col-12 q-mb-md"},n={key:0,class:"col-7"},m={key:1,class:"col-5"},d={class:"col-12 text-right"};function u(e,l,t,u,c,p){const g=(0,a.E1)("locales"),h=(0,a.E1)("q-input"),f=(0,a.E1)("dynamic-field"),$=(0,a.E1)("q-select"),b=(0,a.E1)("q-btn"),T=(0,a.E1)("q-form"),y=(0,a.E1)("inner-loading");return c.success?((0,a.Wz)(),(0,a.An)("div",s,[(0,a.QD)("div",o,[(0,a.QD)("div",i,[(0,a.QD)("div",r,[(0,a.K2)(g,{modelValue:c.locale,"onUpdate:modelValue":l[0]||(l[0]=e=>c.locale=e),ref:"localeComponent",form:e.$refs.formContent},null,8,["modelValue","form"])]),(0,a.K2)(T,{onSubmit:l[12]||(l[12]=e=>c.itemId?p.updateItem():p.createItem()),ref:"formContent",class:"row q-col-gutter-x-sm full-width",autocomplete:"off",onValidationError:l[13]||(l[13]=l=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,a.Ql)((()=>[c.locale.success?((0,a.Wz)(),(0,a.An)("div",n,[(0,a.K2)(h,{"data-testid":"title",outlined:"",dense:"",modelValue:c.locale.formTemplate.title,"onUpdate:modelValue":l[1]||(l[1]=e=>c.locale.formTemplate.title=e),rules:[l=>!!l||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("isite.cms.form.title")} (${c.locale.language})*`},null,8,["modelValue","rules","label"]),"page"==c.locale.formTemplate.linkType?((0,a.Wz)(),(0,a.Az)(f,{key:0,modelValue:c.locale.formTemplate.pageId,"onUpdate:modelValue":l[2]||(l[2]=e=>c.locale.formTemplate.pageId=e),field:p.dynamicFields.pages},null,8,["modelValue","field"])):(0,a.g1)("",!0),(0,a.K2)(f,{modelValue:c.locale.formTemplate.description,"onUpdate:modelValue":l[3]||(l[3]=e=>c.locale.formTemplate.description=e),field:p.dynamicFields.description,language:c.locale.language},null,8,["modelValue","field","language"]),"external"==c.locale.formTemplate.linkType?((0,a.Wz)(),(0,a.Az)(h,{key:1,"data-testid":"url",outlined:"",dense:"",modelValue:c.locale.formTemplate.url,"onUpdate:modelValue":l[4]||(l[4]=e=>c.locale.formTemplate.url=e),rules:[l=>!!l||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("menu.cms.form.url")} (${c.locale.language})*`},null,8,["modelValue","rules","label"])):(0,a.g1)("",!0),"internal"==c.locale.formTemplate.linkType?((0,a.Wz)(),(0,a.Az)(h,{key:2,"data-testid":"uri",outlined:"",dense:"",modelValue:c.locale.formTemplate.uri,"onUpdate:modelValue":l[5]||(l[5]=e=>c.locale.formTemplate.uri=e),rules:[l=>!!l||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("menu.cms.form.uri")} (${c.locale.language})*`},null,8,["modelValue","rules","label"])):(0,a.g1)("",!0),(0,a.K2)($,{"data-testid":"status",outlined:"",dense:"","bg-color":"white",modelValue:c.locale.formTemplate.status,"onUpdate:modelValue":l[6]||(l[6]=e=>c.locale.formTemplate.status=e),options:c.status,label:`${e.$tr("isite.cms.form.status")} (${c.locale.language})`,style:{width:"100%"},"emit-value":"","map-options":""},null,8,["modelValue","options","label"]),(0,a.K2)(h,{"data-testid":"icon",outlined:"",dense:"",modelValue:c.locale.formTemplate.icon,"onUpdate:modelValue":l[7]||(l[7]=e=>c.locale.formTemplate.icon=e),label:`${e.$tr("isite.cms.form.icon")}`},null,8,["modelValue","label"]),(0,a.K2)(h,{"data-testid":"class",outlined:"",dense:"",modelValue:c.locale.formTemplate.class,"onUpdate:modelValue":l[8]||(l[8]=e=>c.locale.formTemplate.class=e),label:`${e.$tr("menu.cms.form.class")}`},null,8,["modelValue","label"])])):(0,a.g1)("",!0),c.locale.success?((0,a.Wz)(),(0,a.An)("div",m,[(0,a.K2)($,{"data-testid":"linkType",outlined:"",dense:"","bg-color":"white",modelValue:c.locale.formTemplate.linkType,"onUpdate:modelValue":l[9]||(l[9]=e=>c.locale.formTemplate.linkType=e),options:c.linkTypes,label:e.$tr("menu.cms.form.typeLink"),style:{width:"100%"},"emit-value":"","map-options":""},null,8,["modelValue","options","label"]),(0,a.K2)($,{"data-testid":"target",outlined:"",dense:"","bg-color":"white",modelValue:c.locale.formTemplate.target,"onUpdate:modelValue":l[10]||(l[10]=e=>c.locale.formTemplate.target=e),options:c.targets,label:e.$tr("menu.cms.form.target"),style:{width:"100%"},"emit-value":"","map-options":""},null,8,["modelValue","options","label"]),(0,a.K2)($,{"data-testid":"parentId",outlined:"",dense:"","bg-color":"white",modelValue:c.locale.formTemplate.parentId,"onUpdate:modelValue":l[11]||(l[11]=e=>c.locale.formTemplate.parentId=e),options:c.menuItems,label:e.$tr("isite.cms.form.parent"),style:{width:"100%"},"emit-value":"","map-options":""},null,8,["modelValue","options","label"])])):(0,a.g1)("",!0),(0,a.QD)("div",d,[c.itemId?((0,a.Wz)(),(0,a.Az)(b,{key:0,color:"green",loading:c.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.update"),type:"submit",rounded:"",unelevated:""},null,8,["loading","label"])):((0,a.Wz)(),(0,a.Az)(b,{key:1,color:"green",loading:c.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.create"),type:"submit",rounded:"",unelevated:""},null,8,["loading","label"]))])])),_:1},512)])]),(0,a.K2)(y,{visible:c.loading},null,8,["visible"])])):(0,a.g1)("",!0)}t(23816);const c={components:{},watch:{$route(e,l){this.initForm()}},mounted(){this.$nextTick((function(){this.initForm()}))},validations(){return this.getObjectValidation()},data(){return{locale:{},loading:!1,success:!1,users:[],itemId:!1,menuItems:[],pages:[],targets:[{value:"_self",label:this.$tr("menu.cms.form.sameTab")},{value:"_blank",label:this.$tr("menu.cms.form.newTab")}],status:[{label:this.$tr("isite.cms.label.enabled"),value:"1"},{label:this.$tr("isite.cms.label.disabled"),value:"0"}],linkTypes:[{label:this.$tr("menu.cms.form.page"),value:"page"},{label:this.$tr("menu.cms.form.internal"),value:"internal"},{label:this.$tr("menu.cms.form.external"),value:"external"}]}},computed:{dataLocale(){return{fields:{menuId:this.$route.params.menuId,pageId:"",parentId:null,position:0,target:"_self",modulename:"",isroot:"",icon:"",linkType:"internal",locale:"",class:""},fieldsTranslatable:{title:"",url:"",uri:"",status:"1",description:null}}},dynamicFields(){return{pages:{testId:"pageId",value:null,type:"select",props:{label:this.$tr("isite.cms.form.page"),rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]},loadOptions:{apiRoute:"apiRoutes.qpage.pages"}},description:{value:"",type:"input",isTranslatable:!0,props:{label:`${this.$tr("isite.cms.form.description")}`,type:"textarea",rows:"3"}}}}},methods:{async initForm(){this.loading=!0,this.success=!1,this.locale=this.$clone(this.dataLocale),this.itemId=this.$route.params.id,this.locale.success&&this.$refs.localeComponent.vReset(),await this.getData(),this.getMenuItems(),this.success=!0,this.loading=!1},getData(){return new Promise(((e,l)=>{const t=this.$clone(this.itemId);if(t){let a="apiRoutes.qmenu.menuItems",s={refresh:!0,params:{filter:{allTranslations:!0}}};this.$crud.show(a,t,s).then((l=>{this.orderDataItemToLocale(l.data),e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1,l(!1)}))}))}else e(!0)}))},orderDataItemToLocale(e){let l=this.$clone(e);this.locale.form=this.$clone(l)},async createItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qmenu.menuItems";this.$crud.create(e,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordCreated")} ID: ${e.data.id}`}),this.$router.push({name:"qmenu.admin.menus.show",params:{id:this.$route.params.menuId}})})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoCreated"),pos:"bottom"})}))}},async updateItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qmenu.menuItems";this.$crud.update(e,this.itemId,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},getDataForm(){let e=this.locale.form;for(var l in e){let t=e[l];null!=t&&void 0!=t||delete e[l]}return e.selectable=JSON.stringify(e.selectable),e},getMenuItems(){return new Promise(((e,l)=>{let t="apiRoutes.qmenu.menuItems",a={refresh:!0,params:{filter:{allTranslations:!0,menu:this.$route.params.menuId}}};this.$crud.index(t,a).then((l=>{this.menuItems=this.$array.tree(l.data),e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error("Failed: "+e,"bottom"),l(!0)}))}))}))},arrayUnique(e){return e.filter(((e,l,t)=>t.findIndex((l=>JSON.stringify(l)===JSON.stringify(e)))===l))}}};var p=t(68716),g=t(41628),h=t(14288),f=t(20540),$=t(36008),b=t(99140),T=t(95252),y=t.n(T);const I=(0,p.c)(c,[["render",u]]),V=I;y()(c,"components",{QLayout:g.c,QForm:h.c,QInput:f.c,QSelect:$.c,QBtn:b.c})}}]);