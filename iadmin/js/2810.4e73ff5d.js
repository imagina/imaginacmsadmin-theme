"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[2810],{31126:(t,e,a)=>{a.r(e),a.d(e,{default:()=>x});var o=a(61758),n=a(58790);const i={id:"appointmentAssignedIndex"},s={id:"appointmentAssignedIndexContent",class:"box relative-position",style:{padding:"0"}},l={key:0},d={key:0,class:"box box-auto-height"},r={class:"text-grey-7 q-mr-xs"},m={key:1},p={class:"text-grey-7 q-mr-xs"},c={class:"text-grey-7 q-mr-xs"},h={class:"text-grey-7 q-mr-xs"},u={key:2,class:"box box-auto-height"},g={class:"text-right"};function v(t,e,a,v,f,b){const y=(0,o.g2)("advanced-chat"),$=(0,o.g2)("not-result"),k=(0,o.g2)("dynamic-field"),E=(0,o.g2)("q-btn"),R=(0,o.g2)("master-modal"),S=(0,o.g2)("dynamic-form"),x=(0,o.g2)("inner-loading");return(0,o.uX)(),(0,o.CE)("div",i,[(0,o.Lk)("div",s,[f.loading?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.Wv)(y,{key:0,"rooms-id":b.assignedConversations.conversationsId,onRoomOpened:e[0]||(e[0]=e=>f.selectedRommId=t.$clone(e)),"advanced-props":b.advancedChatProps,height:"calc(100vh - 200px)","load-rooms":!!b.assignedConversations.conversationsId.length},null,8,["rooms-id","advanced-props","load-rooms"])),(0,o.bF)(R,{modelValue:f.modal.show,"onUpdate:modelValue":e[2]||(e[2]=t=>f.modal.show=t),title:f.modal.title||"",loading:f.modal.loading},{default:(0,o.k6)((()=>[b.appointmentSelected?((0,o.uX)(),(0,o.CE)("div",l,["showInformation"==f.modal.type?((0,o.uX)(),(0,o.CE)("div",d,[((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(b.appointmentSelected.fields||[],((t,e)=>((0,o.uX)(),(0,o.CE)("div",{key:e,class:"appt-card__fields-field q-py-xs"},[(0,o.Lk)("label",r,(0,n.v_)(t.name)+":",1),(0,o.Lk)("label",null,(0,n.v_)(t.value),1)])))),128))])):"showSubscription"==f.modal.type?((0,o.uX)(),(0,o.CE)("div",m,[f.modal.loading||f.modal.data&&f.modal.data.length?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.Wv)($,{key:0})),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(f.modal.data||[],((e,a)=>((0,o.uX)(),(0,o.CE)("div",{key:a,class:"box box-auto-height q-py-xs q-mb-sm"},[(0,o.Lk)("div",null,[(0,o.Lk)("label",p,(0,n.v_)(t.$tr("isite.cms.form.name"))+":",1),(0,o.Lk)("label",null,(0,n.v_)(e.name),1)]),(0,o.Lk)("div",null,[(0,o.Lk)("label",c,(0,n.v_)(t.$tr("qplan.layout.form.startDate"))+":",1),(0,o.Lk)("label",null,(0,n.v_)(t.$trd(e.startDate)),1)]),(0,o.Lk)("div",null,[(0,o.Lk)("label",h,(0,n.v_)(t.$tr("qplan.layout.form.endDate"))+":",1),(0,o.Lk)("label",null,(0,n.v_)(t.$trd(e.endDate)),1)])])))),128))])):((0,o.uX)(),(0,o.CE)("div",u,[(0,o.bF)(k,{modelValue:f.fieldValue[f.modal.type],"onUpdate:modelValue":e[1]||(e[1]=t=>f.fieldValue[f.modal.type]=t),field:b.actionsFields[f.modal.type],class:"q-mb-md"},null,8,["modelValue","field"]),(0,o.Lk)("div",g,[(0,o.bF)(E,{label:t.$tr("isite.cms.label.save"),icon:"fas fa-save",rounded:"",unelevated:"",color:"green",onClick:b.updateAppointment},null,8,["label","onClick"])])]))])):(0,o.Q3)("",!0)])),_:1},8,["modelValue","title","loading"]),(0,o.bF)(R,{modelValue:f.modalReportError,"onUpdate:modelValue":e[4]||(e[4]=t=>f.modalReportError=t),title:t.$tr("iappointment.cms.message.reportError"),loading:f.modal.loading},{default:(0,o.k6)((()=>[b.formErrorId&&b.appointmentSelected?((0,o.uX)(),(0,o.Wv)(S,{key:0,"form-id":b.formErrorId,onSent:e[3]||(e[3]=t=>f.modalReportError=!1),"send-to":{apiRoute:"apiRoutes.qform.leads",extraData:{formId:b.formErrorId}}},null,8,["form-id","send-to"])):(0,o.Q3)("",!0)])),_:1},8,["modelValue","title","loading"]),(0,o.bF)(x,{visible:f.loading},null,8,["visible"])])])}a(10239);var f=a(78319),b=a(71915);const y={beforeUnmount(){b.Bt.off("page.data.refresh"),b.Bt.off("iappointment.appoinment.was.changed")},props:{},components:{advancedChat:f.A},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,appointments:[],selectedRommId:!1,modal:{loading:!1,show:!1,title:!1,type:!1,data:!1},modalReportError:!1,fieldValue:{addRecommendation:null,changeStatus:null}}},computed:{formErrorId(){return this.$getSetting("iappointment::errorFormRelated")},assignedConversations(){let t={conversations:[],conversationsId:[]},e=this.$clone(this.appointments);if(e){let a=e.filter((t=>t.conversation)),o=a.map((t=>t.conversation));t={conversations:o,conversationsId:o.map((t=>t.id))}}return this.$clone(t)},appointmentSelected(){if(!this.selectedRommId)return!1;let t=this.$clone(this.appointments.filter((t=>t.conversation)));return t.find((t=>t.conversation.id=this.selectedRommId))},advancedChatProps(){let t={menuActions:[{name:"showInformation",title:this.$tr("iappointment.cms.message.showInfo"),action:t=>{this.modal={show:!0,title:this.appointmentSelected.customer.fullName,type:"showInformation"}}},{name:"changeStatus",title:this.$tr("iappointment.cms.message.changeStatus"),action:t=>{this.modal={show:!0,title:this.$tr("iappointment.cms.message.changeStatus"),type:"changeStatus"}}},{name:"addRecommendation",title:this.$tr("iappointment.cms.message.addRecommendation"),action:t=>{this.modal={show:!0,title:this.$tr("iappointment.cms.message.addRecommendation"),type:"addRecommendation"}}}]};return this.$hasAccess("iplan.subscriptions.index")&&t.menuActions.push({name:"showSubscriptions",title:this.$tr("iappointment.cms.message.showSubscriptions"),action:t=>{this.modal={show:!0,title:this.$trp("isite.cms.label.subscription"),type:"showSubscription",loading:!0,data:!1},this.getCustomerSubscriptions()}}),this.formErrorId&&t.menuActions.push({name:"reportError",title:this.$tr("iappointment.cms.message.reportError"),action:t=>{this.modalReportError=!0}}),t},actionsFields(){let t=this.appointmentSelected.options&&this.appointmentSelected.options.recommendation||null;return{addRecommendation:{value:t,type:"html"},changeStatus:{value:null,type:"select",props:{label:this.$tr("isite.cms.form.status"),options:[{label:"Abandonado",value:4},{label:"Completado",value:6}]}}}}},methods:{init(){this.listenEvents(),this.getAppointments()},listenEvents(){b.Bt.on("page.data.refresh",(()=>{this.getAppointments(!0)})),b.Bt.on("iappointment.appoinment.was.changed",(t=>{this.$alert.info({mode:"modal",message:this.$tr("iappointment.cms.message.newAssignationMessage"),actions:[{label:this.$tr("isite.cms.label.refresh"),color:"green",handler:()=>this.getAppointments()}]})}))},getAppointments(t=!1){return new Promise(((t,e)=>{this.loading=!0;let a={refresh:!0,params:{include:"category,customer,assigned,status,fields,conversation",filter:{status:3}}};this.$crud.index("apiRoutes.qappointment.appointments",a).then((t=>{this.appointments=t.data,this.loading=!1})).catch((t=>{this.$apiResponse.handleError(t,(()=>{this.loading=!1}))}))}))},updateAppointment(){this.modal.loading=!0;let t=this.$clone(this.appointmentSelected);"changeStatus"==this.modal.type&&(t.statusId=this.fieldValue.changeStatus),"addRecommendation"==this.modal.type&&(t.options={...t.options||{},recommendation:this.fieldValue.addRecommendation}),this.$crud.update("apiRoutes.qappointment.appointments",this.appointmentSelected.id,t).then((e=>{"addRecommendation"==this.modal.type&&this.appointments.forEach(((e,a)=>{e.id==t.id&&(this.appointments[a]=this.$clone(t))})),"changeStatus"==this.modal.type&&this.getAppointments(),this.modal={loading:!1,show:!1,title:!1,type:!1}})).catch((t=>{this.modal.loading=!1}))},getCustomerSubscriptions(){return new Promise(((t,e)=>{let a={params:{filter:{user:this.appointmentSelected.customerId,status:1}}};this.$crud.index("apiRoutes.qplan.subscriptions",a).then((t=>{this.modal.loading=!1,this.modal.data=t.data})).catch((t=>{this.$apiResponse.handleError(t,(()=>{this.modal.loading=!1,e(t)}))}))}))}}};var $=a(12807),k=a(69001),E=a(98582),R=a.n(E);const S=(0,$.A)(y,[["render",v]]),x=S;R()(y,"components",{QBtn:k.A})}}]);