"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[5221],{95221:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ie});var a=s(61758);const o={class:"backend-page row q-col-gutter-x-md"},l={class:"col-md-5"},i={class:"box"},r={class:"col-md-7"},n={class:"box"};function d(e,t,s,d,c,u){const m=(0,a.g2)("formOptions"),p=(0,a.g2)("indexValuesByOptions");return(0,a.uX)(),(0,a.CE)("div",o,[(0,a.Lk)("div",l,[(0,a.Lk)("div",i,[(0,a.bF)(m)])]),(0,a.Lk)("div",r,[(0,a.Lk)("div",n,[(0,a.bF)(p)])])])}const c={key:0,class:"row gutter-x-sm relative-position"},u={class:"col-12"};function m(e,t,s,o,l,i){const r=(0,a.g2)("locales"),n=(0,a.g2)("dynamic-field"),d=(0,a.g2)("q-btn"),m=(0,a.g2)("q-form"),p=(0,a.g2)("inner-loading");return l.success?((0,a.uX)(),(0,a.CE)("div",c,[(0,a.Lk)("div",u,[(0,a.bF)(r,{modelValue:l.locale,"onUpdate:modelValue":t[0]||(t[0]=e=>l.locale=e),ref:"localeComponent",form:e.$refs.formContent},null,8,["modelValue","form"])]),l.locale.success?((0,a.uX)(),(0,a.Wv)(m,{key:0,autocorrect:"off",autocomplete:"off",ref:"formContent",class:"full-width q-my-sm",onSubmit:t[1]||(t[1]=e=>i.updateItem()),onValidationError:t[2]||(t[2]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(i.formFields,((e,t)=>((0,a.uX)(),(0,a.Wv)(n,{key:t,field:e,modelValue:l.locale.formTemplate[t],"onUpdate:modelValue":e=>l.locale.formTemplate[t]=e,language:l.locale.language},null,8,["field","modelValue","onUpdate:modelValue","language"])))),128)),l.itemId?((0,a.uX)(),(0,a.Wv)(d,{key:0,class:"float-right",color:"green",loading:l.loading,unelevated:"","no-caps":"",label:e.$tr("isite.cms.label.save"),type:"submit",rounded:""},null,8,["loading","label"])):(0,a.Q3)("",!0)])),_:1},512)):(0,a.Q3)("",!0),(0,a.bF)(p,{visible:l.loading},null,8,["visible"])])):(0,a.Q3)("",!0)}const p={components:{},watch:{$route(e,t){this.initForm()}},mounted(){this.$nextTick((function(){this.initForm()}))},data(){return{locale:{},loading:!1,success:!1,itemId:!1}},computed:{dataLocale(){return{fields:{type:null},fieldsTranslatable:{description:""}}},formFields(){return{description:{value:"",type:"input",isTranslatable:!0,props:{label:`${this.$tr("isite.cms.form.description")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]}},type:{value:null,type:"select",isTranslatable:!1,props:{label:`${this.$tr("isite.cms.form.type")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]},loadOptions:{apiRoute:"apiRoutes.qcommerce.optionTypes",select:{label:"label",id:"value"}}}}}},methods:{async initForm(){this.loading=!0,this.success=!1,this.locale=this.$clone(this.dataLocale),this.itemId=this.$route.params.id,this.locale.success&&this.$refs.localeComponent.vReset(),await this.getData(),this.success=!0,this.loading=!1},getData(){return new Promise(((e,t)=>{const s=this.$clone(this.itemId);if(s){let a="apiRoutes.qcommerce.options",o={refresh:!0,params:{filter:{allTranslations:!0}}};this.$crud.show(a,s,o).then((t=>{this.orderDataItemToLocale(t.data),e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest")}),this.loading=!1,t(!1)}))}))}else e(!0)}))},orderDataItemToLocale(e){let t=this.$clone(e);this.locale.form=this.$clone(t)},async updateItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qcommerce.options";this.$crud.update(e,this.itemId,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")})}))}},getDataForm(){let e=this.locale.form;for(var t in e){let s=e[t];null!=s&&void 0!=s||delete e[t]}return e.selectable=JSON.stringify(e.selectable),e}}};var g=s(12807),h=s(21565),b=s(69001),f=s(98582),v=s.n(f);const k=(0,g.A)(p,[["render",m]]),$=k;v()(p,"components",{QForm:h.A,QBtn:b.A});var q=s(58790);const V={class:"row gutter-y-sm relative-position"},y={class:"col-md-12"},F={class:"row q-gutter-x-sm justify-between"},I={class:"col-12"},C={class:"col-12 q-mt-sm"},w={class:"col-12 text-right q-mt-sm"},A={class:"text-weight-bold"};function T(e,t,s,o,l,i){const r=(0,a.g2)("q-btn"),n=(0,a.g2)("q-tooltip"),d=(0,a.g2)("q-separator"),c=(0,a.g2)("nestedoptionValues"),u=(0,a.g2)("q-icon"),m=(0,a.g2)("q-avatar"),p=(0,a.g2)("q-toolbar-title"),g=(0,a.g2)("q-toolbar"),h=(0,a.g2)("option-values-form"),b=(0,a.g2)("q-card-section"),f=(0,a.g2)("q-card"),v=(0,a.g2)("q-dialog"),k=(0,a.g2)("inner-loading"),$=(0,a.gN)("close-popup");return(0,a.uX)(),(0,a.CE)("div",V,[(0,a.Lk)("div",y,[(0,a.Lk)("div",F,[(0,a.bF)(r,(0,a.v6)({to:{name:"qcommerce.admin.options"},icon:"fa-light fa-arrow-left"},i.buttonProps),null,16,["to"]),(0,a.bF)(r,(0,a.v6)({onClick:t[0]||(t[0]=e=>(l.id=-1,l.dialogNewValue=!0)),icon:"fa-light fa-plus",label:e.$tr("icommerce.cms.newOptionValue")},i.buttonProps),null,16,["label"]),(0,a.bF)(r,(0,a.v6)({onClick:t[1]||(t[1]=e=>i.getItems(!0)),icon:"fa-light fa-rotate-right"},i.buttonProps),{default:(0,a.k6)((()=>[(0,a.bF)(n,{delay:300},{default:(0,a.k6)((()=>[(0,a.eW)((0,q.v_)(e.$tr("isite.cms.label.refresh")),1)])),_:1})])),_:1},16)])]),(0,a.Lk)("div",I,[(0,a.bF)(d,{class:"q-my-md"})]),(0,a.Lk)("div",C,[(0,a.bF)(c,{optionValues:l.optionValues,onUpdated:t[2]||(t[2]=e=>i.getItems(!0))},null,8,["optionValues"])]),(0,a.Lk)("div",w,[l.optionValues.length?((0,a.uX)(),(0,a.Wv)(r,{key:0,onClick:i.updateOrder,icon:"fas fa-save",label:e.$tr("isite.cms.label.save"),color:"positive",class:"q-ml-xs",rounded:"",unelevated:""},null,8,["onClick","label"])):(0,a.Q3)("",!0)]),(0,a.bF)(v,{modelValue:l.dialogNewValue,"onUpdate:modelValue":t[3]||(t[3]=e=>l.dialogNewValue=e)},{default:(0,a.k6)((()=>[(0,a.bF)(f,null,{default:(0,a.k6)((()=>[(0,a.bF)(g,{class:"bg-primary text-white"},{default:(0,a.k6)((()=>[(0,a.bF)(m,null,{default:(0,a.k6)((()=>[(0,a.bF)(u,{name:"fa fa-stream"})])),_:1}),(0,a.bF)(p,null,{default:(0,a.k6)((()=>[(0,a.Lk)("span",A,(0,q.v_)(this.id>0?e.$tr("icommerce.cms.sidebar.adminValuesEdit"):e.$tr("icommerce.cms.sidebar.adminValuesCreate")),1)])),_:1}),(0,a.bo)((0,a.bF)(r,{flat:"",round:"",dense:"",icon:"fa fa-close"},null,512),[[$]])])),_:1}),(0,a.bF)(b,null,{default:(0,a.k6)((()=>[(0,a.bF)(h,{"option-id":e.$route.params.id,id:l.id,onUpdated:i.closeNewModal},null,8,["option-id","id","onUpdated"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,a.bF)(k,{visible:l.loading},null,8,["visible"])])}s(10239);const x={class:"row justify-between q-mb-xs q-mt-xs"},D={class:"col-6 q-py-xs"},Q={class:"col-6 text-right q-py-xs relative-position"},_={class:"col-12"},L={key:1,class:"col-12 text-center text-h5"},E={class:"q-ma-none text-red"};function R(e,t,s,o,l,i){const r=(0,a.g2)("q-icon"),n=(0,a.g2)("q-btn"),d=(0,a.g2)("q-separator"),c=(0,a.g2)("nestedDraggable"),u=(0,a.g2)("draggable"),m=(0,a.g2)("not-result"),p=(0,a.g2)("q-card-section"),g=(0,a.g2)("q-card-actions"),h=(0,a.g2)("q-card"),b=(0,a.g2)("q-dialog");return(0,a.uX)(),(0,a.CE)("div",null,[s.optionValues.length>0?((0,a.uX)(),(0,a.Wv)(u,(0,a.v6)({key:0,tag:"div"},i.dragOptions,{list:s.optionValues,group:{name:"g1"},"item-key":"id"}),{item:(0,a.k6)((({element:e})=>[((0,a.uX)(),(0,a.CE)("div",{class:"list-group-item",key:e.id},[(0,a.Lk)("div",x,[(0,a.Lk)("div",D,[(0,a.bF)(r,{class:"cursor-pointer",name:"fas fa-arrows-alt"}),(0,a.eW)(" "+(0,q.v_)(e.description),1)]),(0,a.Lk)("div",Q,[(0,a.bF)(n,{onClick:t=>l.eventBus.emit("showEdit",e.id),icon:"fas fa-pen",size:"xs",class:"q-mr-sm",color:"green"},null,8,["onClick"]),(0,a.bF)(n,{onClick:t=>{l.dialogDeleteItem=!0,l.itemIdToDelete=e},icon:"fas fa-trash-alt",size:"xs",color:"red"},null,8,["onClick"])]),(0,a.Lk)("div",_,[(0,a.bF)(d)])]),e.children?((0,a.uX)(),(0,a.Wv)(c,{key:0,class:(0,q.C4)(`${e.children.length} ?: q-mb-xs`),optionValues:e.children},null,8,["class","optionValues"])):(0,a.Q3)("",!0)]))])),_:1},16,["list"])):((0,a.uX)(),(0,a.CE)("div",L,[(0,a.bF)(m)])),(0,a.bF)(b,{modelValue:l.dialogDeleteItem,"onUpdate:modelValue":t[2]||(t[2]=e=>l.dialogDeleteItem=e)},{default:(0,a.k6)((()=>[(0,a.bF)(h,{class:"backend-page"},{default:(0,a.k6)((()=>[(0,a.bF)(p,null,{default:(0,a.k6)((()=>[(0,a.Lk)("h5",E,(0,q.v_)(l.itemIdToDelete.label),1),(0,a.eW)(" "+(0,q.v_)(e.$tr("isite.cms.message.deleteRecord")),1)])),_:1}),(0,a.bF)(g,{align:"right"},{default:(0,a.k6)((()=>[(0,a.bF)(n,{color:"blue-grey",label:"Cancel",onClick:t[0]||(t[0]=e=>l.dialogDeleteItem=!1)}),(0,a.bF)(n,{color:"red",icon:"fas fa-trash-alt",label:"Delete",onClick:t[1]||(t[1]=e=>i.deleteItem())})])),_:1})])),_:1})])),_:1},8,["modelValue"])])}var U=s(10057),N=s.n(U),O=s(41421),X=s(71915);const B={name:"nestedDraggable",components:{draggable:N(),optionValuesForm:O["default"]},props:{optionValues:{required:!0,type:Array}},emits:["updated"],data(){return{dialogDeleteItem:!1,dialogEditValue:!1,itemIdToDelete:{},optionId:this.$route.params.id||null,id:null,eventBus:X.Bt}},computed:{dragOptions(){return{animation:200,group:"description",disabled:!1,ghostClass:"ghost"}}},methods:{deleteItem(){this.$crud.delete("apiRoutes.qcommerce.optionValues",this.itemIdToDelete.id).then((e=>{this.$alert.success({message:this.$tr("isite.cms.message.recordDeleted")}),this.dialogDeleteItem=!1,this.$emit("updated")})).catch((e=>{this.$alert.error({message:this.$tr("isite.cms.message.recordNoDeleted"),pos:"bottom"})}))}}};var W=s(24609),P=s(37015),S=s(57201),z=s(97569),j=s(27066),M=s(16334);const J=(0,g.A)(B,[["render",R]]),K=J;v()(B,"components",{QIcon:W.A,QBtn:b.A,QSeparator:P.A,QDialog:S.A,QCard:z.A,QCardSection:j.A,QCardActions:M.A});const G={components:{nestedoptionValues:K,optionValuesForm:O["default"]},data(){return{loading:!1,optionValues:[],modalNewItem:!1,modalUpdateItem:!1,dialogNewValue:!1,itemUpdate:{},itemDelete:{},id:-1}},created(){this.$nextTick((()=>{this.getItems(),X.Bt.on("updateoptionValues",this.handlerUpdateoptionValues),X.Bt.on("showEdit",this.showEdit)}))},computed:{buttonProps(){return{round:!1,rounded:!0,dense:!0,unelevated:!0,textColor:"primary",style:"border: 1px solid rgba(0, 13, 71, 0.15)",class:`btn-${this.size}`,noCaps:!0}}},methods:{showEdit(e){this.id=e,this.dialogNewValue=!0},getItems(e=!1){this.loading=!0;let t=this.$route.params.id,s={refresh:e,params:{filter:{optionId:t,order:{field:"sort_order",way:"asc"}}}};this.$crud.index("apiRoutes.qcommerce.optionValues",s).then((e=>{this.optionValues=e.data,this.loading=!1})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1}))}))},updateOrder(){let e=[];this.treeToArray(this.optionValues,e),this.loading=!0,this.$crud.create("apiRoutes.qcommerce.optionValuesOrdener",{values:e}).then((e=>{this.loading=!1,this.getItems(!0),this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`})})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"})}))},arrayToTree(e,t=0){return e.filter((s=>{if(s.parentId==t)return s["children"]=this.arrayToTree(e,s.id)}))},treeToArray(e,t,s=null){let a=[...e];a.forEach(((e,a)=>{e.sortOrder=a,e.parentId=s,t.push(e),e.children&&e.children.length&&this.treeToArray(e.children,t,e.id)}))},handlerUpdateoptionValues(e){this.getItems()},closeNewModal(){this.dialogNewValue=!1,this.getItems(!0)}}};var H=s(78151),Y=s(79351),Z=s(53581),ee=s(56769),te=s(62769);const se=(0,g.A)(G,[["render",T]]),ae=se;v()(G,"components",{QBtn:b.A,QTooltip:H.A,QSeparator:P.A,QDialog:S.A,QCard:z.A,QToolbar:Y.A,QAvatar:Z.A,QIcon:W.A,QToolbarTitle:ee.A,QCardSection:j.A}),v()(G,"directives",{ClosePopup:te.A});const oe={components:{formOptions:$,indexValuesByOptions:ae}},le=(0,g.A)(oe,[["render",d]]),ie=le}}]);