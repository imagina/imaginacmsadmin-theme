"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[3876],{63876:(t,a,e)=>{e.r(a),e.d(a,{default:()=>S});var i=e(92444),o=e(74044);const s={id:"walletPage"},l={class:"box box-auto-height q-mb-md"},n={class:"row q-col-gutter-x-md"},m={class:"col-6 col-sm-3"},r={class:"box box-auto-height q-mb-md bg-blue text-white"},d={class:"text-weight-bold"},c={class:"col-6 col-sm-3"},u={class:"box box-auto-height q-mb-md bg-green text-white"},h={class:"text-weight-bold"},g={class:"col-6 col-sm-3"},p={class:"box box-auto-height q-mb-md bg-red-4 text-white"},b={class:"text-weight-bold"},f={class:"col-6 col-sm-3"},y={class:"box box-auto-height q-mb-md bg-amber text-white"},w={class:"text-weight-bold"},$={class:"box box-auto-height"},x={key:1,class:"text-red-4"};function v(t,a,v,P,Q,A){const q=(0,i.E1)("page-actions"),E=(0,i.E1)("payout-config"),D=(0,i.E1)("q-icon"),K=(0,i.E1)("crud"),R=(0,i.E1)("dynamic-field"),W=(0,i.E1)("master-modal");return(0,i.Wz)(),(0,i.An)("div",s,[(0,i.QD)("div",l,[(0,i.K2)(q,{icon:"fas fa-wallet",title:t.$tr("icredit.cms.label.wallet"),ref:"pageActions","extra-actions":A.extraPageActions,onRefresh:a[0]||(a[0]=a=>{A.getSummary(!0),t.$refs.payoutConfig.loadPage()})},null,8,["title","extra-actions"])]),(0,i.K2)(E,{class:"q-mb-md",ref:"payoutConfig"},null,512),(0,i.QD)("div",n,[(0,i.QD)("div",m,[(0,i.QD)("div",r,[(0,i.QD)("div",d,[(0,i.K2)(D,{name:"fas fa-dollar-sign"}),(0,i.mY)(" "+(0,o.WA)(this.$tr("isite.cms.label.available")),1)]),(0,i.mY)(" "+(0,o.WA)(t.$trn(this.summary.amount)),1)])]),(0,i.QD)("div",c,[(0,i.QD)("div",u,[(0,i.QD)("div",h,[(0,i.K2)(D,{name:"fas fa-caret-up"}),(0,i.mY)(" "+(0,o.WA)(this.$tr("isite.cms.label.inbound")),1)]),(0,i.mY)(" "+(0,o.WA)(t.$trn(this.summary.amountIn)),1)])]),(0,i.QD)("div",g,[(0,i.QD)("div",p,[(0,i.QD)("div",b,[(0,i.K2)(D,{name:"fa-solid fa-caret-down"}),(0,i.mY)(" "+(0,o.WA)(this.$tr("isite.cms.label.outbound")),1)]),(0,i.mY)(" "+(0,o.WA)(t.$trn(this.summary.amountOut)),1)])]),(0,i.QD)("div",f,[(0,i.QD)("div",y,[(0,i.QD)("div",w,[(0,i.K2)(D,{name:"fas fa-history"}),(0,i.mY)(" "+(0,o.WA)(this.$tr("isite.cms.label.pending")),1)]),(0,i.mY)(" "+(0,o.WA)(t.$trn(this.summary.amountPending)),1)])])]),(0,i.K2)(K,{"crud-data":e.e(2492).then(e.bind(e,62492))},null,8,["crud-data"]),(0,i.K2)(W,(0,i.Gu)({modelValue:Q.modal.show,"onUpdate:modelValue":a[2]||(a[2]=t=>Q.modal.show=t)},A.modalConfig.props),{default:(0,i.Ql)((()=>[(0,i.QD)("div",$,[A.modalConfig.amountAvailable?((0,i.Wz)(),(0,i.Az)(R,{key:0,modelValue:Q.modal.amount,"onUpdate:modelValue":a[1]||(a[1]=t=>Q.modal.amount=t),field:A.modalConfig.amountField},null,8,["modelValue","field"])):((0,i.Wz)(),(0,i.An)("div",x,(0,o.WA)(t.$tr("icredit.cms.message.notAmountAvailable"))+"... ",1))])])),_:1},16,["modelValue"])])}const P={id:"payoutComponent"},Q={class:"box box-auto-height relative-position",style:{padding:"0"}};function A(t,a,e,o,s,l){const n=(0,i.E1)("btn-menu"),m=(0,i.E1)("q-td"),r=(0,i.E1)("q-table"),d=((0,i.E1)("q-icon"),(0,i.E1)("q-btn"),(0,i.E1)("q-banner"),(0,i.E1)("dynamic-form")),c=(0,i.E1)("master-modal"),u=(0,i.E1)("inner-loading");return(0,i.Wz)(),(0,i.An)("div",P,[(0,i.QD)("div",Q,[(0,i.K2)(r,(0,i.Gu)({id:"tablePayout"},l.payoutTableProps),{"body-cell-actions":(0,i.Ql)((t=>[(0,i.K2)(m,{props:t},{default:(0,i.Ql)((()=>[(0,i.K2)(n,{actions:t.value},null,8,["actions"])])),_:2},1032,["props"])])),_:1},16),(0,i.g1)("",!0),(0,i.K2)(c,{modelValue:s.modal.show,"onUpdate:modelValue":a[2]||(a[2]=t=>s.modal.show=t),title:s.modal.title,"custom-position":""},{default:(0,i.Ql)((()=>[(0,i.K2)(d,{modelValue:s.form,"onUpdate:modelValue":a[1]||(a[1]=t=>s.form=t),"form-type":"grid","form-id":s.paymentMethod.formId,onSubmit:l.connectPayout},null,8,["modelValue","form-id","onSubmit"])])),_:1},8,["modelValue","title"]),(0,i.K2)(u,{visible:s.loading},null,8,["visible"])])])}const q={props:{},components:{},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,paymentMethod:!1,account:!1,form:{},modal:{show:!1,title:""}}},computed:{payoutTableProps(){return{hidePagination:!0,columns:[{name:"title",label:this.$tr("isite.cms.label.payOut"),field:"title",align:"left"},{name:"account",label:this.$tr("isite.cms.label.account"),field:"account",align:"left"},{name:"actions",label:this.$trp("isite.cms.label.action"),field:"actions"}],rows:[{title:"Stripe",account:this.account?this.account.payoutsEnabled?this.account.email:this.account.urlPanelMsj:this.$tr("isite.cms.message.noRegistered"),actions:[{label:this.$tr("isite.cms.label.configuration"),icon:"fas fa-cog",action:t=>{this.modal.show=!0,this.modal.title=`${this.$tr("isite.cms.label.payOut")} | Stripe`}},{label:this.$tr("qcredit.layout.message.showPanel"),icon:"fab fa-cc-stripe",vIf:this.account&&this.account.payoutsEnabled,action:t=>{this.$helper.openExternalURL(this.account.urlPanel)}}]}]}}},methods:{init(){this.loadPage()},async loadPage(){this.loading=!0,await Promise.all([this.getPaymentMethod(),this.getPayoutData()]),this.loading=!1},getPaymentMethod(){return new Promise((t=>{let a={refresh:!0,params:{filter:{field:"name"}}};this.$crud.show("apiRoutes.qcommerce.paymentMethods","icommercestripe",a).then((a=>{this.paymentMethod=a.data,t(a.data)})).catch((a=>{this.$apiResponse.handleError(a,(()=>{t(a)}))}))}))},getPayoutData(){return new Promise(((t,a)=>{this.$crud.get("apiRoutes.qcommerce.stripe.accountUser",{refresh:!0}).then((a=>{a.data&&a.data.email&&(this.account=a.data,this.form.email=this.$clone(a.data.email)),t(a)})).catch((a=>{this.form={},this.account=!1,t(!1)}))}))},connectPayout(){return new Promise(((t,a)=>{this.loading=!0,this.$crud.create("apiRoutes.qcommerce.stripe.connect",this.form).then((t=>{this.$alert.info({mode:"modal",message:this.$tr("isite.cms.message.finishRegister"),actions:[{label:this.$tr("isite.cms.label.next"),color:"green",handler:()=>{this.$helper.openExternalURL(t.data.accountRegisterLink),this.loadPage()}}]}),this.loading=!1})).catch((t=>{this.loading=!1}))}))}}};var E=e(68716),D=e(40792),K=e(50213),R=e(65224),W=e(58120),V=e(99140),C=e(95252),I=e.n(C);const k=(0,E.c)(q,[["render",A]]),T=k;I()(q,"components",{QTable:D.c,QTd:K.c,QBanner:R.c,QIcon:W.c,QBtn:V.c});const Y={props:{},components:{payoutConfig:T},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{summary:{amount:0,amountIn:0,amountOut:0,amountPending:0},customerId:this.$store.state.quserAuth.userId,modal:{loading:!1,show:!1,amount:null}}},computed:{extraPageActions(){return[{props:{label:this.$tr("icredit.cms.label.withdrawal"),rounded:!0,round:!1,color:"green",padding:"3px 15px"},action:()=>{this.modal.show=!0}}]},modalConfig(){let t=parseFloat(this.summary.amount)>0;return{amountAvailable:t,props:{title:this.$tr("icredit.cms.label.withdrawal"),loading:this.modal.loading,actions:t?[{props:{label:this.$tr("isite.cms.label.send"),color:"green"},action:this.withdraw}]:[]},amountField:{value:null,type:"input",props:{label:this.$tr("isite.cms.label.amount"),type:"number"}}}}},methods:{async init(){this.getSummary()},getSummary(t=!1){return new Promise((a=>{let e={refresh:t,params:{filter:{customerId:this.customerId,amountAvailable:!0}}};this.$crud.index("/icredit/v1/credits",e).then((t=>{this.summary=t.data.length?t.data[0]:{amount:0,amountIn:0,amountOut:0,amountPending:0},a(a.data)})).catch((t=>{this.$apiResponse.handleError(error,(()=>{a(!1)}))}))}))},withdraw(){let t=parseFloat(this.summary.amount);if(this.modal.amount<0||this.modal.amount>t)this.$alert.warning(this.$tr("icredit.cms.message.invalidAmount"));else{this.modal.loading=!0;let t={amount:this.modal.amount};this.$crud.create("apiRoutes.qcredit.withdrawalFunds",t).then((t=>{this.$alert.info({message:`${this.$tr("isite.cms.message.recordCreated")}`}),this.modal={loading:!1,show:!1,amount:null},this.$refs.pageActions.emitRefresh()})).catch((t=>{this.modal.loading=!1}))}}}},M=(0,E.c)(Y,[["render",v]]),S=M;I()(Y,"components",{QIcon:W.c})}}]);