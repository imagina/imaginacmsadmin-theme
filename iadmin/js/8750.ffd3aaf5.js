"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[8750],{18750:(e,t,n)=>{n.r(t),n.d(t,{default:()=>k});var o=n(92444);function r(e,t,r,a,i,u){const c=(0,o.E1)("purchase-modal"),l=(0,o.E1)("crud");return(0,o.Wz)(),(0,o.An)("div",null,[(0,o.K2)(c,{modelValue:e.show,"onUpdate:modelValue":t[0]||(t[0]=t=>e.show=t),title:e.modalTitle,onCreate:e.getDataTable,item:e.item},null,8,["modelValue","title","onCreate","item"]),(0,o.K2)(l,{ref:"crudComponent","crud-data":n.e(1972).then(n.bind(n,31972)),"custom-data":e.customCrudData},null,8,["crud-data","custom-data"])])}var a=n(75836),i=n(81824),u=n(8932),c=function(){return c=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},c.apply(this,arguments)},l=function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function i(e){try{c(o.next(e))}catch(t){a(t)}}function u(e){try{c(o["throw"](e))}catch(t){a(t)}}function c(e){e.done?n(e.value):r(e.value).then(i,u)}c((o=o.apply(e,t||[])).next())}))},s=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(e){return function(t){return c([e,t])}}function c(u){if(n)throw new TypeError("Generator is already executing.");while(a&&(a=0,u[0]&&(i=0)),i)try{if(n=1,o&&(r=2&u[0]?o["return"]:u[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,u[1])).done)return r;switch(o=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,o=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(r=i.trys,!(r=r.length>0&&r[r.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){i.label=u[1];break}if(6===u[0]&&i.label<r[1]){i.label=r[1],r=u;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(u);break}r[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(c){u=[6,c],o=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};function d(){var e={crudComponent:(0,a.IL)(i.c)},t=(0,a.cB)({show:!1,item:null,modalTitle:u._s.tr("iaccounting.cms.title.uploadDocument")}),n={customCrudData:(0,o.S6)((function(){return{create:{method:function(){return r.openModal()}},update:{method:function(e){return r.openModal(e)}}}}))},r={openModal:function(e){void 0===e&&(e=null),t.item=e,t.modalTitle=u._s.tr("iaccounting.cms.title.infoDocument"),t.show=!0},getDataTable:function(t){return void 0===t&&(t=!0),l(this,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,e.crudComponent.value.getDataTable(t)];case 1:return n.sent(),[2]}}))}))}};return c(c(c(c({},e),(0,a.kx)(t)),n),r)}function m(e,t,n,r,a,i){var u=(0,o.E1)("dynamic-form"),c=(0,o.E1)("master-modal");return(0,o.Wz)(),(0,o.Az)(c,(0,o.Gu)({modelValue:e.show,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.show=t}),"custom-position":""},e.modalProps,{onHide:e.closeModal,onShow:e.setItem}),{default:(0,o.Ql)((function(){return[(0,o.K2)(u,{modelValue:e.formData,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.formData=t}),blocks:e.fields,"hide-progress-bar":"","no-actions":"",ref:"refForm",onSubmit:e.createItem},null,8,["modelValue","blocks","onSubmit"])]})),_:1},16,["modelValue","onHide","onShow"])}var f=n(20584),p=n(27730),b=function(){return b=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},b.apply(this,arguments)};const h={sendN8NImg:function(e){return new Promise((function(t,n){var o="".concat(u.is.getSetting("isite::n8nBaseUrl"),"/accounting/img"),r=b(b({},e),{attributes:b(b({},e.attributes),{baseUrl:p.c.baseUrl})});f.c.post(o,r).then((function(e){t(e)})).catch((function(e){return n(e)}))}))},createItem:function(e,t){return void 0===t&&(t={}),new Promise((function(n,o){var r=b({notToSnakeCase:["invoice_items"]},t);f.c.create("apiRoutes.qaccounting.purchases",e,r).then((function(e){n(!0)})).catch((function(e){return o(e)}))}))}};var v=function(){return v=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},v.apply(this,arguments)},g=function(e,t,n,o){function r(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,a){function i(e){try{c(o.next(e))}catch(t){a(t)}}function u(e){try{c(o["throw"](e))}catch(t){a(t)}}function c(e){e.done?n(e.value):r(e.value).then(i,u)}c((o=o.apply(e,t||[])).next())}))},y=function(e,t){var n,o,r,a,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:u(0),throw:u(1),return:u(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function u(e){return function(t){return c([e,t])}}function c(u){if(n)throw new TypeError("Generator is already executing.");while(a&&(a=0,u[0]&&(i=0)),i)try{if(n=1,o&&(r=2&u[0]?o["return"]:u[0]?o["throw"]||((r=o["return"])&&r.call(o),0):o.next)&&!(r=r.call(o,u[1])).done)return r;switch(o=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,o=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(r=i.trys,!(r=r.length>0&&r[r.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){i.label=u[1];break}if(6===u[0]&&i.label<r[1]){i.label=r[1],r=u;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(u);break}r[2]&&i.ops.pop(),i.trys.pop();continue}u=t.call(e,i)}catch(c){u=[6,c],o=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}};function w(e,t){var n=this,r={refForm:(0,a.IL)()},i=(0,a.cB)({show:!1,formData:{},loading:!1,n8nData:null}),c={modalProps:(0,o.S6)((function(){var t;if(!i.show)return{};var n=!!i.n8nData,o=!!(null===(t=e.item)||void 0===t?void 0:t.id),a=n?u._s.tr("iaccounting.cms.title.verifyDocument"):e.title,c=[{action:function(){return l.closeModal()},props:{color:"grey-5",label:u._s.tr("isite.cms.label.cancel")}}];return o||c.push({action:function(){return n?r.refForm.value.changeStep("next",!0):l.sendImage()},props:{color:"primary",label:u._s.tr(n?"isite.cms.label.save":"isite.cms.message.uploadFile")}}),{title:a,width:"max-content",persistent:!0,loading:i.loading,actions:c}})),fields:(0,o.S6)((function(){var t;if(!i.show)return[];var n=!!i.n8nData,o=!!(null===(t=e.item)||void 0===t?void 0:t.id),r="";o||(r=n?u._s.tr("iaccounting.cms.messages.descriptionValidate"):u._s.tr("iaccounting.cms.messages.descriptionAnalyze"));var a={mediasSingle:{name:"mediasSingle",value:{},required:!0,type:"media",props:{label:u._s.tr("iaccounting.cms.form.documentAnalysis"),zone:"mainimage",entity:"Modules\\Iaccounting\\Entities\\Purchase",entityId:null}}};return(n||o)&&(a={documentType:{value:"supportDocument",type:"select",props:{label:"".concat(u._s.tr("iaccounting.cms.form.documentType"),"*"),options:[{label:u._s.tr("iaccounting.cms.label.documentSupport"),value:"supportDocument"},{label:u._s.tr("iaccounting.cms.label.electronicInvoice"),value:"electronicInvoice"}],readonly:o,rules:[function(e){return!!e||u._s.tr("isite.cms.message.fieldRequired")}]}},providerName:{value:"",type:"input",props:{label:"".concat(u._s.tr("iaccounting.cms.form.providerName"),"*"),readonly:o,rules:[function(e){return!!e||u._s.tr("isite.cms.message.fieldRequired")}]}},providerIdType:{value:"NIT",type:"select",props:{label:"".concat(u._s.tr("iaccounting.cms.form.providerIdType"),"*"),options:[{label:"Cedula de Ciudadania",value:"CC"},{label:"Número de Identificación Tributaria (NIT)",value:"NIT"}],readonly:o,rules:[function(e){return!!e||u._s.tr("isite.cms.message.fieldRequired")}]}},providerIdNumber:{value:"",type:"input",props:{label:"".concat(u._s.tr("iaccounting.cms.form.providerIdNumber"),"*"),readonly:o,rules:[function(e){return!!e||u._s.tr("isite.cms.message.fieldRequired")}]}},elaborationDate:{value:null,type:"date",props:{label:u._s.tr("iaccounting.cms.form.elaborationDate")+"*",readonly:o,rules:[function(e){return!!e||u._s.tr("isite.cms.message.fieldRequired")}]}},currencyCode:{value:"COP",type:"input",props:{label:u._s.tr("iaccounting.cms.form.currencyCode"),readonly:o}},totalTax:{value:0,type:"input",props:{type:"number",label:u._s.tr("iaccounting.cms.form.totalTax"),readonly:o}},discount:{value:0,type:"input",fakeFieldName:"options",props:{type:"number",label:u._s.tr("iaccounting.cms.form.discount"),readonly:o}},subtotal:{value:0,type:"input",props:{type:"number",label:u._s.tr("iaccounting.cms.form.subtotal"),readonly:o}},total:{value:0,type:"input",props:{type:"number",label:u._s.tr("iaccounting.cms.form.total"),readonly:o}}}),[{description:r,fields:a}]}))},l={sendImage:function(){return g(n,void 0,void 0,(function(){var e,t,n,o;return y(this,(function(r){switch(r.label){case 0:return e=i.formData,null===(n=null===e||void 0===e?void 0:e.mediasSingle)||void 0===n||n.mainimage,i.loading=!0,t={imageId:null===(o=null===e||void 0===e?void 0:e.mediasSingle)||void 0===o?void 0:o.mainimage},[4,h.sendN8NImg({attributes:t}).then((function(t){i.n8nData=v(v({},e),t),setTimeout((function(){i.formData=t}),0)})).catch((function(e){u.Qb.error({message:u._s.tr("isite.cms.message.errorRequest")})}))];case 1:r.sent(),i.loading=!1,r.label=2;case 2:return[2]}}))}))},createItem:function(){if(i.formData){var e=v(v({},i.n8nData),i.formData);i.loading=!0,h.createItem(e).then((function(e){u.Qb.info({message:u._s.tr("isite.cms.message.recordCreated")}),t("create"),l.closeModal()})).catch((function(){u.Qb.error({message:u._s.tr("isite.cms.message.recordNoCreated")}),i.loading=!1}))}},closeModal:function(){i.show=!1,i.formData={},i.loading=!1,i.n8nData=null},setItem:function(){e.item&&(i.formData=e.item)}};return(0,o.u2)((function(){})),(0,o.Kg)((function(){return e.modelValue}),(function(e){i.show=(0,u.ct)(e)})),(0,o.Kg)((function(){return i.show}),(function(e){t("update:modelValue",e)})),v(v(v(v({},r),(0,a.kx)(i)),c),l)}const _=(0,o._M)({props:{modelValue:{default:!1},title:{default:""},item:{default:null}},components:{},emits:["create","update:modelValue"],setup:function(e,t){var n=t.emit;return w(e,n)}});var D=n(68716);const I=(0,D.c)(_,[["render",m]]),T=I,C=(0,o._M)({props:{},components:{purchaseModal:T},setup(){return{...d()}}}),S=(0,D.c)(C,[["render",r]]),k=S}}]);