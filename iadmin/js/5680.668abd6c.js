"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[5680],{48622:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Re});var n=a(92444);function o(e,t,o,i,l,s){const r=(0,n.E1)("infomation"),u=(0,n.E1)("crud");return(0,n.Wz)(),(0,n.An)("div",null,[(0,n.K2)(r,{ref:"modalInfortion",onKanbanRefresh:s.kanbanRefresh},null,8,["onKanbanRefresh"]),(0,n.K2)(u,{crudData:a.e(5280).then(a.bind(a,60044)),"custom-data":s.customData,title:e.$tr(e.$route.meta.title),ref:"crudRequests"},null,8,["crudData","custom-data","title"])])}var i=a(98724);const l={class:""},s={class:"row q-col-gutter-md"},r={class:"col"},u={key:0},c={class:"col-12 col-md-8 col-lg-7"};function d(e,t,a,o,i,d){const m=(0,n.E1)("dynamic-field"),f=(0,n.E1)("dynamic-form"),p=(0,n.E1)("comments"),h=(0,n.E1)("superModal"),v=(0,n.E1)("modalCrud"),b=(0,n.E1)("whatappsModal");return(0,n.Wz)(),(0,n.An)("div",null,[(0,n.K2)(h,{modelValue:i.modal.show,"onUpdate:modelValue":t[1]||(t[1]=e=>i.modal.show=e),onHide:t[2]||(t[2]=e=>d.resetModal()),loading:i.modal.loading,title:i.modal.title,"custom-position":"",modalWidthSize:"98%",multiActions:d.multiActions,actions:d.actions},{default:(0,n.Ql)((()=>[(0,n.QD)("div",l,[(0,n.QD)("div",s,[(0,n.QD)("div",r,[((0,n.Wz)(!0),(0,n.An)(n.ae,null,(0,n.mi)(d.field.main,((e,t)=>((0,n.Wz)(),(0,n.Az)(m,{key:t,modelValue:i.dynamicFieldForm[t],"onUpdate:modelValue":e=>i.dynamicFieldForm[t]=e,field:e,class:"tw-py-2"},null,8,["modelValue","onUpdate:modelValue","field"])))),128)),this.modal.requestData.length>0?((0,n.Wz)(),(0,n.An)("div",u,[(0,n.K2)(f,{modelValue:i.form,"onUpdate:modelValue":t[0]||(t[0]=e=>i.form=e),"form-id":i.formId,onSubmit:d.saveForm,class:"tw-my-2",noSave:"",requestParams:i.requestParams},null,8,["modelValue","form-id","onSubmit","requestParams"])])):(0,n.g1)("",!0),((0,n.Wz)(!0),(0,n.An)(n.ae,null,(0,n.mi)(d.field.bottom,((e,t)=>((0,n.Wz)(),(0,n.Az)(m,{key:t,modelValue:i.dynamicFieldForm[t],"onUpdate:modelValue":e=>i.dynamicFieldForm[t]=e,field:e,itemId:i.requestableId,class:"tw-py-2"},null,8,["modelValue","onUpdate:modelValue","field","itemId"])))),128))]),(0,n.QD)("div",c,[(0,n.K2)(p,{commentableId:Number(i.requestableId)},null,8,["commentableId"])])])])])),_:1},8,["modelValue","loading","title","multiActions","actions"]),(0,n.K2)(v),(0,n.K2)(b)])}a(23816);var m=a(18086),f=a(22772),p=a(75836),h=(0,p.cB)({showModal:!1,dataCrud:{path:null,customData:null}}),v=(0,n.S6)((function(){return{get showModal(){return h.showModal},set showModal(e){h.showModal=e},get dataCrud(){return h.dataCrud},set dataCrud(e){h.dataCrud=e},reset:function(){h.showModal=!1,h.dataCrud={path:null,customData:null}}}})).value;const b=v;function g(e,t,a,o,i,l){var s=(0,n.E1)("crud"),r=(0,n.E1)("master-modal");return(0,n.Wz)(),(0,n.Az)(r,{id:"modalCrud",modelValue:e.showModal,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.showModal=t}),persistent:!0,maximized:e.$q.screen.lt.md,"custom-position":"",modalWidthSize:"98%"},{default:(0,n.Ql)((function(){return[e.showModal&&e.dataCrud.path?((0,n.Wz)(),(0,n.Az)(s,{key:0,crudData:e.dataCrud.path,"custom-data":e.dataCrud.customData,title:e.dataCrud.title},null,8,["crudData","custom-data","title"])):(0,n.g1)("",!0)]})),_:1},8,["modelValue","maximized"])}const y=(0,n._M)({setup:function(e){var t=(0,n.S6)({get:function(){return b.showModal},set:function(e){b.showModal=e}}),a=(0,n.S6)((function(){return b.dataCrud}));return{dataCrud:a,showModal:t}}});var w=a(68716);const q=(0,w.c)(y,[["render",g]]),C=q,I={ref:"otherFilesComponent",key:"otherFiles",icon:"fas fa-photo-video",title:"Archivos",allowCounter:!0,allowOrder:!0,gridColClass:"col-3 col-md-3 col-lg-4",itemActions:[{label:"Descargar",vIf:!0,icon:"fas fa-file-download",props:{tag:"a",key:"39740800-35d0-4b28-9610-7f84d96a0145",clickable:!0}},{label:"Editar",icon:"fas fa-pen",props:{tag:"a",key:"1df14234-2772-4824-be48-b8f3d9c119e3",clickable:!0}},{label:"Copiar enlace",icon:"fas fa-copy",props:{tag:"a",key:"dc3eceff-04a0-47dd-9004-ed2ae4ed1c6e",clickable:!0}},{label:"Eliminar",icon:"fas fa-trash",props:{tag:"a",key:"977d2dc9-ac6c-45cd-bb4c-9c3a65795bc6",clickable:!0}}],allowPagination:!0,allowChangeView:!0,allowSelect:0,loadFiles:{apiRoute:"apiRoutes.qmedia.files",requestParams:{take:24,filter:{search:null,folderId:0,isFolder:!1,order:{field:"created_at",way:"desc"},disk:"publicmedia"}}}};var k=a(74044),x={key:0},z=["src"],A={key:0},Q={class:"flex justify-between"},E={class:"tw-mt-2 tw-space-x-2"},$={key:1,class:"tw-py-8"},D={class:"tw-p-4 tw-rounded-md tw-bg-white"},M={key:0,class:"tw-text-sm"},_={key:0},R={key:1},W={key:2},F={class:"tw-w-11/12"},T=["innerHTML","onClick"],K={class:"tw-text-right tw-text-xs tw-w-1/12"},S={key:3,class:"flex justify-between"},B={class:"tw-mt-2 tw-space-x-2"},V={key:1,class:"tw-my-10"};function P(e,t,a,o,i,l){var s=(0,n.E1)("q-avatar"),r=(0,n.E1)("q-item-section"),u=(0,n.E1)("q-card-section"),c=(0,n.E1)("q-card"),d=(0,n.E1)("CKEditor"),m=(0,n.E1)("dynamic-field"),f=(0,n.E1)("q-btn"),p=(0,n.E1)("q-spinner"),h=(0,n.E1)("q-item"),v=(0,n.E1)("q-tooltip"),b=(0,n.E1)("q-timeline-entry"),g=(0,n.E1)("q-timeline"),y=(0,n.E1)("inner-loading"),w=(0,n.E1)("q-list");return e.permisionComments.index?((0,n.Wz)(),(0,n.An)("div",x,[(0,n.QD)("div",null,[(0,n.K2)(w,{dense:"",class:"list-comments"},{default:(0,n.Ql)((function(){return[e.permisionComments.create?((0,n.Wz)(),(0,n.Az)(h,{key:0,class:"tw-my-3",style:{padding:"0px !important"}},{default:(0,n.Ql)((function(){return[(0,n.K2)(r,{top:"",avatar:""},{default:(0,n.Ql)((function(){return[(0,n.K2)(s,{size:"md",color:"grey-4",class:"tw-ml-2"},{default:(0,n.Ql)((function(){return[(0,n.QD)("img",{src:"".concat(e.dataBase.avatar)},null,8,z)]})),_:1})]})),_:1}),e.dataBase.active?((0,n.Wz)(),(0,n.Az)(r,{key:1,class:"bg-grey-1 shadow-1 tw-p-2"},{default:(0,n.Ql)((function(){return[e.loadingComment?(0,n.g1)("",!0):((0,n.Wz)(),(0,n.An)("div",A,[(0,n.K2)(d,{modelValue:e.dataBase.text,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.dataBase.text=t}),config:e.editorConfig},null,8,["modelValue","config"]),(0,n.QD)("div",null,[(0,n.K2)(m,{field:e.files,class:"tw-py-2 tw-hidden"},null,8,["field"])]),(0,n.QD)("div",Q,[(0,n.QD)("div",E,[(0,n.K2)(f,{loading:e.dataBase.loading,disable:""==e.dataBase.text,onClick:t[2]||(t[2]=function(t){return e.addComment()}),rounded:"",size:"md",label:e.i18n.tr("isite.cms.label.save"),color:"primary","no-caps":""},null,8,["loading","disable","label"]),(0,n.K2)(f,{flat:"",size:"md",onClick:t[3]||(t[3]=function(t){return e.cancelText()}),padding:"4px 4px",icon:"fa fa-close",color:"primary"})])])])),e.loadingComment?((0,n.Wz)(),(0,n.An)("div",$,[(0,n.K2)(p,{color:"primary",size:"3em",thickness:2,class:"tw-mx-auto"})])):(0,n.g1)("",!0)]})),_:1})):((0,n.Wz)(),(0,n.Az)(r,{key:0,class:"tw-mr-4 tw-cursor-pointer"},{default:(0,n.Ql)((function(){return[(0,n.K2)(c,{flat:"",bordered:""},{default:(0,n.Ql)((function(){return[(0,n.K2)(u,{class:"tw-py-2 tw-cursor-pointer text-grey-6",innerHTML:e.textPlaceholder,onClick:t[0]||(t[0]=function(t){return e.activeText()}),title:e.i18n.tr("isite.cms.label.edit")},null,8,["innerHTML","title"])]})),_:1})]})),_:1}))]})),_:1})):(0,n.g1)("",!0),e.permisionComments.index?((0,n.Wz)(),(0,n.Az)(h,{key:1},{default:(0,n.Ql)((function(){return[e.loading?(0,n.g1)("",!0):((0,n.Wz)(),(0,n.Az)(r,{key:0},{default:(0,n.Ql)((function(){return[(0,n.K2)(g,{class:"grey-4 timeline-ctn"},{default:(0,n.Ql)((function(){return[((0,n.Wz)(!0),(0,n.An)(n.ae,null,(0,n.mi)(e.comments,(function(t,a,o){return(0,n.Wz)(),(0,n.Az)(b,{key:o,icon:t.icon?t.icon:"fa-regular fa-comment",color:t.color},{default:(0,n.Ql)((function(){return[(0,n.QD)("div",D,[(0,n.QD)("div",null,[t.userProfile?((0,n.Wz)(),(0,n.An)("h4",M,[Boolean(t.internal)?(0,n.g1)("",!0):((0,n.Wz)(),(0,n.An)("strong",_,(0,k.WA)(t.userProfile.fullName),1)),t.updatedAt||t.createdAt?((0,n.Wz)(),(0,n.An)("small",R,(0,k.WA)(e.formatDate(t.updatedAt||t.createdAt)),1)):(0,n.g1)("",!0)])):(0,n.g1)("",!0),t.active?((0,n.Wz)(),(0,n.Az)(d,{key:1,modelValue:t.comment,"onUpdate:modelValue":function(e){return t.comment=e}},null,8,["modelValue","onUpdate:modelValue"])):((0,n.Wz)(),(0,n.An)("div",W,[(0,n.QD)("div",{class:(0,k.WN)(["tw-flex tw-border tw-p-2",{"tw-cursor-pointer":!Boolean(t.internal)}])},[(0,n.QD)("div",F,[e.permisionComments.index?((0,n.Wz)(),(0,n.An)("div",{key:0,innerHTML:t.comment,onClick:function(a){return Boolean(t.internal)?null:e.activeEdit(t.id)}},null,8,T)):(0,n.g1)("",!0)]),(0,n.QD)("div",K,[e.permisionComments.destroy&&!Boolean(t.internal)?((0,n.Wz)(),(0,n.Az)(f,{key:0,flat:"",class:"tw-text-gray-500",icon:"fa-light fa-trash",size:"xs",onClick:function(a){return e.deleteComment(t.id)}},{default:(0,n.Ql)((function(){return[(0,n.K2)(v,null,{default:(0,n.Ql)((function(){return[(0,n.mY)((0,k.WA)(e.i18n.tr("isite.cms.label.delete")),1)]})),_:1})]})),_:2},1032,["onClick"])):(0,n.g1)("",!0)])],2)])),t.active?((0,n.Wz)(),(0,n.An)("div",S,[(0,n.QD)("div",B,[(0,n.K2)(f,{disable:""==t.comment||t.comment==t.textEdit,loading:t.loading,onClick:function(a){return e.updateComment("edit",t.id)},rounded:"",size:"md",label:e.i18n.tr("isite.cms.label.update"),color:"primary","no-caps":""},null,8,["disable","loading","onClick","label"]),(0,n.K2)(f,{flat:"",size:"md",onClick:function(a){return e.updateComment("cancel",t.id)},padding:"4px 4px",icon:"fa fa-close",color:"primary"},{default:(0,n.Ql)((function(){return[(0,n.K2)(v,null,{default:(0,n.Ql)((function(){return[(0,n.mY)((0,k.WA)(e.i18n.tr("isite.cms.label.cancel")),1)]})),_:1})]})),_:2},1032,["onClick"])])])):(0,n.g1)("",!0)])])]})),_:2},1032,["icon","color"])})),128))]})),_:1})]})),_:1})),e.loading?((0,n.Wz)(),(0,n.An)("div",V,[(0,n.K2)(y,{visible:e.loading},null,8,["visible"])])):(0,n.g1)("",!0)]})),_:1})):(0,n.g1)("",!0)]})),_:1})])])):(0,n.g1)("",!0)}var L=a(33112),U=a.n(L),O="apiRoutes.qrequestable.comments",N="Modules\\Requestable\\Entities\\Requestable",j="icomments.comments",Y={text:"",textEdit:"",active:!1,user:"",loading:!1,avatar:U()},H=a(20584),G=a(8932),J=a(91416),X=function(){return X=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var o in t=arguments[a],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},X.apply(this,arguments)},Z=function(e,t,a,n){function o(e){return e instanceof a?e:new a((function(t){t(e)}))}return new(a||(a=Promise))((function(a,i){function l(e){try{r(n.next(e))}catch(t){i(t)}}function s(e){try{r(n["throw"](e))}catch(t){i(t)}}function r(e){e.done?a(e.value):o(e.value).then(l,s)}r((n=n.apply(e,t||[])).next())}))},ee=function(e,t){var a,n,o,i,l={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return r([e,t])}}function r(s){if(a)throw new TypeError("Generator is already executing.");while(i&&(i=0,s[0]&&(l=0)),l)try{if(a=1,n&&(o=2&s[0]?n["return"]:s[0]?n["throw"]||((o=n["return"])&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return l.label++,{value:s[1],done:!1};case 5:l.label++,n=s[1],s=[0];continue;case 7:s=l.ops.pop(),l.trys.pop();continue;default:if(o=l.trys,!(o=o.length>0&&o[o.length-1])&&(6===s[0]||2===s[0])){l=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){l.label=s[1];break}if(6===s[0]&&l.label<o[1]){l.label=o[1],o=s;break}if(o&&l.label<o[2]){l.label=o[2],l.ops.push(s);break}o[2]&&l.ops.pop(),l.trys.pop();continue}s=t.call(e,l)}catch(r){s=[6,r],n=0}finally{a=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}};function te(e){var t=this,a=G.is.hasAccess,o=(0,J.c)(),i=(0,p.IL)({edit:!1,id:null,close:!1}),l=(0,p.IL)({value:null,type:"uploader",props:{title:G._s.trp("isite.cms.label.file"),gridColClass:"col-3 col-md-3 col-lg-4",maxFiles:3}}),s=(0,p.IL)(!1),r=(0,n.S6)((function(){return e.commentableType})),u=(0,p.IL)(X({},Y)),c=(0,n.S6)((function(){return e.apiRoute})),d=(0,n.S6)((function(){return function(e){var t,a;return e.userProfile&&(null===(t=e.userProfile)||void 0===t?void 0:t.mainImage)?null===(a=null===e||void 0===e?void 0:e.userProfile)||void 0===a?void 0:a.mainImage:Y.avatar}})),m=(0,p.IL)([]),f=(0,p.IL)(!1),h=(0,n.S6)((function(){return{create:a("".concat(e.permisionComments,".create")),edit:a("".concat(e.permisionComments,".edit")),index:a("".concat(e.permisionComments,".index")),destroy:a("".concat(e.permisionComments,".destroy"))}})),v=(0,p.IL)(X({},u.value)),b=(0,p.IL)(G._s.tr("requestable.cms.message.writeComment")),g=(0,p.IL)({height:100});function y(e){return e?(0,G.Gw)(e).format("DD MMM YYYY, h:mm a"):null}function w(){s.value=!0,v.value.active=!0,v.value.text="",setTimeout((function(){s.value=!1}),1e3),i.value.close=!0}function q(){var e=this;v.value.text.length>0?o.dialog({ok:"Si",message:G._s.tr("requestable.cms.message.undoComment"),cancel:"No",persistent:!0}).onOk((function(){return Z(e,void 0,void 0,(function(){return ee(this,(function(e){return v.value.active=!1,v.value.text="",i.value.close=!1,[2]}))}))})).onCancel((function(){})):(v.value.active=!1,i.value.close=!1)}function C(e,t){try{var a=m.value.find((function(e){return e.id===t}));a&&("cancel"==e&&I(a),"edit"==e&&(a.comment!==a.textEdit?k(t,a):I(a)))}catch(n){console.log(n)}}function I(e){var t=this;e.comment!==e.textEdit?o.dialog({ok:G._s.tr("isite.cms.label.yes"),message:G._s.tr("requestable.cms.message.undoComment"),cancel:G._s.tr("isite.cms.label.no"),persistent:!0}).onOk((function(){return Z(t,void 0,void 0,(function(){return ee(this,(function(t){return e.comment=e.textEdit,e.active=!1,i.value.close=!1,[2]}))}))})).onCancel((function(){})):(e.active=!1,i.value.close=!1)}function k(t,a){try{a.loading=!0;var n={approved:a.approved,commentableType:e.commentableType,commentableId:e.commentableId,comment:a.comment,userId:a.userId,is_internal:a.is_internal,options:a.options};H.c.update(c.value,t,X({},n)).then((function(e){var t=e.data;a.updatedAt=t.updatedAt,a.loading=!1,a.active=!1,a.edit=!1,G.Qb.info({message:G._s.tr("requestable.cms.message.updateComment")})})).catch((function(e){a.loading=!1,console.log(e),G.Qb.error({message:G._s.tr("requestable.cms.message.updateNoComment")})})),i.value.close=!1}catch(o){console.log(o),i.value.close=!1}}function x(e){try{i.value.id=e;var t=m.value.find((function(t){return t.id===e}));t&&(t.textEdit=t.comment,t.active=!0,i.value.edit=!0,i.value.close=!0)}catch(a){console.log(a),i.value.edit=!1,i.value.close=!1}}function z(){return Z(this,void 0,Promise,(function(){var t,a,n;return ee(this,(function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),0===v.value.text.length?[2]:(t=G.is.state.quserAuth.userId,v.value.loading=!0,a={approved:!0,commentableType:e.commentableType,commentableId:e.commentableId,comment:v.value.text,userId:t,is_internal:!1,options:null},[4,H.c.create(c.value,a)]);case 1:return o.sent(),[4,Q(e.commentableId)];case 2:return o.sent(),v.value=X({},u.value),G.Qb.info({message:G._s.tr("requestable.cms.message.savedComment")}),[3,4];case 3:return n=o.sent(),console.log(n),v.value.loading=!1,G.Qb.error({message:G._s.tr("requestable.cms.message.savedNoComment")}),[3,4];case 4:return[2]}}))}))}function A(e){return Z(this,void 0,Promise,(function(){var t=this;return ee(this,(function(a){return o.dialog({ok:G._s.tr("isite.cms.label.delete"),message:G._s.tr("isite.cms.message.deleteRecord"),cancel:!0,persistent:!0}).onOk((function(){return Z(t,void 0,void 0,(function(){return ee(this,(function(t){return H.c.delete(c.value,e).then((function(t){m.value=m.value.filter((function(t){return t.id!==e})),G.Qb.info({message:G._s.tr("isite.cms.message.recordDeleted")})})).catch((function(e){console.log(e),G.Qb.error({message:G._s.tr("isite.cms.message.recordNoDeleted")})})),[2]}))}))})).onCancel((function(){})),[2]}))}))}function Q(e){return Z(this,void 0,Promise,(function(){var t,a,n;return ee(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,E()];case 1:return t=o.sent(),f.value=!0,a={filter:{commentableType:r.value,commentableId:e},include:"userProfile"},H.c.get(c.value,a).then((function(e){var a=e.data;m.value=a.map((function(e){return X(X({},e),{active:!1,loading:!1,textEdit:"",icon:e.type?t.data[e.type].icon:"fa-regular fa-comment",color:e.type?t.data[e.type].color:"primary"})})),f.value=!1})).catch((function(e){f.value=!1,G.Qb.error({message:e}),console.log(e)})),[3,3];case 2:return n=o.sent(),console.log(n),[3,3];case 3:return[2]}}))}))}function E(){return Z(this,void 0,void 0,(function(){var e,t;return ee(this,(function(a){switch(a.label){case 0:return e=G.i4.getInfoFromPermission(G.us.route.meta.permission),e?(t={refresh:!0,params:{filter:{configName:"".concat(e.module,".config.commentableConfig.requestable")}}},[4,H.c.index("apiRoutes.qsite.configs",t)]):[2];case 1:return[2,a.sent()]}}))}))}return Q(e.commentableId),(0,n.GE)((function(){return Z(t,void 0,void 0,(function(){return ee(this,(function(e){switch(e.label){case 0:return i.value.close?i.value.edit?[4,C("edit",i.value.id)]:[3,2]:[3,4];case 1:return e.sent(),[3,4];case 2:return[4,z()];case 3:e.sent(),e.label=4;case 4:return[2]}}))}))})),{permisionComments:h,dataBase:v,activeText:w,cancelText:q,updateComment:C,cancelComment:I,editComment:k,activeEdit:x,addComment:z,deleteComment:A,getCommentsList:Q,textPlaceholder:b,editorConfig:g,formatDate:y,comments:m,loading:f,mainImage:d,loadingComment:s,files:l,i18n:G._s}}var ae=function(){return ae=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var o in t=arguments[a],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ae.apply(this,arguments)};const ne=(0,n._M)({components:{CKEditor:m.c},props:{commentableId:{type:Number,required:!0},commentableType:{type:String,default:function(){return N}},apiRoute:{type:String,default:function(){return O}},permisionComments:{type:String,default:function(){return j}}},setup:function(e){return ae({},te(e))}});var oe=a(99588),ie=a(84884),le=a(11032),se=a(11252),re=a(70608),ue=a(71008),ce=a(99140),de=a(21028),me=a(84492),fe=a(97112),pe=a(90111),he=a(95252),ve=a.n(he);const be=(0,w.c)(ne,[["render",P]]),ge=be;ve()(ne,"components",{QList:oe.c,QItem:ie.c,QItemSection:le.c,QAvatar:se.c,QCard:re.c,QCardSection:ue.c,QBtn:ce.c,QSpinner:de.c,QTimeline:me.c,QTimelineEntry:fe.c,QTooltip:pe.c});var ye=(0,p.cB)({showModal:!1,roomId:0,loading:!1}),we=(0,n.S6)((function(){return{get showModal(){return ye.showModal},set showModal(e){ye.showModal=e},get loading(){return ye.loading},set loading(e){ye.loading=e},get roomId(){return ye.roomId},set roomId(e){ye.roomId=e}}})).value;const qe=we;function Ce(e,t,a,o,i,l){var s=(0,n.E1)("advanceChat"),r=(0,n.E1)("master-modal");return(0,n.Wz)(),(0,n.Az)(r,{modelValue:e.showModal,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.showModal=t}),persistent:!0,maximized:e.$q.screen.lt.md,"custom-position":"",modalWidthSize:"98%",loading:e.loading},{default:(0,n.Ql)((function(){return[(0,n.K2)(s,{"room-id":e.roomId},null,8,["room-id"])]})),_:1},8,["modelValue","maximized","loading"])}var Ie=a(19058);const ke=(0,n._M)({components:{advanceChat:Ie.c},setup:function(e){var t=(0,n.S6)({get:function(){return qe.showModal},set:function(e){qe.showModal=e}}),a=(0,n.S6)((function(){return qe.loading})),o=(0,n.S6)((function(){return qe.roomId}));return{showModal:t,roomId:o,loading:a}}}),xe=(0,w.c)(ke,[["render",Ce]]),ze=xe,Ae={text:"",textEdit:"",active:!1,user:"",loading:!1,avatar:"https://dev-gestionhc.ozonohosting.com/modules/iprofile/img/default.jpg"},Qe={components:{fileList:i.c,CKEditor:m.c,superModal:f.c,modalCrud:C,fileListComponent:i.c,comments:ge,whatappsModal:ze},props:{},emits:["kanbanRefresh"],data(){return{loading:!1,route:"apiRoutes.qrequestable.comments",textPlaceholder:"Escriba un comentario...",editorConfig:{height:100},modal:{title:null,show:!1,loading:!1,requestData:[]},dataBase:{...Ae},form:{},dynamicFieldForm:{},formId:null,statusId:null,categoryType:null,requestableId:null,conversations:null,requestParams:{filter:{renderLocation:"requestable"}}}},provide(){return{showRequestData:this.showRequestData,updateRequest:this.updateRequest}},inject:{addCard:{type:Function,default:()=>!1}},computed:{files(){return I},permisionComments(){return{create:this.$hasAccess("icomments.comments.create"),edit:this.$hasAccess("icomments.comments.edit"),index:this.$hasAccess("icomments.comments.index"),destroy:this.$hasAccess("icomments.comments.destroy")}},field(){return{main:{date:{value:null,props:{label:"Block-in/out Date"},name:"blockInBlockOut",field:{value:"blockInBlockOut"},quickFilter:!0},sourceId:{value:null,type:"crud",permission:"requestable.requestables.see-source",props:{crudType:"select",crudData:a.e(2820).then(a.bind(a,92820)),crudProps:{label:this.$tr("isite.cms.label.source"),rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")],readonly:!this.$hasAccess("requestable.requestables.edit-source")},config:{filterByQuery:!0,options:{label:"title",value:"id"}}}},requestedById:{value:null,type:"crud",permission:"requestable.requestables.see-requested-by",props:{crudType:"select",crudData:a.e(6216).then(a.bind(a,96216)),crudProps:{label:this.$tr("isite.cms.form.requestedBy"),rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")],readonly:!this.$hasAccess("requestable.requestables.edit-requested-by")},config:{filterByQuery:!0,options:{label:"fullName",value:"id",img:"mainImage"}}}},responsibleId:{value:null,type:"crud",permission:"requestable.requestables.see-responsible",props:{crudType:"select",crudData:a.e(6216).then(a.bind(a,96216)),crudProps:{label:this.$tr("requestable.cms.label.responsible"),rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")],readonly:!this.$hasAccess("requestable.requestables.edit-responsible")},config:{filterByQuery:!0,options:{label:"fullName",value:"id",img:"mainImage"}}}}},bottom:{mediasMulti:{value:{},type:"media",vIf:!this.$hasAccess("requestable.requestables.see-files"),props:{label:this.$tr("idocs.cms.sidebar.adminGroup"),zone:"documents",entity:"Modules\\Requestable\\Entities\\Requestable",entityId:null,multiple:!0,disk:"privatemedia",readonly:!this.$hasAccess("requestable.requestables.edit-files")}}}}},multiActions(){return[{props:{color:"green",icon:"fa-brands fa-whatsapp",round:!0},action:async()=>{try{qe.loading=!0,qe.showModal=!0,this.conversations?qe.roomId=this.conversations.id:(await this.$crud.post("apiRoutes.qrequestable.chat",{criteria:this.requestableId},{}),qe.roomId=response.data.id),setTimeout((()=>{qe.loading=!1}),3e3)}catch(e){qe.showModal=!1,qe.loading=!1}}}]},actions(){return[{props:{label:this.$tr("isite.cms.label.save"),color:"primary",icon:"fa-light fa-save"},action:async()=>{await this.saveForm()}}]}},methods:{async showRequestData(e){this.requestableId=e.id,this.statusId=e.statusId||null,this.categoryType=e.type||null,this.dynamicFieldForm.requestedById=e.requestedById||null,this.dynamicFieldForm.sourceId=e.sourceId||null,this.dynamicFieldForm.responsibleId=e.responsibleId||null,this.conversations=e.conversation||null;const t=e.status?`- Estado: ${e?.status?.title}`:"";this.modal={title:`ID:${this.requestableId} ${t}`,show:!0,loading:!0,requestData:[],comments:[]};let a=e.category?.form||!1;if(a){this.formId=a.id;let t={};e.fields.forEach((e=>t[e.name]=e.value));let n=this.$clone(e.files||[]),o={refresh:!0,params:{include:"fields"}};await this.$crud.show("apiRoutes.qform.forms",a.id,o).then((async e=>{await this.$clone(e.data.fields).forEach((e=>{let a=e.dynamicField?.type||"input",o=t[this.$helper.convertStringToSnakeCase(e.name)]||"-",i="media"!=a?null:n.find((t=>t.zone==(e.dynamicField.props.zone||"mainimage")));this.modal.requestData.push({...e,label:e.label.replace("*",""),value:"media"!=a?o:[{id:this.$uid(),...i,filename:e.label}],fieldType:a})})),await this.modal.requestData.forEach((e=>{this.form[e.dynamicField.name]=e.value})),this.modal.loading=!1})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.modal.loading=!1}))}))}this.modal.loading=!1},resetModal(){this.modal={show:!1,loading:!1,requestData:[],comments:[]},this.dataBase={...Ae}},updateRequest(e){this.$refs.crudRequests.update({id:e})},async saveForm(){try{this.modal.loading=!0;const e={...this.form,...this.dynamicFieldForm,type:this.categoryType,statusId:this.statusId};await this.$crud.update("apiRoutes.qrequestable.requestables",this.requestableId,e),await this.$emit("kanbanRefresh",this.statusId),this.modal.show=!1,this.form={},this.modal.loading=!1}catch(e){this.modal.loading=!1,console.log(e)}}}};var Ee=a(82764);const $e=(0,w.c)(Qe,[["render",d]]),De=$e;ve()(Qe,"components",{QTimeline:me.c,QBtnDropdown:Ee.c});const Me={components:{fileList:i.c,infomation:De},data(){return{crudId:this.$uid(),modal:{title:null,show:!1,loading:!1,requestData:[],tab:"comments"},form:{},formId:null,requestedBy:null,statusId:null,categoryType:null,requestableId:null}},provide(){return{saveForm:this.saveForm}},computed:{deletePermissions(){return this.$hasAccess("requestable.requestables.destroy")},customData(){return{read:{actions:[{name:"viewEntity",icon:"fa-light fa-eye",label:this.$tr("isite.cms.label.show"),format:e=>e.requestableUrl?{}:{vIf:!1},action:e=>{e.requestableUrl&&this.$helper.openExternalURL(e.requestableUrl)}},{name:"viewLead",icon:"fa-light fa-info-circle",color:"info",tooltip:this.$tr("isite.cms.label.information"),action:e=>{this.showModal(e)}},{name:"deleteLead",label:this.$tr("isite.cms.label.delete"),color:"red",icon:"fa-light fa-trash-alt",format:e=>({vIf:this.deletePermissions}),action:(e,t)=>{this.delete(e,t)}}]}}}},methods:{async showModal(e){await this.$refs.modalInfortion.showRequestData(e)},async delete(e,t=!1){this.$refs.crudRequests.$refs.crudIndex.$refs.kanban&&this.$refs.crudRequests.$refs.crudIndex.$refs.kanban.deleteKanbanCard(e,t)},async kanbanRefresh(e){this.$refs.crudRequests.$refs.crudIndex.$refs.kanban&&this.$refs.crudRequests.$refs.crudIndex.$refs.kanban.addCard(e)}}},_e=(0,w.c)(Me,[["render",o]]),Re=_e}}]);