"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[8892],{25112:(t,e,i)=>{i.r(e),i.d(e,{default:()=>U});var a=i(92444),s=i(74044),n=i(264);const l={id:"notificationsIndexTitle",class:"row q-col-gutter-y-sm full-width items-center justify-between q-mt-md"},o={class:"row text-primary text-weight-bold ellipsis title-content items-center"},r={style:{"font-size":"20px"}},c={class:"row q-my-md"},d={class:"col-xs-12 col-sm-12 col-md-6 q-mb-md"},m={class:"col-xs-12 col-sm-9 col-md-6"},u={class:"row q-col-gutter-x-sm q-col-gutter-y-md"},g={class:"col-xs-6 col-md-3"},p={class:"tw-text-center"},h={class:"flex justify-end"},f={class:"row q-pa-md"},b={key:0,class:"col-12"},v={style:{"min-height":"100px"}},y={class:"q-pa-lg flex flex-center"},w={key:1,class:"col-12"},k={class:"tw-h-64 tw-content-center tw-justify-center"};function P(t,e,i,P,x,Q){const A=(0,a.E1)("q-tab"),D=(0,a.E1)("q-tabs"),z=(0,a.E1)("dynamic-field"),q=(0,a.E1)("q-btn"),E=(0,a.E1)("notification-card"),S=(0,a.E1)("q-separator"),W=(0,a.E1)("q-pagination"),V=(0,a.E1)("not-result"),$=(0,a.E1)("inner-loading"),F=(0,a.E1)("q-page");return(0,a.Wz)(),(0,a.Az)(F,{id:"notificationsIndex"},{default:(0,a.Ql)((()=>[(0,a.QD)("div",l,[(0,a.QD)("div",o,[(0,a.QD)("label",r,(0,s.WA)(t.$tr("notification.cms.sidebar.adminGroup")),1)])]),(0,a.QD)("div",c,[(0,a.QD)("div",d,[(0,a.K2)(D,{modelValue:x.filters.tab,"onUpdate:modelValue":e[0]||(e[0]=t=>x.filters.tab=t),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left","no-caps":"","narrow-indicator":"",style:{"align-items":"center"}},{default:(0,a.Ql)((()=>[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)(x.tabs,((t,e)=>((0,a.Wz)(),(0,a.Az)(A,{key:e,name:t.value,label:t.label},null,8,["name","label"])))),128))])),_:1},8,["modelValue"])]),(0,a.QD)("div",m,[(0,a.QD)("div",u,[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)(x.formFields,((t,e)=>((0,a.Wz)(),(0,a.Az)(z,{key:e,field:t,modelValue:x.filters[e],"onUpdate:modelValue":t=>x.filters[e]=t,class:"col-xs-6 col-md-3"},null,8,["field","modelValue","onUpdate:modelValue"])))),128)),(0,a.QD)("div",g,[(0,a.QD)("div",p,[(0,a.QD)("div",h,[(0,a.K2)(q,{class:"tw-text-sm tw-leading-[18px] tw-font-semibold",flat:"",dense:"",unelevated:"","no-caps":"",padding:"none",label:t.$tr("notification.cms.markAllAsRead"),onClick:e[1]||(e[1]=t=>Q.markAllAsRead())},null,8,["label"])])])])])])]),(0,a.QD)("div",f,[x.notifications.length>0?((0,a.Wz)(),(0,a.An)("div",b,[(0,a.QD)("div",v,[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)(x.notifications,((t,i)=>((0,a.Wz)(),(0,a.An)("div",{key:i},[(0,a.K2)(E,{"item-notification":t,"show-mark-as-read":!0,"source-settings":x.sourceSettings||{},onRead:e=>Q.removeFromUnread(t),onOpenModal:e[2]||(e[2]=t=>Q.openModal(t))},null,8,["item-notification","source-settings","onRead"]),(0,a.K2)(S,{spaced:"10px"})])))),128))]),(0,a.QD)("div",y,[(0,a.wt)((0,a.K2)(W,{modelValue:x.pagination.currentPage,"onUpdate:modelValue":e[3]||(e[3]=t=>x.pagination.currentPage=t),max:x.pagination.lastPage,"max-pages":6,ellipses:!1,"boundary-numbers":!1,unelevated:"",round:"",color:"blue-grey","active-color":"primary","direction-links":""},null,8,["modelValue","max"]),[[n.Ub,x.pagination.lastPage>1&&!x.loading]])])])):((0,a.Wz)(),(0,a.An)("div",w,[(0,a.QD)("div",k,[x.loading?(0,a.g1)("",!0):((0,a.Wz)(),(0,a.Az)(V,{key:0}))])]))]),(0,a.K2)($,{visible:x.loading},null,8,["visible"])])),_:1})}i(23816);var x=i(62792),Q=i(27056),A=i(8932);const D={props:{},components:{notificationCard:Q.c},watch:{"pagination.currentPage":{handler:function(t){this.lockPagination||this.getNotifications()}},filters:{handler:async function(t){this.lockPagination=!0,this.pagination.currentPage=1,await this.getNotifications(),this.lockPagination=!1},deep:!0}},mounted(){this.$nextTick((function(){this.init()}))},data(){return{lockPagination:!1,loading:!1,notifications:[],formFields:{source:{value:null,type:"select",props:{label:this.$tr("notification.cms.type"),clearable:!0,options:[],vIf:!1}},date:{type:"date",props:{clearable:!0,label:this.$tr("isite.cms.form.date")}},search:{type:"search",props:{clearable:!0}}},filters:{tab:"all",date:null,time:null,source:null},tabs:[{value:"all",label:this.$tr("notification.cms.tab.all")},{value:"read",label:this.$tr("notification.cms.tab.read")},{value:"unread",label:this.$tr("notification.cms.tab.unread")}],pagination:{currentPage:1,lastPage:1,perPage:10,total:0},sourceSettings:null}},computed:{},methods:{async init(){await this.getSources(),await this.getNotifications()},getSources(){this.loading=!0,x.c.getSources().then((t=>{this.sourceSettings=t,this.addSourceFilterOptions()}))},addSourceFilterOptions(){for(const[t,e]of Object.entries(this.sourceSettings))this.formFields.source.props.options.push({label:this.sourceSettings[t]["label"],value:t});this.formFields.source.props.options.length>0&&(this.formFields.source.props.vIf=!0)},async resetPagination(){this.lockPagination=!0,this.pagination.currentPage=1,await this.getNotifications(),this.lockPagination=!1},getNotifications(){this.loading=!0;let t={refresh:!0,params:{take:this.pagination.perPage,page:this.pagination.currentPage,filter:{me:!0,type:"broadcast",order:{field:"id",way:"desc"}}}};return this.filters.tab!=this.tabs[0].value&&(t.params.filter["isRead"]=this.filters.tab==this.tabs[1].value),this.filters.date&&(t.params.filter["date"]=this.$moment(this.filters.date).format("YYYY-MM-DD 00:00:00")),this.filters.search&&(t.params.filter["search"]=this.filters.search),this.filters.source&&(t.params.filter["source"]=this.filters.source),new Promise(((e,i)=>{x.c.getNotifications(t).then((t=>{this.loading=!1,this.pagination.lastPage=t.meta.page.lastPage,this.pagination.total=t.meta.page.total,e(this.notifications=t.data)})).catch((t=>{this.$apiResponse.handleError(t,(()=>{this.loading=!1}))}))}))},removeFromUnread(t){this.filters.tab==this.tabs[2].value&&(this.notifications=this.notifications.filter((e=>e.id!==t.id))),0==this.notifications.length&&this.getNotifications()},markAllAsRead(){x.c.markAllAsRead().then((()=>{this.resetPagination()}))},openModal(t){A.kN.emit("imagina.notification.open",t)}}};var z=i(68716),q=i(9440),E=i(38788),S=i(7628),W=i(99140),V=i(70880),$=i(15496),F=i(95252),N=i.n(F);const R=(0,z.c)(D,[["render",P]]),U=R;N()(D,"components",{QPage:q.c,QTabs:E.c,QTab:S.c,QBtn:W.c,QSeparator:V.c,QPagination:$.c})}}]);