"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[7428],{67428:(t,e,i)=>{i.r(e),i.d(e,{default:()=>w});var o=i(92444),s=i(74044);const l={key:0,class:"box"},a={class:"text-grey-7 q-mr-xs"},r=["innerHTML"],n={key:0,class:"q-mt-sm"},d={class:"text-grey-7 q-mr-xs"},h={class:"q-my-sm",style:{"word-wrap":"break-word"}},c={class:"text-grey-7 q-mr-xs"},p={class:"ellipsis"},m={class:"text-grey-7 q-mr-xs"};function u(t,e,i,u,b,f){const y=(0,o.E1)("q-tooltip"),k=(0,o.E1)("master-modal");return(0,o.Wz)(),(0,o.Az)(k,{modelValue:b.showModal,"onUpdate:modelValue":e[0]||(e[0]=t=>b.showModal=t),onHide:e[1]||(e[1]=t=>f.resetModal()),title:b.hook?b.hook.title:"",loading:b.loading,actions:f.actionsModal},{default:(0,o.Ql)((()=>[b.hook?((0,o.Wz)(),(0,o.An)("div",l,[(0,o.QD)("section",null,[(0,o.QD)("label",a,(0,s.WA)(t.$tr("isite.cms.form.description"))+":",1),(0,o.QD)("div",{innerHTML:b.hook.description},null,8,r),b.hook.callEveryMinutes?((0,o.Wz)(),(0,o.An)("div",n,[(0,o.QD)("label",d,(0,s.WA)(t.$tr("iwebhooks.cms.form.callEveryMinutes"))+":",1),(0,o.mY)(" "+(0,s.WA)(b.hook.callEveryMinutes),1)])):(0,o.g1)("",!0)]),(0,o.QD)("section",null,[(0,o.QD)("div",h,[(0,o.QD)("label",c,(0,s.WA)(t.$tr("iwebhooks.cms.form.endpoint"))+":",1),(0,o.QD)("p",p,(0,s.WA)(b.hook.endpoint),1),(0,o.K2)(y,null,{default:(0,o.Ql)((()=>[(0,o.mY)((0,s.WA)(b.hook.endpoint),1)])),_:1})]),(0,o.QD)("div",null,[(0,o.QD)("label",m,(0,s.WA)(t.$tr("iwebhooks.cms.form.httpMethod"))+":",1),(0,o.mY)(" "+(0,s.WA)(b.hook.httpMethod),1)])])])):(0,o.g1)("",!0)])),_:1},8,["modelValue","title","loading","actions"])}var b=i(18528)["c"];const f={data(){return{crudId:this.$uid(),showModal:!1,hook:null,loading:!1,loadingBtn:!1}},computed:{crudData(){const t=!!this.$hasAccess("iwebhooks.hooks.dispatch");return{crudId:this.crudId,entityName:b("main.qwebhook.entityNames.hook"),apiRoute:"apiRoutes.qwebhook.hooks",permission:"iwebhooks.hooks",create:{title:this.$tr("iwebhooks.cms.title.newHook")},read:{columns:[{name:"id",label:this.$tr("isite.cms.form.id"),field:"id",align:"left"},{name:"title",label:this.$tr("isite.cms.form.title"),field:"title",align:"rigth"},{name:"type",label:this.$tr("isite.cms.form.type"),field:"type",format:t=>t?.title||"-",align:"rigth"},{name:"httpMethod",label:this.$tr("iwebhooks.cms.form.httpMethod"),field:"httpMethod",align:"rigth"},{name:"status",label:this.$tr("isite.cms.form.status"),field:"status",align:"rigth"},{name:"endpoint",label:this.$tr("iwebhooks.cms.form.endpoint"),field:"endpoint",align:"left",action:t=>this.openModal(t)},{name:"category",label:this.$tr("isite.cms.form.category"),field:"category",align:"center",format:t=>t?.title||"-"},{name:"eventType",label:this.$tr("isite.cms.label.event"),field:"eventType",align:"center",format:t=>t?.title||"-"},{name:"eventEntity",label:this.$tr("isite.cms.label.entity"),field:"eventEntity",align:"center",format:t=>t||"-"},{name:"created_at",label:this.$tr("isite.cms.form.createdAt"),field:"createdAt",align:"left",format:t=>t?this.$trd(t):"-"},{name:"updated_at",label:this.$tr("isite.cms.form.updatedAt"),field:"updatedAt",align:"left",format:t=>t?this.$trd(t):"-"},{name:"actions",label:this.$tr("isite.cms.form.actions"),align:"left"}],requestParams:{include:"category,country"},actions:[{icon:"fa-regular fa-rocket",tooltip:this.$tr("iwebhooks.cms.label.dispatch"),vIf:t,color:"blue",action:t=>this.openModal(t)}]},update:{title:this.$tr("iwebhooks.cms.title.updateHook"),requestParams:{include:"category"}},delete:!0,formLeft:{id:{value:""},title:{value:"",type:"input",isTranslatable:!0,required:!0,props:{label:`${this.$tr("isite.cms.form.title")}*`}},httpMethod:{value:null,type:"select",required:!0,props:{label:`${this.$tr("iwebhooks.cms.form.httpMethod")}*`},loadOptions:{apiRoute:"apiRoutes.qsite.configs",select:{label:"label",id:"value"},requestParams:{filter:{configName:"Iwebhooks.config.httpMethodsOptions"}}}},endpoint:{value:"",type:"input",required:!0,help:{description:this.$tr("iwebhooks.cms.label.helpFieldEndpoint")},props:{label:`${this.$tr("iwebhooks.cms.form.endpoint")}*`}},headers:{type:"json",props:{label:this.$tr("iwebhooks.cms.form.headers")}},body:{type:"json",props:{label:this.$tr("iwebhooks.cms.form.body")}}},formRight:{categoryId:{type:"crud",props:{crudType:"select",crudData:i.e(5848).then(i.bind(i,55848)),crudProps:{label:`${this.$tr("isite.cms.form.category")}*`,rules:[t=>!!t||this.$tr("isite.cms.message.fieldRequired")]},config:{options:{label:"title",value:"id"}}}},typeId:{value:"1",type:"select",required:!0,props:{label:this.$tr("isite.cms.form.type")+"*"},loadOptions:{apiRoute:"apiRoutes.qwebhook.types"}},eventEntity:{type:"treeSelect",require:!0,props:{label:`${this.$tr("isite.cms.label.entity")}*`,disableBranchNodes:!0,vIf:"1"==this.crudInfo.typeId},loadOptions:{apiRoute:"apiRoutes.qsite.modulesInfo",requestParams:{filter:{asSelect:!0}},select:{label:"name",id:"path"}}},eventTypeId:{type:"select",require:!0,props:{label:`${this.$tr("isite.cms.label.event")}*`,vIf:"1"==this.crudInfo.typeId},loadOptions:{apiRoute:"apiRoutes.qwebhook.eventTypes"}},actionLabel:{value:"",type:"input",isTranslatable:!0,props:{label:this.$tr("iwebhooks.cms.form.actionLabel"),vIf:"2"==this.crudInfo.typeId}},maskEndpoint:{value:"",type:"input",isTranslatable:!0,props:{label:this.$tr("iwebhooks.cms.form.maskEndpoint"),vIf:"2"==this.crudInfo.typeId}},description:{name:"description",value:"",type:"input",isTranslatable:!0,props:{label:`${this.$tr("isite.cms.form.description")}`,type:"textarea",rows:"3",vIf:"2"==this.crudInfo.typeId}},callEveryMinutes:{value:null,type:"input",props:{label:this.$tr("iwebhooks.cms.form.callEveryMinutes"),type:"number",vIf:"2"==this.crudInfo.typeId}},countryId:{value:null,type:"select",props:{label:this.$tr("isite.cms.label.country"),clearable:!0,vIf:"2"==this.crudInfo.typeId},loadOptions:{apiRoute:"apiRoutes.qlocations.countries",select:{label:"name",id:"id"},filterByQuery:!0}},redirectLink:{value:"",type:"input",props:{label:this.$tr("iwebhooks.cms.form.redirectLink"),vIf:"2"==this.crudInfo.typeId}}}}},crudInfo(){return this.$store.state.qcrudComponent.component[this.crudId]||{}},actionsModal(){return[{props:{color:"primary",class:"full-width",vIf:!!this.hook?.actionLabel,label:this.hook?.actionLabel??"",loading:0!==this.hook?.isLoading||this.loadingBtn},action:()=>this.runWebhook(this.hook.id)}]}},methods:{resetModal(){this.showModal=!1,this.hook=null},openModal(t){this.showModal=!0,this.getHook(t.id)},async getHook(t){this.loading=!0;const e={refresh:!0};await this.$crud.show("apiRoutes.qwebhook.hooks",t,e).then((t=>{this.hook=t.data})).catch((t=>this.$alert.error(this.$tr("isite.cms.message.errorRequest")))),this.loading=!1},async runWebhook(t){this.loadingBtn=!0,await this.$crud.post(`${b("apiRoutes.qwebhook.hooks")}/dispatch/${t}`).catch((t=>this.$alert.error(this.$tr("isite.cms.message.errorRequest")))),this.loadingBtn=!1}}};var y=i(68716),k=i(90111),g=i(95252),$=i.n(g);const v=(0,y.c)(f,[["render",u]]),w=v;$()(f,"components",{QTooltip:k.c})}}]);