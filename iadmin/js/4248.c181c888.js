"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[4248],{24248:(n,e,t)=>{t.r(e),t.d(e,{default:()=>g});var i=t(92444),o={class:"row"};function c(n,e,t,c,a,l){var r=(0,i.E1)("dynamic-field"),s=(0,i.E1)("inner-loading");return(0,i.Wz)(),(0,i.An)("div",null,[(0,i.QD)("div",o,[n.loading?(0,i.g1)("",!0):((0,i.Wz)(),(0,i.Az)(r,{key:0,modelValue:n.map,"onUpdate:modelValue":e[0]||(e[0]=function(e){return n.map=e}),class:"q-mb-md col-12",field:n.mapField},null,8,["modelValue","field"]))]),(0,i.K2)(s,{visible:n.loading},null,8,["visible"])])}var a=t(75836),l=t(20584);const r={getDevices:function(){return new Promise((function(n,e){var t={refresh:!0,params:{include:"sensors"}};l.c.index("apiRoutes.qtelemetry.devices",t).then((function(e){n(e.data)})).catch((function(n){return e(n)}))}))}};var s=t(58088),u=t(8932),d=function(){return d=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++)for(var o in e=arguments[t],e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},d.apply(this,arguments)};function v(n,e){var t={},o=(0,a.cB)({loading:!1,map:null,devices:[],mapField:{value:null,type:"positionMarkerMap",help:{description:u._s.tr("icommerce.cms.form.mapHelp")},props:{label:"".concat(u._s.tr("isite.cms.label.search"),"..."),readOnly:!0,markers:!0,height:"80vh"}}}),c={},l={init:function(){o.loading=!0,l.getDevices().then((function(n){l.setMarkers(),o.loading=!1}))},setMarkers:function(){o.map=o.devices.map((function(n){var e,t,i=!(null===(e=n.options)||void 0===e?void 0:e.openPopup)||"0"!=(null===(t=n.options)||void 0===t?void 0:t.openPopup);return{lat:n.lat,lng:n.lng,title:n.title,loadingLabel:u._s.tr("isite.cms.label.loading"),onClick:function(){return l.getLastRecord(n)},openPopup:i}}))},getLastRecord:function(n){return new Promise((function(e,t){var i=n.sensors,o={filter:{deviceId:n.id},orderBy:{field:"id",way:"desc"},take:1};s.c.getRecords(o).then((function(t){var o,c="<b>".concat(null===n||void 0===n?void 0:n.title,"</b>")||0;0==t.length&&e(c);var a=t[0];c="<b>".concat(null===(o=null===a||void 0===a?void 0:a.device)||void 0===o?void 0:o.title,"</b>");var l="";i.length&&i.forEach((function(n){if(null===a||void 0===a?void 0:a.logs){var e=a.logs.find((function(e){return e.sensorId==n.id}));if(e){var t=n.title,i=Number.isInteger(e.value)?e.value:e.value.toFixed(2),o=(null===e||void 0===e?void 0:e.statusSensor)?' <span style="color: '.concat(e.statusSensor.color,'">').concat(e.statusSensor.text,"</span>"):"",c=n.options;c?(t=(null===c||void 0===c?void 0:c.prefix)?c.prefix:n.title,t=(null===c||void 0===c?void 0:c.suffix)?"<b>".concat(t,"</b> : ").concat(i," ").concat(c.suffix):"".concat(t," : ").concat(i)):t="<b>".concat(n.title,"</b> : ").concat(i),l="".concat(l," ").concat(t," ").concat(o,"</br>")}}})),e("".concat(c,"<p>").concat(l,"</p>"))}))}))},getDevices:function(){return new Promise((function(n,e){r.getDevices().then((function(e){o.devices=e,n(e)}))}))}};return(0,i.u2)((function(){l.init()})),d(d(d(d({},t),(0,a.kx)(o)),c),l)}const p=(0,i._M)({setup:function(n,e){var t=e.emit;return v(n,t)}});var f=t(68716);const m=(0,f.c)(p,[["render",c]]),g=m}}]);