"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[4768],{94768:(e,t,s)=>{s.r(t),s.d(t,{default:()=>ie});var l=s(92444);const a={class:"backend-page row q-col-gutter-x-md"},o={class:"col-md-5"},i={class:"box"},r={class:"col-md-7"},n={class:"box"};function d(e,t,s,d,c,m){const u=(0,l.E1)("formOptions"),p=(0,l.E1)("indexValuesByOptions");return(0,l.Wz)(),(0,l.An)("div",a,[(0,l.QD)("div",o,[(0,l.QD)("div",i,[(0,l.K2)(u)])]),(0,l.QD)("div",r,[(0,l.QD)("div",n,[(0,l.K2)(p)])])])}const c={key:0,class:"row gutter-x-sm relative-position"},m={class:"col-12"};function u(e,t,s,a,o,i){const r=(0,l.E1)("locales"),n=(0,l.E1)("dynamic-field"),d=(0,l.E1)("q-btn"),u=(0,l.E1)("q-form"),p=(0,l.E1)("inner-loading");return o.success?((0,l.Wz)(),(0,l.An)("div",c,[(0,l.QD)("div",m,[(0,l.K2)(r,{modelValue:o.locale,"onUpdate:modelValue":t[0]||(t[0]=e=>o.locale=e),ref:"localeComponent",form:e.$refs.formContent},null,8,["modelValue","form"])]),o.locale.success?((0,l.Wz)(),(0,l.Az)(u,{key:0,autocorrect:"off",autocomplete:"off",ref:"formContent",class:"full-width q-my-sm",onSubmit:t[1]||(t[1]=e=>i.updateItem()),onValidationError:t[2]||(t[2]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,l.Ql)((()=>[((0,l.Wz)(!0),(0,l.An)(l.ae,null,(0,l.mi)(i.formFields,((e,t)=>((0,l.Wz)(),(0,l.Az)(n,{key:t,field:e,modelValue:o.locale.formTemplate[t],"onUpdate:modelValue":e=>o.locale.formTemplate[t]=e,language:o.locale.language},null,8,["field","modelValue","onUpdate:modelValue","language"])))),128)),o.itemId?((0,l.Wz)(),(0,l.Az)(d,{key:0,class:"float-right",color:"green",loading:o.loading,unelevated:"","no-caps":"",label:e.$tr("isite.cms.label.save"),type:"submit",rounded:""},null,8,["loading","label"])):(0,l.g1)("",!0)])),_:1},512)):(0,l.g1)("",!0),(0,l.K2)(p,{visible:o.loading},null,8,["visible"])])):(0,l.g1)("",!0)}const p={components:{},watch:{$route(e,t){this.initForm()}},mounted(){this.$nextTick((function(){this.initForm()}))},data(){return{locale:{},loading:!1,success:!1,itemId:!1}},computed:{dataLocale(){return{fields:{type:null},fieldsTranslatable:{description:""}}},formFields(){return{description:{value:"",type:"input",isTranslatable:!0,props:{label:`${this.$tr("isite.cms.form.description")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]}},type:{value:null,type:"select",isTranslatable:!1,props:{label:`${this.$tr("isite.cms.form.type")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]},loadOptions:{apiRoute:"apiRoutes.qcommerce.optionTypes",select:{label:"label",id:"value"}}}}}},methods:{async initForm(){this.loading=!0,this.success=!1,this.locale=this.$clone(this.dataLocale),this.itemId=this.$route.params.id,this.locale.success&&this.$refs.localeComponent.vReset(),await this.getData(),this.success=!0,this.loading=!1},getData(){return new Promise(((e,t)=>{const s=this.$clone(this.itemId);if(s){let l="apiRoutes.qcommerce.options",a={refresh:!0,params:{filter:{allTranslations:!0}}};this.$crud.show(l,s,a).then((t=>{this.orderDataItemToLocale(t.data),e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest")}),this.loading=!1,t(!1)}))}))}else e(!0)}))},orderDataItemToLocale(e){let t=this.$clone(e);this.locale.form=this.$clone(t)},async updateItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qcommerce.options";this.$crud.update(e,this.itemId,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")})}))}},getDataForm(){let e=this.locale.form;for(var t in e){let s=e[t];null!=s&&void 0!=s||delete e[t]}return e.selectable=JSON.stringify(e.selectable),e}}};var h=s(68716),g=s(14288),f=s(99140),b=s(95252),$=s.n(b);const v=(0,h.c)(p,[["render",u]]),Q=v;$()(p,"components",{QForm:g.c,QBtn:f.c});var V=s(74044);const q={class:"row gutter-y-sm relative-position"},y={class:"col-md-12"},D={class:"row q-gutter-x-sm justify-between"},E={class:"col-12"},I={class:"col-12 q-mt-sm"},w={class:"col-12 text-right q-mt-sm"},k={class:"text-weight-bold"};function K(e,t,s,a,o,i){const r=(0,l.E1)("q-btn"),n=(0,l.E1)("q-tooltip"),d=(0,l.E1)("q-separator"),c=(0,l.E1)("nestedoptionValues"),m=(0,l.E1)("q-icon"),u=(0,l.E1)("q-avatar"),p=(0,l.E1)("q-toolbar-title"),h=(0,l.E1)("q-toolbar"),g=(0,l.E1)("option-values-form"),f=(0,l.E1)("q-card-section"),b=(0,l.E1)("q-card"),$=(0,l.E1)("q-dialog"),v=(0,l.E1)("inner-loading"),Q=(0,l.iS)("close-popup");return(0,l.Wz)(),(0,l.An)("div",q,[(0,l.QD)("div",y,[(0,l.QD)("div",D,[(0,l.K2)(r,(0,l.Gu)({to:{name:"qcommerce.admin.options"},icon:"fa-light fa-arrow-left"},i.buttonProps),null,16,["to"]),(0,l.K2)(r,(0,l.Gu)({onClick:t[0]||(t[0]=e=>(o.id=-1,o.dialogNewValue=!0)),icon:"fa-light fa-plus",label:e.$tr("icommerce.cms.newOptionValue")},i.buttonProps),null,16,["label"]),(0,l.K2)(r,(0,l.Gu)({onClick:t[1]||(t[1]=e=>i.getItems(!0)),icon:"fa-light fa-rotate-right"},i.buttonProps),{default:(0,l.Ql)((()=>[(0,l.K2)(n,{delay:300},{default:(0,l.Ql)((()=>[(0,l.mY)((0,V.WA)(e.$tr("isite.cms.label.refresh")),1)])),_:1})])),_:1},16)])]),(0,l.QD)("div",E,[(0,l.K2)(d,{class:"q-my-md"})]),(0,l.QD)("div",I,[(0,l.K2)(c,{optionValues:o.optionValues,onUpdated:t[2]||(t[2]=e=>i.getItems(!0))},null,8,["optionValues"])]),(0,l.QD)("div",w,[o.optionValues.length?((0,l.Wz)(),(0,l.Az)(r,{key:0,onClick:i.updateOrder,icon:"fas fa-save",label:e.$tr("isite.cms.label.save"),color:"positive",class:"q-ml-xs",rounded:"",unelevated:""},null,8,["onClick","label"])):(0,l.g1)("",!0)]),(0,l.K2)($,{modelValue:o.dialogNewValue,"onUpdate:modelValue":t[3]||(t[3]=e=>o.dialogNewValue=e)},{default:(0,l.Ql)((()=>[(0,l.K2)(b,null,{default:(0,l.Ql)((()=>[(0,l.K2)(h,{class:"bg-primary text-white"},{default:(0,l.Ql)((()=>[(0,l.K2)(u,null,{default:(0,l.Ql)((()=>[(0,l.K2)(m,{name:"fa fa-stream"})])),_:1}),(0,l.K2)(p,null,{default:(0,l.Ql)((()=>[(0,l.QD)("span",k,(0,V.WA)(this.id>0?e.$tr("icommerce.cms.sidebar.adminValuesEdit"):e.$tr("icommerce.cms.sidebar.adminValuesCreate")),1)])),_:1}),(0,l.wt)((0,l.K2)(r,{flat:"",round:"",dense:"",icon:"fa fa-close"},null,512),[[Q]])])),_:1}),(0,l.K2)(f,null,{default:(0,l.Ql)((()=>[(0,l.K2)(g,{"option-id":e.$route.params.id,id:o.id,onUpdated:i.closeNewModal},null,8,["option-id","id","onUpdated"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,l.K2)(v,{visible:o.loading},null,8,["visible"])])}s(23816);const C={class:"row justify-between q-mb-xs q-mt-xs"},T={class:"col-6 q-py-xs"},x={class:"col-6 text-right q-py-xs relative-position"},A={class:"col-12"},z={key:1,class:"col-12 text-center text-h5"},W={class:"q-ma-none text-red"};function _(e,t,s,a,o,i){const r=(0,l.E1)("q-icon"),n=(0,l.E1)("q-btn"),d=(0,l.E1)("q-separator"),c=(0,l.E1)("nestedDraggable"),m=(0,l.E1)("draggable"),u=(0,l.E1)("not-result"),p=(0,l.E1)("q-card-section"),h=(0,l.E1)("q-card-actions"),g=(0,l.E1)("q-card"),f=(0,l.E1)("q-dialog");return(0,l.Wz)(),(0,l.An)("div",null,[s.optionValues.length>0?((0,l.Wz)(),(0,l.Az)(m,(0,l.Gu)({key:0,tag:"div"},i.dragOptions,{list:s.optionValues,group:{name:"g1"},"item-key":"id"}),{item:(0,l.Ql)((({element:e})=>[((0,l.Wz)(),(0,l.An)("div",{class:"list-group-item",key:e.id},[(0,l.QD)("div",C,[(0,l.QD)("div",T,[(0,l.K2)(r,{class:"cursor-pointer",name:"fas fa-arrows-alt"}),(0,l.mY)(" "+(0,V.WA)(e.description),1)]),(0,l.QD)("div",x,[(0,l.K2)(n,{onClick:t=>o.eventBus.emit("showEdit",e.id),icon:"fas fa-pen",size:"xs",class:"q-mr-sm",color:"green"},null,8,["onClick"]),(0,l.K2)(n,{onClick:t=>{o.dialogDeleteItem=!0,o.itemIdToDelete=e},icon:"fas fa-trash-alt",size:"xs",color:"red"},null,8,["onClick"])]),(0,l.QD)("div",A,[(0,l.K2)(d)])]),e.children?((0,l.Wz)(),(0,l.Az)(c,{key:0,class:(0,V.WN)(`${e.children.length} ?: q-mb-xs`),optionValues:e.children},null,8,["class","optionValues"])):(0,l.g1)("",!0)]))])),_:1},16,["list"])):((0,l.Wz)(),(0,l.An)("div",z,[(0,l.K2)(u)])),(0,l.K2)(f,{modelValue:o.dialogDeleteItem,"onUpdate:modelValue":t[2]||(t[2]=e=>o.dialogDeleteItem=e)},{default:(0,l.Ql)((()=>[(0,l.K2)(g,{class:"backend-page"},{default:(0,l.Ql)((()=>[(0,l.K2)(p,null,{default:(0,l.Ql)((()=>[(0,l.QD)("h5",W,(0,V.WA)(o.itemIdToDelete.label),1),(0,l.mY)(" "+(0,V.WA)(e.$tr("isite.cms.message.deleteRecord")),1)])),_:1}),(0,l.K2)(h,{align:"right"},{default:(0,l.Ql)((()=>[(0,l.K2)(n,{color:"blue-grey",label:"Cancel",onClick:t[0]||(t[0]=e=>o.dialogDeleteItem=!1)}),(0,l.K2)(n,{color:"red",icon:"fas fa-trash-alt",label:"Delete",onClick:t[1]||(t[1]=e=>i.deleteItem())})])),_:1})])),_:1})])),_:1},8,["modelValue"])])}var N=s(10328),R=s.n(N),U=s(13488),O=s(8932);const F={name:"nestedDraggable",components:{draggable:R(),optionValuesForm:U["default"]},props:{optionValues:{required:!0,type:Array}},emits:["updated"],data(){return{dialogDeleteItem:!1,dialogEditValue:!1,itemIdToDelete:{},optionId:this.$route.params.id||null,id:null,eventBus:O.kN}},computed:{dragOptions(){return{animation:200,group:"description",disabled:!1,ghostClass:"ghost"}}},methods:{deleteItem(){this.$crud.delete("apiRoutes.qcommerce.optionValues",this.itemIdToDelete.id).then((e=>{this.$alert.success({message:this.$tr("isite.cms.message.recordDeleted")}),this.dialogDeleteItem=!1,this.$emit("updated")})).catch((e=>{this.$alert.error({message:this.$tr("isite.cms.message.recordNoDeleted"),pos:"bottom"})}))}}};var B=s(58120),S=s(70880),P=s(30852),G=s(70608),L=s(71008),Y=s(66480);const j=(0,h.c)(F,[["render",_]]),M=j;$()(F,"components",{QIcon:B.c,QBtn:f.c,QSeparator:S.c,QDialog:P.c,QCard:G.c,QCardSection:L.c,QCardActions:Y.c});const J={components:{nestedoptionValues:M,optionValuesForm:U["default"]},data(){return{loading:!1,optionValues:[],modalNewItem:!1,modalUpdateItem:!1,dialogNewValue:!1,itemUpdate:{},itemDelete:{},id:-1}},created(){this.$nextTick((()=>{this.getItems(),O.kN.on("updateoptionValues",this.handlerUpdateoptionValues),O.kN.on("showEdit",this.showEdit)}))},computed:{buttonProps(){return{round:!1,rounded:!0,dense:!0,unelevated:!0,textColor:"primary",style:"border: 1px solid rgba(0, 13, 71, 0.15)",class:`btn-${this.size}`,noCaps:!0}}},methods:{showEdit(e){this.id=e,this.dialogNewValue=!0},getItems(e=!1){this.loading=!0;let t=this.$route.params.id,s={refresh:e,params:{filter:{optionId:t,order:{field:"sort_order",way:"asc"}}}};this.$crud.index("apiRoutes.qcommerce.optionValues",s).then((e=>{this.optionValues=e.data,this.loading=!1})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1}))}))},updateOrder(){let e=[];this.treeToArray(this.optionValues,e),this.loading=!0,this.$crud.create("apiRoutes.qcommerce.optionValuesOrdener",{values:e}).then((e=>{this.loading=!1,this.getItems(!0),this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`})})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"})}))},arrayToTree(e,t=0){return e.filter((s=>{if(s.parentId==t)return s["children"]=this.arrayToTree(e,s.id)}))},treeToArray(e,t,s=null){let l=[...e];l.forEach(((e,l)=>{e.sortOrder=l,e.parentId=s,t.push(e),e.children&&e.children.length&&this.treeToArray(e.children,t,e.id)}))},handlerUpdateoptionValues(e){this.getItems()},closeNewModal(){this.dialogNewValue=!1,this.getItems(!0)}}};var H=s(90111),X=s(6536),Z=s(11252),ee=s(36524),te=s(81020);const se=(0,h.c)(J,[["render",K]]),le=se;$()(J,"components",{QBtn:f.c,QTooltip:H.c,QSeparator:S.c,QDialog:P.c,QCard:G.c,QToolbar:X.c,QAvatar:Z.c,QIcon:B.c,QToolbarTitle:ee.c,QCardSection:L.c}),$()(J,"directives",{ClosePopup:te.c});const ae={components:{formOptions:Q,indexValuesByOptions:le}},oe=(0,h.c)(ae,[["render",d]]),ie=oe}}]);