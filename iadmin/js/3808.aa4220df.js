"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[3808],{33808:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Mn});var l=n(92444),o=n(74044);const i={id:"builderEditor",class:"row relative-position"},r={class:"text-right q-mb-md"},a={class:"drawer-title q-py-xs q-px-md justify-center"},c={id:"renderList"},s={class:"text-right q-pa-md"},u={class:"preview-content"},d={class:"preview-content__actions row justify-between items-center"},f={class:"q-px-md q-py-sm text-blue-grey text-h6"},m={key:1,class:"q-pr-md"},p={class:"preview-content__box"},b={key:1,class:"text-center q-py-lg"},v={class:"q-mt-md text-h5 text-blue-grey"},y={class:"preview-content__actions row justify-between items-center"},h={class:"q-px-md q-py-sm text-blue-grey text-h6"},g={key:0,class:"text-caption",style:{"line-height":"1"}},k={key:0,class:"q-pr-md"},w={class:"preview-content__box"},B={key:1,class:"text-center q-py-lg"},S={class:"q-mt-md text-h5 text-blue-grey"};function Q(e,t,Q,C,A,x){const q=(0,l.E1)("crud"),_=(0,l.E1)("q-icon"),T=(0,l.E1)("q-select"),E=(0,l.E1)("layout-list"),I=(0,l.E1)("block-list"),K=(0,l.E1)("blocks-panel"),z=(0,l.E1)("q-dialog"),P=(0,l.E1)("block-form"),L=(0,l.E1)("block-attributes-form"),W=(0,l.E1)("layout-library-panel"),D=(0,l.E1)("q-item-label"),N=(0,l.E1)("q-item-section"),O=(0,l.E1)("q-item"),F=(0,l.E1)("q-list"),V=(0,l.E1)("q-btn-dropdown"),j=(0,l.E1)("q-tab"),$=(0,l.E1)("q-tabs"),U=(0,l.E1)("q-tooltip"),M=(0,l.E1)("q-btn"),R=(0,l.E1)("q-separator"),G=(0,l.E1)("handle-grid"),Y=(0,l.E1)("q-tab-panel"),H=(0,l.E1)("iframe-post"),J=(0,l.E1)("q-tab-panels"),X=(0,l.E1)("inner-loading"),Z=(0,l.iS)("close-popup");return(0,l.Wz)(),(0,l.An)("div",i,[(0,l.QD)("div",r,[(0,l.K2)(q,{"crud-data":n.e(4912).then(n.bind(n,14912)),type:"onlyUpdate",ref:"crudLayout",onCreatedData:t[0]||(t[0]=t=>e.handleCreateLayout(t,!0)),onUpdated:t[1]||(t[1]=t=>e.refreshApiData({crudAction:"updated"})),onDeleted:t[2]||(t[2]=t=>e.refreshApiData({crudAction:"deleted"}))},null,8,["crud-data"])]),(0,l.QD)("div",{class:"preview-panels relative-position",style:(0,o.MN)(`width: ${e.store.panelWidth}`)},[(0,l.QD)("div",a,[(0,l.K2)(T,{color:"blue-grey",modelValue:e.view,"onUpdate:modelValue":t[3]||(t[3]=t=>e.view=t),options:e.dropdownActions.editor,borderless:"",class:"full-width","emit-value":"","map-options":""},{prepend:(0,l.Ql)((()=>[(0,l.K2)(_,{color:"white",name:"layout"==e.view?"fa-light fa-puzzle":"fa-light fa-puzzle-piece"},null,8,["name"])])),_:1},8,["modelValue","options"])]),(0,l.QD)("div",c,["layout"===e.view?((0,l.Wz)(),(0,l.Az)(E,{key:0,onCreate:t[4]||(t[4]=()=>e.showLayoutPanel=!0),ref:"refLayoutList",onSelected:e.handleLayoutSelected,onRefresh:t[5]||(t[5]=t=>e.loading=t)},null,8,["onSelected"])):((0,l.Wz)(),(0,l.Az)(I,{key:1,onCreate:e.openBlockPanel,ref:"refBlockList",onSelected:e.previewBlock,onRefresh:t[6]||(t[6]=t=>e.loading=t)},null,8,["onCreate","onSelected"]))]),(0,l.K2)(z,{modelValue:e.showBlocksPanel,"onUpdate:modelValue":t[8]||(t[8]=t=>e.showBlocksPanel=t),position:"left",class:"builder-panel-dialog",square:""},{default:(0,l.Ql)((()=>[(0,l.K2)(K,(0,l.Gu)({onCreated:t[7]||(t[7]=t=>e.handleChangesBlock({block:t,refresh:!0,crudAction:"blockCreated"})),class:"full-height"},e.infoToCreateBlock),null,16)])),_:1},8,["modelValue"]),(0,l.K2)(P,{ref:"refBlockForm",onUpdated:t[9]||(t[9]=t=>e.handleChangesBlock({block:t,update:!0,refresh:!0}))},null,512),(0,l.K2)(z,{modelValue:e.showBlockAttributesForm,"onUpdate:modelValue":t[12]||(t[12]=t=>e.showBlockAttributesForm=t),title:e.$tr("ibuilder.cms.label.editBlockAttributes"),position:"left",class:"builder-panel-dialog",square:"",persistent:"","full-width":"","full-height":""},{default:(0,l.Ql)((()=>[(0,l.K2)(L,{ref:"blockAttributesForm",onUpdateBlock:t[10]||(t[10]=t=>e.handleChangesBlock(t)),onCancel:t[11]||(t[11]=()=>e.handleChangesBlock({cancel:!0}))},null,512)])),_:1},8,["modelValue","title"]),(0,l.K2)(z,{modelValue:e.showLayoutPanel,"onUpdate:modelValue":t[13]||(t[13]=t=>e.showLayoutPanel=t),position:"left",class:"builder-panel-dialog",square:""},{default:(0,l.Ql)((()=>[(0,l.K2)(W,{onCreating:e.handleCreateLayout,class:"full-height"},null,8,["onCreating"])])),_:1},8,["modelValue"])],4),(0,l.QD)("div",{id:"rightContent",style:(0,o.MN)(`width: calc(100% - ${e.store.panelWidth})`)},[(0,l.QD)("div",s,[(0,l.K2)(V,{rounded:"","no-caps":"",unelevated:"",split:"",label:e.$tr("ibuilder.cms.label.administrator"),onClick:e.goHome,icon:"fa-light fa-eye",outline:"",color:"primary"},{default:(0,l.Ql)((()=>[(0,l.K2)(F,null,{default:(0,l.Ql)((()=>[((0,l.Wz)(!0),(0,l.An)(l.ae,null,(0,l.mi)(e.dropdownActions.redirect,((e,t)=>(0,l.wt)(((0,l.Wz)(),(0,l.Az)(O,(0,l.Gu)({key:t,clickable:""},e.props,{onClick:t=>void 0!=e.action?e.action():null}),{default:(0,l.Ql)((()=>[(0,l.K2)(N,null,{default:(0,l.Ql)((()=>[(0,l.K2)(D,null,{default:(0,l.Ql)((()=>[(0,l.mY)((0,o.WA)(e.title),1)])),_:2},1024)])),_:2},1024)])),_:2},1040,["onClick"])),[[Z]]))),128))])),_:1})])),_:1},8,["label","onClick"])]),(0,l.QD)("div",u,["layout"===e.view?((0,l.Wz)(),(0,l.An)(l.ae,{key:0},[(0,l.QD)("div",d,[e.store.layoutSelected?((0,l.Wz)(),(0,l.Az)($,{key:0,modelValue:e.layoutTab,"onUpdate:modelValue":t[14]||(t[14]=t=>e.layoutTab=t),align:"right","inline-label":"","no-caps":"","indicator-color":"transparent","active-bg-color":e.tabColor,"active-color":"white","content-class":`text-${e.tabColor} bg-grey-2`},{default:(0,l.Ql)((()=>[(0,l.K2)(j,{name:"builder",label:e.$tr("ibuilder.cms.label.grid"),icon:"fa-light fa-border-none"},null,8,["label"]),(0,l.K2)(j,{name:"preview",label:e.$tr("ibuilder.cms.label.preview"),icon:"fa-light fa-eye",onClick:e.previewPage},null,8,["label","onClick"])])),_:1},8,["modelValue","active-bg-color","content-class"])):(0,l.g1)("",!0),(0,l.QD)("div",f,(0,o.WA)(e.titleTab),1),e.store.layoutSelected?((0,l.Wz)(),(0,l.An)("div",m,[(0,l.K2)(M,{size:"xs",padding:"sm",class:"q-mr-sm",unelevated:"",outline:"",onClick:t[15]||(t[15]=()=>e.handleDeleteLayout(e.store.layoutSelected)),icon:"fa-regular fa-trash",round:"",color:"negative"},{default:(0,l.Ql)((()=>[(0,l.K2)(U,null,{default:(0,l.Ql)((()=>[(0,l.mY)((0,o.WA)(e.$tr("isite.cms.label.delete")),1)])),_:1})])),_:1}),(0,l.K2)(M,{size:"xs",padding:"sm",class:"q-mr-sm",unelevated:"",outline:"",onClick:t[16]||(t[16]=t=>e.crudLayout.update(e.store.layoutSelected)),icon:"fa-light fa-edit",round:"",color:"cyan"},{default:(0,l.Ql)((()=>[(0,l.K2)(U,null,{default:(0,l.Ql)((()=>[(0,l.mY)((0,o.WA)(e.$tr("isite.cms.label.edit")),1)])),_:1})])),_:1}),(0,l.K2)(M,{outline:"",rounded:"",color:"green","no-caps":"",onClick:e.savePivotBlocks,padding:"xs md"},{default:(0,l.Ql)((()=>[(0,l.K2)(_,{name:"fa-light fa-save",size:"17px",class:"q-mr-sm"}),(0,l.mY)(" "+(0,o.WA)(e.$tr("isite.cms.label.save")),1)])),_:1},8,["onClick"])])):(0,l.g1)("",!0)]),(0,l.K2)(R,{color:e.tabColor,size:"3px"},null,8,["color"]),(0,l.QD)("div",p,[e.store.layoutSelected?((0,l.Wz)(),(0,l.Az)(J,{key:0,modelValue:e.layoutTab,"onUpdate:modelValue":t[18]||(t[18]=t=>e.layoutTab=t),animated:"","transition-prev":"scale","transition-next":"scale"},{default:(0,l.Ql)((()=>[(0,l.K2)(Y,{name:"builder",class:"q-pa-none overflow-hidden"},{default:(0,l.Ql)((()=>[(0,l.K2)(G,(0,l.Gu)({elements:e.gridBlocks},e.configHandleGrid,{ref:"handleGrid",onCreate:t[17]||(t[17]=t=>e.handleCreatingBlock(t))}),null,16,["elements"])])),_:1}),(0,l.K2)(Y,{name:"preview",class:"q-pa-none"},{default:(0,l.Ql)((()=>[(0,l.K2)(H,{id:`iframeLayout${e.store.layoutSelected.id}`,ref:"refIframePost"},null,8,["id"])])),_:1})])),_:1},8,["modelValue"])):((0,l.Wz)(),(0,l.An)("div",b,[(0,l.K2)(_,{name:"fa-light fa-exclamation-circle",size:"60px",color:"warning"}),(0,l.QD)("div",v,(0,o.WA)(e.$tr("ibuilder.cms.label.chooseLayout")),1)]))])],64)):((0,l.Wz)(),(0,l.An)(l.ae,{key:1},[(0,l.QD)("div",y,[(0,l.QD)("div",h,[(0,l.mY)((0,o.WA)(e.titleTab)+" ",1),e.store.viewBlockSelected?((0,l.Wz)(),(0,l.An)("div",g,[(0,l.mY)(" SN: "+(0,o.WA)(e.store.viewBlockSelected.systemName)+" ",1),(0,l.K2)(M,{onClick:t[19]||(t[19]=t=>e.$helper.copyToClipboard(e.store.viewBlockSelected.systemName,"isite.cms.messages.copyToClipboard")),icon:"fa-light fa-copy",flat:"",size:"sm",padding:"0",class:"q-ml-xs",round:""})])):(0,l.g1)("",!0)]),e.store.viewBlockSelected?((0,l.Wz)(),(0,l.An)("div",k,[(0,l.K2)(M,{size:"xs",padding:"sm",class:"q-mr-sm",unelevated:"",outline:"",onClick:t[20]||(t[20]=()=>e.handleActionsBlock("delete")),icon:"fa-regular fa-trash",round:"",color:"negative"},{default:(0,l.Ql)((()=>[(0,l.K2)(U,null,{default:(0,l.Ql)((()=>[(0,l.mY)((0,o.WA)(e.$tr("isite.cms.label.delete")),1)])),_:1})])),_:1}),(0,l.K2)(M,{size:"xs",padding:"sm",class:"q-mr-sm",unelevated:"",outline:"",round:"",color:"cyan",onClick:t[21]||(t[21]=()=>e.refBlockForm.updateData(e.store.viewBlockSelected)),icon:"fa-regular fa-book"},{default:(0,l.Ql)((()=>[(0,l.K2)(U,null,{default:(0,l.Ql)((()=>[(0,l.mY)((0,o.WA)(e.$tr("ibuilder.cms.label.content")),1)])),_:1})])),_:1}),(0,l.K2)(M,{size:"xs",padding:"sm",class:"q-mr-sm",unelevated:"",outline:"",onClick:t[22]||(t[22]=()=>e.handleActionsBlock("updateAttr")),icon:"fa-regular fa-palette",round:"",color:"cyan"},{default:(0,l.Ql)((()=>[(0,l.K2)(U,null,{default:(0,l.Ql)((()=>[(0,l.mY)((0,o.WA)(e.$tr("ibuilder.cms.label.attributes")),1)])),_:1})])),_:1})])):(0,l.g1)("",!0)]),(0,l.K2)(R,{color:e.tabColor,size:"3px"},null,8,["color"]),(0,l.QD)("div",w,[e.store.viewBlockSelected&&!e.showBlockAttributesForm?((0,l.Wz)(),(0,l.Az)(H,{key:0,id:`iframeBlock${e.store.viewBlockSelected.id}`,ref:"refIframePost"},null,8,["id"])):((0,l.Wz)(),(0,l.An)("div",B,[(0,l.K2)(_,{name:"fa-light fa-exclamation-circle",size:"60px",color:"warning"}),(0,l.QD)("div",S,(0,o.WA)(e.$tr("ibuilder.cms.label.chooseBlock")),1)]))])],64))])],4),(0,l.K2)(X,{visible:e.loading},null,8,["visible"])])}var C=n(75836),A=n(20584),x=function(e,t,n){if(n||2===arguments.length)for(var l,o=0,i=t.length;o<i;o++)!l&&o in t||(l||(l=Array.prototype.slice.call(t,0,o)),l[o]=t[o]);return e.concat(l||Array.prototype.slice.call(t))},q=(0,C.cB)({panelWidth:"380px",layoutSelected:null,viewBlockSelected:null,blockSelected:null,blockConfigs:[],mainBlockSystemName:"x-ibuilder::block"});const _=(0,l.S6)((function(){return{get panelWidth(){return q.panelWidth},get layoutSelected(){return q.layoutSelected},set layoutSelected(e){q.layoutSelected=e},resetLayoutSelected:function(){q.layoutSelected=null},get blockSelected(){return q.blockSelected},set blockSelected(e){q.blockSelected=e},get blockConfigs(){return q.blockConfigs},set blockConfigs(e){q.blockConfigs=e},get mainBlockSystemName(){return q.mainBlockSystemName},get ignoreConfigKeys(){var e=new Set(q.blockConfigs.reduce((function(e,t){var n;return x(x([],Object.keys(null!==(n=t.childBlocks)&&void 0!==n?n:{}),!0),e,!0)}),["componentAttributes"]));return Array.from(e)},get viewBlockSelected(){return q.viewBlockSelected},set viewBlockSelected(e){q.viewBlockSelected=e},resetSelecteds:function(){q.layoutSelected=null,q.blockSelected=null,q.viewBlockSelected=null}}})).value;var T=n(18528)["c"],E=function(){return E=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},E.apply(this,arguments)},I=function(e,t,n){if(n||2===arguments.length)for(var l,o=0,i=t.length;o<i;o++)!l&&o in t||(l||(l=Array.prototype.slice.call(t,0,o)),l[o]=t[o]);return e.concat(l||Array.prototype.slice.call(t))};const K={getBlockConfigs:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t={}),new Promise((function(n,l){var o={refresh:e,params:t};A.c.index("apiRoutes.qbuilder.layouts",o).then((function(e){n(E(E({},e),{data:e.data.sort((function(e,t){return t.id-e.id}))}))})).catch((function(e){return l(e)}))}))},getModuleBlocks:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t={}),new Promise((function(n,l){var o={refresh:e,params:t};A.c.index("apiRoutes.qsite.configs",o).then((function(e){n(e.data)})).catch((function(e){return l(e)}))}))},blocksBulkUpdate:function(e,t){return void 0===t&&(t=[]),new Promise((function(n,l){var o={notToSnakeCase:I(I([],t,!0),["component","entity","attributes"],!1)};A.c.update("apiRoutes.qbuilder.blocks","bulk/update",e,o).then((function(e){n(!0)})).catch((function(e){return l(e)}))}))},blocksBulkCreate:function(e,t){return void 0===t&&(t=[]),new Promise((function(n,l){var o={notToSnakeCase:I(I([],t,!0),["component","entity","attributes"],!1)};A.c.create("".concat(T("apiRoutes.qbuilder.blocks"),"/bulk/create"),e,o).then((function(e){n(!0)})).catch((function(e){return l(e)}))}))},deleteblock:function(e,t){return void 0===t&&(t={}),new Promise((function(n,l){A.c.delete("apiRoutes.qbuilder.blocks",e,t).then((function(e){n(!0)})).catch((function(e){return l(e)}))}))},updateBlock:function(e,t,n){return void 0===n&&(n={}),new Promise((function(l,o){var i=E(E({},n),{notToSnakeCase:I(I([],_.ignoreConfigKeys,!0),["component","entity","attributes"],!1)});delete t.children,A.c.update("apiRoutes.qbuilder.blocks",e,t,i).then((function(e){l(e.data)})).catch((function(e){return o(e)}))}))},layoutBlocksBulkUpdate:function(e,t){return void 0===t&&(t={}),new Promise((function(n,l){A.c.update("apiRoutes.qbuilder.layoutBlocks","bulk/update",e,t).then((function(e){n(!0)})).catch((function(e){return l(e)}))}))},deleteRelationblock:function(e,t){return void 0===t&&(t={}),new Promise((function(n,l){A.c.delete("apiRoutes.qbuilder.layoutBlocks",e,t).then((function(e){n(!0)})).catch((function(e){return l(e)}))}))}};var z=n(8932),P=function(){return P=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},P.apply(this,arguments)},L=function(e,t,n,l){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{c(l.next(e))}catch(t){i(t)}}function a(e){try{c(l["throw"](e))}catch(t){i(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((l=l.apply(e,t||[])).next())}))},W=function(e,t){var n,l,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,a[0]&&(r=0)),r)try{if(n=1,l&&(o=2&a[0]?l["return"]:a[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,a[1])).done)return o;switch(l=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,l=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],l=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},D=function(e,t,n){if(n||2===arguments.length)for(var l,o=0,i=t.length;o<i;o++)!l&&o in t||(l||(l=Array.prototype.slice.call(t,0,o)),l[o]=t[o]);return e.concat(l||Array.prototype.slice.call(t))};function N(){var e=this,t={refIframePost:(0,C.IL)(),crudLayout:(0,C.IL)(null),refLayoutList:(0,C.IL)(),refBlockList:(0,C.IL)(),handleGrid:(0,C.IL)(),refBlockForm:(0,C.IL)(),blockAttributesForm:(0,C.IL)()},n=(0,C.cB)({blocks:[],layoutTab:"builder",layoutClone:null,loading:!1,showBlocksPanel:!1,showLayoutPanel:!1,showBlockAttributesForm:!1,infoToCreateBlock:{index:0,layoutId:null,parentSystemName:null},gridBlocks:[],view:"layout"}),o={tabColor:(0,l.S6)((function(){return"preview"==n.layoutTab?"indigo-10":"orange-10"})),titleTab:(0,l.S6)((function(){var e,t,l,o=(null===(e=_.layoutSelected)||void 0===e?void 0:e.title)?"".concat(_.layoutSelected.id," | ").concat(_.layoutSelected.title):z._s.tr("ibuilder.cms.layout"),i=(null===(t=_.viewBlockSelected)||void 0===t?void 0:t.internalTitle)?"".concat(_.viewBlockSelected.id," | ").concat(null===(l=_.viewBlockSelected)||void 0===l?void 0:l.internalTitle):z._s.tr("isite.cms.label.block");return"layout"===n.view?o:i})),configHandleGrid:(0,l.S6)((function(){return{orderBy:"sortOrder",titleField:"gridLabel",canAddNewItem:!0,actions:{blockDelete:{label:z._s.tr("isite.cms.label.delete"),icon:"fa-regular fa-trash",color:"red",action:function(e){var t=n.blocks.find((function(t){return t.pivot.id===e.id}));t&&i.alertDeleteBlock(t)}},blockContent:{label:z._s.tr("ibuilder.cms.label.content"),icon:"fa-regular fa-book",action:function(e){var l,o=n.blocks.find((function(t){return t.id===e.blockId}));o&&(null===(l=t.refBlockForm.value)||void 0===l||l.updateData(o))}},blockAttriutes:{label:z._s.tr("ibuilder.cms.label.attributes"),icon:"fa-regular fa-palette",action:function(e){n.showBlockAttributesForm=!0;var l=n.blocks.find((function(t){return t.id===e.blockId}));l&&setTimeout((function(){var e,n;return null===(n=null===(e=t.blockAttributesForm)||void 0===e?void 0:e.value)||void 0===n?void 0:n.edit(l)}),500)}}}}})),dropdownActions:(0,l.S6)((function(){return{redirect:[{title:z._s.tr("isite.cms.showSite"),props:{tag:"a",href:z.is.state.qsiteApp.baseUrl,target:"_blank",id:"siteActionGoToSite"}}],editor:[{label:"Layout",value:"layout"},{label:"Block",value:"block"}]}}))},i={getConfigBlocks:function(){return L(e,void 0,void 0,(function(){var e,t,l,o,i;return W(this,(function(r){switch(r.label){case 0:n.loading=!0,e={filter:{allTranslations:!0,configNameByModule:"blocks"}},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,K.getModuleBlocks(!0,e)];case 2:return t=r.sent(),l=[],o=Object.values(t).filter((function(e){return e})),o.forEach((function(e){Object.values(e).forEach((function(e){e.systemName!==_.mainBlockSystemName&&(e.childBlocks=P({mainblock:_.mainBlockSystemName},e.childBlocks||{})),l.push(e)}))})),_.blockConfigs=l,[3,4];case 3:return i=r.sent(),console.error(i),z.Qb.error(this.$tr("isite.cms.message.errorRequest")),[3,4];case 4:return n.loading=!1,[2]}}))}))},previewPage:function(){"preview"===n.layoutTab&&setTimeout((function(){var e,l;(null===(l=null===(e=t.refIframePost)||void 0===e?void 0:e.value)||void 0===l?void 0:l.loadIframe)&&_.layoutSelected&&t.refIframePost.value.loadIframe("".concat(z.is.state.qsiteApp.baseUrl,"/api/ibuilder/v1/layout/preview/").concat(_.layoutSelected.id),P(P({},_.layoutSelected),{blocks:n.blocks}))}),300)},previewBlock:function(){setTimeout((function(){var e,n,l;(null===(n=null===(e=t.refIframePost)||void 0===e?void 0:e.value)||void 0===n?void 0:n.loadIframe)&&(null===(l=_.viewBlockSelected)||void 0===l?void 0:l.id)&&t.refIframePost.value.loadIframe("".concat(z.is.state.qsiteApp.baseUrl,"/api/ibuilder/v1/block/preview"),_.viewBlockSelected)}),300)},refreshApiData:function(e){var l,o,i,r,a=e.crudAction,c=void 0===a?"":a,s=e.emitSelected,u=void 0===s||s;return L(this,void 0,void 0,(function(){var e;return W(this,(function(a){switch(a.label){case 0:"deleted"==c&&_.resetSelecteds(),n.loading=!0,a.label=1;case 1:return a.trys.push([1,6,,7]),"layout"!=n.view?[3,3]:[4,null===(o=null===(l=t.refLayoutList)||void 0===l?void 0:l.value)||void 0===o?void 0:o.refreshLayouts({crudAction:c,emitSelected:u})];case 2:return a.sent(),[3,5];case 3:return[4,null===(r=null===(i=t.refBlockList)||void 0===i?void 0:i.value)||void 0===r?void 0:r.refreshBlocks(c)];case 4:a.sent(),a.label=5;case 5:return[3,7];case 6:return e=a.sent(),console.error(e),[3,7];case 7:return n.loading=!1,[2]}}))}))},handleLayoutSelected:function(){var e;n.blocks=(0,z.ct)((null===(e=_.layoutSelected)||void 0===e?void 0:e.blocks)||[]),i.setTheGridBlocks(),n.layoutTab="builder"},setTheGridBlocks:function(){var e,t=(0,z.ct)(null!==(e=n.blocks)&&void 0!==e?e:[]),l=_.blockConfigs.filter((function(e){return e.allowChildren})).map((function(e){return e.systemName})),o=t.map((function(e){var t,n,o=P(P({},e.pivot),{gridLabel:"".concat(e.id," | ").concat(e.internalTitle)});return l.includes(null===(t=null===e||void 0===e?void 0:e.component)||void 0===t?void 0:t.systemName)&&!(null===(n=null===e||void 0===e?void 0:e.children)||void 0===n?void 0:n.length)&&(o.children=[]),o})).sort((function(e,t){return e.sortOrder-t.sortOrder}));n.gridBlocks=z.M$.builTree(o||[],0,{parentFieldName:"parentSystemName",parentFieldValue:"systemName"})},handleCreatingBlock:function(e){var t;n.infoToCreateBlock=P(P({},n.infoToCreateBlock),{index:e?e.children.length:n.gridBlocks.length,parentSystemName:(null===e||void 0===e?void 0:e.systemName)||null,layoutId:(null===(t=_.layoutSelected)||void 0===t?void 0:t.id)||null}),n.showBlocksPanel=!0},handleChangesBlock:function(e){var t=e.block,l=void 0===t?null:t,o=e.wasDeleted,r=void 0!==o&&o,a=e.refresh,c=void 0!==a&&a,s=e.update,u=void 0!==s&&s,d=e.persistModalAttributes,f=void 0!==d&&d,m=e.crudAction,p=void 0===m?"":m,b=e.cancel,v=void 0!==b&&b;if("block"==n.view&&(r&&(_.viewBlockSelected=null),v&&setTimeout((function(){return i.previewBlock()}),500),u&&(_.viewBlockSelected=l)),l&&(u&&i.handleUpdateBlock({block:l}),(c||"block"==n.view)&&i.refreshApiData({crudAction:p,emitSelected:!1}),"layout"==n.view)){var y=n.blocks.findIndex((function(e){var t;return e.pivot.id===(null===(t=l.pivot)||void 0===t?void 0:t.id)}));y>=0?r?n.blocks.splice(y,1):n.blocks=n.blocks.map((function(e){return e.id===l.id?P(P({},l),{pivot:e.pivot}):e})):r||(n.blocks=D(D([],n.blocks,!0),[l],!1)),i.setTheGridBlocks()}n.showBlocksPanel=!1,n.showBlockAttributesForm=f},handleCreateLayout:function(e,l){var o,r,a;return void 0===l&&(l=!1),L(this,void 0,void 0,(function(){var c;return W(this,(function(s){switch(s.label){case 0:return l?[3,1]:(n.layoutClone=(0,z.ct)(e),null===(o=t.crudLayout.value)||void 0===o||o.create(e),[3,3]);case 1:return n.showLayoutPanel=!1,n.loading=!0,c=(0,z.ct)(null!==(a=null===(r=n.layoutClone)||void 0===r?void 0:r.blocks)&&void 0!==a?a:[]),c.forEach((function(t){var n,l=(0,z.cB)();c.forEach((function(n){var o,i;n.layouts=n.layouts||{},n.layouts[e.id]=n.layouts[e.id]||{},(null===(o=n.pivot)||void 0===o?void 0:o.parentSystemName)===(null===(i=t.pivot)||void 0===i?void 0:i.systemName)&&(n.layouts[e.id].parentSystemName=l)})),t.entity={},t.systemName=(0,z.cB)(),delete t.id,t.layouts=t.layouts||{},t.layouts[e.id]=P(P({},null!==(n=t.layouts[e.id])&&void 0!==n?n:{}),{systemName:l,gridPosition:t.pivot.gridPosition,sortOrder:t.pivot.sortOrder})})),[4,K.blocksBulkCreate(c,_.ignoreConfigKeys).then((function(e){z.Qb.info({message:z._s.tr("isite.cms.message.recordUpdated")}),i.refreshApiData({crudAction:"created"})})).catch((function(e){z.Qb.error({message:z._s.tr("isite.cms.message.recordNoUpdated")}),n.loading=!1}))];case 2:s.sent(),s.label=3;case 3:return[2]}}))}))},savePivotBlocks:function(){return L(this,void 0,void 0,(function(){var e;return W(this,(function(t){switch(t.label){case 0:return n.loading=!0,e=n.blocks.map((function(e){return P({},e.pivot)})),[4,K.layoutBlocksBulkUpdate(e).then((function(e){z.Qb.info({message:z._s.tr("isite.cms.message.recordUpdated")}),i.refreshApiData({}),n.loading=!1})).catch((function(e){z.Qb.error({message:z._s.tr("isite.cms.message.recordNoUpdated")}),n.loading=!1}))];case 1:return t.sent(),[2]}}))}))},handleUpdateBlock:function(e){var t=e.block,l=e.params,o=void 0===l?{}:l;return L(this,void 0,void 0,(function(){return W(this,(function(e){switch(e.label){case 0:return[4,K.updateBlock(t.id,t,o).then((function(e){n.loading=!1,z.Qb.info({message:z._s.tr("isite.cms.message.recordUpdated")})})).catch((function(e){n.loading=!1,z.Qb.error({message:z._s.tr("isite.cms.message.recordNoUpdated")})}))];case 1:return e.sent(),[2]}}))}))},deleteBlock:function(e){return L(this,void 0,void 0,(function(){return W(this,(function(t){switch(t.label){case 0:return n.loading=!0,"layout"!==n.view?[3,2]:[4,K.deleteRelationblock(e.pivot.id)];case 1:return t.sent(),[3,4];case 2:return[4,K.deleteblock(e.id)];case 3:t.sent(),t.label=4;case 4:return i.handleChangesBlock({block:e,wasDeleted:!0,refresh:!0}),[2]}}))}))},handleDeleteLayout:function(e){var n;return L(this,void 0,void 0,(function(){return W(this,(function(l){return null===(n=t.crudLayout.value)||void 0===n||n.delete(e),[2]}))}))},goHome:function(){var e=z.us.resolve({name:"app.home"});window.open(e.href,"_blank")},openBlockPanel:function(){n.infoToCreateBlock={index:0,layoutId:null,parentSystemName:null},setTimeout((function(){return n.showBlocksPanel=!0}),100)},handleActionsBlock:function(e){"updateAttr"==e?(n.showBlockAttributesForm=!0,setTimeout((function(){var e,n;return null===(n=null===(e=t.blockAttributesForm)||void 0===e?void 0:e.value)||void 0===n?void 0:n.edit(_.viewBlockSelected)}),500)):"delete"==e&&i.alertDeleteBlock(_.viewBlockSelected)},alertDeleteBlock:function(e){var t,n;z.Qb.error({mode:"modal",title:null!==(t=e.internalTitle)&&void 0!==t?t:"".concat(e.id," | Block ID: ").concat(null!==(n=e.blockId)&&void 0!==n?n:""),message:z._s.tr("isite.cms.message.deleteRecord"),actions:[{label:z._s.tr("isite.cms.label.cancel"),color:"grey-8"},{label:z._s.tr("isite.cms.label.accept"),color:"green",handler:function(){return i.deleteBlock(e)}}]})}};return(0,l.u2)((function(){i.getConfigBlocks()})),(0,l.wx)((function(){_.resetSelecteds()})),(0,l.Kg)((function(){return n.gridBlocks}),(function(e,t){var l=z.M$.destroyNestedItems((0,z.ct)(e),null,{parentFieldName:"parentSystemName",parentFieldValue:"systemName"}),o=[];l.forEach((function(e){var t=n.blocks.find((function(t){return t.pivot.id==e.id}));t&&(t.pivot=P(P({},t.pivot),e),o.push(t))})),n.blocks=o}),{deep:!0}),(0,l.Kg)((function(){return n.view}),(function(e,t){_.resetSelecteds()})),P(P(P(P(P({},t),(0,C.kx)(n)),o),i),{store:_})}const O={key:0,id:"iframePostcomponent",class:"relative-position"},F=["id"],V=["action"],j=["innerHTML"];function $(e,t,n,o,i,r){const a=(0,l.E1)("inner-loading");return e.actionUrl?((0,l.Wz)(),(0,l.An)("div",O,[(0,l.QD)("iframe",{id:e.id,name:"post-iframe",frameborder:"0",onLoad:t[0]||(t[0]=(...t)=>e.handleIframeLoad&&e.handleIframeLoad(...t))},null,40,F),(0,l.QD)("form",{name:"formPostIframe",id:"formPostIframe",method:"post",target:"post-iframe",action:e.actionUrl},[((0,l.Wz)(!0),(0,l.An)(l.ae,null,(0,l.mi)(e.inputsForm,(e=>((0,l.Wz)(),(0,l.An)("div",{innerHTML:e.outerHTML},null,8,j)))),256))],8,V),(0,l.K2)(a,{visible:e.loading},null,8,["visible"])])):(0,l.g1)("",!0)}var U=function(){return U=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},U.apply(this,arguments)};function M(e,t){var n={},o=(0,C.cB)({loading:!1,count:0,actionUrl:null,inputsForm:[]}),i={},r={loadIframe:function(e,t){o.loading=!0,o.actionUrl=(0,z.ct)(e);var n=[];Object.keys(t).forEach((function(e){var l=document.createElement("input");l.name=e,l.value=JSON.stringify(t[e]),l.type="hidden",n.push(l)})),o.inputsForm=n,(0,l.o$)((function(){var e=Object.getPrototypeOf(document.forms["formPostIframe"]).submit;e.call(document.forms["formPostIframe"])}))},handleIframeLoad:function(){o.count+=1,2===o.count&&(o.loading=!1,o.count=1)}};return(0,l.u2)((function(){window.addEventListener("message",(function(e){var t=e.data,n=t.elementId,l=document.getElementById(n);l&&(l.style.height="".concat(t.clientHeight,"px"))}))})),U(U(U(U({},n),(0,C.kx)(o)),i),r)}const R=(0,l._M)({props:{id:{type:String,default:""}},components:{},setup(){return{...M()}}});var G=n(68716);const Y=(0,G.c)(R,[["render",$]]),H=Y,J={id:"builderPanelLayouts",class:"drawer-body relative-position"},X={class:"flex q-gutter-xs justify-between"},Z={class:"text-center text-weight-bold"};function ee(e,t,n,i,r,a){const c=(0,l.E1)("q-icon"),s=(0,l.E1)("q-btn"),u=(0,l.E1)("q-separator"),d=(0,l.E1)("recursive-item"),f=(0,l.E1)("inner-loading");return(0,l.Wz)(),(0,l.An)("div",J,[(0,l.QD)("div",X,[(0,l.K2)(s,{onClick:t[0]||(t[0]=t=>e.$emit("create")),outline:"",rounded:"",class:"q-mb-sm text-capitalize",color:"primary","no-caps":""},{default:(0,l.Ql)((()=>[(0,l.K2)(c,{size:"xs",left:"",name:"fa-solid fa-plus"}),(0,l.QD)("div",Z,(0,o.WA)(e.$tr("ibuilder.cms.newLayout")),1)])),_:1}),(0,l.K2)(s,{onClick:e.handleRefresh,outline:"",rounded:"",class:"q-mb-sm",size:"sm",color:"primary","no-caps":"",icon:"fa-light fa-rotate-right"},null,8,["onClick"])]),(0,l.K2)(u,{spaced:""}),(0,l.K2)(d,{id:"recursiveItemContent",translatable:!1,menu:e.mapLayouts,"right-icon":""},null,8,["menu"]),(0,l.K2)(f,{visible:e.loading},null,8,["visible"])])}var te=function(){return te=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},te.apply(this,arguments)};const ne={getLayouts:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t={}),new Promise((function(n,l){var o={refresh:e,params:t};A.c.index("apiRoutes.qbuilder.layouts",o).then((function(e){n(te(te({},e),{data:e.data.sort((function(e,t){return t.id-e.id})).map((function(e){return te(te({},e),{blocks:e.blocks.map((function(e){return te(te({},e),{entity:Array.isArray(e.entity)?{}:e.entity,attributes:Array.isArray(e.attributes)?{}:e.attributes})}))})}))}))})).catch((function(e){return l(e)}))}))}};var le=(0,C.cB)({itemSelected:{}});const oe=(0,l.S6)((function(){return{get itemSelected(){return le.itemSelected},set itemSelected(e){le.itemSelected=e}}})).value;var ie=function(){return ie=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ie.apply(this,arguments)},re=function(e,t,n,l){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{c(l.next(e))}catch(t){i(t)}}function a(e){try{c(l["throw"](e))}catch(t){i(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((l=l.apply(e,t||[])).next())}))},ae=function(e,t){var n,l,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,a[0]&&(r=0)),r)try{if(n=1,l&&(o=2&a[0]?l["return"]:a[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,a[1])).done)return o;switch(l=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,l=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],l=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function ce(e,t){var n={},o=(0,C.cB)({layouts:[],mapLayouts:[],loading:!1}),i={},r={getLayouts:function(){return o.loading=!0,new Promise((function(e){var t={filter:{allTranslations:!0},include:"blocks.fields"};ne.getLayouts(!0,t).then((function(t){o.layouts=t.data,o.mapLayouts=r.orderedItems(),o.loading=!1,e(!1)})).catch((function(t){o.loading=!1,e(!1)}))}))},refreshLayouts:function(e){var n=e.crudAction,l=void 0===n?"":n,i=e.emitSelected,a=void 0===i||i;return re(this,void 0,void 0,(function(){var e,n;return ae(this,(function(i){switch(i.label){case 0:return t("refresh",!0),[4,r.getLayouts()];case 1:return i.sent(),"created"==l?(e=o.layouts[0],oe.itemSelected=e,_.layoutSelected=e,t("selected",(0,z.ct)(e))):_.layoutSelected&&_.layoutSelected.id&&(n=o.layouts.find((function(e){var t;return e.id===(null===(t=_.layoutSelected)||void 0===t?void 0:t.id)})),a&&n&&(_.layoutSelected=(0,z.ct)(n),t("selected",(0,z.ct)(n)))),t("refresh",!1),[2]}}))}))},builderConfig:function(){var e=z.is.getters["qsiteApp/getConfigApp"]("builder.layout",!0),t={};return Object.keys(e).forEach((function(n){e[n]&&(t[n]=e[n])})),t},orderedItems:function(){var e=r.builderConfig(),t=[];return Object.keys(e).forEach((function(n){e[n].forEach((function(e){var l=o.layouts.filter((function(t){return t.entityType==e.entity.value})),i=l.map((function(e){var t,n;return ie(ie({},e),{type:null!==(t=e.type)&&void 0!==t?t:"General",label:"".concat(e.id," | ").concat(e.title," ").concat(e.default?"(Default)":""),subLabel:"".concat(null!==(n=e.type)&&void 0!==n?n:"General"),activated:!0,icon:"fa-light fa-arrow-right",action:r.selectLayout})}));t.push({label:"".concat(e.entity.label," (").concat(n,")"),headerClass:"expansion-header",customClass:"expansion-border",children:i.sort((function(e,t){return e.type.localeCompare(t.type)}))})}))})),t},selectLayout:function(e){return new Promise((function(n){var l=function(){var l=o.layouts.find((function(t){return t.id===e.id}));if(!l)return n(!0);_.layoutSelected=(0,z.ct)(l),t("selected",(0,z.ct)(l)),n(!0)};_.layoutSelected?_.layoutSelected.id!==e.id&&z.Qb.warning({mode:"modal",title:z._s.tr("ibuilder.cms.label.sureChangeLayout"),message:z._s.tr("ibuilder.cms.label.descriptionSureChangeLayout"),actions:[{label:z._s.tr("isite.cms.label.cancel"),color:"grey-8",handler:function(){return n(!1)}},{label:z._s.tr("isite.cms.label.accept"),color:"green",handler:l}]}):l()}))},handleRefresh:function(){_.layoutSelected?z.Qb.warning({mode:"modal",title:z._s.tr("ibuilder.cms.label.sureRefreshLayout"),message:z._s.tr("ibuilder.cms.label.descriptionSureRefreshLayout"),actions:[{label:z._s.tr("isite.cms.label.cancel"),color:"grey-8"},{label:z._s.tr("isite.cms.label.accept"),color:"green",handler:function(){return r.refreshLayouts({})}}]}):r.refreshLayouts({})}};return(0,l.u2)((function(){r.getLayouts()})),ie(ie(ie(ie({},n),(0,C.kx)(o)),i),r)}var se=n(264);const ue={id:"listMenu"};function de(e,t,n,i,r,a){const c=(0,l.E1)("q-tooltip"),s=(0,l.E1)("q-icon"),u=(0,l.E1)("q-item-section"),d=(0,l.E1)("q-item-label"),f=(0,l.E1)("q-item"),m=(0,l.E1)("recursive-menu"),p=(0,l.E1)("q-expansion-item"),b=(0,l.E1)("q-no-ssr");return(0,l.wt)(((0,l.Wz)(),(0,l.An)("div",null,[(0,l.QD)("div",ue,[((0,l.Wz)(!0),(0,l.An)(l.ae,null,(0,l.mi)(e.menuData,((t,i)=>((0,l.Wz)(),(0,l.Az)(b,{key:i,class:(0,o.WN)(`content-item ${n.inLine?"inline-block":""} ${n.showSelected?"select-items":""}`)},{default:(0,l.Ql)((()=>[n.withTooltip?((0,l.Wz)(),(0,l.Az)(c,(0,o.Gk)((0,l.Gu)({key:0},n.tooltipProps||{})),{default:(0,l.Ql)((()=>[(0,l.mY)((0,o.WA)(n.translatable?e.$tr(t.label):t.label),1)])),_:2},1040)):(0,l.g1)("",!0),void 0==t?.itemProps?.vIf||t?.itemProps?.vIf?((0,l.Wz)(),(0,l.Az)(f,(0,l.Gu)({key:1,id:`menuItem-${e.parseIdItem(t.name||i)}`},t.itemProps,{onClick:n=>e.selectItem(t)}),{default:(0,l.Ql)((()=>[t.icon&&n.showIcons?((0,l.Wz)(),(0,l.Az)(u,{key:0,avatar:""},{default:(0,l.Ql)((()=>[(0,l.K2)(s,{name:t.icon},null,8,["name"])])),_:2},1024)):(0,l.g1)("",!0),(0,l.K2)(u,{class:"text-capitalize"},{default:(0,l.Ql)((()=>[(0,l.K2)(d,null,{default:(0,l.Ql)((()=>[(0,l.mY)((0,o.WA)(n.translatable?e.$tr(t.label):t.label),1)])),_:2},1024),(0,l.K2)(d,{caption:"",lines:"2"},{default:(0,l.Ql)((()=>[(0,l.mY)((0,o.WA)(n.translatable?e.$tr(t.subLabel):t.subLabel),1)])),_:2},1024)])),_:2},1024)])),_:2},1040,["id","onClick"])):e.checkItemMultiple(t)?((0,l.Wz)(),(0,l.Az)(p,(0,l.Gu)({icon:t.icon,key:i,label:n.translatable?e.$tr(t.label):t.label},n.group?{group:e.listUid}:{},{"header-class":`${t.headerClass} ${e.selectedChildren(t)}`,"default-opened":!!e.selectedChildren(t),class:`${t.customClass} ${e.selectedChildren(t)?"expansion-selected":""}`}),{default:(0,l.Ql)((()=>[((0,l.Wz)(),(0,l.Az)(m,{translatable:n.translatable,"show-icons":n.showIcons,key:i,menu:t.children,group:n.group,"right-icon":n.rightIcon},null,8,["translatable","show-icons","menu","group","right-icon"]))])),_:2},1040,["icon","label","header-class","default-opened","class"])):(0,l.g1)("",!0)])),_:2},1032,["class"])))),128))])],512)),[[se.Ub,e.showMenu]])}var fe=function(){return fe=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},fe.apply(this,arguments)},me=function(e,t,n,l){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{c(l.next(e))}catch(t){i(t)}}function a(e){try{c(l["throw"](e))}catch(t){i(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((l=l.apply(e,t||[])).next())}))},pe=function(e,t){var n,l,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,a[0]&&(r=0)),r)try{if(n=1,l&&(o=2&a[0]?l["return"]:a[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,a[1])).done)return o;switch(l=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,l=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],l=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function be(e,t){var n={},o=(0,C.cB)({showMenu:!1,listUid:(0,z.cB)().toString(),props:{}}),i={menuData:(0,l.S6)((function(){var t=e.menu.map((function(e){return e.itemProps={class:r.getClassItem(e),tag:"div",key:(0,z.cB)(),vIf:r.checkItemSingle(e),clickable:!0},e.action||(e.itemProps.tag="a",e.toRoute?e.itemProps.href=e.toRoute:e.itemProps.to={name:e.name,params:e.params||{}}),e}));return t}))},r={init:function(){o.props=(0,z.ct)(e),setTimeout((function(){r.checkCollapsibles(),o.showMenu=!0}),300)},parseIdItem:function(e){return Number.isInteger(e)?e:e.replaceAll(".","")},checkItemSingle:function(e){var t,n=!0;return e.activated||(n=!1),e.children&&(n=!1),e.name||(n=!1),e.permission&&!z.is.hasAccess(e.permission)&&(n=!1),!(null===(t=e.children)||void 0===t?void 0:t.length)&&e.action&&(n=!0),n},checkItemMultiple:function(e){var t=!0;return!!(e.children&&e.children.length&&e.action)||(e.children||(t=!1),e.children&&!e.children.length&&(t=!1),e.permission&&!z.is.hasAccess(e.permission)&&(t=!1),t)},checkCollapsibles:function(){for(var e=document.getElementsByClassName("q-expansion-item"),t=0,n=e;t<n.length;t++){var l=n[t],o=l.getElementsByClassName("single-item");o.length||(l.style.display="none")}},redirectTo:function(e){e.linkType&&"external"==e.linkType?window.open("https://".concat(e.url),e.target):e.name&&z.us.push({name:e.name,params:e.params||{}})},selectedChildren:function(e){var t="",n=function(e){var t,l=z.us.route.name,o=!1;return e&&e.forEach((function(e){e.name==l&&(o=!0),e.children&&n(e.children)&&(o=!0)})),e&&(null===(t=oe.itemSelected)||void 0===t?void 0:t.id)&&e.forEach((function(e){var t;e.id==(null===(t=oe.itemSelected)||void 0===t?void 0:t.id)&&(o=!0)})),o};return e.children&&n(e.children)&&(t=" item-is-active"),t},getClassItem:function(t){var n,l="single-item";return e.rightIcon&&(l+=" row reverse"),(null===(n=oe.itemSelected)||void 0===n?void 0:n.id)&&t.id===oe.itemSelected.id&&(l+=" item-is-active"),z.us.route.name==t.name&&JSON.stringify(z.us.route.params)==JSON.stringify(t.params||{})&&(l+=" item-is-active"),l},selectItem:function(e){return me(this,void 0,void 0,(function(){var t;return pe(this,(function(n){switch(n.label){case 0:return e.action?[4,e.action(e)]:[3,2];case 1:t=n.sent(),t&&(oe.itemSelected=e),n.label=2;case 2:return[2]}}))}))}};return(0,l.Kg)((function(){return e.menu}),(function(){r.init()})),(0,l.u2)((function(){(0,l.o$)((function(){r.init()}))})),(0,l.wx)((function(){oe.itemSelected={}})),fe(fe(fe(fe(fe({},n),(0,C.kx)(o)),i),r),{store:oe})}const ve={name:"recursiveMenu",components:{},props:{withTooltip:{type:Boolean,default:!1},menu:{type:Array,default:()=>[]},showIcons:{type:Boolean,default:!0},translatable:{type:Boolean,default:!0},inLine:{type:Boolean,default:!1},group:{type:Boolean,defualt:!1},tooltipProps:{type:Object,default:null},rightIcon:{type:Boolean,default:!1},showSelected:{type:Boolean,default:!0}},setup(e,{emit:t}){return be(e,t)}};var ye=n(68092),he=n(90111),ge=n(84884),ke=n(11032),we=n(58120),Be=n(2992),Se=n(61656),Qe=n(95252),Ce=n.n(Qe);const Ae=(0,G.c)(ve,[["render",de]]),xe=Ae;Ce()(ve,"components",{QNoSsr:ye.c,QTooltip:he.c,QItem:ge.c,QItemSection:ke.c,QIcon:we.c,QItemLabel:Be.c,QExpansionItem:Se.c});const qe=(0,l._M)({props:{},components:{recursiveItem:xe},emits:["refresh","selected","create"],setup(e,{emit:t}){return ce(e,t)}});var _e=n(99140),Te=n(70880),Ee=n(93832),Ie=n(99588);const Ke=(0,G.c)(qe,[["render",ee]]),ze=Ke;Ce()(qe,"components",{QBtn:_e.c,QIcon:we.c,QSeparator:Te.c,QExpansionItem:Se.c,QItem:ge.c,QMenu:Ee.c,QList:Ie.c});var Pe={id:"builderBlockPanel",class:"bg-white relative-position"},Le={class:"drawer-title q-py-md q-px-md"},We={class:"text-center text-subtitle1 text-weight-bold"},De={key:0,class:"row"},Ne={class:"col-5"},Oe=(0,l.QD)("div",{class:"title-tabs"},null,-1),Fe={class:"selection-item ellipsis row justify-between"},Ve={class:"col-7"},je=["src","alt"],$e={class:"ellipsis-2-lines full-width title-item q-py-xs"},Ue={class:"flex q-mt-sm q-px-lg"},Me={class:"text-center text-weight-bold"},Re=["src","alt"],Ge={class:"ellipsis-2-lines full-width title-item q-py-xs"};function Ye(e,t,n,i,r,a){var c=(0,l.E1)("q-icon"),s=(0,l.E1)("q-tab"),u=(0,l.E1)("q-tabs"),d=(0,l.E1)("q-separator"),f=(0,l.E1)("not-result"),m=(0,l.E1)("q-item-section"),p=(0,l.E1)("q-item"),b=(0,l.E1)("q-tab-panel"),v=(0,l.E1)("q-btn"),y=(0,l.E1)("q-list"),h=(0,l.E1)("q-menu"),g=(0,l.E1)("q-tab-panels"),k=(0,l.E1)("block-form"),w=(0,l.E1)("inner-loading"),B=(0,l.iS)("ripple"),S=(0,l.iS)("close-popup");return(0,l.Wz)(),(0,l.An)("div",Pe,[(0,l.QD)("div",Le,[(0,l.QD)("h2",We,(0,o.WA)(e.$tr("ibuilder.cms.label.blocks")),1)]),e.loading?(0,l.g1)("",!0):((0,l.Wz)(),(0,l.An)("div",De,[(0,l.QD)("div",Ne,[Oe,(0,l.K2)(u,{modelValue:e.blockTypeSelected,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.blockTypeSelected=t}),vertical:"","active-bg-color":"primary","inline-label":"","active-class":"selected-item","active-color":"white","indicator-color":"primary",class:"scroll-content border-tab","content-class":"alternating-colors"},{default:(0,l.Ql)((function(){return[((0,l.Wz)(!0),(0,l.An)(l.ae,null,(0,l.mi)(e.blockTypes,(function(e,t){return(0,l.Wz)(),(0,l.Az)(s,{key:t,name:e.systemName,"content-class":"custom-position","no-caps":""},{default:(0,l.Ql)((function(){return[(0,l.QD)("div",Fe,[(0,l.mY)((0,o.WA)(e.title)+" ",1),(0,l.K2)(c,{name:"fa-light fa-arrow-right",class:"q-mr-xs",size:"16px",color:"blue-grey"})])]})),_:2},1032,["name"])})),128))]})),_:1},8,["modelValue"])]),(0,l.QD)("div",Ve,[(0,l.K2)(u,{modelValue:e.blockTypeTab,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.blockTypeTab=t}),align:"right","inline-label":"","no-caps":"","indicator-color":"transparent","active-bg-color":e.tabColor,"active-color":"white","content-class":"text-".concat(e.tabColor," bg-grey-2")},{default:(0,l.Ql)((function(){return[(0,l.K2)(s,{name:"global",label:e.$tr("ibuilder.cms.label.libraryBlocks")},null,8,["label"]),(0,l.K2)(s,{name:"local",label:e.$tr("ibuilder.cms.label.localBlocks")},null,8,["label"])]})),_:1},8,["modelValue","active-bg-color","content-class"]),(0,l.K2)(d,{color:e.tabColor,size:"2px"},null,8,["color"]),(0,l.K2)(g,{modelValue:e.blockTypeTab,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.blockTypeTab=t}),animated:"","transition-prev":"scale","transition-next":"scale",class:"scroll-content"},{default:(0,l.Ql)((function(){return[(0,l.K2)(b,{name:"global",class:(0,o.WN)("q-pa-none ".concat(e.blocksBySelectedType.library.length?"":"overflow-hidden"))},{default:(0,l.Ql)((function(){return[e.blocksBySelectedType.library.length?((0,l.Wz)(!0),(0,l.An)(l.ae,{key:1},(0,l.mi)(e.blocksBySelectedType.library,(function(t,n){return(0,l.wt)(((0,l.Wz)(),(0,l.Az)(p,{key:"libraryKey".concat(n),clickable:"",class:"bg-trans-item",onClick:function(n){return e.selectBlock(t)}},{default:(0,l.Ql)((function(){return[(0,l.K2)(m,{class:"relative-position q-ma-sm image-section selectable"},{default:(0,l.Ql)((function(){return[(0,l.QD)("img",{src:t.mediaFiles.internalimage.url,alt:t.internalTitle},null,8,je),(0,l.QD)("span",$e,(0,o.WA)(t.internalTitle),1)]})),_:2},1024)]})),_:2},1032,["onClick"])),[[B]])})),128)):((0,l.Wz)(),(0,l.Az)(f,{key:0,class:"q-mt-xl"}))]})),_:1},8,["class"]),(0,l.K2)(b,{name:"local",class:(0,o.WN)("q-pa-none ".concat(e.blocksBySelectedType.local.length?"":"overflow-hidden"))},{default:(0,l.Ql)((function(){return[(0,l.QD)("div",Ue,[(0,l.K2)(v,{onClick:t[2]||(t[2]=function(t){return e.selectBlock(e.blockDefault)}),outline:"",rounded:"",class:"full-width q-mx-sm text-capitalize",color:"primary","no-caps":""},{default:(0,l.Ql)((function(){return[(0,l.K2)(c,{size:"xs",left:"",name:"fa-solid fa-plus"}),(0,l.QD)("div",Me,(0,o.WA)(e.$tr("ibuilder.cms.newBlock")),1)]})),_:1})]),e.blocksBySelectedType.local.length?((0,l.Wz)(!0),(0,l.An)(l.ae,{key:1},(0,l.mi)(e.blocksBySelectedType.local,(function(t,n){return(0,l.wt)(((0,l.Wz)(),(0,l.Az)(p,{key:"localKey".concat(n),clickable:!e.layoutId,onClick:function(n){return e.selectBlock(t)},class:"bg-trans-item"},{default:(0,l.Ql)((function(){return[(0,l.K2)(m,{class:"relative-position q-ma-sm image-section selectable"},{default:(0,l.Ql)((function(){return[(0,l.QD)("img",{src:t.mediaFiles.internalimage.url,alt:t.internalTitle},null,8,Re),(0,l.QD)("span",Ge,(0,o.WA)(t.internalTitle),1),e.layoutId?((0,l.Wz)(),(0,l.Az)(h,{key:0,anchor:"top right",self:"top end"},{default:(0,l.Ql)((function(){return[(0,l.K2)(y,{style:{"min-width":"100px"},dense:"",bordered:""},{default:(0,l.Ql)((function(){return[(0,l.wt)(((0,l.Wz)(),(0,l.Az)(p,{clickable:"",onClick:function(n){return e.selectBlock(t)},class:"row items-center"},{default:(0,l.Ql)((function(){return[(0,l.K2)(c,{name:"fa-light fa-clone",class:"q-mr-sm",color:"teal"}),(0,l.mY)(" "+(0,o.WA)(e.$tr("ibuilder.cms.label.clone")),1)]})),_:2},1032,["onClick"])),[[S]]),(0,l.wt)(((0,l.Wz)(),(0,l.Az)(p,{clickable:"",onClick:function(n){return e.relateBlock(t)},class:"row items-center"},{default:(0,l.Ql)((function(){return[(0,l.K2)(c,{name:"fa-light fa-link",class:"q-mr-sm",color:"indigo"}),(0,l.mY)(" "+(0,o.WA)(e.$tr("ibuilder.cms.label.relate")),1)]})),_:2},1032,["onClick"])),[[S]])]})),_:2},1024)]})),_:2},1024)):(0,l.g1)("",!0)]})),_:2},1024)]})),_:2},1032,["clickable","onClick"])),[[B]])})),128)):((0,l.Wz)(),(0,l.Az)(f,{key:0,class:"q-mt-xl"}))]})),_:1},8,["class"])]})),_:1},8,["modelValue"])])])),(0,l.K2)(k,{ref:"refBlockForm",onCreated:e.emitCreated},null,8,["onCreated"]),(0,l.K2)(w,{visible:e.loading},null,8,["visible"])])}var He=n(16728),Je=n(18528)["c"],Xe=function(){return Xe=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Xe.apply(this,arguments)};const Ze={getLocalBlocks:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t={}),new Promise((function(n,l){var o={refresh:e,params:Xe({filter:{allTranslations:!0},include:"fields,files"},t)};A.c.index("apiRoutes.qbuilder.blocks",o).then((function(e){var t=e.data.map((function(e){return Xe(Xe({},e),{entity:Array.isArray(e.entity)?{}:e.entity,attributes:Array.isArray(e.attributes)?{}:e.attributes})}));n(t)})).catch((function(e){return l(e)}))}))},getBlockLibrary:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t={}),new Promise((function(e,n){var l=z.is.getSetting("ibuilder::blockTemplatesUrl");if(!l)return e([]);var o={params:Xe({filter:{allTranslations:!0},include:"fields,files"},t)};He.c.get("".concat(l,"/api").concat(Je("apiRoutes.qbuilder.blocks")),o).then((function(t){e(t.data.data)})).catch((function(e){return n(e)}))}))},createLayoutBlock:function(e,t){return void 0===t&&(t={}),new Promise((function(n,l){var o=Xe({},t);A.c.create("apiRoutes.qbuilder.layoutBlocks",e,o).then((function(e){n(e.data)})).catch((function(e){return l(e)}))}))}};var et=function(){return et=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},et.apply(this,arguments)},tt=function(e,t,n,l){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{c(l.next(e))}catch(t){i(t)}}function a(e){try{c(l["throw"](e))}catch(t){i(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((l=l.apply(e,t||[])).next())}))},nt=function(e,t){var n,l,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,a[0]&&(r=0)),r)try{if(n=1,l&&(o=2&a[0]?l["return"]:a[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,a[1])).done)return o;switch(l=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,l=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],l=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function lt(e,t){var n=this,o={refBlockForm:(0,C.IL)()},i=(0,C.cB)({localBlocks:[],blockLibrary:[],blockTypeSelected:null,blockSelected:null,blockTypeTab:"global",loading:!1}),r={blockTypes:(0,l.S6)((function(){var e=_.blockConfigs.filter((function(e){return!e.internal}));return e})),blocksBySelectedType:(0,l.S6)((function(){return{local:i.localBlocks.filter((function(e){return e.component.systemName==i.blockTypeSelected})),library:i.blockLibrary.filter((function(e){return e.component.systemName==i.blockTypeSelected}))}})),tabColor:(0,l.S6)((function(){return"global"==i.blockTypeTab?"purple":"orange"})),blockDefault:(0,l.S6)((function(){if(!i.blockTypeSelected)return{};var e=_.blockConfigs.find((function(e){return e.systemName===i.blockTypeSelected}));return e?{component:{nameSpace:e.nameSpace,systemName:i.blockTypeSelected}}:{}}))},a={getData:function(){return tt(n,void 0,void 0,(function(){return nt(this,(function(e){switch(e.label){case 0:return i.loading=!0,[4,Promise.all([a.getLocalBlocks(),a.getBlockLibrary()])];case 1:return e.sent(),i.blockTypeSelected=r.blockTypes.value[0].systemName,i.loading=!1,[2]}}))}))},getLocalBlocks:function(){return tt(n,void 0,void 0,(function(){var e;return nt(this,(function(t){switch(t.label){case 0:return[4,Ze.getLocalBlocks(!0)];case 1:return e=t.sent(),i.localBlocks=e,[2]}}))}))},getBlockLibrary:function(){return tt(n,void 0,void 0,(function(){var e;return nt(this,(function(t){switch(t.label){case 0:return[4,Ze.getBlockLibrary(!0)];case 1:return e=t.sent(),i.blockLibrary=e,[2]}}))}))},selectBlock:function(t){var n,l;i.blockSelected=t,null===(l=null===(n=o.refBlockForm)||void 0===n?void 0:n.value)||void 0===l||l.fillData(t,e)},relateBlock:function(t){i.loading=!0;var n={layoutId:e.layoutId,blockId:t.id,sortOrder:e.index,systemName:(0,z.cB)(),parentSystemName:e.parentSystemName,gridPosition:"col-12"};Ze.createLayoutBlock(n).then((function(e){i.loading=!1,t.pivot=et({id:e.id},n),a.emitCreated(et({},t))})).catch((function(e){return i.loading=!1}))},emitCreated:function(e){i.blockSelected=null,t("created",e)}};return(0,l.u2)((function(){a.getData()})),et(et(et(et({},o),(0,C.kx)(i)),r),a)}function ot(e,t,n,o,i,r){var a=(0,l.E1)("dynamic-form"),c=(0,l.E1)("master-modal");return(0,l.Wz)(),(0,l.Az)(c,{modelValue:e.showModal,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.showModal=t}),title:"".concat(e.$tr("ibuilder.cms.label.blockContent")," ").concat(e.idBlock?"- ID: ".concat(e.idBlock):""),"custom-position":"",modalWidthSize:"650px",actions:e.modalActions,loading:e.loading},{default:(0,l.Ql)((function(){return[(0,l.K2)(a,{modelValue:e.formBlock,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.formBlock=t}),formType:"grid",blocks:e.formFields,onSubmit:e.submitData,"no-actions":"",ref:"refForm","no-reset-with-blocks-update":""},null,8,["modelValue","blocks","onSubmit"])]})),_:1},8,["modelValue","title","actions","loading"])}var it=function(){return it=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},it.apply(this,arguments)};const rt={createBlock:function(e,t){return void 0===t&&(t={}),new Promise((function(n,l){var o=it({},t);A.c.create("apiRoutes.qbuilder.blocks",e,o).then((function(e){n(e.data)})).catch((function(e){return l(e)}))}))}};var at=function(){return at=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},at.apply(this,arguments)},ct=function(e,t,n,l){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{c(l.next(e))}catch(t){i(t)}}function a(e){try{c(l["throw"](e))}catch(t){i(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((l=l.apply(e,t||[])).next())}))},st=function(e,t){var n,l,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,a[0]&&(r=0)),r)try{if(n=1,l&&(o=2&a[0]?l["return"]:a[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,a[1])).done)return o;switch(l=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,l=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],l=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},ut=function(e,t,n){if(n||2===arguments.length)for(var l,o=0,i=t.length;o<i;o++)!l&&o in t||(l||(l=Array.prototype.slice.call(t,0,o)),l[o]=t[o]);return e.concat(l||Array.prototype.slice.call(t))};function dt(e,t){var n={refForm:(0,C.IL)()},o=(0,C.cB)({block:{},idBlock:null,indexBlock:1,layoutId:null,parentSystemName:null,showModal:!1,formBlock:null,configBlock:{},languageOptions:z.is.getters["qsiteApp/getSelectedLocalesSelect"],loading:!1}),i={formFields:(0,l.S6)((function(){var e,t=[{name:"main",title:z._s.tr("ibuilder.cms.label.system"),fields:{internalTitle:{isTranslatable:!0,type:"input",required:!0,colClass:"col-12",props:{label:z._s.tr("isite.cms.form.title")+"*",rules:[function(e){return!!e||z._s.tr("isite.cms.message.fieldRequired")}]}},status:{value:"1",type:"select",colClass:"col-6",required:!0,props:{label:"".concat(z._s.tr("isite.cms.form.status")," *"),options:[{label:z._s.tr("isite.cms.label.enabled"),value:"1"},{label:z._s.tr("isite.cms.label.disabled"),value:"0"}]}},systemName:{type:"select",required:!0,fakeFieldName:"component",colClass:"col-6",props:{label:z._s.tr("isite.cms.label.block")+"*",options:Object.values(_.blockConfigs).filter((function(e){return!e.internal})).map((function(e){return{label:e.title,value:e.systemName}})),readonly:!0}},mediasSingle:{value:{},type:"media",colClass:"col-12",fieldItemId:o.idBlock||null,props:{label:z._s.tr("isite.cms.message.preview"),zone:"internalimage",entity:"Modules\\Ibuilder\\Entities\\Block",entityId:null}}}}],n=o.configBlock||{};return(null===(e=n.content)||void 0===e?void 0:e.length)&&t.push(r.getEntityForm()),t})),getBlockRequestData:(0,l.S6)((function(){var e,t,n,l=o.idBlock?at(at({},o.block),o.formBlock):o.formBlock,i=(0,z.ct)(at(at({},l),o.idBlock?{}:{systemName:(0,z.cB)(),attributes:at({},null!==(t=null===(e=o.block)||void 0===e?void 0:e.attributes)&&void 0!==t?t:{})}));return o.layoutId&&(i.layouts={},i.layouts[o.layoutId]={systemName:(0,z.cB)(),gridPosition:"col-md-12",sortOrder:o.indexBlock,parentSystemName:null!==(n=o.parentSystemName)&&void 0!==n?n:null}),i.entity||(i.entity={}),o.languageOptions.forEach((function(e){var t,n,l,r=e.value,a=null!==(t=o.formBlock)&&void 0!==t?t:{};i[r]=at(at({},o.block[r]),null!==(n=a[r])&&void 0!==n?n:{}),i=at(at({},i),null!==(l=a[r])&&void 0!==l?l:{})})),delete i.helpText,i})),modalActions:(0,l.S6)((function(){var e=o.idBlock?z._s.tr("isite.cms.label.update"):z._s.tr("isite.cms.label.save");return[{props:{label:e,color:"green"},action:function(){var e;return null===(e=n.refForm.value)||void 0===e?void 0:e.changeStep("next",!0)}}]}))},r={fillData:function(e,t){var n,l=t.index,i=t.layoutId,a=t.parentSystemName;o.block=(0,z.ct)(e),o.indexBlock=(0,z.ct)(l),o.layoutId=(0,z.ct)(i),o.parentSystemName=(0,z.ct)(a),o.formBlock=(0,z.ct)(e),o.configBlock=r.getBlockConfig(null===(n=e.component)||void 0===n?void 0:n.systemName),o.showModal=!0},updateData:function(e){var t;o.block=(0,z.ct)(e),o.idBlock=(0,z.ct)(e.id),o.formBlock=(0,z.ct)(e),o.configBlock=r.getBlockConfig(null===(t=e.component)||void 0===t?void 0:t.systemName),o.showModal=!0},loadOptionsContent:function(){var e,t=null;return(null===(e=o.configBlock)||void 0===e?void 0:e.content)&&(t=o.configBlock.content.find((function(e){var t,n;if(e.value==(null===(n=null===(t=o.formBlock)||void 0===t?void 0:t.entity)||void 0===n?void 0:n.type))return e}))),(null===t||void 0===t?void 0:t.loadOptions)||null},getBlockConfig:function(e){var t,n;return null!==(n=null===(t=_.blockConfigs)||void 0===t?void 0:t.find((function(t){return(null===t||void 0===t?void 0:t.systemName)===e})))&&void 0!==n?n:{}},getEntityForm:function(){var e,t,n=null===(e=o.formBlock)||void 0===e?void 0:e.entity,l=r.loadOptionsContent();return{title:z._s.tr("isite.cms.label.entity"),fields:{helpText:{type:"banner",colClass:"col-12",props:{message:"Configura aquí el contenido del componente..."}},useViewParams:{type:"select",require:!0,colClass:"col-12",fakeFieldName:"entity",vIf:!!o.configBlock.useViewParams,props:{label:"".concat(z._s.tr("ibuilder.cms.useViewParams"),"*"),rules:[function(e){return!!e||z._s.tr("isite.cms.message.fieldRequired")}],options:[{label:z._s.tr("isite.cms.label.yes"),value:"1"},{label:z._s.tr("isite.cms.label.no"),value:"0"}]}},type:{type:"select",require:!0,colClass:"col-12",fakeFieldName:"entity",props:{label:"".concat(z._s.tr("isite.cms.label.entity"),"*"),rules:[function(e){return!!e||z._s.tr("isite.cms.message.fieldRequired")}],options:(null===(t=o.configBlock)||void 0===t?void 0:t.content)||[]}},id:{type:"select",require:!0,fakeFieldName:"entity",colClass:"col-12",vIf:!!l,props:{label:"".concat(z._s.tr("isite.cms.label.record"),"*"),rules:[function(e){return!!e||z._s.tr("isite.cms.message.fieldRequired")}]},loadOptions:l},params:{type:"json",require:!0,colClass:"col-12",fakeFieldName:"entity",vIf:!(!(null===n||void 0===n?void 0:n.type)||l),props:{label:z._s.tr("isite.cms.label.filter"),rules:[function(e){return!!e||z._s.tr("isite.cms.message.fieldRequired")}]}}}}},submitData:function(){var e,n;return ct(this,void 0,void 0,(function(){var l,a,c;return st(this,(function(s){switch(s.label){case 0:return l=i.getBlockRequestData.value,a=ut(ut(ut([],null!==(e=Object.keys(l.attributes))&&void 0!==e?e:[],!0),null!==(n=_.ignoreConfigKeys)&&void 0!==n?n:[],!0),["component","entity","attributes"],!1),c={notToSnakeCase:a},o.idBlock?(o.showModal=!1,o.idBlock=null,t("updated",l),[3,3]):[3,1];case 1:return[4,r.createBlock(l,c)];case 2:s.sent(),s.label=3;case 3:return[2]}}))}))},createBlock:function(e,n){return ct(this,void 0,void 0,(function(){return st(this,(function(l){return o.loading=!0,rt.createBlock(e,n).then((function(n){var l,i;if(o.loading=!1,o.showModal=!1,e.id=n.id,o.layoutId){var r=null===(i=null===(l=n.layouts[0])||void 0===l?void 0:l.blocks)||void 0===i?void 0:i.find((function(e){return e.id==n.id}));r&&(e.pivot=r.pivot),delete e.layouts}t("created",e)})).catch((function(e){o.loading=!1})),[2]}))}))}};return(0,l.u2)((function(){})),at(at(at(at({},n),(0,C.kx)(o)),i),r)}const ft=(0,l._M)({props:{},components:{},emits:["updated","created"],setup:function(e,t){var n=t.emit;return dt(e,n)}}),mt=(0,G.c)(ft,[["render",ot]]),pt=mt,bt=(0,l._M)({props:{index:{type:Number,default:0},layoutId:{type:Number,default:0},parentSystemName:{default:null}},components:{blockForm:pt},emits:["created"],setup:function(e,t){var n=t.emit;return lt(e,n)}});var vt=n(38788),yt=n(7628),ht=n(65264),gt=n(5296),kt=n(85220),wt=n(81020);const Bt=(0,G.c)(bt,[["render",Ye]]),St=Bt;Ce()(bt,"components",{QTabs:vt.c,QTab:yt.c,QIcon:we.c,QSeparator:Te.c,QTabPanels:ht.c,QTabPanel:gt.c,QItem:ge.c,QItemSection:ke.c,QBtn:_e.c,QMenu:Ee.c,QList:Ie.c}),Ce()(bt,"directives",{Ripple:kt.c,ClosePopup:wt.c});const Qt={class:"row"},Ct={id:"panel-editor-component",class:"full-width"},At={class:"row wrap justify-between full-width q-px-sm"},xt={class:"ellipsis"},qt={class:"row q-gutter-xs"},_t={key:0,class:"full-width q-px-xs"},Tt={key:0,class:"full-width text-center"},Et={class:"ellipsis text-center"};function It(e,t,n,i,r,a){const c=(0,l.E1)("q-tooltip"),s=(0,l.E1)("q-btn"),u=(0,l.E1)("dynamic-field"),d=(0,l.E1)("q-popup-edit"),f=(0,l.E1)("handle-grid"),m=(0,l.E1)("draggable"),p=(0,l.E1)("q-separator"),b=(0,l.E1)("q-icon");return(0,l.Wz)(),(0,l.An)("div",Qt,[(0,l.QD)("section",Ct,[(0,l.K2)(m,{list:e.elements,class:"row q-col-gutter-lg q-pb-md",group:{name:"items"},"item-key":`handleGrid${e.uId}`},{item:(0,l.Ql)((({element:t})=>[(0,l.QD)("div",{class:(0,o.WN)(t[e.gridPosField])},[(0,l.QD)("div",{class:(0,o.WN)("panel-editor-component__component  "+(e.verifyKeys(t,e.childsFieldName)?"hasChild":""))},[(0,l.QD)("div",At,[(0,l.QD)("p",xt,(0,o.WA)(t[e.titleField]),1),(0,l.QD)("div",qt,[((0,l.Wz)(!0),(0,l.An)(l.ae,null,(0,l.mi)(e.actions,((n,i)=>((0,l.Wz)(),(0,l.Az)(s,(0,l.Gu)({key:i},e.getActionsButtonProps(n),{onClick:e=>n.action(t)}),{default:(0,l.Ql)((()=>[(0,l.K2)(c,null,{default:(0,l.Ql)((()=>[(0,l.mY)((0,o.WA)(n.label),1)])),_:2},1024)])),_:2},1040,["onClick"])))),128)),e.verifyKeys(t,e.gridPosField)?((0,l.Wz)(),(0,l.Az)(s,(0,o.Gk)((0,l.Gu)({key:0},e.getActionsButtonProps())),{default:(0,l.Ql)((()=>[(0,l.K2)(d,{modelValue:t[e.gridPosField],"onUpdate:modelValue":n=>t[e.gridPosField]=n,title:t[e.titleField],buttons:"","label-set":e.$tr("isite.cms.label.save"),"label-cancel":e.$tr("isite.cms.label.cancel")},{default:(0,l.Ql)((t=>[(0,l.K2)(u,{modelValue:t.value,"onUpdate:modelValue":e=>t.value=e,field:{type:"input",props:{autofocus:!0,label:e.$tr("isite.cms.label.gridPosition")}}},null,8,["modelValue","onUpdate:modelValue","field"])])),_:2},1032,["modelValue","onUpdate:modelValue","title","label-set","label-cancel"]),(0,l.K2)(c,null,{default:(0,l.Ql)((()=>[(0,l.mY)((0,o.WA)(e.$tr("isite.cms.label.gridPosition")),1)])),_:1})])),_:2},1040)):(0,l.g1)("",!0)])]),e.verifyKeys(t,e.childsFieldName)?((0,l.Wz)(),(0,l.An)("div",_t,[(0,l.K2)(f,(0,l.Gu)(e.$props,{elements:t[e.childsFieldName],parent:t,onCreate:e.emitCreateElement}),null,16,["elements","parent","onCreate"])])):(0,l.g1)("",!0)],2)],2)])),_:1},8,["list","item-key"]),e.canAddNewItem?((0,l.Wz)(),(0,l.An)("div",Tt,[(0,l.K2)(p,{class:"q-my-md"}),(0,l.K2)(s,{unelevated:"","no-caps":"",rounded:"",color:"cyan",onClick:t[0]||(t[0]=t=>e.emitCreateElement()),outline:"",class:"full-width"},{default:(0,l.Ql)((()=>[(0,l.K2)(b,{left:"",name:"fa-regular fa-grid-2-plus",size:"xs"}),(0,l.QD)("p",Et,(0,o.WA)(e.$tr("isite.cms.label.add")),1),(0,l.K2)(c,null,{default:(0,l.Ql)((()=>[(0,l.mY)((0,o.WA)(e.$tr("isite.cms.label.add")),1)])),_:1})])),_:1})])):(0,l.g1)("",!0)])])}var Kt=function(){return Kt=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Kt.apply(this,arguments)};function zt(e,t){var n={},o=(0,C.cB)({uId:(0,z.cB)()}),i={},r={getActionsButtonProps:function(e){return void 0===e&&(e={}),Kt(Kt({icon:"fa-regular fa-objects-column",outline:!0,round:!0,color:"cyan",size:"10px"},e),{label:""})},emitCreateElement:function(n){void 0===n&&(n=null),t("create",n||e.parent)},verifyKeys:function(e,t){var n=Object.keys(e);return n.includes(t)}};return(0,l.u2)((function(){})),Kt(Kt(Kt(Kt({},n),(0,C.kx)(o)),i),r)}var Pt=n(10328),Lt=n.n(Pt);const Wt=(0,l._M)({name:"handleGrid",props:{elements:{type:Array,default:[]},titleField:{type:String,default:"title"},gridPosField:{type:String,default:"gridPosition"},canAddNewItem:{type:Boolean,default:!1},actions:{type:Object,default:()=>({})},childsFieldName:{type:String,default:"children"},parent:{default:null}},components:{draggable:Lt()},setup(e,{emit:t}){return{...zt(e,t)}}});var Dt=n(86742);const Nt=(0,G.c)(Wt,[["render",It]]),Ot=Nt;Ce()(Wt,"components",{QBtn:_e.c,QTooltip:he.c,QPopupEdit:Dt.c,QSeparator:Te.c,QIcon:we.c});var Ft={id:"blockAttributesForm",class:"bg-white"},Vt={class:"drawer-title row justify-between q-py-md q-px-md bg-primary text-white"},jt={class:"col-11 text-center text-subtitle1 text-weight-bold"},$t={class:"row q-col-gutter-x-md relative-position"},Ut={class:"row"},Mt={id:"componentsNameContent",class:"q-pt-xl",style:"width: 30%"},Rt={class:"full-width row justify-between items-center"},Gt={style:"width: 70%"},Yt={id:"formPanelsContent",class:"q-pa-sm relative-position"},Ht={id:"actionsContent",class:"absolute-bottom-right q-mb-sm q-mr-lg"};function Jt(e,t,n,i,r,a){var c=(0,l.E1)("q-btn"),s=(0,l.E1)("q-icon"),u=(0,l.E1)("q-tab"),d=(0,l.E1)("q-tabs"),f=(0,l.E1)("q-separator"),m=(0,l.E1)("not-result"),p=(0,l.E1)("dynamic-form"),b=(0,l.E1)("q-tab-panel"),v=(0,l.E1)("q-tab-panels"),y=(0,l.E1)("inner-loading"),h=(0,l.E1)("iframe-post"),g=(0,l.E1)("q-item-label"),k=(0,l.E1)("q-item-section"),w=(0,l.E1)("q-item"),B=(0,l.E1)("q-list"),S=(0,l.E1)("q-btn-dropdown"),Q=(0,l.iS)("close-popup");return(0,l.Wz)(),(0,l.An)("div",Ft,[(0,l.QD)("div",Vt,[(0,l.QD)("h2",jt,(0,o.WA)(e.$tr("ibuilder.cms.blockEdit"))+" - ID: "+(0,o.WA)(e.block.id),1),(0,l.K2)(c,{unelevated:"",color:"white",outline:"",round:"",icon:"fa fa-close",onClick:e.discardChanges},null,8,["onClick"])]),(0,l.QD)("div",$t,[(0,l.QD)("div",{id:"panelContent",style:(0,o.MN)("width: ".concat(e.panelWidth))},[(0,l.QD)("div",Ut,[(0,l.QD)("div",Mt,[(0,l.K2)(d,{modelValue:e.selectedComponentKey,"onUpdate:modelValue":[t[0]||(t[0]=function(t){return e.selectedComponentKey=t}),e.handleAllowEditIndicator],vertical:"","active-bg-color":"primary","inline-label":"","active-color":"white","indicator-color":"primary",class:"scroll-content","content-class":"alternating-colors",onClick:t[1]||(t[1]=function(){return e.setVModels()})},{default:(0,l.Ql)((function(){return[((0,l.Wz)(!0),(0,l.An)(l.ae,null,(0,l.mi)(e.componentConfigs,(function(t,n){return(0,l.Wz)(),(0,l.Az)(u,{key:n,name:t.componentKey,"content-class":"full-width","no-caps":""},{default:(0,l.Ql)((function(){return[(0,l.QD)("div",Rt,[(0,l.mY)((0,o.WA)(t.title)+" ",1),(0,l.K2)(s,{name:"fa-light fa-arrow-right",class:"q-mr-xs",size:"16px",color:e.selectedComponentKey==t.componentKey?"white":"blue-grey"},null,8,["color"])])]})),_:2},1032,["name"])})),128))]})),_:1},8,["modelValue","onUpdate:modelValue"])]),(0,l.QD)("div",Gt,[(0,l.K2)(d,{modelValue:e.tabName,"onUpdate:modelValue":[t[2]||(t[2]=function(t){return e.tabName=t}),e.handleAllowEditIndicator],"inline-label":"","no-caps":"","indicator-color":"transparent",class:"full-width","active-bg-color":e.tabColor,"active-color":"white","content-class":"text-".concat(e.tabColor," bg-grey-2")},{default:(0,l.Ql)((function(){return[(0,l.K2)(u,{name:"attributes",label:e.$tr("ibuilder.cms.label.attributes")},null,8,["label"]),(0,l.K2)(u,{name:"content",label:e.$tr("ibuilder.cms.label.content")},null,8,["label"])]})),_:1},8,["modelValue","active-bg-color","content-class","onUpdate:modelValue"]),(0,l.K2)(f,{color:e.tabColor,size:"2px"},null,8,["color"]),(0,l.QD)("div",Yt,[(0,l.K2)(v,{modelValue:e.tabName,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.tabName=t}),animated:"","transition-prev":"scale","transition-next":"scale",class:"scroll-content"},{default:(0,l.Ql)((function(){return[(0,l.K2)(b,{name:"attributes",class:"q-pa-none"},{default:(0,l.Ql)((function(){return[e.hasFields(e.attributesForm)?((0,l.Wz)(),(0,l.Az)(p,{key:1,modelValue:e.formAttributes,"onUpdate:modelValue":[t[3]||(t[3]=function(t){return e.formAttributes=t}),e.mergeDataForm],blocks:e.attributesForm,formType:"collapsible","no-actions":""},null,8,["modelValue","onUpdate:modelValue","blocks"])):((0,l.Wz)(),(0,l.Az)(m,{key:0,class:"q-mt-xl"}))]})),_:1}),(0,l.K2)(b,{name:"content",class:"q-pa-none"},{default:(0,l.Ql)((function(){return[e.hasFields(e.contentForm)?(0,l.g1)("",!0):((0,l.Wz)(),(0,l.Az)(m,{key:0,class:"q-mt-xl"})),(0,l.K2)(p,{modelValue:e.formContent,"onUpdate:modelValue":[t[4]||(t[4]=function(t){return e.formContent=t}),e.mergeDataForm],blocks:e.contentForm,formType:"grid","no-actions":""},null,8,["modelValue","onUpdate:modelValue","blocks"])]})),_:1})]})),_:1},8,["modelValue"]),(0,l.K2)(y,{visible:!e.allowEdit},null,8,["visible"])])])])],4),(0,l.QD)("div",{id:"previewContent",style:(0,o.MN)("width: calc(100% - ".concat(e.panelWidth,")"))},[(0,l.K2)(h,{id:"iframeBlock".concat(e.block.id),ref:"refIframePost"},null,8,["id"])],4),(0,l.QD)("div",Ht,[(0,l.K2)(S,{split:"",rounded:"",dense:"","no-caps":"",padding:"xs 15px",color:"green",outline:"","text-color":"green",label:e.$tr("isite.cms.label.save"),onClick:t[7]||(t[7]=function(t){return e.updateBlock({})})},{default:(0,l.Ql)((function(){return[(0,l.K2)(B,null,{default:(0,l.Ql)((function(){return[(0,l.wt)(((0,l.Wz)(),(0,l.Az)(w,{clickable:"",onClick:t[6]||(t[6]=function(t){return e.updateBlock({closeModal:!0})}),class:"q-px-sm"},{default:(0,l.Ql)((function(){return[(0,l.K2)(k,null,{default:(0,l.Ql)((function(){return[(0,l.K2)(g,null,{default:(0,l.Ql)((function(){return[(0,l.mY)((0,o.WA)(e.$tr("isite.cms.message.saveAndReturn")),1)]})),_:1})]})),_:1})]})),_:1})),[[Q]])]})),_:1})]})),_:1},8,["label"])])]),(0,l.K2)(y,{visible:e.loading},null,8,["visible"])])}var Xt=n(96136),Zt=function(){return Zt=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Zt.apply(this,arguments)},en=function(e,t,n){if(n||2===arguments.length)for(var l,o=0,i=t.length;o<i;o++)!l&&o in t||(l||(l=Array.prototype.slice.call(t,0,o)),l[o]=t[o]);return e.concat(l||Array.prototype.slice.call(t))};function tn(e,t){var n={refIframePost:(0,C.IL)()},o=(0,C.cB)({allowEdit:!1,block:{},selectedComponentKey:"componentAttributes",tabName:"attributes",formAttributes:{},formContent:{},panelWidth:"650px",loading:!1,componentConfigs:null}),i={tabColor:(0,l.S6)((function(){return"attributes"==o.tabName?"purple":"orange"})),attributesForm:(0,l.S6)((function(){var e=r.selectedTabConfig();return e?Object.values(e.attributes):[]})),contentForm:(0,l.S6)((function(){var e=r.selectedTabConfig();return e?[{name:"maincontent",title:z._s.tr("ibuilder.cms.label.content"),fields:e.contentFields||{}}]:[]}))},r={init:function(){r.handleAllowEditIndicator()},edit:function(e){var t,n=Zt(Zt({},e),{attributes:Array.isArray(e.attributes)?{}:e.attributes});o.block=(0,z.ct)(n),r.getComponentsConfig(null===(t=e.component)||void 0===t?void 0:t.systemName),r.setVModels(),r.previewBlock()},setVModels:function(){o.formAttributes=o.block.attributes[o.selectedComponentKey],o.formContent=o.block},getComponentsConfig:function(e){var t=_.blockConfigs.find((function(t){return t.systemName==e}));if(!t)return[];var n=Object.values(t.childBlocks||{}),l=en([t],_.blockConfigs.filter((function(e){return n.includes(e.systemName)})),!0);o.componentConfigs=l.map((function(e){e.componentKey="componentAttributes";for(var n=0,l=Object.entries(t.childBlocks);n<l.length;n++){var o=l[n],i=o[0],a=o[1];a==e.systemName&&(e.componentKey=i)}return(null===e||void 0===e?void 0:e.contentFields)&&(e.contentFields=r.setFakeFieldNameInContent(e.contentFields,e.componentKey)),e}))},updateBlock:function(e){var n=e.closeModal,l=void 0!==n&&n;o.block&&(o.loading=!0,K.updateBlock(o.block.id,o.block).then((function(e){z.Qb.info({message:z._s.tr("isite.cms.message.recordUpdated")}),t("updateBlock",{block:(0,z.ct)(o.block),persistModalAttributes:!l}),o.loading=!1})).catch((function(){z.Qb.error({message:z._s.tr("isite.cms.message.recordNoUpdated")}),o.loading=!1})))},handleAllowEditIndicator:function(){o.allowEdit=!1,r.enableAllowEditIndicator()},enableAllowEditIndicator:(0,Xt.c)((function(){return o.allowEdit=!0}),1e3),mergeDataForm:function(){if(o.allowEdit){var e=r.selectedTabConfig(),t=null===e||void 0===e?void 0:e.componentKey;if(!t)return;"attributes"==o.tabName?o.block.attributes[t]=(0,z.ct)(Zt(Zt({},o.block.attributes[t]),o.formAttributes)):o.block=(0,z.ct)(z.i4.deepMergeObjects(o.block,o.formContent)),r.previewBlock()}},previewBlock:(0,Xt.c)((function(){var e,t;(null===(t=null===(e=n.refIframePost)||void 0===e?void 0:e.value)||void 0===t?void 0:t.loadIframe)&&o.block.id&&n.refIframePost.value.loadIframe("".concat(z.is.state.qsiteApp.baseUrl,"/api/ibuilder/v1/block/preview"),o.block)}),2e3),discardChanges:function(){z.Qb.warning({mode:"modal",title:z._s.tr("ibuilder.cms.label.sureDiscardBlock"),message:z._s.tr("ibuilder.cms.label.descriptionSureDiscardBlock"),actions:[{label:z._s.tr("isite.cms.label.cancel"),color:"grey-8"},{label:z._s.tr("isite.cms.label.accept"),color:"green",handler:function(){return t("cancel")}}]})},hasFields:function(e){var t,n;if(!e.length)return!1;var l=Object.keys(null!==(n=null===(t=e[0])||void 0===t?void 0:t.fields)&&void 0!==n?n:{});return l.length>0},selectedTabConfig:function(){return!!o.componentConfigs&&o.componentConfigs.find((function(e){return e.componentKey==o.selectedComponentKey}))},setFakeFieldNameInContent:function(e,t){for(var n=0,l=Object.entries(e);n<l.length;n++){var i=l[n],r=i[0],a=i[1];e[r]=Zt(Zt({},a),"media"!==(null===a||void 0===a?void 0:a.type)?{fakeFieldName:t}:{fieldItemId:o.block.id})}return e}};return(0,l.u2)((function(){r.init()})),Zt(Zt(Zt(Zt({},n),(0,C.kx)(o)),i),r)}const nn=(0,l._M)({props:{},components:{iframePost:H},emits:["updateBlock","cancel"],setup:function(e,t){var n=t.emit;return tn(e,n)}});var ln=n(82764);const on=(0,G.c)(nn,[["render",Jt]]),rn=on;Ce()(nn,"components",{QBtn:_e.c,QTabs:vt.c,QTab:yt.c,QIcon:we.c,QSeparator:Te.c,QTabPanels:ht.c,QTabPanel:gt.c,QBtnDropdown:ln.c,QList:Ie.c,QItem:ge.c,QItemSection:ke.c,QItemLabel:Be.c}),Ce()(nn,"directives",{ClosePopup:wt.c});var an={id:"builderLayoutLibraryPanel",class:"bg-white relative-position"},cn={class:"drawer-title q-py-md q-px-md"},sn={class:"text-center text-subtitle1 text-weight-bold"},un={key:0,class:"row"},dn={class:"col-5"},fn=(0,l.QD)("div",{class:"title-tabs"},null,-1),mn={class:"selection-item ellipsis row justify-between"},pn={class:"col-7"},bn={class:"flex q-my-sm q-px-lg"},vn={class:"text-center text-weight-bold"},yn=["src","alt"],hn={class:"ellipsis-2-lines full-width title-item q-py-xs"};function gn(e,t,n,i,r,a){var c=(0,l.E1)("q-icon"),s=(0,l.E1)("q-tab"),u=(0,l.E1)("q-tabs"),d=(0,l.E1)("q-btn"),f=(0,l.E1)("not-result"),m=(0,l.E1)("q-item-section"),p=(0,l.E1)("q-item"),b=(0,l.E1)("inner-loading"),v=(0,l.iS)("ripple");return(0,l.Wz)(),(0,l.An)("div",an,[(0,l.QD)("div",cn,[(0,l.QD)("h2",sn,(0,o.WA)(e.$tr("ibuilder.cms.layouts")),1)]),e.loading?(0,l.g1)("",!0):((0,l.Wz)(),(0,l.An)("div",un,[(0,l.QD)("div",dn,[fn,(0,l.K2)(u,{modelValue:e.layoutTypeSelected,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.layoutTypeSelected=t}),vertical:"","active-bg-color":"indigo-8","inline-label":"","active-class":"selected-item","active-color":"white","indicator-color":"indigo-6",class:"scroll-content border-tab","content-class":"alternating-colors"},{default:(0,l.Ql)((function(){return[((0,l.Wz)(!0),(0,l.An)(l.ae,null,(0,l.mi)(e.layoutTypes,(function(e,t){return(0,l.Wz)(),(0,l.Az)(s,{key:t,name:e.entityType,"content-class":"custom-position","no-caps":""},{default:(0,l.Ql)((function(){return[(0,l.QD)("div",mn,[(0,l.mY)((0,o.WA)(e.title)+" ",1),(0,l.K2)(c,{name:"fa-light fa-arrow-right",class:"q-mr-xs",size:"16px",color:"blue-grey"})])]})),_:2},1032,["name"])})),128))]})),_:1},8,["modelValue"])]),(0,l.QD)("div",pn,[(0,l.QD)("div",bn,[(0,l.K2)(d,{onClick:t[1]||(t[1]=function(t){return e.selectedLayout()}),outline:"",rounded:"",class:"full-width q-mx-sm text-capitalize btn-color","no-caps":"",padding:"sm lg"},{default:(0,l.Ql)((function(){return[(0,l.K2)(c,{size:"xs",left:"",name:"fa-solid fa-plus"}),(0,l.QD)("div",vn,(0,o.WA)(e.$tr("ibuilder.cms.label.newLayout")),1)]})),_:1})]),(0,l.QD)("div",{class:(0,o.WN)("scroll-content q-pa-none ".concat(e.layoutsBySelectedType.length?"":"overflow-hidden"))},[e.layoutsBySelectedType.length?((0,l.Wz)(!0),(0,l.An)(l.ae,{key:1},(0,l.mi)(e.layoutsBySelectedType,(function(t,n){return(0,l.wt)(((0,l.Wz)(),(0,l.Az)(p,{key:"localKey".concat(n),clickable:"",class:"bg-trans-item",onClick:function(n){return e.selectedLayout(t)}},{default:(0,l.Ql)((function(){return[(0,l.K2)(m,{class:"relative-position q-ma-sm image-section selectable"},{default:(0,l.Ql)((function(){return[(0,l.QD)("img",{src:t.mediaFiles.internalimage.url,alt:t.title},null,8,yn),(0,l.QD)("span",hn,(0,o.WA)(t.title),1)]})),_:2},1024)]})),_:2},1032,["onClick"])),[[v]])})),128)):((0,l.Wz)(),(0,l.Az)(f,{key:0,class:"q-mt-xl"}))],2)])])),(0,l.K2)(b,{visible:e.loading},null,8,["visible"])])}var kn=n(18528)["c"],wn=function(){return wn=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},wn.apply(this,arguments)};const Bn={getLayoutsLibrary:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t={}),new Promise((function(n,l){var o=z.is.getSetting("ibuilder::blockTemplatesUrl");if(!o)return n([]);var i={refresh:e,params:wn({filter:{allTranslations:!0}},t)};He.c.get("".concat(o,"/api").concat(kn("apiRoutes.qbuilder.layouts")),i).then((function(e){n(e.data.data)})).catch((function(e){return l(e)}))}))}};var Sn=function(){return Sn=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Sn.apply(this,arguments)},Qn=function(e,t,n,l){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{c(l.next(e))}catch(t){i(t)}}function a(e){try{c(l["throw"](e))}catch(t){i(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((l=l.apply(e,t||[])).next())}))},Cn=function(e,t){var n,l,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,a[0]&&(r=0)),r)try{if(n=1,l&&(o=2&a[0]?l["return"]:a[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,a[1])).done)return o;switch(l=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,l=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],l=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function An(e,t){var n=this,o={},i=(0,C.cB)({layoutLibrary:[],layoutTypeSelected:"",loading:!1}),r={layoutTypes:(0,l.S6)((function(){var e=a.builderConfig(),t=[];return Object.keys(e).forEach((function(n){e[n].forEach((function(e){t.push({title:"".concat(e.entity.label," (").concat(n,")"),entityType:e.entity.value})}))})),t})),layoutsBySelectedType:(0,l.S6)((function(){return i.layoutLibrary.filter((function(e){return e.entityType.includes(i.layoutTypeSelected)}))}))},a={getData:function(){return Qn(n,void 0,void 0,(function(){var e,t;return Cn(this,(function(n){switch(n.label){case 0:i.loading=!0,n.label=1;case 1:return n.trys.push([1,3,,4]),e=i,[4,Bn.getLayoutsLibrary(!0,{include:"files"})];case 2:return e.layoutLibrary=n.sent(),i.layoutTypeSelected=r.layoutTypes.value[0].entityType,[3,4];case 3:return t=n.sent(),console.error("Failed Load Library: ",t),[3,4];case 4:return i.loading=!1,[2]}}))}))},builderConfig:function(){var e=z.is.getters["qsiteApp/getConfigApp"]("builder.layout",!0),t={};return Object.keys(e).forEach((function(n){e[n]&&(t[n]=e[n])})),t},selectedLayout:function(e){var n={blocks:[]};e&&(n=(0,z.ct)(e),n.systemName=(0,z.cB)(),delete n.default,delete n.id),t("creating",n)}};return(0,l.u2)((function(){a.getData()})),Sn(Sn(Sn(Sn({},o),(0,C.kx)(i)),r),a)}const xn=(0,l._M)({props:{},components:{},emits:["creating"],setup:function(e,t){var n=t.emit;return An(e,n)}}),qn=(0,G.c)(xn,[["render",gn]]),_n=qn;Ce()(xn,"components",{QTabs:vt.c,QTab:yt.c,QIcon:we.c,QBtn:_e.c,QItem:ge.c,QItemSection:ke.c}),Ce()(xn,"directives",{Ripple:kt.c});const Tn={id:"builderBlockList",class:"drawer-body relative-position"},En={class:"flex q-gutter-xs justify-between"},In={class:"text-center text-weight-bold"};function Kn(e,t,n,i,r,a){const c=(0,l.E1)("q-icon"),s=(0,l.E1)("q-btn"),u=(0,l.E1)("q-separator"),d=(0,l.E1)("recursive-item"),f=(0,l.E1)("inner-loading");return(0,l.Wz)(),(0,l.An)("div",Tn,[(0,l.QD)("div",En,[(0,l.K2)(s,{onClick:t[0]||(t[0]=t=>e.$emit("create")),outline:"",rounded:"",class:"q-mb-sm text-capitalize heigth-button",color:"primary","no-caps":""},{default:(0,l.Ql)((()=>[(0,l.K2)(c,{size:"xs",left:"",name:"fa-solid fa-plus"}),(0,l.QD)("div",In,(0,o.WA)(e.$tr("ibuilder.cms.newBlock")),1)])),_:1}),(0,l.K2)(s,{onClick:e.refreshBlocks,outline:"",rounded:"",class:"q-mb-sm",size:"sm",color:"primary","no-caps":"",icon:"fa-light fa-rotate-right"},null,8,["onClick"])]),(0,l.K2)(u,{spaced:""}),(0,l.K2)(d,{id:"recursiveItemContent",translatable:!1,menu:e.mapBlocks,"right-icon":""},null,8,["menu"]),(0,l.K2)(f,{visible:e.loading},null,8,["visible"])])}var zn=function(){return zn=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},zn.apply(this,arguments)},Pn=function(e,t,n,l){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{c(l.next(e))}catch(t){i(t)}}function a(e){try{c(l["throw"](e))}catch(t){i(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((l=l.apply(e,t||[])).next())}))},Ln=function(e,t){var n,l,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,a[0]&&(r=0)),r)try{if(n=1,l&&(o=2&a[0]?l["return"]:a[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,a[1])).done)return o;switch(l=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,l=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],l=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function Wn(e,t){var n={},o=(0,C.cB)({blocks:[],mapBlocks:[],loading:!1}),i={},r={blockTypes:function(){var e=_.blockConfigs.filter((function(e){return!e.internal}));return e},getBlocks:function(){return o.loading=!0,new Promise((function(e){Ze.getLocalBlocks(!0).then((function(t){o.blocks=t,o.mapBlocks=r.orderedItems(),o.loading=!1,e(!1)})).catch((function(){o.loading=!1,e(!1)}))}))},refreshBlocks:function(e){return void 0===e&&(e=""),Pn(this,void 0,void 0,(function(){var n,l;return Ln(this,(function(i){switch(i.label){case 0:return t("refresh",!0),[4,r.getBlocks()];case 1:return i.sent(),n=null,"blockCreated"==e?(l=o.blocks.reduce((function(e,t){return e.id>t.id?e:t})),n=l):_.viewBlockSelected&&_.viewBlockSelected.id&&(n=o.blocks.find((function(e){var t;return e.id===(null===(t=_.viewBlockSelected)||void 0===t?void 0:t.id)}))||null),n&&(_.viewBlockSelected=(0,z.ct)(n),oe.itemSelected=n,t("selected",(0,z.ct)(n))),t("refresh",!1),[2]}}))}))},orderedItems:function(){var e=r.blockTypes(),t=[];return e.forEach((function(e){var n=o.blocks.filter((function(t){return t.component.systemName==e.systemName})),l=n.map((function(e){return zn(zn({},e),{label:"".concat(e.id," | ").concat(e.internalTitle),activated:!0,icon:"fa-light fa-arrow-right",action:r.selectBlock})}));t.push({label:"".concat(e.title),headerClass:"expansion-header",customClass:"expansion-border",children:l.sort((function(e,t){return t.id-e.id}))})})),t},selectBlock:function(e){var n=o.blocks.find((function(t){return t.id===e.id}));return n?(_.viewBlockSelected=(0,z.ct)(n),t("selected",(0,z.ct)(n)),Promise.resolve(!0)):Promise.resolve(!0)}};return(0,l.u2)((function(){r.getBlocks()})),zn(zn(zn(zn({},n),(0,C.kx)(o)),i),r)}const Dn=(0,l._M)({props:{},components:{recursiveItem:xe},emits:["refresh","selected","create"],setup(e,{emit:t}){return Wn(e,t)}}),Nn=(0,G.c)(Dn,[["render",Kn]]),On=Nn;Ce()(Dn,"components",{QBtn:_e.c,QIcon:we.c,QSeparator:Te.c,QExpansionItem:Se.c,QItem:ge.c,QMenu:Ee.c,QList:Ie.c});const Fn=(0,l._M)({computed:{store(){return _}},props:{},components:{blockForm:pt,iframePost:H,layoutList:ze,blockList:On,blocksPanel:St,handleGrid:Ot,blockAttributesForm:rn,layoutLibraryPanel:_n},setup(){return{...N()}}});var Vn=n(36008),jn=n(30852),$n=n(69452);const Un=(0,G.c)(Fn,[["render",Q]]),Mn=Un;Ce()(Fn,"components",{QSelect:Vn.c,QIcon:we.c,QDialog:jn.c,QBtnDropdown:ln.c,QList:Ie.c,QItem:ge.c,QItemSection:ke.c,QItemLabel:Be.c,QTabs:vt.c,QTab:yt.c,QBtn:_e.c,QTooltip:he.c,QSeparator:Te.c,QTabPanels:ht.c,QTabPanel:gt.c,QField:$n.c}),Ce()(Fn,"directives",{ClosePopup:wt.c})}}]);