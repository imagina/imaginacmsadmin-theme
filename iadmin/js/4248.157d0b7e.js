"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[4248],{24248:(n,e,t)=>{t.r(e),t.d(e,{default:()=>g});var i=t(92444),o={class:"row"};function c(n,e,t,c,a,r){var l=(0,i.E1)("dynamic-field"),s=(0,i.E1)("inner-loading");return(0,i.Wz)(),(0,i.An)("div",null,[(0,i.QD)("div",o,[n.loading?(0,i.g1)("",!0):((0,i.Wz)(),(0,i.Az)(l,{key:0,modelValue:n.map,"onUpdate:modelValue":e[0]||(e[0]=function(e){return n.map=e}),class:"q-mb-md col-12",field:n.mapField},null,8,["modelValue","field"]))]),(0,i.K2)(s,{visible:n.loading},null,8,["visible"])])}var a=t(75836),r=t(20584);const l={getDevices:function(){return new Promise((function(n,e){var t={refresh:!0,params:{include:"sensors"}};r.c.index("apiRoutes.qtelemetry.devices",t).then((function(e){n(e.data)})).catch((function(n){return e(n)}))}))}};var s=t(58088),u=t(8932),d=function(){return d=Object.assign||function(n){for(var e,t=1,i=arguments.length;t<i;t++)for(var o in e=arguments[t],e)Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n},d.apply(this,arguments)};function v(n,e){var t={},o=(0,a.cB)({loading:!1,map:null,devices:[],mapField:{value:null,type:"positionMarkerMap",help:{description:u._s.tr("icommerce.cms.form.mapHelp")},props:{label:"".concat(u._s.tr("isite.cms.label.search"),"..."),readOnly:!0,markers:!0,height:"80vh"}}}),c={},r={init:function(){o.loading=!0,r.getDevices().then((function(n){r.setMarkers(),o.loading=!1}))},setMarkers:function(){o.map=o.devices.map((function(n){return{lat:n.lat,lng:n.lng,title:n.title,loadingLabel:u._s.tr("isite.cms.label.loading"),onClick:function(){return r.getLastRecord(n)}}}))},getLastRecord:function(n){return new Promise((function(e,t){var i=n.sensors,o={filter:{deviceId:n.id},orderBy:{field:"id",way:"desc"},take:1};s.c.getRecords(o).then((function(n){var t;0==n.length&&e("-");var o=n[0],c="<b>".concat(null===(t=null===o||void 0===o?void 0:o.device)||void 0===t?void 0:t.title,"</b>")||0,a="";i.length&&i.forEach((function(n){if(null===o||void 0===o?void 0:o.logs){var e=o.logs.find((function(e){return e.sensorId==n.id}));if(e){var t=n.title,i=Number.isInteger(e.value)?e.value:e.value.toFixed(2),c=(null===e||void 0===e?void 0:e.statusSensor)?' <span style="color: '.concat(e.statusSensor.color,'">').concat(e.statusSensor.text,"</span>"):"",r=n.options;r?(t=(null===r||void 0===r?void 0:r.prefix)?r.prefix:n.title,t=(null===r||void 0===r?void 0:r.suffix)?"<b>".concat(t,"</b> : ").concat(i," ").concat(r.suffix):"".concat(t," : ").concat(i)):t="<b>".concat(n.title,"</b> : ").concat(i),a="".concat(a," ").concat(t," ").concat(c,"</br>")}}})),e("".concat(c,"<p>").concat(a,"</p>"))}))}))},getDevices:function(){return new Promise((function(n,e){l.getDevices().then((function(e){o.devices=e,n(e)}))}))}};return(0,i.u2)((function(){r.init()})),d(d(d(d({},t),(0,a.kx)(o)),c),r)}const f=(0,i._M)({setup:function(n,e){var t=e.emit;return v(n,t)}});var p=t(68716);const m=(0,p.c)(f,[["render",c]]),g=m}}]);