"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[4312],{4312:(e,t,s)=>{s.r(t),s.d(t,{default:()=>te});var l=s(92444);const a={class:"backend-page row q-col-gutter-x-md"},o={class:"col-md-5"},i={class:"box"},n={class:"col-md-7"},r={class:"box"};function m(e,t,s,m,d,c){const u=(0,l.E1)("formMenu"),h=(0,l.E1)("indexItemsByMenu");return(0,l.Wz)(),(0,l.An)("div",a,[(0,l.QD)("div",o,[(0,l.QD)("div",i,[(0,l.K2)(u)])]),(0,l.QD)("div",n,[(0,l.QD)("div",r,[(0,l.K2)(h)])])])}const d={key:0,class:"row gutter-x-sm relative-position"},c={class:"col-12 q-mb-md"},u={key:0};function h(e,t,s,a,o,i){const n=(0,l.E1)("locales"),r=(0,l.E1)("q-input"),m=(0,l.E1)("q-select"),h=(0,l.E1)("q-btn"),p=(0,l.E1)("q-form"),g=(0,l.E1)("inner-loading");return o.success?((0,l.Wz)(),(0,l.An)("div",d,[(0,l.K2)(p,{autocorrect:"off",autocomplete:"off",ref:"formContent",class:"full-width q-my-sm",onSubmit:t[5]||(t[5]=e=>i.updateItem()),onValidationError:t[6]||(t[6]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,l.Ql)((()=>[(0,l.QD)("div",c,[(0,l.K2)(n,{modelValue:o.locale,"onUpdate:modelValue":t[0]||(t[0]=e=>o.locale=e),ref:"localeComponent",form:e.$refs.formContent},null,8,["modelValue","form"])]),o.locale.success?((0,l.Wz)(),(0,l.An)("div",u,[(0,l.K2)(r,{outlined:"",dense:"",modelValue:o.locale.formTemplate.name,"onUpdate:modelValue":t[1]||(t[1]=e=>o.locale.formTemplate.name=e),label:`${e.$tr("isite.cms.form.name")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","rules"]),(0,l.K2)(r,{outlined:"",dense:"",modelValue:o.locale.formTemplate.title,"onUpdate:modelValue":t[2]||(t[2]=e=>o.locale.formTemplate.title=e),label:`${e.$tr("isite.cms.form.title")} (${o.locale.language})*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","rules"]),(0,l.K2)(m,{label:`${e.$tr("isite.cms.form.status")} (${o.locale.language})`,modelValue:o.locale.formTemplate.status,"onUpdate:modelValue":t[3]||(t[3]=e=>o.locale.formTemplate.status=e),options:[{label:this.$tr("isite.cms.label.enabled"),value:"1"},{label:this.$tr("isite.cms.label.disabled"),value:"0"}],outlined:"",dense:"","emit-value":"","map-options":""},null,8,["label","modelValue","options"]),(0,l.K2)(m,{label:e.$tr("isite.cms.form.default"),modelValue:o.locale.formTemplate.isDefault,"onUpdate:modelValue":t[4]||(t[4]=e=>o.locale.formTemplate.isDefault=e),options:[{label:this.$tr("isite.cms.label.yes"),value:"1"},{label:this.$tr("isite.cms.label.no"),value:"0"}],outlined:"",dense:"","emit-value":"","map-options":""},null,8,["label","modelValue","options"]),o.itemId?((0,l.Wz)(),(0,l.Az)(h,{key:0,class:"float-right",color:"green",loading:o.loading,unelevated:"",icon:"fas fa-save",label:e.$tr("isite.cms.label.save"),type:"submit",rounded:""},null,8,["loading","label"])):(0,l.g1)("",!0)])):(0,l.g1)("",!0)])),_:1},512),(0,l.K2)(g,{visible:o.loading},null,8,["visible"])])):(0,l.g1)("",!0)}const p={components:{},watch:{$route(e,t){this.initForm()}},mounted(){this.$nextTick((function(){this.initForm()}))},data(){return{locale:{},loading:!1,success:!1,itemId:!1}},computed:{dataLocale(){return{fields:{name:"",isDefault:"0"},fieldsTranslatable:{title:"",status:"1"}}}},methods:{async initForm(){this.loading=!0,this.success=!1,this.locale=this.$clone(this.dataLocale),this.itemId=this.$route.params.id,this.locale.success&&this.$refs.localeComponent.vReset(),await this.getData(),this.success=!0,this.loading=!1},getData(){return new Promise(((e,t)=>{const s=this.$clone(this.itemId);if(s){let l="apiRoutes.qmenu.menus",a={refresh:!0,params:{filter:{allTranslations:!0}}};this.$crud.show(l,s,a).then((t=>{this.orderDataItemToLocale(t.data),e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1,t(!1)}))}))}else e(!0)}))},orderDataItemToLocale(e){let t=this.$clone(e);this.locale.form=this.$clone(t)},async updateItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qmenu.menus";this.$crud.update(e,this.itemId,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},getDataForm(){let e=this.locale.form;for(var t in e){let s=e[t];null!=s&&void 0!=s||delete e[t]}return e.selectable=JSON.stringify(e.selectable),e}}};var g=s(68716),f=s(14288),b=s(20540),$=s(36008),I=s(99140),v=s(95252),q=s.n(v);const D=(0,g.c)(p,[["render",h]]),Q=D;q()(p,"components",{QForm:f.c,QInput:b.c,QSelect:$.c,QBtn:I.c});var y=s(74044);const T={class:"row gutter-y-sm relative-position"},K={class:"col-md-12"},E={class:"float-right"},k={class:"col-12 q-mt-sm"},x={class:"col-12 text-right q-mt-sm"};function C(e,t,s,a,o,i){const n=(0,l.E1)("q-btn"),r=(0,l.E1)("q-tooltip"),m=(0,l.E1)("nestedMenuItems"),d=(0,l.E1)("inner-loading");return(0,l.Wz)(),(0,l.An)("div",T,[(0,l.QD)("div",K,[(0,l.QD)("div",E,[(0,l.K2)(n,{to:{name:"qmenu.admin.menu.create",params:{menuId:e.$route.params.id}},icon:"fas fa-plus-circle",label:e.$tr("menu.cms.newItem"),color:"green",class:"q-ml-xs",rounded:"",outline:""},null,8,["to","label"]),(0,l.K2)(n,{onClick:t[0]||(t[0]=e=>i.getItems(!0)),icon:"fas fa-sync-alt",color:"blue-grey",class:"q-ml-xs",round:"",outline:""},{default:(0,l.Ql)((()=>[(0,l.K2)(r,{delay:300},{default:(0,l.Ql)((()=>[(0,l.mY)((0,y.WA)(e.$tr("isite.cms.label.refresh")),1)])),_:1})])),_:1})])]),(0,l.QD)("div",k,[(0,l.K2)(m,{menuItems:o.menuItems,onUpdated:t[1]||(t[1]=e=>i.getItems(!0))},null,8,["menuItems"])]),(0,l.QD)("div",x,[o.menuItems.length?((0,l.Wz)(),(0,l.Az)(n,{key:0,onClick:i.updateOrder,icon:"fas fa-save",label:e.$tr("isite.cms.label.save"),color:"green",class:"q-ml-xs",rounded:"",unelevated:""},null,8,["onClick","label"])):(0,l.g1)("",!0)]),(0,l.K2)(d,{visible:o.loading},null,8,["visible"])])}s(23816);const V={class:"row justify-between q-mb-xs q-mt-xs"},w={class:"col-6 q-py-xs"},A={class:"col-6 text-right q-py-xs relative-position"},R={class:"col-12"},U={class:"q-ma-none text-red"};function W(e,t,s,a,o,i){const n=(0,l.E1)("q-icon"),r=(0,l.E1)("q-btn"),m=(0,l.E1)("q-separator"),d=(0,l.E1)("nestedDraggable"),c=(0,l.E1)("draggable"),u=(0,l.E1)("q-card-section"),h=(0,l.E1)("q-card-actions"),p=(0,l.E1)("q-card"),g=(0,l.E1)("q-dialog");return(0,l.Wz)(),(0,l.An)("div",null,[(0,l.K2)(c,(0,l.Gu)({tag:"div"},i.dragOptions,{list:s.menuItems,group:{name:"g1"},"item-key":"id"}),{item:(0,l.Ql)((({element:t})=>[((0,l.Wz)(),(0,l.An)("div",{class:"list-group-item",key:t.id},[(0,l.QD)("div",V,[(0,l.QD)("div",w,[(0,l.K2)(n,{class:"cursor-pointer",name:"fas fa-arrows-alt"}),(0,l.mY)(" "+(0,y.WA)(t.title),1)]),(0,l.QD)("div",A,[(0,l.K2)(r,{to:{name:"qmenu.admin.menu.update",params:{menuId:e.$route.params.id,id:t.id}},icon:"fas fa-pen",size:"xs",class:"q-mr-sm",rounded:"",unelevated:"",color:"green"},null,8,["to"]),(0,l.K2)(r,{onClick:e=>{o.dialogDeleteItem=!0,o.itemIdToDelete=t},icon:"fas fa-trash-alt",size:"xs",rounded:"",unelevated:"",color:"red"},null,8,["onClick"])]),(0,l.QD)("div",R,[(0,l.K2)(m)])]),(0,l.K2)(d,{class:(0,y.WN)(`${t.children.length} ?: q-mb-xs`),menuItems:t.children},null,8,["class","menuItems"])]))])),_:1},16,["list"]),(0,l.K2)(g,{modelValue:o.dialogDeleteItem,"onUpdate:modelValue":t[2]||(t[2]=e=>o.dialogDeleteItem=e)},{default:(0,l.Ql)((()=>[(0,l.K2)(p,{class:"backend-page"},{default:(0,l.Ql)((()=>[(0,l.K2)(u,null,{default:(0,l.Ql)((()=>[(0,l.QD)("h5",U,(0,y.WA)(o.itemIdToDelete.label),1),(0,l.mY)(" "+(0,y.WA)(e.$tr("isite.cms.message.deleteRecord")),1)])),_:1}),(0,l.K2)(h,{align:"right"},{default:(0,l.Ql)((()=>[(0,l.K2)(r,{color:"blue-grey",label:"Cancel",onClick:t[0]||(t[0]=e=>o.dialogDeleteItem=!1)}),(0,l.K2)(r,{color:"red",icon:"fas fa-trash-alt",label:"Delete",onClick:t[1]||(t[1]=e=>i.deleteItem())})])),_:1})])),_:1})])),_:1},8,["modelValue"])])}var z=s(10328),_=s.n(z);const M={name:"nestedDraggable",components:{draggable:_()},props:{menuItems:{required:!0,type:Array}},emits:["updated"],data(){return{dialogDeleteItem:!1,itemIdToDelete:{}}},computed:{dragOptions(){return{animation:200,group:"description",disabled:!1,ghostClass:"ghost"}}},methods:{deleteItem(){this.$crud.delete("apiRoutes.qmenu.menuItems",this.itemIdToDelete.id).then((e=>{this.$alert.success({message:this.$tr("isite.cms.message.recordDeleted")}),this.dialogDeleteItem=!1,this.$emit("updated")})).catch((e=>{this.$alert.error({message:this.$tr("isite.cms.message.recordNoDeleted"),pos:"bottom"})}))}}};var F=s(58120),N=s(70880),O=s(30852),B=s(70608),S=s(71008),L=s(66480);const Y=(0,g.c)(M,[["render",W]]),j=Y;q()(M,"components",{QIcon:F.c,QBtn:I.c,QSeparator:N.c,QDialog:O.c,QCard:B.c,QCardSection:S.c,QCardActions:L.c});var G=s(8932);const J={components:{nestedMenuItems:j},data(){return{loading:!1,menuItems:[],modalNewItem:!1,modalUpdateItem:!1,itemUpdate:{},itemDelete:{}}},created(){this.$nextTick((()=>{this.getItems(),G.kN.on("updateMenuItems",this.handlerUpdateMenuItems)}))},methods:{getItems(e=!1){this.loading=!0;let t=this.$route.params.id,s={refresh:e,params:{include:"menuitems"}};this.$crud.show("apiRoutes.qmenu.menus",t,s).then((e=>{this.menuItems=this.arrayToTree(e.data.menuitems),this.loading=!1})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1}))}))},updateOrder(){let e=[];this.treeToArray(this.menuItems,e),this.loading=!0,this.$crud.create("apiRoutes.qmenu.menuItemsOrdener",{menuitems:e}).then((e=>{this.loading=!1,this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`})})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"})}))},arrayToTree(e,t=0){return e.filter((s=>{if(s.parentId==t)return s["children"]=this.arrayToTree(e,s.id)}))},treeToArray(e,t,s=null){let l=[...e];l.forEach(((e,l)=>{e.position=l,e.parentId=s,t.push(e),e.children.length&&this.treeToArray(e.children,t,e.id)}))},handlerUpdateMenuItems(e){this.getItems()}}};var P=s(90111);const H=(0,g.c)(J,[["render",C]]),X=H;q()(J,"components",{QBtn:I.c,QTooltip:P.c});const Z={components:{formMenu:Q,indexItemsByMenu:X}},ee=(0,g.c)(Z,[["render",m]]),te=ee}}]);