"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[896],{80896:(e,t,n)=>{n.r(t),n.d(t,{default:()=>M});var o=n(92444);function i(e,t,n,i,r,l){const a=(0,o.E1)("attributes-form");return(0,o.Wz)(),(0,o.Az)(a,{modelValue:r.showModal,"onUpdate:modelValue":t[0]||(t[0]=e=>r.showModal=e),"id-block":r.idBlock,title:e.$tr("ibuilder.cms.blockEdit")},null,8,["modelValue","id-block","title"])}function r(e,t,n,i,r,l){var a=(0,o.E1)("dynamic-form"),c=(0,o.E1)("master-modal");return(0,o.Wz)(),(0,o.Az)(c,(0,o.Gu)({modelValue:e.show,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.show=t}),"custom-position":""},e.modalProps,{onHide:e.closeModal}),{default:(0,o.Ql)((function(){return[(0,o.K2)(a,{modelValue:e.formBlock,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.formBlock=t}),formType:"collapsible",blocks:e.fields,"no-actions":"","no-reset-with-blocks-update":""},null,8,["modelValue","blocks"])]})),_:1},16,["modelValue","onHide"])}var l=n(75836),a=n(20584),c=function(e,t,n){if(n||2===arguments.length)for(var o,i=0,r=t.length;i<r;i++)!o&&i in t||(o||(o=Array.prototype.slice.call(t,0,i)),o[i]=t[i]);return e.concat(o||Array.prototype.slice.call(t))},s=(0,l.cB)({blockConfigs:[],mainBlockSystemName:"x-ibuilder::block"});const u=(0,o.S6)((function(){return{get blockConfigs(){return s.blockConfigs},set blockConfigs(e){s.blockConfigs=e},get mainBlockSystemName(){return s.mainBlockSystemName},get ignoreConfigKeys(){var e=new Set(s.blockConfigs.reduce((function(e,t){var n;return c(c([],Object.keys(null!==(n=t.childBlocks)&&void 0!==n?n:{}),!0),e,!0)}),["componentAttributes"]));return Array.from(e)}}})).value;var d=function(){return d=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},d.apply(this,arguments)},f=function(e,t,n){if(n||2===arguments.length)for(var o,i=0,r=t.length;i<r;i++)!o&&i in t||(o||(o=Array.prototype.slice.call(t,0,i)),o[i]=t[i]);return e.concat(o||Array.prototype.slice.call(t))};const m={getOneBlock:function(e,t,n){return void 0===e&&(e=!1),void 0===n&&(n={}),new Promise((function(o,i){var r={refresh:e,params:d({filter:{allTranslations:!0},include:"fields,files"},n)};a.c.show("apiRoutes.qbuilder.blocks",t,r).then((function(e){o(e.data)})).catch((function(e){return i(e)}))}))},getModuleBlocks:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t={}),new Promise((function(n,o){var i={refresh:e,params:t};a.c.index("apiRoutes.qsite.configs",i).then((function(e){n(e.data)})).catch((function(e){return o(e)}))}))},getConfigBlocks:function(e){var t=[],n=Object.values(e).filter((function(e){return e}));return n.forEach((function(e){Object.values(e).forEach((function(e){"x-ibuilder::block"!==e.systemName&&(e.childBlocks=d({mainblock:"x-ibuilder::block"},e.childBlocks||{})),t.push(e)}))})),u.blockConfigs=t,t},updateBlock:function(e,t,n){return void 0===n&&(n={}),new Promise((function(o,i){var r=d(d({},n),{notToSnakeCase:f(f([],u.ignoreConfigKeys,!0),["component","entity","attributes"],!1)});delete t.children,a.c.update("apiRoutes.qbuilder.blocks",e,t,r).then((function(e){o(e.data)})).catch((function(e){return i(e)}))}))}};var h=n(8932),p=n(17072),b=function(){return b=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var i in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},b.apply(this,arguments)},k=function(e,t,n,o){function i(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,r){function l(e){try{c(o.next(e))}catch(t){r(t)}}function a(e){try{c(o["throw"](e))}catch(t){r(t)}}function c(e){e.done?n(e.value):i(e.value).then(l,a)}c((o=o.apply(e,t||[])).next())}))},g=function(e,t){var n,o,i,r,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(r&&(r=0,a[0]&&(l=0)),l)try{if(n=1,o&&(i=2&a[0]?o["return"]:a[0]?o["throw"]||((i=o["return"])&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return l.label++,{value:a[1],done:!1};case 5:l.label++,o=a[1],a=[0];continue;case 7:a=l.ops.pop(),l.trys.pop();continue;default:if(i=l.trys,!(i=i.length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){l=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){l.label=a[1];break}if(6===a[0]&&l.label<i[1]){l.label=i[1],i=a;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(a);break}i[2]&&l.ops.pop(),l.trys.pop();continue}a=t.call(e,l)}catch(c){a=[6,c],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function v(e,t){var n=this,i={},r=(0,l.cB)({block:{},show:!1,formBlock:{},loading:!1,fields:[]}),a={modalProps:(0,o.S6)((function(){return r.show?{title:e.idBlock?"".concat(e.title," - ID: ").concat(e.idBlock):e.title,width:"max-content",loading:r.loading,actions:[{props:{color:"green",label:e.idBlock?h._s.tr("isite.cms.label.update"):h._s.tr("isite.cms.label.save")},action:function(){return c.updateBlock()}}]}:{}}))},c={init:function(){u.blockConfigs.length&&c.getData()},getConfigBlocks:function(){return k(n,void 0,void 0,(function(){var e,t,n;return g(this,(function(o){switch(o.label){case 0:r.loading=!0,e={filter:{allTranslations:!0,configNameByModule:"blocks"}},o.label=1;case 1:return o.trys.push([1,3,,4]),[4,m.getModuleBlocks(!0,e)];case 2:return t=o.sent(),m.getConfigBlocks(t),[3,4];case 3:return n=o.sent(),p.c.handleError(n,(function(){console.error("[Ibuilder Get Configs]: ",n)})),[3,4];case 4:return r.loading=!1,[2]}}))}))},getData:function(){var t;return k(this,void 0,void 0,(function(){var n,o;return g(this,(function(i){switch(i.label){case 0:if(!e.idBlock||!r.show)return[3,5];r.loading=!0,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,m.getOneBlock(!0,e.idBlock)];case 2:return n=i.sent(),r.block=(0,h.ct)(n),r.formBlock=(0,h.ct)(n),r.fields=c.getFormContentFields(null===(t=n.component)||void 0===t?void 0:t.systemName),[3,4];case 3:return o=i.sent(),p.c.handleError(o,(function(){console.error("[Ibuilder Get Data]: ",o)})),[3,4];case 4:r.loading=!1,i.label=5;case 5:return[2]}}))}))},updateBlock:function(){if(r.block){r.loading=!0;var e=b(b({},r.block),r.formBlock);m.updateBlock(e.id,e).then((function(e){h.Qb.info({message:h._s.tr("isite.cms.message.recordUpdated")}),t("update"),c.closeModal()})).catch((function(){h.Qb.error({message:h._s.tr("isite.cms.message.recordNoUpdated")}),r.loading=!1}))}},closeModal:function(){r.show=!1,r.block={},r.formBlock={},r.loading=!1,r.fields=[]},getFormContentFields:function(e){var t=[],n=u.blockConfigs,o=n.find((function(t){return t.systemName==e}));if(o){if(o.contentFields){var i=c.addFakeFieldName(o.contentFields,"componentAttributes");t.push({name:o.systemName,title:o.title,fields:i})}Object.entries(o.childBlocks).forEach((function(e){var o=e[0],i=e[1],r=n.find((function(e){return e.systemName==i}));if(r&&(null===r||void 0===r?void 0:r.contentFields)){var l=c.addFakeFieldName(r.contentFields,o);t.push({name:r.systemName,title:r.title,fields:l})}}))}return t},addFakeFieldName:function(t,n){for(var o={},i=0,r=Object.entries(t);i<r.length;i++){var l=r[i],a=l[0],c=l[1];o[a]=b(b({},c),"media"!==(null===c||void 0===c?void 0:c.type)?{fakeFieldName:n}:{fieldItemId:e.idBlock})}return o}};return(0,o.u2)((function(){c.getConfigBlocks()})),(0,o.Kg)((function(){return e.modelValue}),(function(e){r.show=(0,h.ct)(e),c.init()})),(0,o.Kg)((function(){return r.show}),(function(e){t("update:modelValue",e)})),(0,o.Kg)((function(){return u.blockConfigs}),(function(e){c.init()})),b(b(b(b({},i),(0,l.kx)(r)),a),c)}const y=(0,o._M)({props:{modelValue:{default:!1},title:{default:""},idBlock:{default:null}},emits:["update:modelValue","update"],components:{},setup:function(e,t){var n=t.emit;return v(e,n)}});var B=n(68716);const w=(0,B.c)(y,[["render",r]]),C=w,N={data(){return{crudId:this.$uid(),showModal:!1,idBlock:null}},components:{attributesForm:C},computed:{crudData(){return{crudId:this.crudId,apiRoute:"apiRoutes.qbuilder.blocks",permission:"ibuilder.blocks",create:!1,read:{columns:[{name:"id",label:this.$tr("isite.cms.form.id"),field:"id",style:"width: 50px"},{name:"title",label:this.$tr("isite.cms.form.title"),field:"internalTitle",align:"left"},{name:"componentName",label:this.$tr("isite.cms.label.component"),field:"component",align:"left",format:e=>e.systemName||"-"},{name:"systemName",label:this.$tr("isite.cms.form.systemName"),field:"systemName",align:"left"},{name:"status",label:this.$tr("isite.cms.form.status"),field:"status",align:"left"},{name:"created_at",label:this.$tr("isite.cms.form.createdAt"),field:"createdAt",align:"left",format:e=>e?this.$trd(e):"-"},{name:"actions",label:this.$tr("isite.cms.form.actions"),align:"left"}]},update:{method:e=>this.openModal(e.id)},delete:!0,formLeft:{}}},crudInfo(){return this.$store.state.qcrudComponent.component[this.crudId]||{}}},methods:{openModal(e){e&&(this.idBlock=e,this.showModal=!0)}}},F=(0,B.c)(N,[["render",i]]),M=F}}]);