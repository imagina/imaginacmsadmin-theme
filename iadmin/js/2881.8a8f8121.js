"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[2881],{83989:(t,e,i)=>{i.r(e),i.d(e,{default:()=>Q});var a=i(61758),s=i(58790),n=i(29104);const l={id:"notificationsIndexTitle",class:"row q-col-gutter-y-sm full-width items-center justify-between q-mt-md"},o={class:"row text-primary text-weight-bold ellipsis title-content items-center"},r={style:{"font-size":"20px"}},c={class:"row q-my-md"},d={class:"col-xs-12 col-sm-12 col-md-6 q-mb-md"},u={class:"col-xs-12 col-sm-9 col-md-6"},g={class:"row q-col-gutter-x-sm q-col-gutter-y-md"},m={class:"col-xs-6 col-md-3"},p={class:"tw-text-center"},h={class:"flex justify-end"},f={class:"row q-pa-md"},b={key:0,class:"col-12"},v={style:{"min-height":"100px"}},k={class:"q-pa-lg flex flex-center"},y={key:1,class:"col-12"},w={class:"tw-h-64 tw-content-center tw-justify-center"};function P(t,e,i,P,x,A){const F=(0,a.g2)("q-tab"),q=(0,a.g2)("q-tabs"),L=(0,a.g2)("dynamic-field"),S=(0,a.g2)("q-btn"),C=(0,a.g2)("notification-card"),V=(0,a.g2)("q-separator"),X=(0,a.g2)("q-pagination"),$=(0,a.g2)("not-result"),R=(0,a.g2)("inner-loading"),E=(0,a.g2)("q-page");return(0,a.uX)(),(0,a.Wv)(E,{id:"notificationsIndex"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",l,[(0,a.Lk)("div",o,[(0,a.Lk)("label",r,(0,s.v_)(t.$tr("notification.cms.sidebar.adminGroup")),1)])]),(0,a.Lk)("div",c,[(0,a.Lk)("div",d,[(0,a.bF)(q,{modelValue:x.filters.tab,"onUpdate:modelValue":e[0]||(e[0]=t=>x.filters.tab=t),dense:"",class:"text-grey","active-color":"primary","indicator-color":"primary",align:"left","no-caps":"","narrow-indicator":"",style:{"align-items":"center"}},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(x.tabs,((t,e)=>((0,a.uX)(),(0,a.Wv)(F,{key:e,name:t.value,label:t.label},null,8,["name","label"])))),128))])),_:1},8,["modelValue"])]),(0,a.Lk)("div",u,[(0,a.Lk)("div",g,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(x.formFields,((t,e)=>((0,a.uX)(),(0,a.Wv)(L,{key:e,field:t,modelValue:x.filters[e],"onUpdate:modelValue":t=>x.filters[e]=t,class:"col-xs-6 col-md-3"},null,8,["field","modelValue","onUpdate:modelValue"])))),128)),(0,a.Lk)("div",m,[(0,a.Lk)("div",p,[(0,a.Lk)("div",h,[(0,a.bF)(S,{class:"tw-text-sm tw-leading-[18px] tw-font-semibold",flat:"",dense:"",unelevated:"","no-caps":"",padding:"none",label:t.$tr("notification.cms.markAllAsRead"),onClick:e[1]||(e[1]=t=>A.markAllAsRead())},null,8,["label"])])])])])])]),(0,a.Lk)("div",f,[x.notifications.length>0?((0,a.uX)(),(0,a.CE)("div",b,[(0,a.Lk)("div",v,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(x.notifications,((t,i)=>((0,a.uX)(),(0,a.CE)("div",{key:i},[(0,a.bF)(C,{"item-notification":t,"show-mark-as-read":!0,"source-settings":x.sourceSettings||{},onRead:e=>A.removeFromUnread(t),onOpenModal:e[2]||(e[2]=t=>A.openModal(t))},null,8,["item-notification","source-settings","onRead"]),(0,a.bF)(V,{spaced:"10px"})])))),128))]),(0,a.Lk)("div",k,[(0,a.bo)((0,a.bF)(X,{modelValue:x.pagination.currentPage,"onUpdate:modelValue":e[3]||(e[3]=t=>x.pagination.currentPage=t),max:x.pagination.lastPage,"max-pages":6,ellipses:!1,"boundary-numbers":!1,unelevated:"",round:"",color:"blue-grey","active-color":"primary","direction-links":""},null,8,["modelValue","max"]),[[n.aG,x.pagination.lastPage>1&&!x.loading]])])])):((0,a.uX)(),(0,a.CE)("div",y,[(0,a.Lk)("div",w,[x.loading?(0,a.Q3)("",!0):((0,a.uX)(),(0,a.Wv)($,{key:0}))])]))]),(0,a.bF)(R,{visible:x.loading},null,8,["visible"])])),_:1})}i(10239);var x=i(38932),A=i(11743),F=i(71915);const q={props:{},components:{notificationCard:A.A},watch:{"pagination.currentPage":{handler:function(t){this.lockPagination||this.getNotifications()}},filters:{handler:async function(t){this.lockPagination=!0,this.pagination.currentPage=1,await this.getNotifications(),this.lockPagination=!1},deep:!0}},mounted(){this.$nextTick((function(){this.init()}))},data(){return{lockPagination:!1,loading:!1,notifications:[],formFields:{source:{value:null,type:"select",props:{label:this.$tr("notification.cms.type"),clearable:!0,options:[],vIf:!1}},date:{type:"date",props:{clearable:!0,label:this.$tr("isite.cms.form.date")}},search:{type:"search",props:{clearable:!0}}},filters:{tab:"all",date:null,time:null,source:null},tabs:[{value:"all",label:this.$tr("notification.cms.tab.all")},{value:"read",label:this.$tr("notification.cms.tab.read")},{value:"unread",label:this.$tr("notification.cms.tab.unread")}],pagination:{currentPage:1,lastPage:1,perPage:10,total:0},sourceSettings:null}},computed:{},methods:{async init(){await this.getSources(),await this.getNotifications()},getSources(){this.loading=!0,x.A.getSources().then((t=>{this.sourceSettings=t,this.addSourceFilterOptions()}))},addSourceFilterOptions(){for(const[t,e]of Object.entries(this.sourceSettings))this.formFields.source.props.options.push({label:this.sourceSettings[t]["label"],value:t});this.formFields.source.props.options.length>0&&(this.formFields.source.props.vIf=!0)},async resetPagination(){this.lockPagination=!0,this.pagination.currentPage=1,await this.getNotifications(),this.lockPagination=!1},getNotifications(){this.loading=!0;let t={refresh:!0,params:{take:this.pagination.perPage,page:this.pagination.currentPage,filter:{me:!0,type:"broadcast",order:{field:"id",way:"desc"}}}};return this.filters.tab!=this.tabs[0].value&&(t.params.filter["isRead"]=this.filters.tab==this.tabs[1].value),this.filters.date&&(t.params.filter["date"]=this.$moment(this.filters.date).format("YYYY-MM-DD 00:00:00")),this.filters.search&&(t.params.filter["search"]=this.filters.search),this.filters.source&&(t.params.filter["source"]=this.filters.source),new Promise(((e,i)=>{x.A.getNotifications(t).then((t=>{this.loading=!1,this.pagination.lastPage=t.meta.page.lastPage,this.pagination.total=t.meta.page.total,e(this.notifications=t.data)})).catch((t=>{this.$apiResponse.handleError(t,(()=>{this.loading=!1}))}))}))},removeFromUnread(t){this.filters.tab==this.tabs[2].value&&(this.notifications=this.notifications.filter((e=>e.id!==t.id))),0==this.notifications.length&&this.getNotifications()},markAllAsRead(){x.A.markAllAsRead().then((()=>{this.resetPagination()}))},openModal(t){F.Bt.emit("imagina.notification.open",t)}}};var L=i(12807),S=i(33177),C=i(64873),V=i(26721),X=i(69001),$=i(37015),R=i(33489),E=i(98582),I=i.n(E);const N=(0,L.A)(q,[["render",P]]),Q=N;I()(q,"components",{QPage:S.A,QTabs:C.A,QTab:V.A,QBtn:X.A,QSeparator:$.A,QPagination:R.A})}}]);