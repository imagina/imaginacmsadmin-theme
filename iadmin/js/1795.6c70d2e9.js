"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[1795],{91795:(e,t,l)=>{l.r(t),l.d(t,{default:()=>x});var a=l(61758),o=l(58790),s=l(29104);const i={id:"pageId",class:"q-layout-page layout-padding"},r={class:"relative-position q-mb-lg backend-page"},d={class:"box"},m={class:"col-md-8"},u={class:"col-md-4"};function n(e,t,l,n,c,p){const f=(0,a.g2)("q-tooltip"),h=(0,a.g2)("q-btn"),b=(0,a.g2)("q-input"),g=(0,a.g2)("q-select"),$=(0,a.g2)("q-item-section"),y=(0,a.g2)("q-item"),V=(0,a.g2)("dynamic-field"),q=(0,a.g2)("q-icon"),F=(0,a.g2)("q-date"),k=(0,a.g2)("q-popup-proxy"),v=(0,a.g2)("q-page-sticky"),R=(0,a.g2)("q-form"),D=(0,a.g2)("inner-loading");return(0,a.uX)(),(0,a.CE)("div",i,[(0,a.Lk)("div",r,[(0,a.Lk)("div",d,[(0,a.bF)(R,{onSubmit:t[22]||(t[22]=t=>e.$route.params.id?p.updateItem():p.createItem()),ref:"formContent",onValidationError:t[23]||(t[23]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid"))),class:"row q-col-gutter-x-md",autocomplete:"off"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",m,[(0,a.bF)(b,{modelValue:c.form.code,"onUpdate:modelValue":t[1]||(t[1]=e=>c.form.code=e),type:"text",outlined:"",dense:"",label:e.$tr("icommerce.cms.form.code"),rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},{after:(0,a.k6)((()=>[(0,a.bF)(h,{onClick:t[0]||(t[0]=e=>p.generateCoupon()),round:"",size:"sm",color:"primary",icon:"fas fa-qrcode"},{default:(0,a.k6)((()=>[(0,a.bF)(f,null,{default:(0,a.k6)((()=>[(0,a.eW)("Generate Code")])),_:1})])),_:1})])),_:1},8,["modelValue","label","rules"]),(0,a.bF)(g,{outlined:"",dense:"","bg-color":"white",modelValue:c.form.typeDiscount,"onUpdate:modelValue":t[2]||(t[2]=e=>c.form.typeDiscount=e),label:`${e.$tr("icommerce.cms.form.typeDiscount")}*`,style:{width:"100%"},"emit-value":"","map-options":"",options:[{label:this.$tr("icommerce.cms.options.fixedValue"),value:"0"},{label:this.$tr("icommerce.cms.options.percentage"),value:"1"}],rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","options","rules"]),(0,a.bF)(b,{modelValue:c.form.discount,"onUpdate:modelValue":t[3]||(t[3]=e=>c.form.discount=e),type:"number",outlined:"",dense:"",rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("icommerce.cms.form.discount")} *`},null,8,["modelValue","rules","label"]),(0,a.bF)(b,{modelValue:c.form.quantityTotal,"onUpdate:modelValue":t[4]||(t[4]=e=>c.form.quantityTotal=e),type:"number",outlined:"",dense:"",rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("icommerce.cms.form.quantityTotal")} *`},null,8,["modelValue","rules","label"]),(0,a.bF)(b,{modelValue:c.form.quantityTotalCustomer,"onUpdate:modelValue":t[5]||(t[5]=e=>c.form.quantityTotalCustomer=e),type:"number",outlined:"",dense:"",rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("icommerce.cms.form.quantityTotalCustomer")} *`},null,8,["modelValue","rules","label"]),(0,a.Q3)("",!0),(0,a.bF)(g,{outlined:"",dense:"","bg-color":"white",modelValue:c.form.type,"onUpdate:modelValue":t[7]||(t[7]=e=>c.form.type=e),label:`${e.$tr("icommerce.cms.form.allOrder")}*`,style:{width:"100%"},"emit-value":"","map-options":"",options:[{label:this.$tr("isite.cms.label.no"),value:"0"},{label:this.$tr("isite.cms.label.yes"),value:"1"}],rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","options","rules"]),(0,a.bo)((0,a.Lk)("div",null,[(0,a.bF)(g,{outlined:"",dense:"",modelValue:c.form.products,"onUpdate:modelValue":t[8]||(t[8]=e=>c.form.products=e),"use-input":"","emit-value":"","map-options":"","input-debounce":"800",options:c.productList,onFilter:p.getProducts,label:`${e.$trp("isite.cms.label.product")}`,multiple:"","use-chips":"",style:{width:"100%"},hint:`${e.$tr("icommerce.cms.form.productHint")}`},{"no-option":(0,a.k6)((()=>[(0,a.bF)(y,null,{default:(0,a.k6)((()=>[(0,a.bF)($,{class:"text-grey"},{default:(0,a.k6)((()=>[(0,a.eW)((0,o.v_)(e.$tr("isite.cms.message.searchNotFound")),1)])),_:1})])),_:1})])),_:1},8,["modelValue","options","onFilter","label","hint"]),(0,a.bF)(V,{field:p.dynamicFields.categories,modelValue:c.form.categories,"onUpdate:modelValue":t[9]||(t[9]=e=>c.form.categories=e)},null,8,["field","modelValue"]),(0,a.bF)(V,{field:p.dynamicFields.manufacturers,modelValue:c.form.manufacturers,"onUpdate:modelValue":t[10]||(t[10]=e=>c.form.manufacturers=e)},null,8,["field","modelValue"])],512),[[s.aG,"0"==c.form.type]])]),(0,a.Lk)("div",u,[(0,a.bF)(g,{outlined:"",dense:"","bg-color":"white",modelValue:c.form.status,"onUpdate:modelValue":t[11]||(t[11]=e=>c.form.status=e),rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("icommerce.cms.form.status")}*`,style:{width:"100%"},"emit-value":"","map-options":"",options:[{label:this.$tr("isite.cms.label.enabled"),value:"1"},{label:this.$tr("isite.cms.label.disabled"),value:"2"}]},null,8,["modelValue","rules","label","options"]),(0,a.bF)(b,{dense:"",mask:"date","bg-color":"white",modelValue:c.form.dateStart,"onUpdate:modelValue":t[14]||(t[14]=e=>c.form.dateStart=e),color:"primary",rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("icommerce.cms.form.dateStart")}*`,outlined:"",placeholder:"YYYY/MM/DD"},{append:(0,a.k6)((()=>[(0,a.bF)(q,{name:"fas fa-calendar-day"}),(0,a.bF)(k,{ref:"qDateStart","transition-show":"scale","transition-hide":"scale"},{default:(0,a.k6)((()=>[(0,a.bF)(F,{modelValue:c.form.dateStart,"onUpdate:modelValue":[t[12]||(t[12]=e=>c.form.dateStart=e),t[13]||(t[13]=t=>e.$refs.qDateStart.hide())]},null,8,["modelValue"])])),_:1},512)])),_:1},8,["modelValue","rules","label"]),(0,a.bF)(b,{dense:"",mask:"date","bg-color":"white",modelValue:c.form.dateEnd,"onUpdate:modelValue":t[17]||(t[17]=e=>c.form.dateEnd=e),color:"primary",rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("icommerce.cms.form.dateEnd")}*`,outlined:"",placeholder:"YYYY/MM/DD"},{append:(0,a.k6)((()=>[(0,a.bF)(q,{name:"fas fa-calendar-day"}),(0,a.bF)(k,{ref:"qDateEnd","transition-show":"scale","transition-hide":"scale"},{default:(0,a.k6)((()=>[(0,a.bF)(F,{modelValue:c.form.dateEnd,"onUpdate:modelValue":[t[15]||(t[15]=e=>c.form.dateEnd=e),t[16]||(t[16]=t=>e.$refs.qDateEnd.hide())]},null,8,["modelValue"])])),_:1},512)])),_:1},8,["modelValue","rules","label"]),(0,a.Q3)("",!0),(0,a.bF)(g,{outlined:"",dense:"","bg-color":"white",modelValue:c.form.logged,"onUpdate:modelValue":t[19]||(t[19]=e=>c.form.logged=e),label:`${e.$tr("icommerce.cms.form.logged")}*`,style:{width:"100%"},"emit-value":"","map-options":"",options:[{label:this.$tr("isite.cms.label.yes"),value:"1"},{label:this.$tr("isite.cms.label.no"),value:"0"}],rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","options","rules"]),(0,a.bF)(V,{field:p.dynamicFields.includeDepartments,modelValue:c.form.includeDepartments,"onUpdate:modelValue":t[20]||(t[20]=e=>c.form.includeDepartments=e)},null,8,["field","modelValue"]),(0,a.bF)(V,{field:p.dynamicFields.excludeDepartments,modelValue:c.form.excludeDepartments,"onUpdate:modelValue":t[21]||(t[21]=e=>c.form.excludeDepartments=e)},null,8,["field","modelValue"])]),(0,a.bF)(v,{position:"bottom-right",offset:[18,18]},{default:(0,a.k6)((()=>[e.$route.params.id?((0,a.uX)(),(0,a.Wv)(h,{key:0,color:"green",loading:c.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.update"),type:"submit"},null,8,["loading","label"])):((0,a.uX)(),(0,a.Wv)(h,{key:1,color:"green",loading:c.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.create"),type:"submit"},null,8,["loading","label"]))])),_:1})])),_:1},512),(0,a.bF)(D,{visible:c.loading},null,8,["visible"])])])])}l(10239);var c=l(71915);const p={components:{},computed:{dynamicFields(){return{includeDepartments:{value:[0],type:"select",loadOptions:{apiRoute:"apiRoutes.quser.departments",select:{label:"title",id:"id"}},props:{clearable:!0,multiple:!0,label:`${this.$tr("icommerce.cms.form.customerGroup")}*`,options:[{label:"All",value:0}]}},excludeDepartments:{value:[],type:"select",loadOptions:{apiRoute:"apiRoutes.quser.departments",select:{label:"title",id:"id"}},props:{clearable:!0,multiple:!0,label:`${this.$tr("icommerce.cms.form.customerGroupExclude")}`}},categories:{value:[],type:"treeSelect",loadOptions:{apiRoute:"apiRoutes.qcommerce.categories",select:{label:"title",id:"id"}},props:{clearable:!0,multiple:!0,label:`${this.$trp("isite.cms.label.category")}`}},manufacturers:{value:[],type:"select",loadOptions:{apiRoute:"apiRoutes.qcommerce.manufacturers",select:{label:"name",id:"id"}},props:{clearable:!0,multiple:!0,useChips:!0,label:`${this.$trp("icommerce.cms.form.manufacturer")}`}}}}},data(){return{loading:!1,types:[],productList:[],form:{id:"",code:"",discount:"",type:"1",typeDiscount:null,logged:"0",shipping:"0",minimumOrderAmount:"0",quantityProducts:"0",dateStart:"",dateEnd:"",quantityTotal:"",quantityTotalCustomer:"",status:1,includeDepartments:[0],excludeDepartments:[],categories:[],products:[],manufacturers:[]}}},watch:{"form.type":function(e){}},mounted(){this.$nextTick((()=>{this.initForm(),c.Bt.on("page.data.refresh",(()=>this.initForm()))}))},methods:{initForm(){this.$route.params.id&&this.getData()},getData(){this.loading=!0;let e={refresh:!0,params:{include:"categories,products,manufacturers"}};this.$crud.show("apiRoutes.qcommerce.coupons",this.$route.params.id,e).then((e=>{let t=this.$clone(e.data);for(let l in t)t[l]=Array.isArray(e.data[l])?e.data[l]:null!=e.data[l]?e.data[l].toString():null;Object.assign(this.form,{...t}),setTimeout((()=>{this.form.products&&this.form.products.length>0&&this.getProductsFromBack(),this.loading=!1}),1e3)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{console.error(e),this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1}))}))},getProducts(e,t,l){if(e.length<2)return l();let a={params:{take:100,filter:{search:e}}};this.$crud.index("apiRoutes.qcommerce.products",a).then((e=>{t((()=>{let t=this.$array.select(e.data,{label:"name",id:"id"});this.productList=this.$clone(t)}))})).catch((e=>{this.$apiResponse.handleError(e,(()=>{t((()=>{this.productList=[]}))}))}))},getProductsFromBack(){this.form.products=this.form.products.map((e=>e.id));let e={params:{take:100,filter:{ids:this.form.products}}};this.$crud.index("apiRoutes.qcommerce.products",e).then((e=>{let t=this.$array.select(e.data,{label:"name",id:"id"});this.productList=this.$clone(t)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.productList=[]}))}))},createItem(){this.loading=!0,this.$crud.create("apiRoutes.qcommerce.coupons",this.form).then((e=>{this.loading=!1,this.$router.push({name:"qcommerce.admin.coupons.index"}),this.$alert.success({message:`${this.$tr("isite.cms.message.recordCreated")} ID: ${e.data.id}`})})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoCreatde"),pos:"bottom"})}))},updateItem(){this.loading=!0,this.$crud.update("apiRoutes.qcommerce.coupons",this.form.id,this.form).then((e=>{this.loading=!1,this.$router.push({name:"qcommerce.admin.coupons.index"}),this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.initForm()})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))},generateCoupon(){this.form.code=this.makeCouponCode(20).toUpperCase()},makeCouponCode(e=10){let t="",l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=l.length;for(var o=0;o<e;o++)t+=l.charAt(Math.floor(Math.random()*a));return t}}};var f=l(12807),h=l(83333),b=l(21565),g=l(78020),$=l(69001),y=l(78151),V=l(833),q=l(75329),F=l(63418),k=l(24609),v=l(87308),R=l(73145),D=l(70918),C=l(98582),U=l.n(C);const w=(0,f.A)(p,[["render",n]]),x=w;U()(p,"components",{QLayout:h.A,QForm:b.A,QInput:g.A,QBtn:$.A,QTooltip:y.A,QSelect:V.A,QItem:q.A,QItemSection:F.A,QIcon:k.A,QPopupProxy:v.A,QDate:R.A,QPageSticky:D.A})}}]);