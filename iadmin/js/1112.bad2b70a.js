"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[1112],{61112:(t,e,s)=>{s.r(e),s.d(e,{default:()=>mt});var a=s(92444),i=s(74044);const o={id:"quotesFormPage"},r={id:"quoteFormContent",class:"relative-position"},c={class:"row q-col-gutter-md"},l={class:"col-4"},d={class:"box box-auto-height q-mb-md"},n={class:"row items-center"},m={class:"col box-title"},u={class:"col text-right"},p={class:"text-grey q-mr-sm"},h={key:0},g={class:"box box-auto-height q-mb-md"},b={class:"row items-center"},$={class:"col box-title"},f={class:"row items-center"},D={class:"col-7 text-caption text-blue-grey",style:{"line-height":"1"}},v={class:"col-5 text-right"},Q={class:"box box-auto-height q-mb-md"},q={class:"row items-center"},A={class:"col box-title"},x={class:"row"},y={class:"col-6 text-blue-grey"},C={class:"col-6 text-right"},W=(0,a.QD)("div",{class:"col-6 text-blue-grey"},"Total:",-1),k={class:"col-6 text-right"},P={id:"actionsSummary",class:"text-right"},w={key:1,class:"box box-auto-height text-center"},V={class:"q-mb-sm"},O={class:"col-8"};function I(t,e,s,I,E,K){const z=(0,a.E1)("q-btn"),R=(0,a.E1)("q-separator"),S=(0,a.E1)("dynamic-form"),T=(0,a.E1)("master-modal"),_=(0,a.E1)("btn-menu"),N=(0,a.E1)("q-icon"),U=(0,a.E1)("crud"),B=(0,a.E1)("select-product-config"),F=(0,a.E1)("inner-loading");return(0,a.Wz)(),(0,a.An)("div",o,[(0,a.QD)("div",r,[(0,a.QD)("div",c,[(0,a.QD)("div",l,[(0,a.QD)("div",d,[(0,a.QD)("div",n,[(0,a.QD)("div",m,(0,i.WA)(t.$tr("isite.cms.label.customer")),1),(0,a.QD)("div",u,[(0,a.K2)(z,{icon:"fas fa-pen",onClick:e[0]||(e[0]=t=>E.modalCustomer=!0),color:"green",round:"",unelevated:"",class:"btn-small"})])]),(0,a.K2)(R,{class:"q-my-sm"}),((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)(E.form,((t,e)=>((0,a.Wz)(),(0,a.An)("div",{key:e,class:"row"},[(0,a.QD)("label",p,(0,i.WA)(e)+":",1),(0,a.mY)(" "+(0,i.WA)(E.form[e]),1)])))),128)),(0,a.K2)(T,{modelValue:E.modalCustomer,"onUpdate:modelValue":e[3]||(e[3]=t=>E.modalCustomer=t),title:t.$tr("isite.cms.label.customer")},{default:(0,a.Ql)((()=>[(0,a.K2)(S,{modelValue:E.form,"onUpdate:modelValue":e[1]||(e[1]=t=>E.form=t),"form-id":K.settings.formId,"hide-title":"","hide-progress-bar":"",onSubmit:e[2]||(e[2]=t=>E.modalCustomer=!1),"default-col-class":"col-12"},null,8,["modelValue","form-id"])])),_:1},8,["modelValue","title"])]),E.cartData&&E.cartData.products.length?((0,a.Wz)(),(0,a.An)("div",h,[(0,a.QD)("div",g,[(0,a.QD)("div",b,[(0,a.QD)("div",$,(0,i.WA)(t.$tr("isite.cms.label.quote"))+" | #"+(0,i.WA)(E.cartData.id),1)]),((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)(E.cartData.products,((e,s)=>((0,a.Wz)(),(0,a.An)("div",{key:s},[(0,a.K2)(R,{class:"q-my-sm"}),(0,a.QD)("div",f,[(0,a.QD)("div",D,(0,i.WA)(e.product.name),1),(0,a.QD)("div",v,[(0,a.mY)(" $"+(0,i.WA)(t.$trn(e.total))+" ",1),(0,a.K2)(_,{class:"q-ml-md",actions:K.itemQuoteActions(e)},null,8,["actions"])])])])))),128))]),(0,a.QD)("div",Q,[(0,a.QD)("div",q,[(0,a.QD)("div",A,(0,i.WA)(t.$tr("isite.cms.label.summary")),1)]),(0,a.K2)(R,{class:"q-my-sm"}),(0,a.QD)("div",x,[(0,a.QD)("div",y,(0,i.WA)(t.$tr("isite.cms.label.quantity"))+":",1),(0,a.QD)("div",C,(0,i.WA)(E.cartData.products.length),1),W,(0,a.QD)("div",k,"$"+(0,i.WA)(t.$trn(parseInt(E.cartData.total)||0)),1)]),(0,a.K2)(R,{class:"q-my-sm"}),(0,a.QD)("div",P,[(0,a.K2)(z,{label:t.$tr("isite.cms.label.send"),color:"green",rounded:"",unelevated:"",onClick:K.sendQuote},null,8,["label","onClick"])])])])):((0,a.Wz)(),(0,a.An)("div",w,[(0,a.QD)("div",V,(0,i.WA)(t.$tr("icommerce.cms.message.addProductToQuote")),1),(0,a.K2)(N,{name:"fas fa-arrow-alt-circle-right",color:"cyan",size:"40px"})]))]),(0,a.QD)("div",O,[(0,a.K2)(U,(0,i.Gk)((0,a.o9)(K.crudProductsProps)),null,16)])]),(0,a.K2)(B,{ref:"selectProductConfig"},null,512),(0,a.K2)(F,{visible:E.loading},null,8,["visible"])])])}s(23816);const E={key:0,class:"box q-mb-md box-auto-height"},K={class:"box-title text-lowercase"},z={class:"row"},R={class:"col-6 text-blue-grey"},S={class:"col-6 text-right"},T={class:"col-6 text-blue-grey"},_={class:"col-6 text-right"},N=(0,a.QD)("div",{class:"col-6 text-blue-grey"},"Total:",-1),U={class:"col-6 text-right"},B={key:1,class:"box"},F={class:"box-title"};function L(t,e,s,o,r,c){const l=(0,a.E1)("q-separator"),d=(0,a.E1)("q-checkbox"),n=(0,a.E1)("q-item-section"),m=(0,a.E1)("q-item"),u=(0,a.E1)("q-list"),p=(0,a.E1)("master-modal"),h=(0,a.iS)("ripple");return(0,a.Wz)(),(0,a.Az)(p,{id:"selectProductConfig",modelValue:r.modal,"onUpdate:modelValue":e[1]||(e[1]=t=>r.modal=t),title:t.$tr("icommerce.cms.message.productSetup"),loading:r.loading,actions:c.modalActions},{default:(0,a.Ql)((()=>[r.productData?((0,a.Wz)(),(0,a.An)("div",E,[(0,a.QD)("div",K,(0,i.WA)(r.productData.name),1),(0,a.K2)(l,{class:"q-my-sm"}),(0,a.QD)("div",z,[(0,a.QD)("div",R,(0,i.WA)(t.$tr("isite.cms.label.price"))+":",1),(0,a.QD)("div",S,"$"+(0,i.WA)(t.$trn(r.productData.price||0)),1),(0,a.QD)("div",T,(0,i.WA)(t.$trp("isite.cms.label.option"))+":",1),(0,a.QD)("div",_,"$"+(0,i.WA)(t.$trn(c.priceOptions)),1),N,(0,a.QD)("div",U,"$"+(0,i.WA)(t.$trn(parseInt(r.productData.price)+parseInt(c.priceOptions)||0)),1)])])):(0,a.g1)("",!0),r.productData?((0,a.Wz)(),(0,a.An)("div",B,[(0,a.QD)("div",F,(0,i.WA)(t.$trp("isite.cms.label.option")),1),(0,a.K2)(l,{class:"q-mt-sm"}),(0,a.K2)(u,{class:"q-pa-none"},{default:(0,a.Ql)((()=>[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)(r.productData.optionValues,((s,o)=>(0,a.wt)(((0,a.Wz)(),(0,a.Az)(m,{key:o,clickable:"",class:"q-pl-none q-pr-sm"},{default:(0,a.Ql)((()=>[(0,a.K2)(n,null,{default:(0,a.Ql)((()=>[((0,a.Wz)(),(0,a.Az)(d,{modelValue:r.params.selectedOptions,"onUpdate:modelValue":e[0]||(e[0]=t=>r.params.selectedOptions=t),key:s.id,val:s.id,label:s.optionValue},null,8,["modelValue","val","label"]))])),_:2},1024),(0,a.K2)(n,{side:""},{default:(0,a.Ql)((()=>[(0,a.mY)(" $"+(0,i.WA)(t.$trn(s.price)),1)])),_:2},1024)])),_:2},1024)),[[h]]))),128))])),_:1})])):(0,a.g1)("",!0)])),_:1},8,["modelValue","title","loading","actions"])}const Y={props:{},components:{},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,modal:!1,productData:!1,params:{productId:!1,selectedOptions:[],callBack:()=>{}}}},computed:{modalActions(){return[{props:{label:this.params.actionLabel||this.$tr("isite.cms.label.save"),color:"green"},action:()=>this.emitProductConfig()}]},priceOptions(){let t=0;return this.params.selectedOptions&&this.params.selectedOptions.length&&this.productData.optionValues.forEach((e=>{this.params.selectedOptions.includes(e.id)&&(t+=e.price)})),t}},methods:{init(){this.getData()},load(t){this.params=this.$clone({...this.params,...t}),this.getData(!0),this.modal=!0},getData(t=!1){if(this.params.productId)return new Promise(((e,s)=>{this.loading=!0;let a={refresh:t,params:{include:"optionValues"}};this.$crud.show("apiRoutes.qcommerce.products",this.params.productId,a).then((t=>{this.productData=t.data,this.productData&&this.productData.optionValues&&this.productData.optionValues.forEach((t=>{t.price||this.params.selectedOptions.push(this.$clone(t.id))})),this.loading=!1})).catch((t=>{this.$apiResponse.handleError(t,(()=>{this.loading=!1}))}))}))},reset(){this.productData=!1,this.params={productId:!1,selectedOptions:[],callBack:()=>{}}},emitProductConfig(){this.params.callBack({product:this.$clone(this.productData),options:this.params.selectedOptions.length?this.productData.optionValues.filter((t=>this.params.selectedOptions.includes(t.id))):[]}),this.reset(),this.modal=!1}}};var G=s(68716),j=s(70880),H=s(99588),J=s(84884),M=s(11032),X=s(78488),Z=s(29632),tt=s(85220),et=s(95252),st=s.n(et);const at=(0,G.c)(Y,[["render",L]]),it=at;st()(Y,"components",{QSeparator:j.c,QList:H.c,QItem:J.c,QItemSection:M.c,QCheckbox:X.c,QOptionGroup:Z.c}),st()(Y,"directives",{Ripple:tt.c});var ot=s(8932);const rt={beforeUnmount(){ot.kN.off("qcommerce.quote.addProduct")},props:{},components:{selectProductConfig:it},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,modalCustomer:!1,form:{},cartData:!1}},computed:{settings(){return{formId:this.$getSetting("icommerce::icommerceCartQuoteForm")}},crudProductsProps(){return{crudData:s.e(2448).then(s.bind(s,32448)),title:this.$trp("isite.cms.label.product"),customData:{create:!1,read:{showAs:"grid",allowToggleView:!1,grid:{component:()=>s.e(4636).then(s.bind(s,84636))},filters:{status:{value:"1"},stockStatus:{value:1},soonToSoldOut:{value:!1},withDiscount:{value:!1},categories:{value:null,type:"treeSelect",props:{label:`${this.$tr("isite.cms.form.category")}:`,clearable:!0},loadOptions:{apiRoute:"apiRoutes.qcommerce.categories"}},manufacturers:{value:null,type:"select",props:{label:`${this.$tr("icommerce.cms.form.manufacturer")}:`,clearable:!0},loadOptions:{apiRoute:"apiRoutes.qcommerce.manufacturers",select:{label:"name",id:"id"}}}}},update:!1,delete:!1}}}},methods:{async init(){Object.keys(this.form).length||(this.modalCustomer=!0),this.manageAddProduct(),this.getCart()},getCart(){return new Promise(((t,e)=>{this.loading=!0;let s={userId:this.$store.state.quserAuth.userId};this.$crud.create("apiRoutes.qcommerce.carts",s).then((t=>{this.cartData=t.data,this.loading=!1})).catch((t=>{this.loading=!1,e(t)}))}))},manageAddProduct(){ot.kN.on("qcommerce.quote.addProduct",(t=>{this.$refs.selectProductConfig.load({productId:t.id,actionLabel:this.$tr("isite.cms.label.add"),callBack:t=>this.addProduct(t)})}))},itemQuoteActions(t){return[{icon:"fas fa-pen",color:"red",label:`${this.$tr("isite.cms.label.show")} / ${this.$tr("isite.cms.label.edit")}`,action:()=>{this.$refs.selectProductConfig.load({productId:t.product.id,selectedOptions:t.productOptionValues.map((t=>t.id)),callBack:e=>{this.loading=!0;let s={cartId:this.cartData.id,productId:e.product.id,quantity:1,productOptionValues:e.options,isCall:!0};this.$crud.update("apiRoutes.qcommerce.cartProducts",t.id,s).then((t=>{this.$alert.info({message:this.$tr("isite.cms.message.recordUpdated")}),this.getCart()})).catch((t=>{this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")}),this.loading=!1}))}})}},{icon:"fas fa-trash-alt",color:"red",label:this.$tr("isite.cms.label.delete"),action:()=>{this.loading=!0,this.$crud.delete("apiRoutes.qcommerce.cartProducts",t.id).then((t=>{this.$alert.info({message:this.$tr("isite.cms.message.recordDeleted")}),this.getCart()})).catch((t=>{this.$alert.error({message:this.$tr("isite.cms.message.recordNoDeleted")}),this.loading=!1}))}}]},addProduct(t){return new Promise(((e,s)=>{this.loading=!0;let a={cartId:this.cartData.id,productId:t.product.id,quantity:1,productOptionValues:t.options,isCall:!0};this.$crud.create("apiRoutes.qcommerce.cartProducts",a).then((t=>{this.$alert.info({message:`${this.$tr("isite.cms.message.recordCreated")}`}),this.getCart(),e(t.data)})).catch((t=>{this.$alert.error({message:`${this.$tr("isite.cms.message.recordNoCreated")}`}),this.loading=!1,s(t)}))}))},sendQuote(){return new Promise(((t,e)=>{if(!this.form.email)return this.modalCustomer=!0,t(!1);this.loading=!0;let s={cartId:this.cartData.id,type:"quote",firstName:this.form.first_name||"",lastName:this.form.last_name||"",email:this.form.email||"",telephone:this.form.telephone||"",options:{quoteForm:this.form}};this.$crud.create("apiRoutes.qcommerce.orders",s).then((t=>{this.$alert.info({message:`${this.$tr("isite.cms.message.recordCreated")}`}),this.$router.push({name:"qcommerce.admin.quotes.index"})})).catch((t=>{this.$alert.error({message:`${this.$tr("isite.cms.message.recordNoCreated")}`}),this.loading=!1}))}))}}};var ct=s(99140),lt=s(58120),dt=s(65264);const nt=(0,G.c)(rt,[["render",I]]),mt=nt;st()(rt,"components",{QBtn:ct.c,QSeparator:j.c,QIcon:lt.c,QTabPanels:dt.c})}}]);