"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[3348],{80696:(t,e,i)=>{i.r(e),i.d(e,{default:()=>pt});var s=i(61758),a=i(58790);const o={id:"showOrderPage"},l={class:"box box-auto-height q-mb-md"},r={id:"dynamicBlocksContent",class:"row q-col-gutter-md"},n={class:"box-title"},m={id:"orderItemsContent",class:"box box-auto-height q-mb-md"},d={style:{"max-width":"250px","white-space":"normal"}},c={class:"box box-auto-height q-mb-md"},u={class:"text-blue-grey q-mr-sm"},p={class:"row q-col-gutter-md q-mb-md"},h={class:"col-12 col-md-6"},g={id:"trackingOrderStatusContent",class:"box box-auto-height"},b={class:"box-title"},f={key:0,class:"box q-mt-md"},v={class:"box-title"},$={key:0,class:"col-12 col-md-6"},y={class:"box"},k={class:"box-title"};function q(t,e,i,q,R,w){const C=(0,s.g2)("page-actions"),I=(0,s.g2)("q-icon"),x=(0,s.g2)("q-separator"),F=(0,s.g2)("q-item-label"),A=(0,s.g2)("q-item-section"),L=(0,s.g2)("q-item"),_=(0,s.g2)("q-list"),E=(0,s.g2)("q-td"),S=(0,s.g2)("btn-menu"),Q=(0,s.g2)("q-table"),P=(0,s.g2)("dynamic-form"),T=(0,s.g2)("master-modal"),X=(0,s.g2)("q-timeline-entry"),O=(0,s.g2)("q-timeline"),V=(0,s.g2)("advance-chat"),D=(0,s.g2)("inner-loading");return(0,s.uX)(),(0,s.CE)("div",o,[(0,s.Lk)("div",l,[(0,s.bF)(C,{onRefresh:w.init,"exclude-actions":["export"],"extra-actions":w.extraPageActions,title:`${t.$tr(t.$route.meta.title)} #${w.orderId.toString().padStart(5,"0")}`},null,8,["onRefresh","extra-actions","title"])]),(0,s.Lk)("div",r,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(w.informationBlocks,((t,e)=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"col-12 col-md-6"},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t,((t,e)=>((0,s.uX)(),(0,s.CE)("div",{key:e,class:"box box-auto-height q-mb-md"},[(0,s.Lk)("div",n,[t.icon?((0,s.uX)(),(0,s.Wv)(I,{key:0,name:t.icon},null,8,["name"])):(0,s.Q3)("",!0),(0,s.eW)(" "+(0,a.v_)(t.title),1)]),(0,s.bF)(x,{class:"q-my-sm"}),(0,s.bF)(_,null,{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.values,((t,e)=>((0,s.uX)(),(0,s.Wv)(L,{key:e,class:"q-px-none"},{default:(0,s.k6)((()=>[(0,s.bF)(A,null,{default:(0,s.k6)((()=>[(0,s.bF)(F,null,{default:(0,s.k6)((()=>[(0,s.eW)((0,a.v_)(t.label),1)])),_:2},1024),(0,s.bF)(F,{caption:"",innerHTML:t.value},null,8,["innerHTML"])])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)])))),128))])))),128))]),(0,s.Lk)("div",m,[(0,s.bF)(Q,(0,a._B)((0,s.Ng)(w.tableConfig.props)),{"body-cell-productOptionsLabel":(0,s.k6)((t=>[(0,s.bF)(E,{props:t},{default:(0,s.k6)((()=>[(0,s.Lk)("div",d,(0,a.v_)(t.value),1)])),_:2},1032,["props"])])),"body-cell":(0,s.k6)((t=>["actions"==t.col.name?((0,s.uX)(),(0,s.Wv)(E,{key:0,props:t},{default:(0,s.k6)((()=>[(0,s.bF)(S,{actions:w.tableConfig.actions,"action-data":t.row},null,8,["actions","action-data"])])),_:2},1032,["props"])):((0,s.uX)(),(0,s.Wv)(E,{key:1,props:t,title:t.value},{default:(0,s.k6)((()=>[(0,s.eW)((0,a.v_)(t.value),1)])),_:2},1032,["props","title"]))])),_:1},16),(0,s.bF)(T,{modelValue:R.modalRating.show,"onUpdate:modelValue":e[1]||(e[1]=t=>R.modalRating.show=t),title:t.$tr("isite.cms.label.rating"),loading:R.modalRating.loading},{default:(0,s.k6)((()=>[(0,s.Lk)("div",c,[(0,s.Lk)("b",u,(0,a.v_)(t.$tr("isite.cms.label.product"))+":",1),(0,s.eW)(" "+(0,a.v_)(R.modalRating.item.title),1)]),R.modalRating.loading?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.Wv)(P,(0,s.v6)({key:0},w.form.rating,{onSent:e[0]||(e[0]=t=>{R.modalRating.show=!1,w.init()})}),null,16))])),_:1},8,["modelValue","title","loading"])]),(0,s.Lk)("div",p,[(0,s.Lk)("div",h,[(0,s.Lk)("div",g,[(0,s.Lk)("div",b,(0,a.v_)(t.$tr("icommerce.cms.orderHistory")),1),(0,s.bF)(x,{class:"q-mt-sm q-mb-md"}),(0,s.bF)(O,{color:"info",class:"q-mb-none"},{default:(0,s.k6)((()=>[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(w.timeLine,((t,e)=>((0,s.uX)(),(0,s.Wv)(X,{key:e,title:t.title,subtitle:t.subtitle,body:t.body},null,8,["title","subtitle","body"])))),128))])),_:1})]),w.canEditOrder?((0,s.uX)(),(0,s.CE)("div",f,[(0,s.Lk)("div",v,(0,a.v_)(t.$tr("icommerce.cms.newStatus")),1),(0,s.bF)(x,{class:"q-mt-sm q-mb-md"}),(0,s.bF)(P,(0,s.v6)(w.form.status,{onSent:e[2]||(e[2]=t=>w.init())}),null,16)])):(0,s.Q3)("",!0)]),R.conversation?((0,s.uX)(),(0,s.CE)("div",$,[(0,s.Lk)("div",y,[(0,s.Lk)("div",k,(0,a.v_)(t.$trp("isite.cms.label.message")),1),(0,s.bF)(x,{class:"q-mt-sm q-mb-md"}),(0,s.bF)(V,{"room-id":R.conversation.id},null,8,["room-id"])])])):(0,s.Q3)("",!0)]),(0,s.bF)(D,{visible:R.loading},null,8,["visible"])])}i(10239);const R={id:"orderStatusHistoryComponent"};function w(t,e,i,a,o,l){const r=(0,s.g2)("q-table");return(0,s.uX)(),(0,s.CE)("div",R,[(0,s.bF)(r,{rows:i.items,columns:o.columns,pagination:{rowsPerPage:0},"hide-bottom":"",class:"no-shadow"},null,8,["rows","columns"])])}const C={props:{items:{default:()=>[]}},components:{},watch:{},mounted(){this.$nextTick((function(){}))},data(){return{columns:[{name:"title",label:this.$tr("isite.cms.form.status"),field:t=>t.status.title,align:"left"},{name:"comment",label:this.$tr("isite.cms.form.comment"),field:t=>t.comment||"-",align:"left"},{name:"created_at",label:this.$trp("isite.cms.form.createdAt"),field:"created_at",format:t=>t?this.$d(this.$moment(t,"YYYY-MM-DD HH:mm").toDate(),"long"):"-",align:"left"}]}},methods:{}};var I=i(12807),x=i(18383),F=i(98582),A=i.n(F);const L=(0,I.A)(C,[["render",w]]),_=L;A()(C,"components",{QTable:x.A});const E={id:"orderItemsComponent"},S={key:0},Q={class:"option-title"},P={class:"value-title"};function T(t,e,i,o,l,r){const n=(0,s.g2)("q-icon"),m=(0,s.g2)("q-td"),d=(0,s.g2)("q-table");return(0,s.uX)(),(0,s.CE)("div",E,[(0,s.bF)(d,{rows:i.items,columns:l.columns,pagination:{rowsPerPage:0},"hide-bottom":"",class:"no-shadow secondary-font"},{default:(0,s.k6)((()=>[(0,s.bF)(m,{slot:"body-cell-description","slot-scope":"props",props:t.props},{default:(0,s.k6)((()=>[(0,s.Lk)("div",null,[(0,s.Lk)("div",null,(0,a.v_)(t.props.row.title),1),t.props.row.options&&t.props.row.options.length?((0,s.uX)(),(0,s.CE)("div",S,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.props.row.options,((t,e)=>((0,s.uX)(),(0,s.CE)("div",{class:"inline-block option-content text-left",key:e},[(0,s.Lk)("div",Q,(0,a.v_)(t.optionDescription),1),(0,s.Lk)("div",P,[(0,s.bF)(n,{name:"fas fa-caret-right"}),(0,s.eW)(" "+(0,a.v_)(t.optionValueDescription),1)])])))),128))])):(0,s.Q3)("",!0)])])),_:1},8,["props"])])),_:1},8,["rows","columns"])])}const X={props:{items:{default:[]}},components:{},watch:{},mounted(){this.$nextTick((function(){}))},data(){return{columns:[{name:"cantidad",label:"Cantidad",field:"quantity",align:"left"},{name:"productId",label:"ID",field:"productId",align:"left"},{name:"sku",label:"SKU",field:"reference",align:"left"},{name:"description",label:"Description",align:"left"},{name:"valor",label:"Valor",field:"total",format:t=>t?"$ "+this.$n(t):"0",align:"center"}]}},methods:{}};var O=i(77109),V=i(24609);const D=(0,I.A)(X,[["render",T]]),H=D;A()(X,"components",{QTable:x.A,QTd:O.A,QIcon:V.A});const W={class:"q-mt-lg"},B={class:"q-py-xs"},M={class:"q-py-xs"},U={class:"q-py-xs"},K=(0,s.Lk)("span",null,"Notificar al Cliente",-1),N={class:"q-mt-md"};function Y(t,e,i,o,l,r){const n=(0,s.g2)("tree-select"),m=(0,s.g2)("q-input"),d=(0,s.g2)("q-toggle"),c=(0,s.g2)("q-btn");return(0,s.uX)(),(0,s.CE)("div",W,[(0,s.Lk)("p",null,[(0,s.Lk)("b",null,(0,a.v_)(t.$tr("icommerce.cms.newStatus")),1)]),(0,s.Lk)("div",B,[(0,s.bF)(n,{modelValue:l.form.status,"onUpdate:modelValue":e[0]||(e[0]=t=>l.form.status=t),options:l.statuses,placeholder:t.$tr("isite.cms.form.status")},null,8,["modelValue","options","placeholder"])]),(0,s.Lk)("div",M,[(0,s.bF)(m,{label:t.$tr("isite.cms.form.comment"),outlined:"","error-message":"We need a comment",rows:"3",type:"textarea",modelValue:l.form.comment,"onUpdate:modelValue":e[1]||(e[1]=t=>l.form.comment=t)},null,8,["label","modelValue"])]),(0,s.Lk)("div",U,[K,(0,s.bF)(d,{modelValue:l.form.notify,"onUpdate:modelValue":e[2]||(e[2]=t=>l.form.notify=t),"checked-icon":"check",color:"green","false-value":!1,"true-value":!0,"unchecked-icon":"clear"},null,8,["modelValue"])]),(0,s.Lk)("div",N,[(0,s.bF)(c,{unelevated:"",rounded:"",label:"save",color:"primary",icon:"fa-light fa-save",onClick:e[3]||(e[3]=t=>r.saveOrderHistoryStatus())})])])}const z={emits:["orderHistoryCreated"],data(){return{loading:!1,statuses:[],form:{orderId:this.$route.params.id,status:null,notify:!1,comment:""}}},created(){this.getStatus()},methods:{getStatus(){let t={params:{refresh:!0}};this.$crud.index("apiRoutes.qcommerce.orderStatus",t).then((t=>{this.statuses=t.data.map((t=>({id:t.id,label:t.title})))})).catch((t=>{this.$apiResponse.handleError(t,(()=>{}))}))},saveOrderHistoryStatus(){if(this.$v.form.$touch(),this.loading=!0,this.$v.form.$error)return this.$alert.error({message:this.$tr("isite.cms.message.formInvalid")}),void(this.loading=!1);this.$crud.create("apiRoutes.qcommerce.orderStatusHistory",this.form).then((t=>{this.$emit("orderHistoryCreated"),this.$alert.success({message:this.$tr("isite.cms.message.recordUpdated")}),this.clearForm(),this.loading=!1})).catch((t=>{this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")}),this.loading=!1}))},clearForm(){this.form.comment="",this.form.status=null}}};var j=i(78020),G=i(90449),J=i(69001);const Z=(0,I.A)(z,[["render",Y]]),tt=Z;A()(z,"components",{QInput:j.A,QToggle:G.A,QBtn:J.A});var et=i(78319),it=i(99526)["A"];const st={components:{orderItems:H,orderStatusHistory:_,addStatusOrder:tt,advanceChat:et.A},mounted(){this.init()},data(){return{loading:!1,order:{customer:{fullName:""},items:[]},modalRating:{loading:!1,show:!1,item:!1,itemRating:!1},conversation:!1}},computed:{extraPageActions(){return[{label:this.$tr("isite.cms.label.print"),props:{icon:"fa-light fa-print"},action:this.printScreen}]},settings(){return{showReviewsProduct:"iadmin"!=it("app.mode")&&parseInt(this.$getSetting("icommerce::showReviewsProduct")||0),chatByOrderEnable:parseInt(this.$getSetting("icommerce::chatByOrderEnable")||0)}},orderId(){return this.$clone(this.$route.params.id)},informationBlocks(){let t=2,e=Array(t).fill(0).map(((t,e)=>[])),i=[...this.$clone(this.order.informationBlocks||[]),{title:"Total",values:[{label:this.$tr("icommerce.cms.subtotal"),value:`$${this.$n(this.order.total-this.order.shippingAmount)}`},{label:this.$tr("icommerce.cms.shipping"),value:`$${this.$n(this.order.shippingAmount)}`},{label:this.$tr("icommerce.cms.form.total"),value:`$${this.$n(this.order.total)}`}]}],s=0;return i.forEach((i=>{e[s].push(i),s=s>=t-1?0:s+1})),e},tableConfig(){let t={props:{rows:this.order.items,pagination:{rowsPerPage:0},class:"no-shadow",hideBottom:!0,columns:[{name:"id",label:"ID",field:"productId",align:"left"},{name:"title",label:this.$tr("isite.cms.form.product"),field:"title",align:"left"},{name:"productOptionsLabel",label:this.$trp("isite.cms.label.option"),field:"productOptionsLabel",align:"left"},{name:"sku",label:"SKU",field:"reference",align:"left"},{name:"quantity",label:this.$tr("isite.cms.label.quantity"),field:"quantity",align:"left"},{name:"price",label:this.$tr("isite.cms.label.price"),field:"total",align:"center",format:t=>`$${this.$n(t||0)}`},{name:"total",label:"Total",field:"total",align:"center",format:t=>`$${this.$n(t||0)}`}]},actions:[]};return this.settings.showReviewsProduct&&t.actions.push({label:this.$tr("isite.cms.label.rate"),icon:"fas fa-check",action:t=>{this.getProductRating(t)}}),t.actions.length&&t.props.columns.push({name:"actions",label:this.$tr("isite.cms.form.actions"),align:"right"}),t},canEditOrder(){return!("iadmin"!=it("app.mode")||!this.$hasAccess("icommerce.orders.edit"))},form(){let t=this.modalRating.itemRating?.comments||[];return{status:{formType:"grid",sendTo:{apiRoute:"apiRoutes.qcommerce.orderStatusHistory",extraData:{orderId:this.orderId}},blocks:[{fields:{status:{value:null,type:"select",required:!0,props:{label:`${this.$tr("isite.cms.form.status")}*`},loadOptions:{apiRoute:"apiRoutes.qcommerce.orderStatus"}},notify:{value:"0",type:"select",required:!0,props:{label:"Notificar al Cliente*",options:[{label:this.$tr("isite.cms.label.yes"),value:1},{label:this.$tr("isite.cms.label.no"),value:0}]}},comment:{value:null,type:"input",colClass:"col-12",props:{label:this.$tr("isite.cms.form.comment"),type:"textarea",rows:"3"}}}}]},rating:{formType:"grid",noActions:!!this.modalRating.itemRating,sendTo:{apiRoute:"apiRoutes.qcommerce.ratings",extraData:{userId:this.$store.state.quserAuth.userId,rateableId:this.modalRating.item?.productId||null,rateableType:"Modules\\Icommerce\\Entities\\Product"}},blocks:[{fields:{rating:{value:this.modalRating.itemRating?.rating||3,type:"rating",required:!0,colClass:"col-12",props:{label:`${this.$tr("isite.cms.label.rating")}*`,readonly:!!this.modalRating.itemRating},loadOptions:{apiRoute:"apiRoutes.qcommerce.orderStatus"}},comment:{value:t[0]?.comment||null,type:"input",colClass:"col-12",fakeFieldName:"comment",props:{label:this.$tr("isite.cms.form.comment"),type:"textarea",rows:"3",readonly:!!this.modalRating.itemRating}},mediasMulti:{value:{},type:"media",colClass:"col-12",fakeFieldName:"comment",fieldItemId:t[0]?.id||null,props:{label:this.$trp("isite.cms.form.image"),zone:"gallery",entity:"Modules\\Icomments\\Entities\\Comment",entityId:t[0]?.id||null,accept:"images",directUpload:!0,maxFiles:6,readonly:!!this.modalRating.itemRating,disk:"rateable"}}}}]}}},timeLine(){return this.order.histories?this.order.histories.reverse().map((t=>({title:t.status.title,subtitle:this.$trd(t.created_at,{type:"long"}),body:t.comment||null}))):[]}},methods:{init(){this.getData(!0)},getData(t){return new Promise((async(e,i)=>{this.loading=!0,await Promise.all([this.getOrder(t),this.getChatConversation(t)]),this.loading=!1}))},getOrder(t){return new Promise(((e,i)=>{let s={refresh:t,params:{include:"shippingDepartment,shippingCountry,customer.addresses,customer.fields"}};this.$crud.show("apiRoutes.qcommerce.orders",this.orderId,s).then((t=>{this.order=t.data,e(t.data)})).catch((t=>{this.$apiResponse.handleError(t,(()=>{e(t)}))}))}))},getChatConversation(t){return new Promise(((e,i)=>{if(!this.settings.chatByOrderEnable)return e(!0);let s={refresh:t,params:{filter:{field:"entity_id",entity_type:"Modules\\Icommerce\\Entities\\Order"}}};this.$crud.show("apiRoutes.qchat.conversations",this.orderId,s).then((t=>{this.conversation=this.$clone(t.data),e(t.data)})).catch((t=>{this.$apiResponse.handleError(t,(()=>{e(t)}))}))}))},getProductRating(t){return new Promise(((e,i)=>{this.modalRating.loading=!0,this.modalRating.item=t,this.modalRating.show=!0;let s={refresh:!0,params:{include:"comments",filter:{field:"rateable_id",userId:this.$store.state.quserAuth.userId,rateableType:"Modules\\Icommerce\\Entities\\Product"}}};this.$crud.show("apiRoutes.qcommerce.ratings",t.productId,s).then((t=>{this.modalRating.itemRating=this.$clone(t.data),this.modalRating.loading=!1})).catch((t=>{this.$apiResponse.handleError(t,(()=>{this.modalRating.loading=!1}))}))}))},printScreen(){print()}}};var at=i(37015),ot=i(54514),lt=i(75329),rt=i(63418),nt=i(35779),mt=i(6633),dt=i(86017),ct=i(71102);const ut=(0,I.A)(st,[["render",q]]),pt=ut;A()(st,"components",{QIcon:V.A,QSeparator:at.A,QList:ot.A,QItem:lt.A,QItemSection:rt.A,QItemLabel:nt.A,QTable:x.A,QTd:O.A,QTimeline:mt.A,QTimelineEntry:dt.A,QPageContainer:ct.A})}}]);