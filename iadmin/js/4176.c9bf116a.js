"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[4176],{84176:(e,s,i)=>{i.r(s),i.d(s,{default:()=>E});var a=i(61758),t=i(58790);const l={class:"box box-auto-height q-mb-md"},o={id:"formProfile",class:"relative-position"},r={class:"row q-col-gutter-md"},d={id:"menuContent",class:"col-12 col-md-3"},n={class:"box box-auto-height"},m={id:"formContent",class:"col-12 col-md-9"},u={class:"box box-auto-height"},c={class:"box-title row items-center"},f={id:"profileActions",class:"col-12 text-right"},p={class:"box box-auto-height q-mb-md"},h={class:"box-title row items-center"};function g(e,s,g,b,v,k){const $=(0,a.g2)("page-actions"),F=(0,a.g2)("dynamic-field"),q=(0,a.g2)("q-tab"),y=(0,a.g2)("q-tabs"),I=(0,a.g2)("q-icon"),A=(0,a.g2)("q-separator"),P=(0,a.g2)("q-btn"),D=(0,a.g2)("q-form"),w=(0,a.g2)("q-tab-panel"),C=(0,a.g2)("dynamic-form"),U=(0,a.g2)("crud"),E=(0,a.g2)("q-tab-panels"),V=(0,a.g2)("inner-loading");return(0,a.uX)(),(0,a.CE)("div",{id:"profilePage",key:v.pageId},[(0,a.Lk)("div",l,[(0,a.bF)($,{title:k.userData.fullName,onRefresh:k.loadPage},null,8,["title","onRefresh"])]),(0,a.Lk)("div",o,[(0,a.Lk)("div",r,[(0,a.Lk)("div",d,[(0,a.Lk)("div",n,[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(k.formsData.profile.fields,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{id:"profilePicture",key:s,class:(0,t.C4)(e.colClass||"col-12 q-mb-md")},[(0,a.bF)(F,{field:e,itemId:k.userData.id,modelValue:v.form.session[s],"onUpdate:modelValue":e=>v.form.session[s]=e},null,8,["field","itemId","modelValue","onUpdate:modelValue"])],2)))),128)),(0,a.bF)(y,{modelValue:v.menuOption,"onUpdate:modelValue":s[0]||(s[0]=e=>v.menuOption=e),vertical:"","active-color":"primary"},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(k.menuOptions,((e,s)=>((0,a.uX)(),(0,a.CE)(a.FK,{key:s},[void 0==e?.vIf||e?.vIf?((0,a.uX)(),(0,a.Wv)(q,{key:0,name:e.value,label:e.label,"no-caps":""},null,8,["name","label"])):(0,a.Q3)("",!0)],64)))),128))])),_:1},8,["modelValue"])])]),(0,a.Lk)("div",m,[(0,a.bF)(E,{modelValue:v.menuOption,"onUpdate:modelValue":s[7]||(s[7]=e=>v.menuOption=e),animated:"","transition-prev":"slide-down","transition-next":"slide-up","keep-alive":""},{default:(0,a.k6)((()=>[(0,a.bF)(w,{name:"session"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",u,[(0,a.Lk)("div",c,[(0,a.bF)(I,{name:k.formsData.session.icon,size:"22px",class:"q-mr-sm"},null,8,["name"]),(0,a.eW)(" "+(0,t.v_)(k.formsData.session.title),1)]),(0,a.bF)(A,{class:"q-mt-sm q-mb-md"}),(0,a.bF)(D,{onSubmit:s[1]||(s[1]=e=>k.updateUserData(v.form.session)),ref:"formRegister",autocomplete:"off",class:"row q-col-gutter-x-md",onValidationError:s[2]||(s[2]=s=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,a.k6)((()=>[((0,a.uX)(!0),(0,a.CE)(a.FK,null,(0,a.pI)(k.formsData.session.fields,((e,s)=>((0,a.uX)(),(0,a.CE)("div",{key:s,class:(0,t.C4)(e.colClass||"col-12")},[(0,a.bF)(F,{field:e,modelValue:v.form.session[e.name||s],"onUpdate:modelValue":i=>v.form.session[e.name||s]=i},null,8,["field","modelValue","onUpdate:modelValue"])],2)))),128)),(0,a.Lk)("div",f,[(0,a.bF)(P,{label:e.$tr("isite.cms.label.save"),rounded:"",unelevated:"",color:"green",type:"submit"},null,8,["label"])])])),_:1},512)])])),_:1}),k.roleFormId?((0,a.uX)(),(0,a.Wv)(w,{key:0,name:"profile"},{default:(0,a.k6)((()=>[(0,a.Lk)("div",p,[(0,a.Lk)("div",h,[(0,a.bF)(I,{name:"fas fa-user",size:"22px",class:"q-mr-sm"}),(0,a.eW)(" "+(0,t.v_)(e.$tr("isite.cms.label.profile")),1)])]),k.roleFormId&&v.profileFormBlocks.length?((0,a.uX)(),(0,a.Wv)(C,{key:0,modelValue:v.form.profile,"onUpdate:modelValue":s[3]||(s[3]=e=>v.form.profile=e),formType:"grid",blocks:v.profileFormBlocks,onSubmit:s[4]||(s[4]=e=>k.updateUserData(v.form.profile))},null,8,["modelValue","blocks"])):(0,a.Q3)("",!0)])),_:1})):(0,a.Q3)("",!0),k.hasPermission.addresses?((0,a.uX)(),(0,a.Wv)(w,{key:1,name:"address"},{default:(0,a.k6)((()=>[(0,a.bF)(U,{"crud-data":i.e(4256).then(i.bind(i,54256)),onCreated:s[5]||(s[5]=s=>e.$store.dispatch("quserAuth/AUTH_UPDATE")),onUpdated:s[6]||(s[6]=s=>e.$store.dispatch("quserAuth/AUTH_UPDATE"))},null,8,["crud-data"])])),_:1})):(0,a.Q3)("",!0)])),_:1},8,["modelValue"])])]),(0,a.bF)(V,{visible:v.loading},null,8,["visible"])])])}i(10239);var b=i(71915);const v={beforeUnmount(){b.Bt.off("page.data.refresh")},props:{},components:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,pageId:this.$uid(),menuOption:"session",profileFormBlocks:[],form:{session:{},profile:{},payout:{}},mainFields:["firstName","lastName"]}},computed:{hasPermission(){return{addresses:this.$hasAccess("profile.addresses.manage")}},roleFormId(){let e=this.$store.state.quserAuth.selectedRoleId,s=this.$store.state.quserAuth.userData.roles,i=e?s.fond((s=>s.id==e)):s[0];return i?.formId||null},menuOptions(){return[{label:this.$tr("isite.cms.label.session"),value:"session"},{label:this.$tr("isite.cms.label.profile"),value:"profile",vIf:!(!this.roleFormId||!this.profileFormBlocks.length)},{label:this.$trp("isite.cms.label.address"),value:"address",vIf:this.hasPermission.addresses}]},userData(){return this.$clone(this.$store.state.quserAuth.userData)},formsData(){return{session:{icon:"fas fa-sign-in-alt",title:this.$tr("isite.cms.label.session"),fields:{email:{value:this.userData.email,type:"input",colClass:"col-12 col-md-6",props:{label:`${this.$tr("isite.cms.form.email")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired"),e=>this.$helper.validateEmail(e)||this.$tr("isite.cms.message.fieldEmail")]}},changePassword:{value:0,type:"checkbox",colClass:"col-12 col-md-6",props:{label:`${this.$tr("isite.cms.message.updatePassword")}`,trueValue:1,falseValue:0}},password:{value:null,type:"input",colClass:"col-12 col-md-6",props:{label:`${this.$trp("isite.cms.form.password")}*`,type:"password",vIf:this.form.session.changePassword,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired"),e=>e.length>=6||this.$tr("isite.cms.message.fieldMinLeng",{num:6})]}},passwordConfirmation:{value:null,type:"input",colClass:"col-12 col-md-6",props:{label:`${this.$trp("isite.cms.form.checkPassword")}*`,type:"password",vIf:this.form.session.changePassword,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired"),e=>this.form.session.password==e||this.$tr("isite.cms.message.fieldCheckPassword")]}}}},profile:{fields:{mediasSingle:{name:"mediasSingle",value:{},type:"media",props:{label:this.$tr("iprofile.cms.label.profilePicture"),accept:"images",directUpload:!0,multiple:!1,zone:"profile",entity:"Modules\\User\\Entities\\Sentinel\\User",entityId:null}}}}}}},methods:{async init(){this.loadPage(),b.Bt.on("page.data.refresh",(()=>{this.loadPage()}))},async loadPage(){this.loading=!0,await Promise.all([this.$store.dispatch("qsiteApp/GET_SITE_SETTINGS"),this.$store.dispatch("quserAuth/AUTH_UPDATE"),this.setProfileFormData(),this.getRoleForm()]),this.pageId=this.$uid(),this.loading=!1},setProfileFormData(){return new Promise(((e,s)=>{let i={};this.mainFields.map((e=>i[e]=this.userData[e])),this.userData.fields&&Array.isArray(this.userData.fields)&&this.userData.fields.forEach((e=>{i[e.name]=e.value})),this.form.profile=this.$clone(i),e(!0)}))},getRoleForm(){return new Promise(((e,s)=>{if(!this.roleFormId)return e(!1);this.extraBlocks=[],this.loading=!0;let i={refresh:!0,params:{include:"blocks.fields"}};this.$crud.show("apiRoutes.qform.forms",this.roleFormId,i).then((s=>{let i=s.data.blocks.map((e=>({...e,fields:e.fields.map((e=>e.dynamicField))})));i.forEach(((e,s)=>{let a={};e.fields.forEach(((e,s)=>a[`${e.name}`]=e)),i[s].fields=a})),this.profileFormBlocks=i.filter((e=>"fields"==e.name)),this.profileFormBlocks&&this.profileFormBlocks.length&&(this.profileFormBlocks[0].fields={mainImage:{name:"mainImage",type:"image",colClass:"col-12"},...this.profileFormBlocks[0].fields}),this.loading=!1,e(s.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{s(e),this.loading=!1}))}))}))},updateUserData(e={}){if(this.loading=!0,"profile"==this.menuOption){let s={};Object.keys(e).forEach((i=>{this.mainFields.includes(i)?s[i]=e[i]:(s.fields||(s.fields=[]),s.fields.push({name:i,value:e[i]||""}))})),e=this.$clone(s)}e={email:this.userData.email,...e,id:this.userData.id,isActivated:!0},this.$crud.update("apiRoutes.quser.users",this.userData.id,e).then((async e=>{this.$alert.success({message:this.$tr("isite.cms.message.recordUpdated")}),this.loading=!1})).catch((e=>{this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")}),this.loading=!1}))}}};var k=i(12807),$=i(64873),F=i(26721),q=i(64082),y=i(63815),I=i(24609),A=i(37015),P=i(21565),D=i(69001),w=i(98582),C=i.n(w);const U=(0,k.A)(v,[["render",g]]),E=U;C()(v,"components",{QTabs:$.A,QTab:F.A,QTabPanels:q.A,QTabPanel:y.A,QIcon:I.A,QSeparator:A.A,QForm:P.A,QBtn:D.A})}}]);