"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[6744],{16744:(e,s,i)=>{i.r(s),i.d(s,{default:()=>U});var a=i(92444),l=i(74044);const t={class:"box box-auto-height q-mb-md"},o={id:"formProfile",class:"relative-position"},r={class:"row q-col-gutter-md"},d={id:"menuContent",class:"col-12 col-md-3"},n={class:"box box-auto-height"},m={id:"formContent",class:"col-12 col-md-9"},c={class:"box box-auto-height"},u={class:"box-title row items-center"},f={id:"profileActions",class:"col-12 text-right"},h={class:"box box-auto-height q-mb-md"},p={class:"box-title row items-center"};function g(e,s,g,b,v,$){const D=(0,a.E1)("page-actions"),k=(0,a.E1)("dynamic-field"),y=(0,a.E1)("q-tab"),A=(0,a.E1)("q-tabs"),q=(0,a.E1)("q-icon"),E=(0,a.E1)("q-separator"),P=(0,a.E1)("q-btn"),I=(0,a.E1)("q-form"),Q=(0,a.E1)("q-tab-panel"),F=(0,a.E1)("dynamic-form"),w=(0,a.E1)("crud"),U=(0,a.E1)("q-tab-panels"),V=(0,a.E1)("inner-loading");return(0,a.Wz)(),(0,a.An)("div",{id:"profilePage",key:v.pageId},[(0,a.QD)("div",t,[(0,a.K2)(D,{title:$.userData.fullName,onRefresh:$.loadPage},null,8,["title","onRefresh"])]),(0,a.QD)("div",o,[(0,a.QD)("div",r,[(0,a.QD)("div",d,[(0,a.QD)("div",n,[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)($.formsData.profile.fields,((e,s)=>((0,a.Wz)(),(0,a.An)("div",{id:"profilePicture",key:s,class:(0,l.WN)(e.colClass||"col-12 q-mb-md")},[(0,a.K2)(k,{field:e,itemId:$.userData.id,modelValue:v.form.session[s],"onUpdate:modelValue":e=>v.form.session[s]=e},null,8,["field","itemId","modelValue","onUpdate:modelValue"])],2)))),128)),(0,a.K2)(A,{modelValue:v.menuOption,"onUpdate:modelValue":s[0]||(s[0]=e=>v.menuOption=e),vertical:"","active-color":"primary"},{default:(0,a.Ql)((()=>[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)($.menuOptions,((e,s)=>((0,a.Wz)(),(0,a.An)(a.ae,{key:s},[void 0==e?.vIf||e?.vIf?((0,a.Wz)(),(0,a.Az)(y,{key:0,name:e.value,label:e.label,"no-caps":""},null,8,["name","label"])):(0,a.g1)("",!0)],64)))),128))])),_:1},8,["modelValue"])])]),(0,a.QD)("div",m,[(0,a.K2)(U,{modelValue:v.menuOption,"onUpdate:modelValue":s[7]||(s[7]=e=>v.menuOption=e),animated:"","transition-prev":"slide-down","transition-next":"slide-up","keep-alive":""},{default:(0,a.Ql)((()=>[(0,a.K2)(Q,{name:"session"},{default:(0,a.Ql)((()=>[(0,a.QD)("div",c,[(0,a.QD)("div",u,[(0,a.K2)(q,{name:$.formsData.session.icon,size:"22px",class:"q-mr-sm"},null,8,["name"]),(0,a.mY)(" "+(0,l.WA)($.formsData.session.title),1)]),(0,a.K2)(E,{class:"q-mt-sm q-mb-md"}),(0,a.K2)(I,{onSubmit:s[1]||(s[1]=e=>$.updateUserData(v.form.session)),ref:"formRegister",autocomplete:"off",class:"row q-col-gutter-x-md",onValidationError:s[2]||(s[2]=s=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,a.Ql)((()=>[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)($.formsData.session.fields,((e,s)=>((0,a.Wz)(),(0,a.An)("div",{key:s,class:(0,l.WN)(e.colClass||"col-12")},[(0,a.K2)(k,{field:e,modelValue:v.form.session[e.name||s],"onUpdate:modelValue":i=>v.form.session[e.name||s]=i},null,8,["field","modelValue","onUpdate:modelValue"])],2)))),128)),(0,a.QD)("div",f,[(0,a.K2)(P,{label:e.$tr("isite.cms.label.save"),rounded:"",unelevated:"",color:"green",type:"submit"},null,8,["label"])])])),_:1},512)])])),_:1}),$.roleFormId?((0,a.Wz)(),(0,a.Az)(Q,{key:0,name:"profile"},{default:(0,a.Ql)((()=>[(0,a.QD)("div",h,[(0,a.QD)("div",p,[(0,a.K2)(q,{name:"fas fa-user",size:"22px",class:"q-mr-sm"}),(0,a.mY)(" "+(0,l.WA)(e.$tr("isite.cms.label.profile")),1)])]),$.roleFormId&&v.profileFormBlocks.length?((0,a.Wz)(),(0,a.Az)(F,{key:0,modelValue:v.form.profile,"onUpdate:modelValue":s[3]||(s[3]=e=>v.form.profile=e),formType:"grid",blocks:v.profileFormBlocks,onSubmit:s[4]||(s[4]=e=>$.updateUserData(v.form.profile))},null,8,["modelValue","blocks"])):(0,a.g1)("",!0)])),_:1})):(0,a.g1)("",!0),$.hasPermission.addresses?((0,a.Wz)(),(0,a.Az)(Q,{key:1,name:"address"},{default:(0,a.Ql)((()=>[(0,a.K2)(w,{"crud-data":i.e(9184).then(i.bind(i,59184)),onCreated:s[5]||(s[5]=s=>e.$store.dispatch("quserAuth/AUTH_UPDATE")),onUpdated:s[6]||(s[6]=s=>e.$store.dispatch("quserAuth/AUTH_UPDATE"))},null,8,["crud-data"])])),_:1})):(0,a.g1)("",!0)])),_:1},8,["modelValue"])])]),(0,a.K2)(V,{visible:v.loading},null,8,["visible"])])])}i(23816);var b=i(8932);const v={beforeUnmount(){b.kN.off("page.data.refresh")},props:{},components:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,pageId:this.$uid(),menuOption:"session",profileFormBlocks:[],form:{session:{},profile:{},payout:{}},mainFields:["firstName","lastName"]}},computed:{hasPermission(){return{addresses:this.$hasAccess("profile.addresses.manage")}},roleFormId(){let e=this.$store.state.quserAuth.selectedRoleId,s=this.$store.state.quserAuth.userData.roles,i=e?s.fond((s=>s.id==e)):s[0];return i?.formId||null},menuOptions(){return[{label:this.$tr("isite.cms.label.session"),value:"session"},{label:this.$tr("isite.cms.label.profile"),value:"profile",vIf:!(!this.roleFormId||!this.profileFormBlocks.length)},{label:this.$trp("isite.cms.label.address"),value:"address",vIf:this.hasPermission.addresses}]},userData(){return this.$clone(this.$store.state.quserAuth.userData)},formsData(){return{session:{icon:"fas fa-sign-in-alt",title:this.$tr("isite.cms.label.session"),fields:{email:{value:this.userData.email,type:"input",colClass:"col-12 col-md-6",props:{label:`${this.$tr("isite.cms.form.email")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired"),e=>this.$helper.validateEmail(e)||this.$tr("isite.cms.message.fieldEmail")]}},changePassword:{value:0,type:"checkbox",colClass:"col-12 col-md-6",props:{label:`${this.$tr("isite.cms.message.updatePassword")}`,trueValue:1,falseValue:0}},password:{value:null,type:"input",colClass:"col-12 col-md-6",props:{label:`${this.$trp("isite.cms.form.password")}*`,type:"password",vIf:this.form.session.changePassword,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired"),e=>e.length>=6||this.$tr("isite.cms.message.fieldMinLeng",{num:6})]}},passwordConfirmation:{value:null,type:"input",colClass:"col-12 col-md-6",props:{label:`${this.$trp("isite.cms.form.checkPassword")}*`,type:"password",vIf:this.form.session.changePassword,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired"),e=>this.form.session.password==e||this.$tr("isite.cms.message.fieldCheckPassword")]}}}},profile:{fields:{mediasSingle:{name:"mediasSingle",value:{},type:"media",props:{label:this.$tr("iprofile.cms.label.profilePicture"),accept:"images",directUpload:!0,multiple:!1,zone:"profile",entity:"Modules\\User\\Entities\\Sentinel\\User",entityId:null}}}}}}},methods:{async init(){this.loadPage(),b.kN.on("page.data.refresh",(()=>{this.loadPage()}))},async loadPage(){this.loading=!0,await Promise.all([this.$store.dispatch("qsiteApp/GET_SITE_SETTINGS"),this.$store.dispatch("quserAuth/AUTH_UPDATE"),this.setProfileFormData(),this.getRoleForm()]),this.pageId=this.$uid(),this.loading=!1},setProfileFormData(){return new Promise(((e,s)=>{let i={};this.mainFields.map((e=>i[e]=this.userData[e])),this.userData.fields&&Array.isArray(this.userData.fields)&&this.userData.fields.forEach((e=>{i[e.name]=e.value})),this.form.profile=this.$clone(i),e(!0)}))},getRoleForm(){return new Promise(((e,s)=>{if(!this.roleFormId)return e(!1);this.extraBlocks=[],this.loading=!0;let i={refresh:!0,params:{include:"blocks.fields"}};this.$crud.show("apiRoutes.qform.forms",this.roleFormId,i).then((s=>{let i=s.data.blocks.map((e=>({...e,fields:e.fields.map((e=>e.dynamicField))})));i.forEach(((e,s)=>{let a={};e.fields.forEach(((e,s)=>a[`${e.name}`]=e)),i[s].fields=a})),this.profileFormBlocks=i.filter((e=>"fields"==e.name)),this.profileFormBlocks&&this.profileFormBlocks.length&&(this.profileFormBlocks[0].fields={mainImage:{name:"mainImage",type:"image",colClass:"col-12"},...this.profileFormBlocks[0].fields}),this.loading=!1,e(s.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{s(e),this.loading=!1}))}))}))},updateUserData(e={}){if(this.loading=!0,"profile"==this.menuOption){let s={};Object.keys(e).forEach((i=>{this.mainFields.includes(i)?s[i]=e[i]:(s.fields||(s.fields=[]),s.fields.push({name:i,value:e[i]||""}))})),e=this.$clone(s)}e={email:this.userData.email,...e,id:this.userData.id,isActivated:!0},this.$crud.update("apiRoutes.quser.users",this.userData.id,e).then((async e=>{this.$alert.success({message:this.$tr("isite.cms.message.recordUpdated")}),this.loading=!1})).catch((e=>{this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")}),this.loading=!1}))}}};var $=i(68716),D=i(38788),k=i(7628),y=i(65264),A=i(5296),q=i(58120),E=i(70880),P=i(14288),I=i(99140),Q=i(95252),F=i.n(Q);const w=(0,$.c)(v,[["render",g]]),U=w;F()(v,"components",{QTabs:D.c,QTab:k.c,QTabPanels:y.c,QTabPanel:A.c,QIcon:q.c,QSeparator:E.c,QForm:P.c,QBtn:I.c})}}]);