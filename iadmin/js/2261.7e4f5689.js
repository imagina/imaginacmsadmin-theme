"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[2261],{2261:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Mn});var l=n(61758),o=n(58790);const i={id:"builderEditor",class:"row relative-position"},r={class:"text-right q-mb-md"},a={class:"drawer-title q-py-xs q-px-md justify-center"},c={id:"renderList"},s={class:"text-right q-pa-md"},u={class:"preview-content"},d={class:"preview-content__actions row justify-between items-center"},f={class:"q-px-md q-py-sm text-blue-grey text-h6"},p={key:1,class:"q-pr-md"},b={class:"preview-content__box"},m={key:1,class:"text-center q-py-lg"},v={class:"q-mt-md text-h5 text-blue-grey"},y={class:"preview-content__actions row justify-between items-center"},k={class:"q-px-md q-py-sm text-blue-grey text-h6"},g={key:0,class:"text-caption",style:{"line-height":"1"}},h={key:0,class:"q-pr-md"},w={class:"preview-content__box"},B={key:1,class:"text-center q-py-lg"},C={class:"q-mt-md text-h5 text-blue-grey"};function A(e,t,A,F,S,x){const L=(0,l.g2)("crud"),q=(0,l.g2)("q-icon"),T=(0,l.g2)("q-select"),I=(0,l.g2)("layout-list"),_=(0,l.g2)("block-list"),P=(0,l.g2)("blocks-panel"),E=(0,l.g2)("q-dialog"),Q=(0,l.g2)("block-form"),N=(0,l.g2)("block-attributes-form"),R=(0,l.g2)("layout-library-panel"),W=(0,l.g2)("q-item-label"),O=(0,l.g2)("q-item-section"),V=(0,l.g2)("q-item"),j=(0,l.g2)("q-list"),X=(0,l.g2)("q-btn-dropdown"),K=(0,l.g2)("q-tab"),$=(0,l.g2)("q-tabs"),U=(0,l.g2)("q-tooltip"),M=(0,l.g2)("q-btn"),D=(0,l.g2)("q-separator"),z=(0,l.g2)("handle-grid"),G=(0,l.g2)("q-tab-panel"),H=(0,l.g2)("iframe-post"),Y=(0,l.g2)("q-tab-panels"),J=(0,l.g2)("inner-loading"),Z=(0,l.gN)("close-popup");return(0,l.uX)(),(0,l.CE)("div",i,[(0,l.Lk)("div",r,[(0,l.bF)(L,{"crud-data":n.e(9736).then(n.bind(n,39736)),type:"onlyUpdate",ref:"crudLayout",onCreatedData:t[0]||(t[0]=t=>e.handleCreateLayout(t,!0)),onUpdated:t[1]||(t[1]=t=>e.refreshApiData({crudAction:"updated"})),onDeleted:t[2]||(t[2]=t=>e.refreshApiData({crudAction:"deleted"}))},null,8,["crud-data"])]),(0,l.Lk)("div",{class:"preview-panels relative-position",style:(0,o.Tr)(`width: ${e.store.panelWidth}`)},[(0,l.Lk)("div",a,[(0,l.bF)(T,{color:"blue-grey",modelValue:e.view,"onUpdate:modelValue":t[3]||(t[3]=t=>e.view=t),options:e.dropdownActions.editor,borderless:"",class:"full-width","emit-value":"","map-options":""},{prepend:(0,l.k6)((()=>[(0,l.bF)(q,{color:"white",name:"layout"==e.view?"fa-light fa-puzzle":"fa-light fa-puzzle-piece"},null,8,["name"])])),_:1},8,["modelValue","options"])]),(0,l.Lk)("div",c,["layout"===e.view?((0,l.uX)(),(0,l.Wv)(I,{key:0,onCreate:t[4]||(t[4]=()=>e.showLayoutPanel=!0),ref:"refLayoutList",onSelected:e.handleLayoutSelected,onRefresh:t[5]||(t[5]=t=>e.loading=t)},null,8,["onSelected"])):((0,l.uX)(),(0,l.Wv)(_,{key:1,onCreate:e.openBlockPanel,ref:"refBlockList",onSelected:e.previewBlock,onRefresh:t[6]||(t[6]=t=>e.loading=t)},null,8,["onCreate","onSelected"]))]),(0,l.bF)(E,{modelValue:e.showBlocksPanel,"onUpdate:modelValue":t[8]||(t[8]=t=>e.showBlocksPanel=t),position:"left",class:"builder-panel-dialog",square:""},{default:(0,l.k6)((()=>[(0,l.bF)(P,(0,l.v6)({onCreated:t[7]||(t[7]=t=>e.handleChangesBlock({block:t,refresh:!0,crudAction:"blockCreated"})),class:"full-height"},e.infoToCreateBlock),null,16)])),_:1},8,["modelValue"]),(0,l.bF)(Q,{ref:"refBlockForm",onUpdated:t[9]||(t[9]=t=>e.handleChangesBlock({block:t,update:!0,refresh:!0}))},null,512),(0,l.bF)(E,{modelValue:e.showBlockAttributesForm,"onUpdate:modelValue":t[12]||(t[12]=t=>e.showBlockAttributesForm=t),title:e.$tr("ibuilder.cms.label.editBlockAttributes"),position:"left",class:"builder-panel-dialog",square:"",persistent:"","full-width":"","full-height":""},{default:(0,l.k6)((()=>[(0,l.bF)(N,{ref:"blockAttributesForm",onUpdateBlock:t[10]||(t[10]=t=>e.handleChangesBlock(t)),onCancel:t[11]||(t[11]=()=>e.handleChangesBlock({cancel:!0}))},null,512)])),_:1},8,["modelValue","title"]),(0,l.bF)(E,{modelValue:e.showLayoutPanel,"onUpdate:modelValue":t[13]||(t[13]=t=>e.showLayoutPanel=t),position:"left",class:"builder-panel-dialog",square:""},{default:(0,l.k6)((()=>[(0,l.bF)(R,{onCreating:e.handleCreateLayout,class:"full-height"},null,8,["onCreating"])])),_:1},8,["modelValue"])],4),(0,l.Lk)("div",{id:"rightContent",style:(0,o.Tr)(`width: calc(100% - ${e.store.panelWidth})`)},[(0,l.Lk)("div",s,[(0,l.bF)(X,{rounded:"","no-caps":"",unelevated:"",split:"",label:e.$tr("ibuilder.cms.label.administrator"),onClick:e.goHome,icon:"fa-light fa-eye",outline:"",color:"primary"},{default:(0,l.k6)((()=>[(0,l.bF)(j,null,{default:(0,l.k6)((()=>[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.dropdownActions.redirect,((e,t)=>(0,l.bo)(((0,l.uX)(),(0,l.Wv)(V,(0,l.v6)({key:t,clickable:""},e.props,{onClick:t=>void 0!=e.action?e.action():null}),{default:(0,l.k6)((()=>[(0,l.bF)(O,null,{default:(0,l.k6)((()=>[(0,l.bF)(W,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.title),1)])),_:2},1024)])),_:2},1024)])),_:2},1040,["onClick"])),[[Z]]))),128))])),_:1})])),_:1},8,["label","onClick"])]),(0,l.Lk)("div",u,["layout"===e.view?((0,l.uX)(),(0,l.CE)(l.FK,{key:0},[(0,l.Lk)("div",d,[e.store.layoutSelected?((0,l.uX)(),(0,l.Wv)($,{key:0,modelValue:e.layoutTab,"onUpdate:modelValue":t[14]||(t[14]=t=>e.layoutTab=t),align:"right","inline-label":"","no-caps":"","indicator-color":"transparent","active-bg-color":e.tabColor,"active-color":"white","content-class":`text-${e.tabColor} bg-grey-2`},{default:(0,l.k6)((()=>[(0,l.bF)(K,{name:"builder",label:e.$tr("ibuilder.cms.label.grid"),icon:"fa-light fa-border-none"},null,8,["label"]),(0,l.bF)(K,{name:"preview",label:e.$tr("ibuilder.cms.label.preview"),icon:"fa-light fa-eye",onClick:e.previewPage},null,8,["label","onClick"])])),_:1},8,["modelValue","active-bg-color","content-class"])):(0,l.Q3)("",!0),(0,l.Lk)("div",f,(0,o.v_)(e.titleTab),1),e.store.layoutSelected?((0,l.uX)(),(0,l.CE)("div",p,[(0,l.bF)(M,{size:"xs",padding:"sm",class:"q-mr-sm",unelevated:"",outline:"",onClick:t[15]||(t[15]=()=>e.handleDeleteLayout(e.store.layoutSelected)),icon:"fa-regular fa-trash",round:"",color:"negative"},{default:(0,l.k6)((()=>[(0,l.bF)(U,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.$tr("isite.cms.label.delete")),1)])),_:1})])),_:1}),(0,l.bF)(M,{size:"xs",padding:"sm",class:"q-mr-sm",unelevated:"",outline:"",onClick:t[16]||(t[16]=t=>e.crudLayout.update(e.store.layoutSelected)),icon:"fa-light fa-edit",round:"",color:"cyan"},{default:(0,l.k6)((()=>[(0,l.bF)(U,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.$tr("isite.cms.label.edit")),1)])),_:1})])),_:1}),(0,l.bF)(M,{outline:"",rounded:"",color:"green","no-caps":"",onClick:e.savePivotBlocks,padding:"xs md"},{default:(0,l.k6)((()=>[(0,l.bF)(q,{name:"fa-light fa-save",size:"17px",class:"q-mr-sm"}),(0,l.eW)(" "+(0,o.v_)(e.$tr("isite.cms.label.save")),1)])),_:1},8,["onClick"])])):(0,l.Q3)("",!0)]),(0,l.bF)(D,{color:e.tabColor,size:"3px"},null,8,["color"]),(0,l.Lk)("div",b,[e.store.layoutSelected?((0,l.uX)(),(0,l.Wv)(Y,{key:0,modelValue:e.layoutTab,"onUpdate:modelValue":t[18]||(t[18]=t=>e.layoutTab=t),animated:"","transition-prev":"scale","transition-next":"scale"},{default:(0,l.k6)((()=>[(0,l.bF)(G,{name:"builder",class:"q-pa-none overflow-hidden"},{default:(0,l.k6)((()=>[(0,l.bF)(z,(0,l.v6)({elements:e.gridBlocks},e.configHandleGrid,{ref:"handleGrid",onCreate:t[17]||(t[17]=t=>e.handleCreatingBlock(t))}),null,16,["elements"])])),_:1}),(0,l.bF)(G,{name:"preview",class:"q-pa-none"},{default:(0,l.k6)((()=>[(0,l.bF)(H,{id:`iframeLayout${e.store.layoutSelected.id}`,ref:"refIframePost"},null,8,["id"])])),_:1})])),_:1},8,["modelValue"])):((0,l.uX)(),(0,l.CE)("div",m,[(0,l.bF)(q,{name:"fa-light fa-exclamation-circle",size:"60px",color:"warning"}),(0,l.Lk)("div",v,(0,o.v_)(e.$tr("ibuilder.cms.label.chooseLayout")),1)]))])],64)):((0,l.uX)(),(0,l.CE)(l.FK,{key:1},[(0,l.Lk)("div",y,[(0,l.Lk)("div",k,[(0,l.eW)((0,o.v_)(e.titleTab)+" ",1),e.store.viewBlockSelected?((0,l.uX)(),(0,l.CE)("div",g,[(0,l.eW)(" SN: "+(0,o.v_)(e.store.viewBlockSelected.systemName)+" ",1),(0,l.bF)(M,{onClick:t[19]||(t[19]=t=>e.$helper.copyToClipboard(e.store.viewBlockSelected.systemName,"isite.cms.messages.copyToClipboard")),icon:"fa-light fa-copy",flat:"",size:"sm",padding:"0",class:"q-ml-xs",round:""})])):(0,l.Q3)("",!0)]),e.store.viewBlockSelected?((0,l.uX)(),(0,l.CE)("div",h,[(0,l.bF)(M,{size:"xs",padding:"sm",class:"q-mr-sm",unelevated:"",outline:"",onClick:t[20]||(t[20]=()=>e.handleActionsBlock("delete")),icon:"fa-regular fa-trash",round:"",color:"negative"},{default:(0,l.k6)((()=>[(0,l.bF)(U,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.$tr("isite.cms.label.delete")),1)])),_:1})])),_:1}),(0,l.bF)(M,{size:"xs",padding:"sm",class:"q-mr-sm",unelevated:"",outline:"",round:"",color:"cyan",onClick:t[21]||(t[21]=()=>e.refBlockForm.updateData(e.store.viewBlockSelected)),icon:"fa-regular fa-book"},{default:(0,l.k6)((()=>[(0,l.bF)(U,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.$tr("ibuilder.cms.label.content")),1)])),_:1})])),_:1}),(0,l.bF)(M,{size:"xs",padding:"sm",class:"q-mr-sm",unelevated:"",outline:"",onClick:t[22]||(t[22]=()=>e.handleActionsBlock("updateAttr")),icon:"fa-regular fa-palette",round:"",color:"cyan"},{default:(0,l.k6)((()=>[(0,l.bF)(U,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.$tr("ibuilder.cms.label.attributes")),1)])),_:1})])),_:1})])):(0,l.Q3)("",!0)]),(0,l.bF)(D,{color:e.tabColor,size:"3px"},null,8,["color"]),(0,l.Lk)("div",w,[e.store.viewBlockSelected&&!e.showBlockAttributesForm?((0,l.uX)(),(0,l.Wv)(H,{key:0,id:`iframeBlock${e.store.viewBlockSelected.id}`,ref:"refIframePost"},null,8,["id"])):((0,l.uX)(),(0,l.CE)("div",B,[(0,l.bF)(q,{name:"fa-light fa-exclamation-circle",size:"60px",color:"warning"}),(0,l.Lk)("div",C,(0,o.v_)(e.$tr("ibuilder.cms.label.chooseBlock")),1)]))])],64))])],4),(0,l.bF)(J,{visible:e.loading},null,8,["visible"])])}var F=n(38734),S=n(717),x=function(e,t,n){if(n||2===arguments.length)for(var l,o=0,i=t.length;o<i;o++)!l&&o in t||(l||(l=Array.prototype.slice.call(t,0,o)),l[o]=t[o]);return e.concat(l||Array.prototype.slice.call(t))},L=(0,F.Kh)({panelWidth:"380px",layoutSelected:null,viewBlockSelected:null,blockSelected:null,blockConfigs:[],mainBlockSystemName:"x-ibuilder::block"});const q=(0,l.EW)((function(){return{get panelWidth(){return L.panelWidth},get layoutSelected(){return L.layoutSelected},set layoutSelected(e){L.layoutSelected=e},resetLayoutSelected:function(){L.layoutSelected=null},get blockSelected(){return L.blockSelected},set blockSelected(e){L.blockSelected=e},get blockConfigs(){return L.blockConfigs},set blockConfigs(e){L.blockConfigs=e},get mainBlockSystemName(){return L.mainBlockSystemName},get ignoreConfigKeys(){var e=new Set(L.blockConfigs.reduce((function(e,t){var n;return x(x([],Object.keys(null!==(n=t.childBlocks)&&void 0!==n?n:{}),!0),e,!0)}),["componentAttributes"]));return Array.from(e)},get viewBlockSelected(){return L.viewBlockSelected},set viewBlockSelected(e){L.viewBlockSelected=e},resetSelecteds:function(){L.layoutSelected=null,L.blockSelected=null,L.viewBlockSelected=null}}})).value;var T=n(99526)["A"],I=function(){return I=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},I.apply(this,arguments)},_=function(e,t,n){if(n||2===arguments.length)for(var l,o=0,i=t.length;o<i;o++)!l&&o in t||(l||(l=Array.prototype.slice.call(t,0,o)),l[o]=t[o]);return e.concat(l||Array.prototype.slice.call(t))};const P={getBlockConfigs:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t={}),new Promise((function(n,l){var o={refresh:e,params:t};S.A.index("apiRoutes.qbuilder.layouts",o).then((function(e){n(I(I({},e),{data:e.data.sort((function(e,t){return t.id-e.id}))}))})).catch((function(e){return l(e)}))}))},getModuleBlocks:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t={}),new Promise((function(n,l){var o={refresh:e,params:t};S.A.index("apiRoutes.qsite.configs",o).then((function(e){n(e.data)})).catch((function(e){return l(e)}))}))},blocksBulkUpdate:function(e,t){return void 0===t&&(t=[]),new Promise((function(n,l){var o={notToSnakeCase:_(_([],t,!0),["component","entity","attributes"],!1)};S.A.update("apiRoutes.qbuilder.blocks","bulk/update",e,o).then((function(e){n(!0)})).catch((function(e){return l(e)}))}))},blocksBulkCreate:function(e,t){return void 0===t&&(t=[]),new Promise((function(n,l){var o={notToSnakeCase:_(_([],t,!0),["component","entity","attributes"],!1)};S.A.create("".concat(T("apiRoutes.qbuilder.blocks"),"/bulk/create"),e,o).then((function(e){n(!0)})).catch((function(e){return l(e)}))}))},deleteblock:function(e,t){return void 0===t&&(t={}),new Promise((function(n,l){S.A.delete("apiRoutes.qbuilder.blocks",e,t).then((function(e){n(!0)})).catch((function(e){return l(e)}))}))},updateBlock:function(e,t,n){return void 0===n&&(n={}),new Promise((function(l,o){var i=I(I({},n),{notToSnakeCase:_(_([],q.ignoreConfigKeys,!0),["component","entity","attributes"],!1)});delete t.children,S.A.update("apiRoutes.qbuilder.blocks",e,t,i).then((function(e){l(e.data)})).catch((function(e){return o(e)}))}))},layoutBlocksBulkUpdate:function(e,t){return void 0===t&&(t={}),new Promise((function(n,l){S.A.update("apiRoutes.qbuilder.layoutBlocks","bulk/update",e,t).then((function(e){n(!0)})).catch((function(e){return l(e)}))}))},deleteRelationblock:function(e,t){return void 0===t&&(t={}),new Promise((function(n,l){S.A.delete("apiRoutes.qbuilder.layoutBlocks",e,t).then((function(e){n(!0)})).catch((function(e){return l(e)}))}))}};var E=n(71915),Q=function(){return Q=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Q.apply(this,arguments)},N=function(e,t,n,l){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{c(l.next(e))}catch(t){i(t)}}function a(e){try{c(l["throw"](e))}catch(t){i(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((l=l.apply(e,t||[])).next())}))},R=function(e,t){var n,l,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,a[0]&&(r=0)),r)try{if(n=1,l&&(o=2&a[0]?l["return"]:a[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,a[1])).done)return o;switch(l=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,l=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],l=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},W=function(e,t,n){if(n||2===arguments.length)for(var l,o=0,i=t.length;o<i;o++)!l&&o in t||(l||(l=Array.prototype.slice.call(t,0,o)),l[o]=t[o]);return e.concat(l||Array.prototype.slice.call(t))};function O(){var e=this,t={refIframePost:(0,F.KR)(),crudLayout:(0,F.KR)(null),refLayoutList:(0,F.KR)(),refBlockList:(0,F.KR)(),handleGrid:(0,F.KR)(),refBlockForm:(0,F.KR)(),blockAttributesForm:(0,F.KR)()},n=(0,F.Kh)({blocks:[],layoutTab:"builder",layoutClone:null,loading:!1,showBlocksPanel:!1,showLayoutPanel:!1,showBlockAttributesForm:!1,infoToCreateBlock:{index:0,layoutId:null,parentSystemName:null},gridBlocks:[],view:"layout"}),o={tabColor:(0,l.EW)((function(){return"preview"==n.layoutTab?"indigo-10":"orange-10"})),titleTab:(0,l.EW)((function(){var e,t,l,o=(null===(e=q.layoutSelected)||void 0===e?void 0:e.title)?"".concat(q.layoutSelected.id," | ").concat(q.layoutSelected.title):E.Ru.tr("ibuilder.cms.layout"),i=(null===(t=q.viewBlockSelected)||void 0===t?void 0:t.internalTitle)?"".concat(q.viewBlockSelected.id," | ").concat(null===(l=q.viewBlockSelected)||void 0===l?void 0:l.internalTitle):E.Ru.tr("isite.cms.label.block");return"layout"===n.view?o:i})),configHandleGrid:(0,l.EW)((function(){return{orderBy:"sortOrder",titleField:"gridLabel",canAddNewItem:!0,actions:{blockDelete:{label:E.Ru.tr("isite.cms.label.delete"),icon:"fa-regular fa-trash",color:"red",action:function(e){var t=n.blocks.find((function(t){return t.pivot.id===e.id}));t&&i.alertDeleteBlock(t)}},blockContent:{label:E.Ru.tr("ibuilder.cms.label.content"),icon:"fa-regular fa-book",action:function(e){var l,o=n.blocks.find((function(t){return t.id===e.blockId}));o&&(null===(l=t.refBlockForm.value)||void 0===l||l.updateData(o))}},blockAttriutes:{label:E.Ru.tr("ibuilder.cms.label.attributes"),icon:"fa-regular fa-palette",action:function(e){n.showBlockAttributesForm=!0;var l=n.blocks.find((function(t){return t.id===e.blockId}));l&&setTimeout((function(){var e,n;return null===(n=null===(e=t.blockAttributesForm)||void 0===e?void 0:e.value)||void 0===n?void 0:n.edit(l)}),500)}}}}})),dropdownActions:(0,l.EW)((function(){return{redirect:[{title:E.Ru.tr("isite.cms.showSite"),props:{tag:"a",href:E.M_.state.qsiteApp.baseUrl,target:"_blank",id:"siteActionGoToSite"}}],editor:[{label:"Layout",value:"layout"},{label:"Block",value:"block"}]}}))},i={getConfigBlocks:function(){return N(e,void 0,void 0,(function(){var e,t,l,o,i;return R(this,(function(r){switch(r.label){case 0:n.loading=!0,e={filter:{allTranslations:!0,configNameByModule:"blocks"}},r.label=1;case 1:return r.trys.push([1,3,,4]),[4,P.getModuleBlocks(!0,e)];case 2:return t=r.sent(),l=[],o=Object.values(t).filter((function(e){return e})),o.forEach((function(e){Object.values(e).forEach((function(e){e.systemName!==q.mainBlockSystemName&&(e.childBlocks=Q({mainblock:q.mainBlockSystemName},e.childBlocks||{})),l.push(e)}))})),q.blockConfigs=l,[3,4];case 3:return i=r.sent(),console.error(i),E.xE.error(this.$tr("isite.cms.message.errorRequest")),[3,4];case 4:return n.loading=!1,[2]}}))}))},previewPage:function(){"preview"===n.layoutTab&&setTimeout((function(){var e,l;(null===(l=null===(e=t.refIframePost)||void 0===e?void 0:e.value)||void 0===l?void 0:l.loadIframe)&&q.layoutSelected&&t.refIframePost.value.loadIframe("".concat(E.M_.state.qsiteApp.baseUrl,"/api/ibuilder/v1/layout/preview/").concat(q.layoutSelected.id),Q(Q({},q.layoutSelected),{blocks:n.blocks}))}),300)},previewBlock:function(){setTimeout((function(){var e,n,l;(null===(n=null===(e=t.refIframePost)||void 0===e?void 0:e.value)||void 0===n?void 0:n.loadIframe)&&(null===(l=q.viewBlockSelected)||void 0===l?void 0:l.id)&&t.refIframePost.value.loadIframe("".concat(E.M_.state.qsiteApp.baseUrl,"/api/ibuilder/v1/block/preview"),q.viewBlockSelected)}),300)},refreshApiData:function(e){var l,o,i,r,a=e.crudAction,c=void 0===a?"":a,s=e.emitSelected,u=void 0===s||s;return N(this,void 0,void 0,(function(){var e;return R(this,(function(a){switch(a.label){case 0:"deleted"==c&&q.resetSelecteds(),n.loading=!0,a.label=1;case 1:return a.trys.push([1,6,,7]),"layout"!=n.view?[3,3]:[4,null===(o=null===(l=t.refLayoutList)||void 0===l?void 0:l.value)||void 0===o?void 0:o.refreshLayouts({crudAction:c,emitSelected:u})];case 2:return a.sent(),[3,5];case 3:return[4,null===(r=null===(i=t.refBlockList)||void 0===i?void 0:i.value)||void 0===r?void 0:r.refreshBlocks(c)];case 4:a.sent(),a.label=5;case 5:return[3,7];case 6:return e=a.sent(),console.error(e),[3,7];case 7:return n.loading=!1,[2]}}))}))},handleLayoutSelected:function(){var e;n.blocks=(0,E.o8)((null===(e=q.layoutSelected)||void 0===e?void 0:e.blocks)||[]),i.setTheGridBlocks(),n.layoutTab="builder"},setTheGridBlocks:function(){var e,t=(0,E.o8)(null!==(e=n.blocks)&&void 0!==e?e:[]),l=q.blockConfigs.filter((function(e){return e.allowChildren})).map((function(e){return e.systemName})),o=t.map((function(e){var t,n,o=Q(Q({},e.pivot),{gridLabel:"".concat(e.id," | ").concat(e.internalTitle)});return l.includes(null===(t=null===e||void 0===e?void 0:e.component)||void 0===t?void 0:t.systemName)&&!(null===(n=null===e||void 0===e?void 0:e.children)||void 0===n?void 0:n.length)&&(o.children=[]),o})).sort((function(e,t){return e.sortOrder-t.sortOrder}));n.gridBlocks=E.YO.builTree(o||[],0,{parentFieldName:"parentSystemName",parentFieldValue:"systemName"})},handleCreatingBlock:function(e){var t;n.infoToCreateBlock=Q(Q({},n.infoToCreateBlock),{index:e?e.children.length:n.gridBlocks.length,parentSystemName:(null===e||void 0===e?void 0:e.systemName)||null,layoutId:(null===(t=q.layoutSelected)||void 0===t?void 0:t.id)||null}),n.showBlocksPanel=!0},handleChangesBlock:function(e){var t=e.block,l=void 0===t?null:t,o=e.wasDeleted,r=void 0!==o&&o,a=e.refresh,c=void 0!==a&&a,s=e.update,u=void 0!==s&&s,d=e.persistModalAttributes,f=void 0!==d&&d,p=e.crudAction,b=void 0===p?"":p,m=e.cancel,v=void 0!==m&&m;if("block"==n.view&&(r&&(q.viewBlockSelected=null),v&&setTimeout((function(){return i.previewBlock()}),500),u&&(q.viewBlockSelected=l)),l&&(u&&i.handleUpdateBlock({block:l}),(c||"block"==n.view)&&i.refreshApiData({crudAction:b,emitSelected:!1}),"layout"==n.view)){var y=n.blocks.findIndex((function(e){var t;return e.pivot.id===(null===(t=l.pivot)||void 0===t?void 0:t.id)}));y>=0?r?n.blocks.splice(y,1):n.blocks=n.blocks.map((function(e){return e.id===l.id?Q(Q({},l),{pivot:e.pivot}):e})):r||(n.blocks=W(W([],n.blocks,!0),[l],!1)),i.setTheGridBlocks()}n.showBlocksPanel=!1,n.showBlockAttributesForm=f},handleCreateLayout:function(e,l){var o,r,a;return void 0===l&&(l=!1),N(this,void 0,void 0,(function(){var c;return R(this,(function(s){switch(s.label){case 0:return l?[3,1]:(n.layoutClone=(0,E.o8)(e),null===(o=t.crudLayout.value)||void 0===o||o.create(e),[3,3]);case 1:return n.showLayoutPanel=!1,n.loading=!0,c=(0,E.o8)(null!==(a=null===(r=n.layoutClone)||void 0===r?void 0:r.blocks)&&void 0!==a?a:[]),c.forEach((function(t){var n,l=(0,E.Ld)();c.forEach((function(n){var o,i;n.layouts=n.layouts||{},n.layouts[e.id]=n.layouts[e.id]||{},(null===(o=n.pivot)||void 0===o?void 0:o.parentSystemName)===(null===(i=t.pivot)||void 0===i?void 0:i.systemName)&&(n.layouts[e.id].parentSystemName=l)})),t.entity={},t.systemName=(0,E.Ld)(),delete t.id,t.layouts=t.layouts||{},t.layouts[e.id]=Q(Q({},null!==(n=t.layouts[e.id])&&void 0!==n?n:{}),{systemName:l,gridPosition:t.pivot.gridPosition,sortOrder:t.pivot.sortOrder})})),[4,P.blocksBulkCreate(c,q.ignoreConfigKeys).then((function(e){E.xE.info({message:E.Ru.tr("isite.cms.message.recordUpdated")}),i.refreshApiData({crudAction:"created"})})).catch((function(e){E.xE.error({message:E.Ru.tr("isite.cms.message.recordNoUpdated")}),n.loading=!1}))];case 2:s.sent(),s.label=3;case 3:return[2]}}))}))},savePivotBlocks:function(){return N(this,void 0,void 0,(function(){var e;return R(this,(function(t){switch(t.label){case 0:return n.loading=!0,e=n.blocks.map((function(e){return Q({},e.pivot)})),[4,P.layoutBlocksBulkUpdate(e).then((function(e){E.xE.info({message:E.Ru.tr("isite.cms.message.recordUpdated")}),i.refreshApiData({}),n.loading=!1})).catch((function(e){E.xE.error({message:E.Ru.tr("isite.cms.message.recordNoUpdated")}),n.loading=!1}))];case 1:return t.sent(),[2]}}))}))},handleUpdateBlock:function(e){var t=e.block,l=e.params,o=void 0===l?{}:l;return N(this,void 0,void 0,(function(){return R(this,(function(e){switch(e.label){case 0:return[4,P.updateBlock(t.id,t,o).then((function(e){n.loading=!1,E.xE.info({message:E.Ru.tr("isite.cms.message.recordUpdated")})})).catch((function(e){n.loading=!1,E.xE.error({message:E.Ru.tr("isite.cms.message.recordNoUpdated")})}))];case 1:return e.sent(),[2]}}))}))},deleteBlock:function(e){return N(this,void 0,void 0,(function(){return R(this,(function(t){switch(t.label){case 0:return n.loading=!0,"layout"!==n.view?[3,2]:[4,P.deleteRelationblock(e.pivot.id)];case 1:return t.sent(),[3,4];case 2:return[4,P.deleteblock(e.id)];case 3:t.sent(),t.label=4;case 4:return i.handleChangesBlock({block:e,wasDeleted:!0,refresh:!0}),[2]}}))}))},handleDeleteLayout:function(e){var n;return N(this,void 0,void 0,(function(){return R(this,(function(l){return null===(n=t.crudLayout.value)||void 0===n||n.delete(e),[2]}))}))},goHome:function(){var e=E.QB.resolve({name:"app.home"});window.open(e.href,"_blank")},openBlockPanel:function(){n.infoToCreateBlock={index:0,layoutId:null,parentSystemName:null},setTimeout((function(){return n.showBlocksPanel=!0}),100)},handleActionsBlock:function(e){"updateAttr"==e?(n.showBlockAttributesForm=!0,setTimeout((function(){var e,n;return null===(n=null===(e=t.blockAttributesForm)||void 0===e?void 0:e.value)||void 0===n?void 0:n.edit(q.viewBlockSelected)}),500)):"delete"==e&&i.alertDeleteBlock(q.viewBlockSelected)},alertDeleteBlock:function(e){var t,n;E.xE.error({mode:"modal",title:null!==(t=e.internalTitle)&&void 0!==t?t:"".concat(e.id," | Block ID: ").concat(null!==(n=e.blockId)&&void 0!==n?n:""),message:E.Ru.tr("isite.cms.message.deleteRecord"),actions:[{label:E.Ru.tr("isite.cms.label.cancel"),color:"grey-8"},{label:E.Ru.tr("isite.cms.label.accept"),color:"green",handler:function(){return i.deleteBlock(e)}}]})}};return(0,l.sV)((function(){i.getConfigBlocks()})),(0,l.hi)((function(){q.resetSelecteds()})),(0,l.wB)((function(){return n.gridBlocks}),(function(e,t){var l=E.YO.destroyNestedItems((0,E.o8)(e),null,{parentFieldName:"parentSystemName",parentFieldValue:"systemName"}),o=[];l.forEach((function(e){var t=n.blocks.find((function(t){return t.pivot.id==e.id}));t&&(t.pivot=Q(Q({},t.pivot),e),o.push(t))})),n.blocks=o}),{deep:!0}),(0,l.wB)((function(){return n.view}),(function(e,t){q.resetSelecteds()})),Q(Q(Q(Q(Q({},t),(0,F.QW)(n)),o),i),{store:q})}const V={key:0,id:"iframePostcomponent",class:"relative-position"},j=["id"],X=["action"],K=["innerHTML"];function $(e,t,n,o,i,r){const a=(0,l.g2)("inner-loading");return e.actionUrl?((0,l.uX)(),(0,l.CE)("div",V,[(0,l.Lk)("iframe",{id:e.id,name:"post-iframe",frameborder:"0",onLoad:t[0]||(t[0]=(...t)=>e.handleIframeLoad&&e.handleIframeLoad(...t))},null,40,j),(0,l.Lk)("form",{name:"formPostIframe",id:"formPostIframe",method:"post",target:"post-iframe",action:e.actionUrl},[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.inputsForm,(e=>((0,l.uX)(),(0,l.CE)("div",{innerHTML:e.outerHTML},null,8,K)))),256))],8,X),(0,l.bF)(a,{visible:e.loading},null,8,["visible"])])):(0,l.Q3)("",!0)}var U=function(){return U=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},U.apply(this,arguments)};function M(e,t){var n={},o=(0,F.Kh)({loading:!1,count:0,actionUrl:null,inputsForm:[]}),i={},r={loadIframe:function(e,t){o.loading=!0,o.actionUrl=(0,E.o8)(e);var n=[];Object.keys(t).forEach((function(e){var l=document.createElement("input");l.name=e,l.value=JSON.stringify(t[e]),l.type="hidden",n.push(l)})),o.inputsForm=n,(0,l.dY)((function(){var e=Object.getPrototypeOf(document.forms["formPostIframe"]).submit;e.call(document.forms["formPostIframe"])}))},handleIframeLoad:function(){o.count+=1,2===o.count&&(o.loading=!1,o.count=1)}};return(0,l.sV)((function(){window.addEventListener("message",(function(e){var t=e.data,n=t.elementId,l=document.getElementById(n);l&&(l.style.height="".concat(t.clientHeight,"px"))}))})),U(U(U(U({},n),(0,F.QW)(o)),i),r)}const D=(0,l.pM)({props:{id:{type:String,default:""}},components:{},setup(){return{...M()}}});var z=n(12807);const G=(0,z.A)(D,[["render",$]]),H=G,Y={id:"builderPanelLayouts",class:"drawer-body relative-position"},J={class:"flex q-gutter-xs justify-between"},Z={class:"text-center text-weight-bold"};function ee(e,t,n,i,r,a){const c=(0,l.g2)("q-icon"),s=(0,l.g2)("q-btn"),u=(0,l.g2)("q-separator"),d=(0,l.g2)("recursive-item"),f=(0,l.g2)("inner-loading");return(0,l.uX)(),(0,l.CE)("div",Y,[(0,l.Lk)("div",J,[(0,l.bF)(s,{onClick:t[0]||(t[0]=t=>e.$emit("create")),outline:"",rounded:"",class:"q-mb-sm text-capitalize",color:"primary","no-caps":""},{default:(0,l.k6)((()=>[(0,l.bF)(c,{size:"xs",left:"",name:"fa-solid fa-plus"}),(0,l.Lk)("div",Z,(0,o.v_)(e.$tr("ibuilder.cms.newLayout")),1)])),_:1}),(0,l.bF)(s,{onClick:e.handleRefresh,outline:"",rounded:"",class:"q-mb-sm",size:"sm",color:"primary","no-caps":"",icon:"fa-light fa-rotate-right"},null,8,["onClick"])]),(0,l.bF)(u,{spaced:""}),(0,l.bF)(d,{id:"recursiveItemContent",translatable:!1,menu:e.mapLayouts,"right-icon":""},null,8,["menu"]),(0,l.bF)(f,{visible:e.loading},null,8,["visible"])])}var te=function(){return te=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},te.apply(this,arguments)};const ne={getLayouts:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t={}),new Promise((function(n,l){var o={refresh:e,params:t};S.A.index("apiRoutes.qbuilder.layouts",o).then((function(e){n(te(te({},e),{data:e.data.sort((function(e,t){return t.id-e.id})).map((function(e){return te(te({},e),{blocks:e.blocks.map((function(e){return te(te({},e),{entity:Array.isArray(e.entity)?{}:e.entity,attributes:Array.isArray(e.attributes)?{}:e.attributes})}))})}))}))})).catch((function(e){return l(e)}))}))}};var le=(0,F.Kh)({itemSelected:{}});const oe=(0,l.EW)((function(){return{get itemSelected(){return le.itemSelected},set itemSelected(e){le.itemSelected=e}}})).value;var ie=function(){return ie=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},ie.apply(this,arguments)},re=function(e,t,n,l){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{c(l.next(e))}catch(t){i(t)}}function a(e){try{c(l["throw"](e))}catch(t){i(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((l=l.apply(e,t||[])).next())}))},ae=function(e,t){var n,l,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,a[0]&&(r=0)),r)try{if(n=1,l&&(o=2&a[0]?l["return"]:a[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,a[1])).done)return o;switch(l=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,l=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],l=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function ce(e,t){var n={},o=(0,F.Kh)({layouts:[],mapLayouts:[],loading:!1}),i={},r={getLayouts:function(){return o.loading=!0,new Promise((function(e){var t={filter:{allTranslations:!0},include:"blocks.fields"};ne.getLayouts(!0,t).then((function(t){o.layouts=t.data,o.mapLayouts=r.orderedItems(),o.loading=!1,e(!1)})).catch((function(t){o.loading=!1,e(!1)}))}))},refreshLayouts:function(e){var n=e.crudAction,l=void 0===n?"":n,i=e.emitSelected,a=void 0===i||i;return re(this,void 0,void 0,(function(){var e,n;return ae(this,(function(i){switch(i.label){case 0:return t("refresh",!0),[4,r.getLayouts()];case 1:return i.sent(),"created"==l?(e=o.layouts[0],oe.itemSelected=e,q.layoutSelected=e,t("selected",(0,E.o8)(e))):q.layoutSelected&&q.layoutSelected.id&&(n=o.layouts.find((function(e){var t;return e.id===(null===(t=q.layoutSelected)||void 0===t?void 0:t.id)})),a&&n&&(q.layoutSelected=(0,E.o8)(n),t("selected",(0,E.o8)(n)))),t("refresh",!1),[2]}}))}))},builderConfig:function(){var e=E.M_.getters["qsiteApp/getConfigApp"]("builder.layout",!0),t={};return Object.keys(e).forEach((function(n){e[n]&&(t[n]=e[n])})),t},orderedItems:function(){var e=r.builderConfig(),t=[];return Object.keys(e).forEach((function(n){e[n].forEach((function(e){var l=o.layouts.filter((function(t){return t.entityType==e.entity.value})),i=l.map((function(e){var t,n;return ie(ie({},e),{type:null!==(t=e.type)&&void 0!==t?t:"General",label:"".concat(e.id," | ").concat(e.title," ").concat(e.default?"(Default)":""),subLabel:"".concat(null!==(n=e.type)&&void 0!==n?n:"General"),activated:!0,icon:"fa-light fa-arrow-right",action:r.selectLayout})}));t.push({label:"".concat(e.entity.label," (").concat(n,")"),headerClass:"expansion-header",customClass:"expansion-border",children:i.sort((function(e,t){return e.type.localeCompare(t.type)}))})}))})),t},selectLayout:function(e){return new Promise((function(n){var l=function(){var l=o.layouts.find((function(t){return t.id===e.id}));if(!l)return n(!0);q.layoutSelected=(0,E.o8)(l),t("selected",(0,E.o8)(l)),n(!0)};q.layoutSelected?q.layoutSelected.id!==e.id&&E.xE.warning({mode:"modal",title:E.Ru.tr("ibuilder.cms.label.sureChangeLayout"),message:E.Ru.tr("ibuilder.cms.label.descriptionSureChangeLayout"),actions:[{label:E.Ru.tr("isite.cms.label.cancel"),color:"grey-8",handler:function(){return n(!1)}},{label:E.Ru.tr("isite.cms.label.accept"),color:"green",handler:l}]}):l()}))},handleRefresh:function(){q.layoutSelected?E.xE.warning({mode:"modal",title:E.Ru.tr("ibuilder.cms.label.sureRefreshLayout"),message:E.Ru.tr("ibuilder.cms.label.descriptionSureRefreshLayout"),actions:[{label:E.Ru.tr("isite.cms.label.cancel"),color:"grey-8"},{label:E.Ru.tr("isite.cms.label.accept"),color:"green",handler:function(){return r.refreshLayouts({})}}]}):r.refreshLayouts({})}};return(0,l.sV)((function(){r.getLayouts()})),ie(ie(ie(ie({},n),(0,F.QW)(o)),i),r)}var se=n(29104);const ue={id:"listMenu"};function de(e,t,n,i,r,a){const c=(0,l.g2)("q-tooltip"),s=(0,l.g2)("q-icon"),u=(0,l.g2)("q-item-section"),d=(0,l.g2)("q-item-label"),f=(0,l.g2)("q-item"),p=(0,l.g2)("recursive-menu"),b=(0,l.g2)("q-expansion-item"),m=(0,l.g2)("q-no-ssr");return(0,l.bo)(((0,l.uX)(),(0,l.CE)("div",null,[(0,l.Lk)("div",ue,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.menuData,((t,i)=>((0,l.uX)(),(0,l.Wv)(m,{key:i,class:(0,o.C4)(`content-item ${n.inLine?"inline-block":""} ${n.showSelected?"select-items":""}`)},{default:(0,l.k6)((()=>[n.withTooltip?((0,l.uX)(),(0,l.Wv)(c,(0,o._B)((0,l.v6)({key:0},n.tooltipProps||{})),{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(n.translatable?e.$tr(t.label):t.label),1)])),_:2},1040)):(0,l.Q3)("",!0),void 0==t?.itemProps?.vIf||t?.itemProps?.vIf?((0,l.uX)(),(0,l.Wv)(f,(0,l.v6)({key:1,id:`menuItem-${e.parseIdItem(t.name||i)}`},t.itemProps,{onClick:n=>e.selectItem(t)}),{default:(0,l.k6)((()=>[t.icon&&n.showIcons?((0,l.uX)(),(0,l.Wv)(u,{key:0,avatar:""},{default:(0,l.k6)((()=>[(0,l.bF)(s,{name:t.icon},null,8,["name"])])),_:2},1024)):(0,l.Q3)("",!0),(0,l.bF)(u,{class:"text-capitalize"},{default:(0,l.k6)((()=>[(0,l.bF)(d,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(n.translatable?e.$tr(t.label):t.label),1)])),_:2},1024),(0,l.bF)(d,{caption:"",lines:"2"},{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(n.translatable?e.$tr(t.subLabel):t.subLabel),1)])),_:2},1024)])),_:2},1024)])),_:2},1040,["id","onClick"])):e.checkItemMultiple(t)?((0,l.uX)(),(0,l.Wv)(b,(0,l.v6)({icon:t.icon,key:i,label:n.translatable?e.$tr(t.label):t.label},n.group?{group:e.listUid}:{},{"header-class":`${t.headerClass} ${e.selectedChildren(t)}`,"default-opened":!!e.selectedChildren(t),class:`${t.customClass} ${e.selectedChildren(t)?"expansion-selected":""}`}),{default:(0,l.k6)((()=>[((0,l.uX)(),(0,l.Wv)(p,{translatable:n.translatable,"show-icons":n.showIcons,key:i,menu:t.children,group:n.group,"right-icon":n.rightIcon},null,8,["translatable","show-icons","menu","group","right-icon"]))])),_:2},1040,["icon","label","header-class","default-opened","class"])):(0,l.Q3)("",!0)])),_:2},1032,["class"])))),128))])],512)),[[se.aG,e.showMenu]])}var fe=function(){return fe=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},fe.apply(this,arguments)},pe=function(e,t,n,l){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{c(l.next(e))}catch(t){i(t)}}function a(e){try{c(l["throw"](e))}catch(t){i(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((l=l.apply(e,t||[])).next())}))},be=function(e,t){var n,l,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,a[0]&&(r=0)),r)try{if(n=1,l&&(o=2&a[0]?l["return"]:a[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,a[1])).done)return o;switch(l=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,l=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],l=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function me(e,t){var n={},o=(0,F.Kh)({showMenu:!1,listUid:(0,E.Ld)().toString(),props:{}}),i={menuData:(0,l.EW)((function(){var t=e.menu.map((function(e){return e.itemProps={class:r.getClassItem(e),tag:"div",key:(0,E.Ld)(),vIf:r.checkItemSingle(e),clickable:!0},e.action||(e.itemProps.tag="a",e.toRoute?e.itemProps.href=e.toRoute:e.itemProps.to={name:e.name,params:e.params||{}}),e}));return t}))},r={init:function(){o.props=(0,E.o8)(e),setTimeout((function(){r.checkCollapsibles(),o.showMenu=!0}),300)},parseIdItem:function(e){return Number.isInteger(e)?e:e.replaceAll(".","")},checkItemSingle:function(e){var t,n=!0;return e.activated||(n=!1),e.children&&(n=!1),e.name||(n=!1),e.permission&&!E.M_.hasAccess(e.permission)&&(n=!1),!(null===(t=e.children)||void 0===t?void 0:t.length)&&e.action&&(n=!0),n},checkItemMultiple:function(e){var t=!0;return!!(e.children&&e.children.length&&e.action)||(e.children||(t=!1),e.children&&!e.children.length&&(t=!1),e.permission&&!E.M_.hasAccess(e.permission)&&(t=!1),t)},checkCollapsibles:function(){for(var e=document.getElementsByClassName("q-expansion-item"),t=0,n=e;t<n.length;t++){var l=n[t],o=l.getElementsByClassName("single-item");o.length||(l.style.display="none")}},redirectTo:function(e){e.linkType&&"external"==e.linkType?window.open("https://".concat(e.url),e.target):e.name&&E.QB.push({name:e.name,params:e.params||{}})},selectedChildren:function(e){var t="",n=function(e){var t,l=E.QB.route.name,o=!1;return e&&e.forEach((function(e){e.name==l&&(o=!0),e.children&&n(e.children)&&(o=!0)})),e&&(null===(t=oe.itemSelected)||void 0===t?void 0:t.id)&&e.forEach((function(e){var t;e.id==(null===(t=oe.itemSelected)||void 0===t?void 0:t.id)&&(o=!0)})),o};return e.children&&n(e.children)&&(t=" item-is-active"),t},getClassItem:function(t){var n,l="single-item";return e.rightIcon&&(l+=" row reverse"),(null===(n=oe.itemSelected)||void 0===n?void 0:n.id)&&t.id===oe.itemSelected.id&&(l+=" item-is-active"),E.QB.route.name==t.name&&JSON.stringify(E.QB.route.params)==JSON.stringify(t.params||{})&&(l+=" item-is-active"),l},selectItem:function(e){return pe(this,void 0,void 0,(function(){var t;return be(this,(function(n){switch(n.label){case 0:return e.action?[4,e.action(e)]:[3,2];case 1:t=n.sent(),t&&(oe.itemSelected=e),n.label=2;case 2:return[2]}}))}))}};return(0,l.wB)((function(){return e.menu}),(function(){r.init()})),(0,l.sV)((function(){(0,l.dY)((function(){r.init()}))})),(0,l.hi)((function(){oe.itemSelected={}})),fe(fe(fe(fe(fe({},n),(0,F.QW)(o)),i),r),{store:oe})}const ve={name:"recursiveMenu",components:{},props:{withTooltip:{type:Boolean,default:!1},menu:{type:Array,default:()=>[]},showIcons:{type:Boolean,default:!0},translatable:{type:Boolean,default:!0},inLine:{type:Boolean,default:!1},group:{type:Boolean,defualt:!1},tooltipProps:{type:Object,default:null},rightIcon:{type:Boolean,default:!1},showSelected:{type:Boolean,default:!0}},setup(e,{emit:t}){return me(e,t)}};var ye=n(13430),ke=n(78151),ge=n(75329),he=n(63418),we=n(24609),Be=n(35779),Ce=n(76986),Ae=n(98582),Fe=n.n(Ae);const Se=(0,z.A)(ve,[["render",de]]),xe=Se;Fe()(ve,"components",{QNoSsr:ye.A,QTooltip:ke.A,QItem:ge.A,QItemSection:he.A,QIcon:we.A,QItemLabel:Be.A,QExpansionItem:Ce.A});const Le=(0,l.pM)({props:{},components:{recursiveItem:xe},emits:["refresh","selected","create"],setup(e,{emit:t}){return ce(e,t)}});var qe=n(69001),Te=n(37015),Ie=n(66929),_e=n(54514);const Pe=(0,z.A)(Le,[["render",ee]]),Ee=Pe;Fe()(Le,"components",{QBtn:qe.A,QIcon:we.A,QSeparator:Te.A,QExpansionItem:Ce.A,QItem:ge.A,QMenu:Ie.A,QList:_e.A});var Qe={id:"builderBlockPanel",class:"bg-white relative-position"},Ne={class:"drawer-title q-py-md q-px-md"},Re={class:"text-center text-subtitle1 text-weight-bold"},We={key:0,class:"row"},Oe={class:"col-5"},Ve=(0,l.Lk)("div",{class:"title-tabs"},null,-1),je={class:"selection-item ellipsis row justify-between"},Xe={class:"col-7"},Ke=["src","alt"],$e={class:"ellipsis-2-lines full-width title-item q-py-xs"},Ue={class:"flex q-mt-sm q-px-lg"},Me={class:"text-center text-weight-bold"},De=["src","alt"],ze={class:"ellipsis-2-lines full-width title-item q-py-xs"};function Ge(e,t,n,i,r,a){var c=(0,l.g2)("q-icon"),s=(0,l.g2)("q-tab"),u=(0,l.g2)("q-tabs"),d=(0,l.g2)("q-separator"),f=(0,l.g2)("not-result"),p=(0,l.g2)("q-item-section"),b=(0,l.g2)("q-item"),m=(0,l.g2)("q-tab-panel"),v=(0,l.g2)("q-btn"),y=(0,l.g2)("q-list"),k=(0,l.g2)("q-menu"),g=(0,l.g2)("q-tab-panels"),h=(0,l.g2)("block-form"),w=(0,l.g2)("inner-loading"),B=(0,l.gN)("ripple"),C=(0,l.gN)("close-popup");return(0,l.uX)(),(0,l.CE)("div",Qe,[(0,l.Lk)("div",Ne,[(0,l.Lk)("h2",Re,(0,o.v_)(e.$tr("ibuilder.cms.label.blocks")),1)]),e.loading?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",We,[(0,l.Lk)("div",Oe,[Ve,(0,l.bF)(u,{modelValue:e.blockTypeSelected,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.blockTypeSelected=t}),vertical:"","active-bg-color":"primary","inline-label":"","active-class":"selected-item","active-color":"white","indicator-color":"primary",class:"scroll-content border-tab","content-class":"alternating-colors"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.blockTypes,(function(e,t){return(0,l.uX)(),(0,l.Wv)(s,{key:t,name:e.systemName,"content-class":"custom-position","no-caps":""},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",je,[(0,l.eW)((0,o.v_)(e.title)+" ",1),(0,l.bF)(c,{name:"fa-light fa-arrow-right",class:"q-mr-xs",size:"16px",color:"blue-grey"})])]})),_:2},1032,["name"])})),128))]})),_:1},8,["modelValue"])]),(0,l.Lk)("div",Xe,[(0,l.bF)(u,{modelValue:e.blockTypeTab,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.blockTypeTab=t}),align:"right","inline-label":"","no-caps":"","indicator-color":"transparent","active-bg-color":e.tabColor,"active-color":"white","content-class":"text-".concat(e.tabColor," bg-grey-2")},{default:(0,l.k6)((function(){return[(0,l.bF)(s,{name:"global",label:e.$tr("ibuilder.cms.label.libraryBlocks")},null,8,["label"]),(0,l.bF)(s,{name:"local",label:e.$tr("ibuilder.cms.label.localBlocks")},null,8,["label"])]})),_:1},8,["modelValue","active-bg-color","content-class"]),(0,l.bF)(d,{color:e.tabColor,size:"2px"},null,8,["color"]),(0,l.bF)(g,{modelValue:e.blockTypeTab,"onUpdate:modelValue":t[3]||(t[3]=function(t){return e.blockTypeTab=t}),animated:"","transition-prev":"scale","transition-next":"scale",class:"scroll-content"},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{name:"global",class:(0,o.C4)("q-pa-none ".concat(e.blocksBySelectedType.library.length?"":"overflow-hidden"))},{default:(0,l.k6)((function(){return[e.blocksBySelectedType.library.length?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(e.blocksBySelectedType.library,(function(t,n){return(0,l.bo)(((0,l.uX)(),(0,l.Wv)(b,{key:"libraryKey".concat(n),clickable:"",class:"bg-trans-item",onClick:function(n){return e.selectBlock(t)}},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{class:"relative-position q-ma-sm image-section selectable"},{default:(0,l.k6)((function(){return[(0,l.Lk)("img",{src:t.mediaFiles.internalimage.url,alt:t.internalTitle},null,8,Ke),(0,l.Lk)("span",$e,(0,o.v_)(t.internalTitle),1)]})),_:2},1024)]})),_:2},1032,["onClick"])),[[B]])})),128)):((0,l.uX)(),(0,l.Wv)(f,{key:0,class:"q-mt-xl"}))]})),_:1},8,["class"]),(0,l.bF)(m,{name:"local",class:(0,o.C4)("q-pa-none ".concat(e.blocksBySelectedType.local.length?"":"overflow-hidden"))},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",Ue,[(0,l.bF)(v,{onClick:t[2]||(t[2]=function(t){return e.selectBlock(e.blockDefault)}),outline:"",rounded:"",class:"full-width q-mx-sm text-capitalize",color:"primary","no-caps":""},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{size:"xs",left:"",name:"fa-solid fa-plus"}),(0,l.Lk)("div",Me,(0,o.v_)(e.$tr("ibuilder.cms.newBlock")),1)]})),_:1})]),e.blocksBySelectedType.local.length?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(e.blocksBySelectedType.local,(function(t,n){return(0,l.bo)(((0,l.uX)(),(0,l.Wv)(b,{key:"localKey".concat(n),clickable:!e.layoutId,onClick:function(n){return e.selectBlock(t)},class:"bg-trans-item"},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{class:"relative-position q-ma-sm image-section selectable"},{default:(0,l.k6)((function(){return[(0,l.Lk)("img",{src:t.mediaFiles.internalimage.url,alt:t.internalTitle},null,8,De),(0,l.Lk)("span",ze,(0,o.v_)(t.internalTitle),1),e.layoutId?((0,l.uX)(),(0,l.Wv)(k,{key:0,anchor:"top right",self:"top end"},{default:(0,l.k6)((function(){return[(0,l.bF)(y,{style:{"min-width":"100px"},dense:"",bordered:""},{default:(0,l.k6)((function(){return[(0,l.bo)(((0,l.uX)(),(0,l.Wv)(b,{clickable:"",onClick:function(n){return e.selectBlock(t)},class:"row items-center"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{name:"fa-light fa-clone",class:"q-mr-sm",color:"teal"}),(0,l.eW)(" "+(0,o.v_)(e.$tr("ibuilder.cms.label.clone")),1)]})),_:2},1032,["onClick"])),[[C]]),(0,l.bo)(((0,l.uX)(),(0,l.Wv)(b,{clickable:"",onClick:function(n){return e.relateBlock(t)},class:"row items-center"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{name:"fa-light fa-link",class:"q-mr-sm",color:"indigo"}),(0,l.eW)(" "+(0,o.v_)(e.$tr("ibuilder.cms.label.relate")),1)]})),_:2},1032,["onClick"])),[[C]])]})),_:2},1024)]})),_:2},1024)):(0,l.Q3)("",!0)]})),_:2},1024)]})),_:2},1032,["clickable","onClick"])),[[B]])})),128)):((0,l.uX)(),(0,l.Wv)(f,{key:0,class:"q-mt-xl"}))]})),_:1},8,["class"])]})),_:1},8,["modelValue"])])])),(0,l.bF)(h,{ref:"refBlockForm",onCreated:e.emitCreated},null,8,["onCreated"]),(0,l.bF)(w,{visible:e.loading},null,8,["visible"])])}var He=n(94461),Ye=n(99526)["A"],Je=function(){return Je=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Je.apply(this,arguments)};const Ze={getLocalBlocks:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t={}),new Promise((function(n,l){var o={refresh:e,params:Je({filter:{allTranslations:!0},include:"fields,files"},t)};S.A.index("apiRoutes.qbuilder.blocks",o).then((function(e){var t=e.data.map((function(e){return Je(Je({},e),{entity:Array.isArray(e.entity)?{}:e.entity,attributes:Array.isArray(e.attributes)?{}:e.attributes})}));n(t)})).catch((function(e){return l(e)}))}))},getBlockLibrary:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t={}),new Promise((function(e,n){var l=E.M_.getSetting("ibuilder::blockTemplatesUrl");if(!l)return e([]);var o={params:Je({filter:{allTranslations:!0},include:"fields,files"},t)};He.A.get("".concat(l,"/api").concat(Ye("apiRoutes.qbuilder.blocks")),o).then((function(t){e(t.data.data)})).catch((function(e){return n(e)}))}))},createLayoutBlock:function(e,t){return void 0===t&&(t={}),new Promise((function(n,l){var o=Je({},t);S.A.create("apiRoutes.qbuilder.layoutBlocks",e,o).then((function(e){n(e.data)})).catch((function(e){return l(e)}))}))}};var et=function(){return et=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},et.apply(this,arguments)},tt=function(e,t,n,l){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{c(l.next(e))}catch(t){i(t)}}function a(e){try{c(l["throw"](e))}catch(t){i(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((l=l.apply(e,t||[])).next())}))},nt=function(e,t){var n,l,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,a[0]&&(r=0)),r)try{if(n=1,l&&(o=2&a[0]?l["return"]:a[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,a[1])).done)return o;switch(l=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,l=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],l=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function lt(e,t){var n=this,o={refBlockForm:(0,F.KR)()},i=(0,F.Kh)({localBlocks:[],blockLibrary:[],blockTypeSelected:null,blockSelected:null,blockTypeTab:"global",loading:!1}),r={blockTypes:(0,l.EW)((function(){var e=q.blockConfigs.filter((function(e){return!e.internal}));return e})),blocksBySelectedType:(0,l.EW)((function(){return{local:i.localBlocks.filter((function(e){return e.component.systemName==i.blockTypeSelected})),library:i.blockLibrary.filter((function(e){return e.component.systemName==i.blockTypeSelected}))}})),tabColor:(0,l.EW)((function(){return"global"==i.blockTypeTab?"purple":"orange"})),blockDefault:(0,l.EW)((function(){if(!i.blockTypeSelected)return{};var e=q.blockConfigs.find((function(e){return e.systemName===i.blockTypeSelected}));return e?{component:{nameSpace:e.nameSpace,systemName:i.blockTypeSelected}}:{}}))},a={getData:function(){return tt(n,void 0,void 0,(function(){return nt(this,(function(e){switch(e.label){case 0:return i.loading=!0,[4,Promise.all([a.getLocalBlocks(),a.getBlockLibrary()])];case 1:return e.sent(),i.blockTypeSelected=r.blockTypes.value[0].systemName,i.loading=!1,[2]}}))}))},getLocalBlocks:function(){return tt(n,void 0,void 0,(function(){var e;return nt(this,(function(t){switch(t.label){case 0:return[4,Ze.getLocalBlocks(!0)];case 1:return e=t.sent(),i.localBlocks=e,[2]}}))}))},getBlockLibrary:function(){return tt(n,void 0,void 0,(function(){var e;return nt(this,(function(t){switch(t.label){case 0:return[4,Ze.getBlockLibrary(!0)];case 1:return e=t.sent(),i.blockLibrary=e,[2]}}))}))},selectBlock:function(t){var n,l;i.blockSelected=t,null===(l=null===(n=o.refBlockForm)||void 0===n?void 0:n.value)||void 0===l||l.fillData(t,e)},relateBlock:function(t){i.loading=!0;var n={layoutId:e.layoutId,blockId:t.id,sortOrder:e.index,systemName:(0,E.Ld)(),parentSystemName:e.parentSystemName,gridPosition:"col-12"};Ze.createLayoutBlock(n).then((function(e){i.loading=!1,t.pivot=et({id:e.id},n),a.emitCreated(et({},t))})).catch((function(e){return i.loading=!1}))},emitCreated:function(e){i.blockSelected=null,t("created",e)}};return(0,l.sV)((function(){a.getData()})),et(et(et(et({},o),(0,F.QW)(i)),r),a)}function ot(e,t,n,o,i,r){var a=(0,l.g2)("dynamic-form"),c=(0,l.g2)("master-modal");return(0,l.uX)(),(0,l.Wv)(c,{modelValue:e.showModal,"onUpdate:modelValue":t[1]||(t[1]=function(t){return e.showModal=t}),title:"".concat(e.$tr("ibuilder.cms.label.blockContent")," ").concat(e.idBlock?"- ID: ".concat(e.idBlock):""),"custom-position":"",modalWidthSize:"650px",actions:e.modalActions,loading:e.loading},{default:(0,l.k6)((function(){return[(0,l.bF)(a,{modelValue:e.formBlock,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.formBlock=t}),formType:"grid",blocks:e.formFields,onSubmit:e.submitData,"no-actions":"",ref:"refForm","no-reset-with-blocks-update":""},null,8,["modelValue","blocks","onSubmit"])]})),_:1},8,["modelValue","title","actions","loading"])}var it=function(){return it=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},it.apply(this,arguments)};const rt={createBlock:function(e,t){return void 0===t&&(t={}),new Promise((function(n,l){var o=it({},t);S.A.create("apiRoutes.qbuilder.blocks",e,o).then((function(e){n(e.data)})).catch((function(e){return l(e)}))}))}};var at=function(){return at=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},at.apply(this,arguments)},ct=function(e,t,n,l){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{c(l.next(e))}catch(t){i(t)}}function a(e){try{c(l["throw"](e))}catch(t){i(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((l=l.apply(e,t||[])).next())}))},st=function(e,t){var n,l,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,a[0]&&(r=0)),r)try{if(n=1,l&&(o=2&a[0]?l["return"]:a[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,a[1])).done)return o;switch(l=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,l=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],l=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}},ut=function(e,t,n){if(n||2===arguments.length)for(var l,o=0,i=t.length;o<i;o++)!l&&o in t||(l||(l=Array.prototype.slice.call(t,0,o)),l[o]=t[o]);return e.concat(l||Array.prototype.slice.call(t))};function dt(e,t){var n={refForm:(0,F.KR)()},o=(0,F.Kh)({block:{},idBlock:null,indexBlock:1,layoutId:null,parentSystemName:null,showModal:!1,formBlock:null,configBlock:{},languageOptions:E.M_.getters["qsiteApp/getSelectedLocalesSelect"],loading:!1}),i={formFields:(0,l.EW)((function(){var e,t=[{name:"main",title:E.Ru.tr("ibuilder.cms.label.system"),fields:{internalTitle:{isTranslatable:!0,type:"input",required:!0,colClass:"col-12",props:{label:E.Ru.tr("isite.cms.form.title")+"*",rules:[function(e){return!!e||E.Ru.tr("isite.cms.message.fieldRequired")}]}},status:{value:"1",type:"select",colClass:"col-6",required:!0,props:{label:"".concat(E.Ru.tr("isite.cms.form.status")," *"),options:[{label:E.Ru.tr("isite.cms.label.enabled"),value:"1"},{label:E.Ru.tr("isite.cms.label.disabled"),value:"0"}]}},systemName:{type:"select",required:!0,fakeFieldName:"component",colClass:"col-6",props:{label:E.Ru.tr("isite.cms.label.block")+"*",options:Object.values(q.blockConfigs).filter((function(e){return!e.internal})).map((function(e){return{label:e.title,value:e.systemName}})),readonly:!0}},mediasSingle:{value:{},type:"media",colClass:"col-12",fieldItemId:o.idBlock||null,props:{label:E.Ru.tr("isite.cms.message.preview"),zone:"internalimage",entity:"Modules\\Ibuilder\\Entities\\Block",entityId:null}}}}],n=o.configBlock||{};return(null===(e=n.content)||void 0===e?void 0:e.length)&&t.push(r.getEntityForm()),t})),getBlockRequestData:(0,l.EW)((function(){var e,t,n,l=o.idBlock?at(at({},o.block),o.formBlock):o.formBlock,i=(0,E.o8)(at(at({},l),o.idBlock?{}:{systemName:(0,E.Ld)(),attributes:at({},null!==(t=null===(e=o.block)||void 0===e?void 0:e.attributes)&&void 0!==t?t:{})}));return o.layoutId&&(i.layouts={},i.layouts[o.layoutId]={systemName:(0,E.Ld)(),gridPosition:"col-md-12",sortOrder:o.indexBlock,parentSystemName:null!==(n=o.parentSystemName)&&void 0!==n?n:null}),i.entity||(i.entity={}),o.languageOptions.forEach((function(e){var t,n,l,r=e.value,a=null!==(t=o.formBlock)&&void 0!==t?t:{};i[r]=at(at({},o.block[r]),null!==(n=a[r])&&void 0!==n?n:{}),i=at(at({},i),null!==(l=a[r])&&void 0!==l?l:{})})),delete i.helpText,i})),modalActions:(0,l.EW)((function(){var e=o.idBlock?E.Ru.tr("isite.cms.label.update"):E.Ru.tr("isite.cms.label.save");return[{props:{label:e,color:"green"},action:function(){var e;return null===(e=n.refForm.value)||void 0===e?void 0:e.changeStep("next",!0)}}]}))},r={fillData:function(e,t){var n,l=t.index,i=t.layoutId,a=t.parentSystemName;o.block=(0,E.o8)(e),o.indexBlock=(0,E.o8)(l),o.layoutId=(0,E.o8)(i),o.parentSystemName=(0,E.o8)(a),o.formBlock=(0,E.o8)(e),o.configBlock=r.getBlockConfig(null===(n=e.component)||void 0===n?void 0:n.systemName),o.showModal=!0},updateData:function(e){var t;o.block=(0,E.o8)(e),o.idBlock=(0,E.o8)(e.id),o.formBlock=(0,E.o8)(e),o.configBlock=r.getBlockConfig(null===(t=e.component)||void 0===t?void 0:t.systemName),o.showModal=!0},loadOptionsContent:function(){var e,t=null;return(null===(e=o.configBlock)||void 0===e?void 0:e.content)&&(t=o.configBlock.content.find((function(e){var t,n;if(e.value==(null===(n=null===(t=o.formBlock)||void 0===t?void 0:t.entity)||void 0===n?void 0:n.type))return e}))),(null===t||void 0===t?void 0:t.loadOptions)||null},getBlockConfig:function(e){var t,n;return null!==(n=null===(t=q.blockConfigs)||void 0===t?void 0:t.find((function(t){return(null===t||void 0===t?void 0:t.systemName)===e})))&&void 0!==n?n:{}},getEntityForm:function(){var e,t,n=null===(e=o.formBlock)||void 0===e?void 0:e.entity,l=r.loadOptionsContent();return{title:E.Ru.tr("isite.cms.label.entity"),fields:{helpText:{type:"banner",colClass:"col-12",props:{message:"Configura aquí el contenido del componente..."}},useViewParams:{type:"select",require:!0,colClass:"col-12",fakeFieldName:"entity",vIf:!!o.configBlock.useViewParams,props:{label:"".concat(E.Ru.tr("ibuilder.cms.useViewParams"),"*"),rules:[function(e){return!!e||E.Ru.tr("isite.cms.message.fieldRequired")}],options:[{label:E.Ru.tr("isite.cms.label.yes"),value:"1"},{label:E.Ru.tr("isite.cms.label.no"),value:"0"}]}},type:{type:"select",require:!0,colClass:"col-12",fakeFieldName:"entity",props:{label:"".concat(E.Ru.tr("isite.cms.label.entity"),"*"),rules:[function(e){return!!e||E.Ru.tr("isite.cms.message.fieldRequired")}],options:(null===(t=o.configBlock)||void 0===t?void 0:t.content)||[]}},id:{type:"select",require:!0,fakeFieldName:"entity",colClass:"col-12",vIf:!!l,props:{label:"".concat(E.Ru.tr("isite.cms.label.record"),"*"),rules:[function(e){return!!e||E.Ru.tr("isite.cms.message.fieldRequired")}]},loadOptions:l},params:{type:"json",require:!0,colClass:"col-12",fakeFieldName:"entity",vIf:!(!(null===n||void 0===n?void 0:n.type)||l),props:{label:E.Ru.tr("isite.cms.label.filter"),rules:[function(e){return!!e||E.Ru.tr("isite.cms.message.fieldRequired")}]}}}}},submitData:function(){var e,n;return ct(this,void 0,void 0,(function(){var l,a,c;return st(this,(function(s){switch(s.label){case 0:return l=i.getBlockRequestData.value,a=ut(ut(ut([],null!==(e=Object.keys(l.attributes))&&void 0!==e?e:[],!0),null!==(n=q.ignoreConfigKeys)&&void 0!==n?n:[],!0),["component","entity","attributes"],!1),c={notToSnakeCase:a},o.idBlock?(o.showModal=!1,o.idBlock=null,t("updated",l),[3,3]):[3,1];case 1:return[4,r.createBlock(l,c)];case 2:s.sent(),s.label=3;case 3:return[2]}}))}))},createBlock:function(e,n){return ct(this,void 0,void 0,(function(){return st(this,(function(l){return o.loading=!0,rt.createBlock(e,n).then((function(n){var l,i;if(o.loading=!1,o.showModal=!1,e.id=n.id,o.layoutId){var r=null===(i=null===(l=n.layouts[0])||void 0===l?void 0:l.blocks)||void 0===i?void 0:i.find((function(e){return e.id==n.id}));r&&(e.pivot=r.pivot),delete e.layouts}t("created",e)})).catch((function(e){o.loading=!1})),[2]}))}))}};return(0,l.sV)((function(){})),at(at(at(at({},n),(0,F.QW)(o)),i),r)}const ft=(0,l.pM)({props:{},components:{},emits:["updated","created"],setup:function(e,t){var n=t.emit;return dt(e,n)}}),pt=(0,z.A)(ft,[["render",ot]]),bt=pt,mt=(0,l.pM)({props:{index:{type:Number,default:0},layoutId:{type:Number,default:0},parentSystemName:{default:null}},components:{blockForm:bt},emits:["created"],setup:function(e,t){var n=t.emit;return lt(e,n)}});var vt=n(64873),yt=n(26721),kt=n(64082),gt=n(63815),ht=n(44029),wt=n(62769);const Bt=(0,z.A)(mt,[["render",Ge]]),Ct=Bt;Fe()(mt,"components",{QTabs:vt.A,QTab:yt.A,QIcon:we.A,QSeparator:Te.A,QTabPanels:kt.A,QTabPanel:gt.A,QItem:ge.A,QItemSection:he.A,QBtn:qe.A,QMenu:Ie.A,QList:_e.A}),Fe()(mt,"directives",{Ripple:ht.A,ClosePopup:wt.A});const At={class:"row"},Ft={id:"panel-editor-component",class:"full-width"},St={class:"row wrap justify-between full-width q-px-sm"},xt={class:"ellipsis"},Lt={class:"row q-gutter-xs"},qt={key:0,class:"full-width q-px-xs"},Tt={key:0,class:"full-width text-center"},It={class:"ellipsis text-center"};function _t(e,t,n,i,r,a){const c=(0,l.g2)("q-tooltip"),s=(0,l.g2)("q-btn"),u=(0,l.g2)("dynamic-field"),d=(0,l.g2)("q-popup-edit"),f=(0,l.g2)("handle-grid"),p=(0,l.g2)("draggable"),b=(0,l.g2)("q-separator"),m=(0,l.g2)("q-icon");return(0,l.uX)(),(0,l.CE)("div",At,[(0,l.Lk)("section",Ft,[(0,l.bF)(p,{list:e.elements,class:"row q-col-gutter-lg q-pb-md",group:{name:"items"},"item-key":`handleGrid${e.uId}`},{item:(0,l.k6)((({element:t})=>[(0,l.Lk)("div",{class:(0,o.C4)(t[e.gridPosField])},[(0,l.Lk)("div",{class:(0,o.C4)("panel-editor-component__component  "+(e.verifyKeys(t,e.childsFieldName)?"hasChild":""))},[(0,l.Lk)("div",St,[(0,l.Lk)("p",xt,(0,o.v_)(t[e.titleField]),1),(0,l.Lk)("div",Lt,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.actions,((n,i)=>((0,l.uX)(),(0,l.Wv)(s,(0,l.v6)({key:i},e.getActionsButtonProps(n),{onClick:e=>n.action(t)}),{default:(0,l.k6)((()=>[(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(n.label),1)])),_:2},1024)])),_:2},1040,["onClick"])))),128)),e.verifyKeys(t,e.gridPosField)?((0,l.uX)(),(0,l.Wv)(s,(0,o._B)((0,l.v6)({key:0},e.getActionsButtonProps())),{default:(0,l.k6)((()=>[(0,l.bF)(d,{modelValue:t[e.gridPosField],"onUpdate:modelValue":n=>t[e.gridPosField]=n,title:t[e.titleField],buttons:"","label-set":e.$tr("isite.cms.label.save"),"label-cancel":e.$tr("isite.cms.label.cancel")},{default:(0,l.k6)((t=>[(0,l.bF)(u,{modelValue:t.value,"onUpdate:modelValue":e=>t.value=e,field:{type:"input",props:{autofocus:!0,label:e.$tr("isite.cms.label.gridPosition")}}},null,8,["modelValue","onUpdate:modelValue","field"])])),_:2},1032,["modelValue","onUpdate:modelValue","title","label-set","label-cancel"]),(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.$tr("isite.cms.label.gridPosition")),1)])),_:1})])),_:2},1040)):(0,l.Q3)("",!0)])]),e.verifyKeys(t,e.childsFieldName)?((0,l.uX)(),(0,l.CE)("div",qt,[(0,l.bF)(f,(0,l.v6)(e.$props,{elements:t[e.childsFieldName],parent:t,onCreate:e.emitCreateElement}),null,16,["elements","parent","onCreate"])])):(0,l.Q3)("",!0)],2)],2)])),_:1},8,["list","item-key"]),e.canAddNewItem?((0,l.uX)(),(0,l.CE)("div",Tt,[(0,l.bF)(b,{class:"q-my-md"}),(0,l.bF)(s,{unelevated:"","no-caps":"",rounded:"",color:"cyan",onClick:t[0]||(t[0]=t=>e.emitCreateElement()),outline:"",class:"full-width"},{default:(0,l.k6)((()=>[(0,l.bF)(m,{left:"",name:"fa-regular fa-grid-2-plus",size:"xs"}),(0,l.Lk)("p",It,(0,o.v_)(e.$tr("isite.cms.label.add")),1),(0,l.bF)(c,null,{default:(0,l.k6)((()=>[(0,l.eW)((0,o.v_)(e.$tr("isite.cms.label.add")),1)])),_:1})])),_:1})])):(0,l.Q3)("",!0)])])}var Pt=function(){return Pt=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Pt.apply(this,arguments)};function Et(e,t){var n={},o=(0,F.Kh)({uId:(0,E.Ld)()}),i={},r={getActionsButtonProps:function(e){return void 0===e&&(e={}),Pt(Pt({icon:"fa-regular fa-objects-column",outline:!0,round:!0,color:"cyan",size:"10px"},e),{label:""})},emitCreateElement:function(n){void 0===n&&(n=null),t("create",n||e.parent)},verifyKeys:function(e,t){var n=Object.keys(e);return n.includes(t)}};return(0,l.sV)((function(){})),Pt(Pt(Pt(Pt({},n),(0,F.QW)(o)),i),r)}var Qt=n(10057),Nt=n.n(Qt);const Rt=(0,l.pM)({name:"handleGrid",props:{elements:{type:Array,default:[]},titleField:{type:String,default:"title"},gridPosField:{type:String,default:"gridPosition"},canAddNewItem:{type:Boolean,default:!1},actions:{type:Object,default:()=>({})},childsFieldName:{type:String,default:"children"},parent:{default:null}},components:{draggable:Nt()},setup(e,{emit:t}){return{...Et(e,t)}}});var Wt=n(67404);const Ot=(0,z.A)(Rt,[["render",_t]]),Vt=Ot;Fe()(Rt,"components",{QBtn:qe.A,QTooltip:ke.A,QPopupEdit:Wt.A,QSeparator:Te.A,QIcon:we.A});var jt={id:"blockAttributesForm",class:"bg-white"},Xt={class:"drawer-title row justify-between q-py-md q-px-md bg-primary text-white"},Kt={class:"col-11 text-center text-subtitle1 text-weight-bold"},$t={class:"row q-col-gutter-x-md relative-position"},Ut={class:"row"},Mt={id:"componentsNameContent",class:"q-pt-xl",style:"width: 30%"},Dt={class:"full-width row justify-between items-center"},zt={style:"width: 70%"},Gt={id:"formPanelsContent",class:"q-pa-sm relative-position"},Ht={id:"actionsContent",class:"absolute-bottom-right q-mb-sm q-mr-lg"};function Yt(e,t,n,i,r,a){var c=(0,l.g2)("q-btn"),s=(0,l.g2)("q-icon"),u=(0,l.g2)("q-tab"),d=(0,l.g2)("q-tabs"),f=(0,l.g2)("q-separator"),p=(0,l.g2)("not-result"),b=(0,l.g2)("dynamic-form"),m=(0,l.g2)("q-tab-panel"),v=(0,l.g2)("q-tab-panels"),y=(0,l.g2)("inner-loading"),k=(0,l.g2)("iframe-post"),g=(0,l.g2)("q-item-label"),h=(0,l.g2)("q-item-section"),w=(0,l.g2)("q-item"),B=(0,l.g2)("q-list"),C=(0,l.g2)("q-btn-dropdown"),A=(0,l.gN)("close-popup");return(0,l.uX)(),(0,l.CE)("div",jt,[(0,l.Lk)("div",Xt,[(0,l.Lk)("h2",Kt,(0,o.v_)(e.$tr("ibuilder.cms.blockEdit"))+" - ID: "+(0,o.v_)(e.block.id),1),(0,l.bF)(c,{unelevated:"",color:"white",outline:"",round:"",icon:"fa fa-close",onClick:e.discardChanges},null,8,["onClick"])]),(0,l.Lk)("div",$t,[(0,l.Lk)("div",{id:"panelContent",style:(0,o.Tr)("width: ".concat(e.panelWidth))},[(0,l.Lk)("div",Ut,[(0,l.Lk)("div",Mt,[(0,l.bF)(d,{modelValue:e.selectedComponentKey,"onUpdate:modelValue":[t[0]||(t[0]=function(t){return e.selectedComponentKey=t}),e.handleAllowEditIndicator],vertical:"","active-bg-color":"primary","inline-label":"","active-color":"white","indicator-color":"primary",class:"scroll-content","content-class":"alternating-colors",onClick:t[1]||(t[1]=function(){return e.setVModels()})},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.componentConfigs,(function(t,n){return(0,l.uX)(),(0,l.Wv)(u,{key:n,name:t.componentKey,"content-class":"full-width","no-caps":""},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",Dt,[(0,l.eW)((0,o.v_)(t.title)+" ",1),(0,l.bF)(s,{name:"fa-light fa-arrow-right",class:"q-mr-xs",size:"16px",color:e.selectedComponentKey==t.componentKey?"white":"blue-grey"},null,8,["color"])])]})),_:2},1032,["name"])})),128))]})),_:1},8,["modelValue","onUpdate:modelValue"])]),(0,l.Lk)("div",zt,[(0,l.bF)(d,{modelValue:e.tabName,"onUpdate:modelValue":[t[2]||(t[2]=function(t){return e.tabName=t}),e.handleAllowEditIndicator],"inline-label":"","no-caps":"","indicator-color":"transparent",class:"full-width","active-bg-color":e.tabColor,"active-color":"white","content-class":"text-".concat(e.tabColor," bg-grey-2")},{default:(0,l.k6)((function(){return[(0,l.bF)(u,{name:"attributes",label:e.$tr("ibuilder.cms.label.attributes")},null,8,["label"]),(0,l.bF)(u,{name:"content",label:e.$tr("ibuilder.cms.label.content")},null,8,["label"])]})),_:1},8,["modelValue","active-bg-color","content-class","onUpdate:modelValue"]),(0,l.bF)(f,{color:e.tabColor,size:"2px"},null,8,["color"]),(0,l.Lk)("div",Gt,[(0,l.bF)(v,{modelValue:e.tabName,"onUpdate:modelValue":t[5]||(t[5]=function(t){return e.tabName=t}),animated:"","transition-prev":"scale","transition-next":"scale",class:"scroll-content"},{default:(0,l.k6)((function(){return[(0,l.bF)(m,{name:"attributes",class:"q-pa-none"},{default:(0,l.k6)((function(){return[e.hasFields(e.attributesForm)?((0,l.uX)(),(0,l.Wv)(b,{key:1,modelValue:e.formAttributes,"onUpdate:modelValue":[t[3]||(t[3]=function(t){return e.formAttributes=t}),e.mergeDataForm],blocks:e.attributesForm,formType:"collapsible","no-actions":""},null,8,["modelValue","onUpdate:modelValue","blocks"])):((0,l.uX)(),(0,l.Wv)(p,{key:0,class:"q-mt-xl"}))]})),_:1}),(0,l.bF)(m,{name:"content",class:"q-pa-none"},{default:(0,l.k6)((function(){return[e.hasFields(e.contentForm)?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.Wv)(p,{key:0,class:"q-mt-xl"})),(0,l.bF)(b,{modelValue:e.formContent,"onUpdate:modelValue":[t[4]||(t[4]=function(t){return e.formContent=t}),e.mergeDataForm],blocks:e.contentForm,formType:"grid","no-actions":""},null,8,["modelValue","onUpdate:modelValue","blocks"])]})),_:1})]})),_:1},8,["modelValue"]),(0,l.bF)(y,{visible:!e.allowEdit},null,8,["visible"])])])])],4),(0,l.Lk)("div",{id:"previewContent",style:(0,o.Tr)("width: calc(100% - ".concat(e.panelWidth,")"))},[(0,l.bF)(k,{id:"iframeBlock".concat(e.block.id),ref:"refIframePost"},null,8,["id"])],4),(0,l.Lk)("div",Ht,[(0,l.bF)(C,{split:"",rounded:"",dense:"","no-caps":"",padding:"xs 15px",color:"green",outline:"","text-color":"green",label:e.$tr("isite.cms.label.save"),onClick:t[7]||(t[7]=function(t){return e.updateBlock({})})},{default:(0,l.k6)((function(){return[(0,l.bF)(B,null,{default:(0,l.k6)((function(){return[(0,l.bo)(((0,l.uX)(),(0,l.Wv)(w,{clickable:"",onClick:t[6]||(t[6]=function(t){return e.updateBlock({closeModal:!0})}),class:"q-px-sm"},{default:(0,l.k6)((function(){return[(0,l.bF)(h,null,{default:(0,l.k6)((function(){return[(0,l.bF)(g,null,{default:(0,l.k6)((function(){return[(0,l.eW)((0,o.v_)(e.$tr("isite.cms.message.saveAndReturn")),1)]})),_:1})]})),_:1})]})),_:1})),[[A]])]})),_:1})]})),_:1},8,["label"])])]),(0,l.bF)(y,{visible:e.loading},null,8,["visible"])])}var Jt=n(34307),Zt=function(){return Zt=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Zt.apply(this,arguments)},en=function(e,t,n){if(n||2===arguments.length)for(var l,o=0,i=t.length;o<i;o++)!l&&o in t||(l||(l=Array.prototype.slice.call(t,0,o)),l[o]=t[o]);return e.concat(l||Array.prototype.slice.call(t))};function tn(e,t){var n={refIframePost:(0,F.KR)()},o=(0,F.Kh)({allowEdit:!1,block:{},selectedComponentKey:"componentAttributes",tabName:"attributes",formAttributes:{},formContent:{},panelWidth:"650px",loading:!1,componentConfigs:null}),i={tabColor:(0,l.EW)((function(){return"attributes"==o.tabName?"purple":"orange"})),attributesForm:(0,l.EW)((function(){var e=r.selectedTabConfig();return e?Object.values(e.attributes):[]})),contentForm:(0,l.EW)((function(){var e=r.selectedTabConfig();return e?[{name:"maincontent",title:E.Ru.tr("ibuilder.cms.label.content"),fields:e.contentFields||{}}]:[]}))},r={init:function(){r.handleAllowEditIndicator()},edit:function(e){var t,n=Zt(Zt({},e),{attributes:Array.isArray(e.attributes)?{}:e.attributes});o.block=(0,E.o8)(n),r.getComponentsConfig(null===(t=e.component)||void 0===t?void 0:t.systemName),r.setVModels(),r.previewBlock()},setVModels:function(){o.formAttributes=o.block.attributes[o.selectedComponentKey],o.formContent=o.block},getComponentsConfig:function(e){var t=q.blockConfigs.find((function(t){return t.systemName==e}));if(!t)return[];var n=Object.values(t.childBlocks||{}),l=en([t],q.blockConfigs.filter((function(e){return n.includes(e.systemName)})),!0);o.componentConfigs=l.map((function(e){e.componentKey="componentAttributes";for(var n=0,l=Object.entries(t.childBlocks);n<l.length;n++){var o=l[n],i=o[0],a=o[1];a==e.systemName&&(e.componentKey=i)}return(null===e||void 0===e?void 0:e.contentFields)&&(e.contentFields=r.setFakeFieldNameInContent(e.contentFields,e.componentKey)),e}))},updateBlock:function(e){var n=e.closeModal,l=void 0!==n&&n;o.block&&(o.loading=!0,P.updateBlock(o.block.id,o.block).then((function(e){E.xE.info({message:E.Ru.tr("isite.cms.message.recordUpdated")}),t("updateBlock",{block:(0,E.o8)(o.block),persistModalAttributes:!l}),o.loading=!1})).catch((function(){E.xE.error({message:E.Ru.tr("isite.cms.message.recordNoUpdated")}),o.loading=!1})))},handleAllowEditIndicator:function(){o.allowEdit=!1,r.enableAllowEditIndicator()},enableAllowEditIndicator:(0,Jt.A)((function(){return o.allowEdit=!0}),1e3),mergeDataForm:function(){if(o.allowEdit){var e=r.selectedTabConfig(),t=null===e||void 0===e?void 0:e.componentKey;if(!t)return;"attributes"==o.tabName?o.block.attributes[t]=(0,E.o8)(Zt(Zt({},o.block.attributes[t]),o.formAttributes)):o.block=(0,E.o8)(E.dw.deepMergeObjects(o.block,o.formContent)),r.previewBlock()}},previewBlock:(0,Jt.A)((function(){var e,t;(null===(t=null===(e=n.refIframePost)||void 0===e?void 0:e.value)||void 0===t?void 0:t.loadIframe)&&o.block.id&&n.refIframePost.value.loadIframe("".concat(E.M_.state.qsiteApp.baseUrl,"/api/ibuilder/v1/block/preview"),o.block)}),2e3),discardChanges:function(){E.xE.warning({mode:"modal",title:E.Ru.tr("ibuilder.cms.label.sureDiscardBlock"),message:E.Ru.tr("ibuilder.cms.label.descriptionSureDiscardBlock"),actions:[{label:E.Ru.tr("isite.cms.label.cancel"),color:"grey-8"},{label:E.Ru.tr("isite.cms.label.accept"),color:"green",handler:function(){return t("cancel")}}]})},hasFields:function(e){var t,n;if(!e.length)return!1;var l=Object.keys(null!==(n=null===(t=e[0])||void 0===t?void 0:t.fields)&&void 0!==n?n:{});return l.length>0},selectedTabConfig:function(){return!!o.componentConfigs&&o.componentConfigs.find((function(e){return e.componentKey==o.selectedComponentKey}))},setFakeFieldNameInContent:function(e,t){for(var n=0,l=Object.entries(e);n<l.length;n++){var i=l[n],r=i[0],a=i[1];e[r]=Zt(Zt({},a),"media"!==(null===a||void 0===a?void 0:a.type)?{fakeFieldName:t}:{fieldItemId:o.block.id})}return e}};return(0,l.sV)((function(){r.init()})),Zt(Zt(Zt(Zt({},n),(0,F.QW)(o)),i),r)}const nn=(0,l.pM)({props:{},components:{iframePost:H},emits:["updateBlock","cancel"],setup:function(e,t){var n=t.emit;return tn(e,n)}});var ln=n(74434);const on=(0,z.A)(nn,[["render",Yt]]),rn=on;Fe()(nn,"components",{QBtn:qe.A,QTabs:vt.A,QTab:yt.A,QIcon:we.A,QSeparator:Te.A,QTabPanels:kt.A,QTabPanel:gt.A,QBtnDropdown:ln.A,QList:_e.A,QItem:ge.A,QItemSection:he.A,QItemLabel:Be.A}),Fe()(nn,"directives",{ClosePopup:wt.A});var an={id:"builderLayoutLibraryPanel",class:"bg-white relative-position"},cn={class:"drawer-title q-py-md q-px-md"},sn={class:"text-center text-subtitle1 text-weight-bold"},un={key:0,class:"row"},dn={class:"col-5"},fn=(0,l.Lk)("div",{class:"title-tabs"},null,-1),pn={class:"selection-item ellipsis row justify-between"},bn={class:"col-7"},mn={class:"flex q-my-sm q-px-lg"},vn={class:"text-center text-weight-bold"},yn=["src","alt"],kn={class:"ellipsis-2-lines full-width title-item q-py-xs"};function gn(e,t,n,i,r,a){var c=(0,l.g2)("q-icon"),s=(0,l.g2)("q-tab"),u=(0,l.g2)("q-tabs"),d=(0,l.g2)("q-btn"),f=(0,l.g2)("not-result"),p=(0,l.g2)("q-item-section"),b=(0,l.g2)("q-item"),m=(0,l.g2)("inner-loading"),v=(0,l.gN)("ripple");return(0,l.uX)(),(0,l.CE)("div",an,[(0,l.Lk)("div",cn,[(0,l.Lk)("h2",sn,(0,o.v_)(e.$tr("ibuilder.cms.layouts")),1)]),e.loading?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("div",un,[(0,l.Lk)("div",dn,[fn,(0,l.bF)(u,{modelValue:e.layoutTypeSelected,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.layoutTypeSelected=t}),vertical:"","active-bg-color":"indigo-8","inline-label":"","active-class":"selected-item","active-color":"white","indicator-color":"indigo-6",class:"scroll-content border-tab","content-class":"alternating-colors"},{default:(0,l.k6)((function(){return[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.layoutTypes,(function(e,t){return(0,l.uX)(),(0,l.Wv)(s,{key:t,name:e.entityType,"content-class":"custom-position","no-caps":""},{default:(0,l.k6)((function(){return[(0,l.Lk)("div",pn,[(0,l.eW)((0,o.v_)(e.title)+" ",1),(0,l.bF)(c,{name:"fa-light fa-arrow-right",class:"q-mr-xs",size:"16px",color:"blue-grey"})])]})),_:2},1032,["name"])})),128))]})),_:1},8,["modelValue"])]),(0,l.Lk)("div",bn,[(0,l.Lk)("div",mn,[(0,l.bF)(d,{onClick:t[1]||(t[1]=function(t){return e.selectedLayout()}),outline:"",rounded:"",class:"full-width q-mx-sm text-capitalize btn-color","no-caps":"",padding:"sm lg"},{default:(0,l.k6)((function(){return[(0,l.bF)(c,{size:"xs",left:"",name:"fa-solid fa-plus"}),(0,l.Lk)("div",vn,(0,o.v_)(e.$tr("ibuilder.cms.label.newLayout")),1)]})),_:1})]),(0,l.Lk)("div",{class:(0,o.C4)("scroll-content q-pa-none ".concat(e.layoutsBySelectedType.length?"":"overflow-hidden"))},[e.layoutsBySelectedType.length?((0,l.uX)(!0),(0,l.CE)(l.FK,{key:1},(0,l.pI)(e.layoutsBySelectedType,(function(t,n){return(0,l.bo)(((0,l.uX)(),(0,l.Wv)(b,{key:"localKey".concat(n),clickable:"",class:"bg-trans-item",onClick:function(n){return e.selectedLayout(t)}},{default:(0,l.k6)((function(){return[(0,l.bF)(p,{class:"relative-position q-ma-sm image-section selectable"},{default:(0,l.k6)((function(){return[(0,l.Lk)("img",{src:t.mediaFiles.internalimage.url,alt:t.title},null,8,yn),(0,l.Lk)("span",kn,(0,o.v_)(t.title),1)]})),_:2},1024)]})),_:2},1032,["onClick"])),[[v]])})),128)):((0,l.uX)(),(0,l.Wv)(f,{key:0,class:"q-mt-xl"}))],2)])])),(0,l.bF)(m,{visible:e.loading},null,8,["visible"])])}var hn=n(99526)["A"],wn=function(){return wn=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},wn.apply(this,arguments)};const Bn={getLayoutsLibrary:function(e,t){return void 0===e&&(e=!1),void 0===t&&(t={}),new Promise((function(n,l){var o=E.M_.getSetting("ibuilder::blockTemplatesUrl");if(!o)return n([]);var i={refresh:e,params:wn({filter:{allTranslations:!0}},t)};He.A.get("".concat(o,"/api").concat(hn("apiRoutes.qbuilder.layouts")),i).then((function(e){n(e.data.data)})).catch((function(e){return l(e)}))}))}};var Cn=function(){return Cn=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Cn.apply(this,arguments)},An=function(e,t,n,l){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{c(l.next(e))}catch(t){i(t)}}function a(e){try{c(l["throw"](e))}catch(t){i(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((l=l.apply(e,t||[])).next())}))},Fn=function(e,t){var n,l,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,a[0]&&(r=0)),r)try{if(n=1,l&&(o=2&a[0]?l["return"]:a[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,a[1])).done)return o;switch(l=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,l=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],l=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function Sn(e,t){var n=this,o={},i=(0,F.Kh)({layoutLibrary:[],layoutTypeSelected:"",loading:!1}),r={layoutTypes:(0,l.EW)((function(){var e=a.builderConfig(),t=[];return Object.keys(e).forEach((function(n){e[n].forEach((function(e){t.push({title:"".concat(e.entity.label," (").concat(n,")"),entityType:e.entity.value})}))})),t})),layoutsBySelectedType:(0,l.EW)((function(){return i.layoutLibrary.filter((function(e){return e.entityType.includes(i.layoutTypeSelected)}))}))},a={getData:function(){return An(n,void 0,void 0,(function(){var e,t;return Fn(this,(function(n){switch(n.label){case 0:i.loading=!0,n.label=1;case 1:return n.trys.push([1,3,,4]),e=i,[4,Bn.getLayoutsLibrary(!0,{include:"files"})];case 2:return e.layoutLibrary=n.sent(),i.layoutTypeSelected=r.layoutTypes.value[0].entityType,[3,4];case 3:return t=n.sent(),console.error("Failed Load Library: ",t),[3,4];case 4:return i.loading=!1,[2]}}))}))},builderConfig:function(){var e=E.M_.getters["qsiteApp/getConfigApp"]("builder.layout",!0),t={};return Object.keys(e).forEach((function(n){e[n]&&(t[n]=e[n])})),t},selectedLayout:function(e){var n={blocks:[]};e&&(n=(0,E.o8)(e),n.systemName=(0,E.Ld)(),delete n.default,delete n.id),t("creating",n)}};return(0,l.sV)((function(){a.getData()})),Cn(Cn(Cn(Cn({},o),(0,F.QW)(i)),r),a)}const xn=(0,l.pM)({props:{},components:{},emits:["creating"],setup:function(e,t){var n=t.emit;return Sn(e,n)}}),Ln=(0,z.A)(xn,[["render",gn]]),qn=Ln;Fe()(xn,"components",{QTabs:vt.A,QTab:yt.A,QIcon:we.A,QBtn:qe.A,QItem:ge.A,QItemSection:he.A}),Fe()(xn,"directives",{Ripple:ht.A});const Tn={id:"builderBlockList",class:"drawer-body relative-position"},In={class:"flex q-gutter-xs justify-between"},_n={class:"text-center text-weight-bold"};function Pn(e,t,n,i,r,a){const c=(0,l.g2)("q-icon"),s=(0,l.g2)("q-btn"),u=(0,l.g2)("q-separator"),d=(0,l.g2)("recursive-item"),f=(0,l.g2)("inner-loading");return(0,l.uX)(),(0,l.CE)("div",Tn,[(0,l.Lk)("div",In,[(0,l.bF)(s,{onClick:t[0]||(t[0]=t=>e.$emit("create")),outline:"",rounded:"",class:"q-mb-sm text-capitalize heigth-button",color:"primary","no-caps":""},{default:(0,l.k6)((()=>[(0,l.bF)(c,{size:"xs",left:"",name:"fa-solid fa-plus"}),(0,l.Lk)("div",_n,(0,o.v_)(e.$tr("ibuilder.cms.newBlock")),1)])),_:1}),(0,l.bF)(s,{onClick:e.refreshBlocks,outline:"",rounded:"",class:"q-mb-sm",size:"sm",color:"primary","no-caps":"",icon:"fa-light fa-rotate-right"},null,8,["onClick"])]),(0,l.bF)(u,{spaced:""}),(0,l.bF)(d,{id:"recursiveItemContent",translatable:!1,menu:e.mapBlocks,"right-icon":""},null,8,["menu"]),(0,l.bF)(f,{visible:e.loading},null,8,["visible"])])}var En=function(){return En=Object.assign||function(e){for(var t,n=1,l=arguments.length;n<l;n++)for(var o in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},En.apply(this,arguments)},Qn=function(e,t,n,l){function o(e){return e instanceof n?e:new n((function(t){t(e)}))}return new(n||(n=Promise))((function(n,i){function r(e){try{c(l.next(e))}catch(t){i(t)}}function a(e){try{c(l["throw"](e))}catch(t){i(t)}}function c(e){e.done?n(e.value):o(e.value).then(r,a)}c((l=l.apply(e,t||[])).next())}))},Nn=function(e,t){var n,l,o,i,r={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(e){return function(t){return c([e,t])}}function c(a){if(n)throw new TypeError("Generator is already executing.");while(i&&(i=0,a[0]&&(r=0)),r)try{if(n=1,l&&(o=2&a[0]?l["return"]:a[0]?l["throw"]||((o=l["return"])&&o.call(l),0):l.next)&&!(o=o.call(l,a[1])).done)return o;switch(l=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return r.label++,{value:a[1],done:!1};case 5:r.label++,l=a[1],a=[0];continue;case 7:a=r.ops.pop(),r.trys.pop();continue;default:if(o=r.trys,!(o=o.length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){r=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){r.label=a[1];break}if(6===a[0]&&r.label<o[1]){r.label=o[1],o=a;break}if(o&&r.label<o[2]){r.label=o[2],r.ops.push(a);break}o[2]&&r.ops.pop(),r.trys.pop();continue}a=t.call(e,r)}catch(c){a=[6,c],l=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}};function Rn(e,t){var n={},o=(0,F.Kh)({blocks:[],mapBlocks:[],loading:!1}),i={},r={blockTypes:function(){var e=q.blockConfigs.filter((function(e){return!e.internal}));return e},getBlocks:function(){return o.loading=!0,new Promise((function(e){Ze.getLocalBlocks(!0).then((function(t){o.blocks=t,o.mapBlocks=r.orderedItems(),o.loading=!1,e(!1)})).catch((function(){o.loading=!1,e(!1)}))}))},refreshBlocks:function(e){return void 0===e&&(e=""),Qn(this,void 0,void 0,(function(){var n,l;return Nn(this,(function(i){switch(i.label){case 0:return t("refresh",!0),[4,r.getBlocks()];case 1:return i.sent(),n=null,"blockCreated"==e?(l=o.blocks.reduce((function(e,t){return e.id>t.id?e:t})),n=l):q.viewBlockSelected&&q.viewBlockSelected.id&&(n=o.blocks.find((function(e){var t;return e.id===(null===(t=q.viewBlockSelected)||void 0===t?void 0:t.id)}))||null),n&&(q.viewBlockSelected=(0,E.o8)(n),oe.itemSelected=n,t("selected",(0,E.o8)(n))),t("refresh",!1),[2]}}))}))},orderedItems:function(){var e=r.blockTypes(),t=[];return e.forEach((function(e){var n=o.blocks.filter((function(t){return t.component.systemName==e.systemName})),l=n.map((function(e){return En(En({},e),{label:"".concat(e.id," | ").concat(e.internalTitle),activated:!0,icon:"fa-light fa-arrow-right",action:r.selectBlock})}));t.push({label:"".concat(e.title),headerClass:"expansion-header",customClass:"expansion-border",children:l.sort((function(e,t){return t.id-e.id}))})})),t},selectBlock:function(e){var n=o.blocks.find((function(t){return t.id===e.id}));return n?(q.viewBlockSelected=(0,E.o8)(n),t("selected",(0,E.o8)(n)),Promise.resolve(!0)):Promise.resolve(!0)}};return(0,l.sV)((function(){r.getBlocks()})),En(En(En(En({},n),(0,F.QW)(o)),i),r)}const Wn=(0,l.pM)({props:{},components:{recursiveItem:xe},emits:["refresh","selected","create"],setup(e,{emit:t}){return Rn(e,t)}}),On=(0,z.A)(Wn,[["render",Pn]]),Vn=On;Fe()(Wn,"components",{QBtn:qe.A,QIcon:we.A,QSeparator:Te.A,QExpansionItem:Ce.A,QItem:ge.A,QMenu:Ie.A,QList:_e.A});const jn=(0,l.pM)({computed:{store(){return q}},props:{},components:{blockForm:bt,iframePost:H,layoutList:Ee,blockList:Vn,blocksPanel:Ct,handleGrid:Vt,blockAttributesForm:rn,layoutLibraryPanel:qn},setup(){return{...O()}}});var Xn=n(833),Kn=n(57201),$n=n(51225);const Un=(0,z.A)(jn,[["render",A]]),Mn=Un;Fe()(jn,"components",{QSelect:Xn.A,QIcon:we.A,QDialog:Kn.A,QBtnDropdown:ln.A,QList:_e.A,QItem:ge.A,QItemSection:he.A,QItemLabel:Be.A,QTabs:vt.A,QTab:yt.A,QBtn:qe.A,QTooltip:ke.A,QSeparator:Te.A,QTabPanels:kt.A,QTabPanel:gt.A,QField:$n.A}),Fe()(jn,"directives",{ClosePopup:wt.A})}}]);