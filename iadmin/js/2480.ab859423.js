"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[2480],{70144:(e,t,a)=>{a.r(t),a.d(t,{default:()=>_});var s=a(92444);function o(e,t,o,l,i,d){const r=(0,s.E1)("infomation"),n=(0,s.E1)("crud");return(0,s.Wz)(),(0,s.An)("div",null,[(0,s.K2)(r,{ref:"modalInfortion",onKanbanRefresh:d.kanbanRefresh},null,8,["onKanbanRefresh"]),(0,s.K2)(n,{crudData:a.e(5280).then(a.bind(a,60044)),"custom-data":d.customData,title:e.$tr(e.$route.meta.title),ref:"crudRequests"},null,8,["crudData","custom-data","title"])])}var l=a(98724);const i={class:""},d={class:"row q-col-gutter-md"},r={class:"col"},n={key:0},u={class:"col-12 col-md-8 col-lg-7"};function c(e,t,a,o,l,c){const m=(0,s.E1)("dynamic-field"),h=(0,s.E1)("dynamic-form"),f=(0,s.E1)("comments"),p=(0,s.E1)("superModal"),b=(0,s.E1)("modalCrud"),y=(0,s.E1)("whatappsModal");return(0,s.Wz)(),(0,s.An)("div",null,[(0,s.K2)(p,{modelValue:l.modal.show,"onUpdate:modelValue":t[1]||(t[1]=e=>l.modal.show=e),onHide:t[2]||(t[2]=e=>c.resetModal()),loading:l.modal.loading,title:l.modal.title,"custom-position":"",modalWidthSize:"98%",multiActions:c.multiActions,actions:c.actions},{default:(0,s.Ql)((()=>[(0,s.QD)("div",i,[(0,s.QD)("div",d,[(0,s.QD)("div",r,[((0,s.Wz)(!0),(0,s.An)(s.ae,null,(0,s.mi)(c.field.main,((e,t)=>((0,s.Wz)(),(0,s.Az)(m,{key:t,modelValue:l.dynamicFieldForm[t],"onUpdate:modelValue":e=>l.dynamicFieldForm[t]=e,field:e,class:"tw-py-2"},null,8,["modelValue","onUpdate:modelValue","field"])))),128)),this.modal.requestData.length>0?((0,s.Wz)(),(0,s.An)("div",n,[(0,s.K2)(h,{modelValue:l.form,"onUpdate:modelValue":t[0]||(t[0]=e=>l.form=e),"form-id":l.formId,onSubmit:c.saveForm,class:"tw-my-2",noSave:"",requestParams:l.requestParams},null,8,["modelValue","form-id","onSubmit","requestParams"])])):(0,s.g1)("",!0),((0,s.Wz)(!0),(0,s.An)(s.ae,null,(0,s.mi)(c.field.bottom,((e,t)=>((0,s.Wz)(),(0,s.Az)(m,{key:t,modelValue:l.dynamicFieldForm[t],"onUpdate:modelValue":e=>l.dynamicFieldForm[t]=e,field:e,itemId:l.requestableId,class:"tw-py-2"},null,8,["modelValue","onUpdate:modelValue","field","itemId"])))),128))]),(0,s.QD)("div",u,[(0,s.K2)(f,{commentableId:Number(l.requestableId)},null,8,["commentableId"])])])])])),_:1},8,["modelValue","loading","title","multiActions","actions"]),(0,s.K2)(b),(0,s.K2)(y)])}a(23816);var m=a(63528),h=a(22772),f=a(75836),p=(0,f.cB)({showModal:!1,dataCrud:{path:null,customData:null}}),b=(0,s.S6)((function(){return{get showModal(){return p.showModal},set showModal(e){p.showModal=e},get dataCrud(){return p.dataCrud},set dataCrud(e){p.dataCrud=e},reset:function(){p.showModal=!1,p.dataCrud={path:null,customData:null}}}})).value;const y=b;function q(e,t,a,o,l,i){var d=(0,s.E1)("crud"),r=(0,s.E1)("master-modal");return(0,s.Wz)(),(0,s.Az)(r,{id:"modalCrud",modelValue:e.showModal,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.showModal=t}),persistent:!0,maximized:e.$q.screen.lt.md,"custom-position":"",modalWidthSize:"98%"},{default:(0,s.Ql)((function(){return[e.showModal&&e.dataCrud.path?((0,s.Wz)(),(0,s.Az)(d,{key:0,crudData:e.dataCrud.path,"custom-data":e.dataCrud.customData,title:e.dataCrud.title},null,8,["crudData","custom-data","title"])):(0,s.g1)("",!0)]})),_:1},8,["modelValue","maximized"])}const g=(0,s._M)({setup:function(e){var t=(0,s.S6)({get:function(){return y.showModal},set:function(e){y.showModal=e}}),a=(0,s.S6)((function(){return y.dataCrud}));return{dataCrud:a,showModal:t}}});var w=a(68716);const v=(0,w.c)(g,[["render",q]]),I=v,$={ref:"otherFilesComponent",key:"otherFiles",icon:"fas fa-photo-video",title:"Archivos",allowCounter:!0,allowOrder:!0,gridColClass:"col-3 col-md-3 col-lg-4",itemActions:[{label:"Descargar",vIf:!0,icon:"fas fa-file-download",props:{tag:"a",key:"39740800-35d0-4b28-9610-7f84d96a0145",clickable:!0}},{label:"Editar",icon:"fas fa-pen",props:{tag:"a",key:"1df14234-2772-4824-be48-b8f3d9c119e3",clickable:!0}},{label:"Copiar enlace",icon:"fas fa-copy",props:{tag:"a",key:"dc3eceff-04a0-47dd-9004-ed2ae4ed1c6e",clickable:!0}},{label:"Eliminar",icon:"fas fa-trash",props:{tag:"a",key:"977d2dc9-ac6c-45cd-bb4c-9c3a65795bc6",clickable:!0}}],allowPagination:!0,allowChangeView:!0,allowSelect:0,loadFiles:{apiRoute:"apiRoutes.qmedia.files",requestParams:{take:24,filter:{search:null,folderId:0,isFolder:!1,order:{field:"created_at",way:"desc"},disk:"publicmedia"}}}};var M=a(97180),k=(0,f.cB)({showModal:!1,roomId:0,loading:!1}),C=(0,s.S6)((function(){return{get showModal(){return k.showModal},set showModal(e){k.showModal=e},get loading(){return k.loading},set loading(e){k.loading=e},get roomId(){return k.roomId},set roomId(e){k.roomId=e}}})).value;const F=C;function R(e,t,a,o,l,i){var d=(0,s.E1)("advanceChat"),r=(0,s.E1)("master-modal");return(0,s.Wz)(),(0,s.Az)(r,{modelValue:e.showModal,"onUpdate:modelValue":t[0]||(t[0]=function(t){return e.showModal=t}),persistent:!0,maximized:e.$q.screen.lt.md,"custom-position":"",modalWidthSize:"98%",loading:e.loading},{default:(0,s.Ql)((function(){return[(0,s.K2)(d,{"room-id":e.roomId},null,8,["room-id"])]})),_:1},8,["modelValue","maximized","loading"])}var D=a(61480);const z=(0,s._M)({components:{advanceChat:D.c},setup:function(e){var t=(0,s.S6)({get:function(){return F.showModal},set:function(e){F.showModal=e}}),a=(0,s.S6)((function(){return F.loading})),o=(0,s.S6)((function(){return F.roomId}));return{showModal:t,roomId:o,loading:a}}}),A=(0,w.c)(z,[["render",R]]),E=A,V={text:"",textEdit:"",active:!1,user:"",loading:!1,avatar:"https://dev-gestionhc.ozonohosting.com/modules/iprofile/img/default.jpg"},B={components:{fileList:l.c,CKEditor:m.c,superModal:h.c,modalCrud:I,fileListComponent:l.c,comments:M.c,whatappsModal:E},props:{},emits:["kanbanRefresh"],data(){return{loading:!1,route:"apiRoutes.qrequestable.comments",textPlaceholder:"Escriba un comentario...",editorConfig:{height:100},modal:{title:null,show:!1,loading:!1,requestData:[]},dataBase:{...V},form:{},dynamicFieldForm:{},formId:null,statusId:null,categoryType:null,requestableId:null,conversations:null,requestParams:{filter:{renderLocation:"requestable"}}}},provide(){return{showRequestData:this.showRequestData,updateRequest:this.updateRequest}},inject:{addCard:{type:Function,default:()=>!1}},computed:{files(){return $},permisionComments(){return{create:this.$hasAccess("icomments.comments.create"),edit:this.$hasAccess("icomments.comments.edit"),index:this.$hasAccess("icomments.comments.index"),destroy:this.$hasAccess("icomments.comments.destroy")}},field(){return{main:{date:{value:null,props:{label:"Block-in/out Date"},name:"blockInBlockOut",field:{value:"blockInBlockOut"},quickFilter:!0},sourceId:{value:null,type:"crud",permission:"requestable.requestables.see-source",props:{crudType:"select",crudData:a.e(2820).then(a.bind(a,92820)),crudProps:{label:this.$tr("isite.cms.label.source"),rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")],readonly:!this.$hasAccess("requestable.requestables.edit-source")},config:{filterByQuery:!0,options:{label:"title",value:"id"}}}},requestedById:{value:null,type:"crud",permission:"requestable.requestables.see-requested-by",props:{crudType:"select",crudData:a.e(7480).then(a.bind(a,27480)),crudProps:{label:this.$tr("isite.cms.form.requestedBy"),rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")],readonly:!this.$hasAccess("requestable.requestables.edit-requested-by")},config:{filterByQuery:!0,options:{label:"fullName",value:"id",img:"mainImage"}}}},responsibleId:{value:null,type:"crud",permission:"requestable.requestables.see-responsible",props:{crudType:"select",crudData:a.e(7480).then(a.bind(a,27480)),crudProps:{label:this.$tr("requestable.cms.label.responsible"),rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")],readonly:!this.$hasAccess("requestable.requestables.edit-responsible")},config:{filterByQuery:!0,options:{label:"fullName",value:"id",img:"mainImage"}}}}},bottom:{mediasMulti:{value:{},type:"media",vIf:!this.$hasAccess("requestable.requestables.see-files"),props:{label:this.$tr("idocs.cms.sidebar.adminGroup"),zone:"documents",entity:"Modules\\Requestable\\Entities\\Requestable",entityId:null,multiple:!0,disk:"privatemedia",readonly:!this.$hasAccess("requestable.requestables.edit-files")}}}}},multiActions(){return[{props:{color:"green",icon:"fa-brands fa-whatsapp",round:!0},action:async()=>{try{F.loading=!0,F.showModal=!0,this.conversations?F.roomId=this.conversations.id:(await this.$crud.post("apiRoutes.qrequestable.chat",{criteria:this.requestableId},{}),F.roomId=response.data.id),setTimeout((()=>{F.loading=!1}),3e3)}catch(e){F.showModal=!1,F.loading=!1}}}]},actions(){return[{props:{label:this.$tr("isite.cms.label.save"),color:"primary",icon:"fa-light fa-save"},action:async()=>{await this.saveForm()}}]}},methods:{async showRequestData(e){this.requestableId=e.id,this.statusId=e.statusId||null,this.categoryType=e.type||null,this.dynamicFieldForm.requestedById=e.requestedById||null,this.dynamicFieldForm.sourceId=e.sourceId||null,this.dynamicFieldForm.responsibleId=e.responsibleId||null,this.conversations=e.conversation||null;const t=e.status?`- Estado: ${e?.status?.title}`:"";this.modal={title:`ID:${this.requestableId} ${t}`,show:!0,loading:!0,requestData:[],comments:[]};let a=e.category?.form||!1;if(a){this.formId=a.id;let t={};e.fields.forEach((e=>t[e.name]=e.value));let s=this.$clone(e.files||[]),o={refresh:!0,params:{include:"fields"}};await this.$crud.show("apiRoutes.qform.forms",a.id,o).then((async e=>{await this.$clone(e.data.fields).forEach((e=>{let a=e.dynamicField?.type||"input",o=t[this.$helper.convertStringToSnakeCase(e.name)]||"-",l="media"!=a?null:s.find((t=>t.zone==(e.dynamicField.props.zone||"mainimage")));this.modal.requestData.push({...e,label:e.label.replace("*",""),value:"media"!=a?o:[{id:this.$uid(),...l,filename:e.label}],fieldType:a})})),await this.modal.requestData.forEach((e=>{this.form[e.dynamicField.name]=e.value})),this.modal.loading=!1})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.modal.loading=!1}))}))}this.modal.loading=!1},resetModal(){this.modal={show:!1,loading:!1,requestData:[],comments:[]},this.dataBase={...V}},updateRequest(e){this.$refs.crudRequests.update({id:e})},async saveForm(){try{this.modal.loading=!0;const e={...this.form,...this.dynamicFieldForm,type:this.categoryType,statusId:this.statusId};await this.$crud.update("apiRoutes.qrequestable.requestables",this.requestableId,e),await this.$emit("kanbanRefresh",this.statusId),this.modal.show=!1,this.form={},this.modal.loading=!1}catch(e){this.modal.loading=!1,console.log(e)}}}};var S=a(84492),x=a(82764),T=a(95252),W=a.n(T);const K=(0,w.c)(B,[["render",c]]),P=K;W()(B,"components",{QTimeline:S.c,QBtnDropdown:x.c});const Q={components:{fileList:l.c,infomation:P},data(){return{crudId:this.$uid(),modal:{title:null,show:!1,loading:!1,requestData:[],tab:"comments"},form:{},formId:null,requestedBy:null,statusId:null,categoryType:null,requestableId:null}},provide(){return{saveForm:this.saveForm}},computed:{deletePermissions(){return this.$hasAccess("requestable.requestables.destroy")},customData(){return{read:{actions:[{name:"viewEntity",icon:"fa-light fa-eye",label:this.$tr("isite.cms.label.show"),format:e=>e.requestableUrl?{}:{vIf:!1},action:e=>{e.requestableUrl&&this.$helper.openExternalURL(e.requestableUrl)}},{name:"viewLead",icon:"fa-light fa-info-circle",color:"info",tooltip:this.$tr("isite.cms.label.information"),action:e=>{this.showModal(e)}},{name:"deleteLead",label:this.$tr("isite.cms.label.delete"),color:"red",icon:"fa-light fa-trash-alt",format:e=>({vIf:this.deletePermissions}),action:(e,t)=>{this.delete(e,t)}}]}}}},methods:{async showModal(e){await this.$refs.modalInfortion.showRequestData(e)},async delete(e,t=!1){this.$refs.crudRequests.$refs.crudIndex.$refs.kanban&&this.$refs.crudRequests.$refs.crudIndex.$refs.kanban.deleteKanbanCard(e,t)},async kanbanRefresh(e){this.$refs.crudRequests.$refs.crudIndex.$refs.kanban&&this.$refs.crudRequests.$refs.crudIndex.$refs.kanban.addCard(e)}}},U=(0,w.c)(Q,[["render",o]]),_=U}}]);