"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[532],{60532:(e,t,a)=>{a.r(t),a.d(t,{default:()=>U});a(23816);var l=a(92444),s=a(74044);const o={id:"pageId",class:"q-layout-page layout-padding"},i={key:0,class:"relative-position q-mb-lg backend-page"},r={class:"box"},c={class:"col-12"},d={class:"input-title"},m={class:"row"},n={class:"col-12 text-right q-py-sm"},u={key:0,class:"col-12 q-py-xs"},p={class:"row q-col-gutter-sm"},h={class:"col-4"},g={class:"col-4"},f={class:"col-2 col-sm-3"},$={class:"col-2 col-sm-1 text-right"};function b(e,t,b,v,y,q){const V=(0,l.E1)("locales"),Q=(0,l.E1)("q-input"),R=(0,l.E1)("q-editor"),T=(0,l.E1)("q-field"),x=(0,l.E1)("q-tooltip"),I=(0,l.E1)("q-btn"),k=(0,l.E1)("crud"),C=(0,l.E1)("q-select"),D=(0,l.E1)("q-page-sticky"),w=(0,l.E1)("q-form"),E=(0,l.E1)("inner-loading");return(0,l.Wz)(),(0,l.An)("div",o,[y.success?((0,l.Wz)(),(0,l.An)("div",i,[(0,l.QD)("div",r,[(0,l.QD)("div",c,[(0,l.K2)(V,{modelValue:y.locale,"onUpdate:modelValue":t[0]||(t[0]=e=>y.locale=e),ref:"localeComponent",form:e.$refs.formContent},null,8,["modelValue","form"])]),y.locale.success?((0,l.Wz)(),(0,l.Az)(w,{key:0,autocorrect:"off",autocomplete:"off",ref:"formContent",class:"full-width q-my-sm",onSubmit:t[5]||(t[5]=e=>y.itemId?q.updateItem():q.createItem()),onValidationError:t[6]||(t[6]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,l.Ql)((()=>[(0,l.K2)(Q,{outlined:"",dense:"",modelValue:y.locale.formTemplate.name,"onUpdate:modelValue":t[1]||(t[1]=e=>y.locale.formTemplate.name=e),label:`${e.$tr("isite.cms.form.name")} (${y.locale.language})*`,rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","rules"]),(0,l.QD)("div",d,(0,s.WA)(`${e.$tr("isite.cms.form.description")} (${y.locale.language})*`),1),(0,l.K2)(T,{borderless:"",modelValue:y.locale.formTemplate.description,"onUpdate:modelValue":t[3]||(t[3]=e=>y.locale.formTemplate.description=e),rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},{default:(0,l.Ql)((()=>[(0,l.K2)(R,{class:"full-width",modelValue:y.locale.formTemplate.description,"onUpdate:modelValue":t[2]||(t[2]=e=>y.locale.formTemplate.description=e)},null,8,["modelValue"])])),_:1},8,["modelValue","rules"]),(0,l.QD)("div",m,[(0,l.QD)("div",n,[(0,l.K2)(I,{color:"green",loading:y.loading,onClick:t[4]||(t[4]=e=>y.locale.formTemplate.rates.push(q.defaultRate)),icon:"fas fa-plus"},{default:(0,l.Ql)((()=>[(0,l.K2)(x,null,{default:(0,l.Ql)((()=>[(0,l.mY)((0,s.WA)(e.$tr("icommerce.cms.newTaxRate")),1)])),_:1})])),_:1},8,["loading"])]),((0,l.Wz)(!0),(0,l.An)(l.ae,null,(0,l.mi)(y.locale.formTemplate.rates,((t,s)=>((0,l.Wz)(),(0,l.An)(l.ae,{key:s},[y.locale.formTemplate.rates?((0,l.Wz)(),(0,l.An)("div",u,[(0,l.QD)("div",p,[(0,l.QD)("div",h,[(0,l.K2)(k,{"crud-data":a.e(6363).then(a.bind(a,6363)),type:"select","crud-props":{label:`${e.$tr("icommerce.cms.form.taxRate")}*`},modelValue:t.taxRateId,"onUpdate:modelValue":e=>t.taxRateId=e,config:{options:{label:"name",value:"id"}}},null,8,["crud-data","crud-props","modelValue","onUpdate:modelValue"])]),(0,l.QD)("div",g,[(0,l.K2)(C,{outlined:"",dense:"","bg-color":"white",modelValue:t.based,"onUpdate:modelValue":e=>t.based=e,rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")],label:`${e.$tr("icommerce.cms.form.taxBased")}*`,style:{width:"100%"},"emit-value":"","map-options":"",options:y.optionsBased},null,8,["modelValue","onUpdate:modelValue","rules","label","options"])]),(0,l.QD)("div",f,[(0,l.K2)(Q,{type:"number",outlined:"",dense:"",modelValue:t.priority,"onUpdate:modelValue":e=>t.priority=e,label:`${e.$tr("icommerce.cms.form.priority")}`,rules:[t=>!!t||e.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","onUpdate:modelValue","label","rules"])]),(0,l.QD)("div",$,[(0,l.K2)(I,{color:"red",loading:y.loading,onClick:e=>q.deleteRateItem(s),icon:"fas fa-trash"},null,8,["loading","onClick"])])])])):(0,l.g1)("",!0)],64)))),128))]),(0,l.K2)(D,{position:"bottom-right",offset:[18,18]},{default:(0,l.Ql)((()=>[e.$route.params.id?((0,l.Wz)(),(0,l.Az)(I,{key:0,color:"green",loading:y.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.update"),type:"submit"},null,8,["loading","label"])):((0,l.Wz)(),(0,l.Az)(I,{key:1,color:"green",loading:y.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.create"),type:"submit"},null,8,["loading","label"]))])),_:1})])),_:1},512)):(0,l.g1)("",!0)])])):(0,l.g1)("",!0),(0,l.K2)(E,{visible:y.loading},null,8,["visible"])])}var v=a(8932);const y={components:{},watch:{$route(e,t){this.initForm()}},mounted(){this.$nextTick((function(){this.initForm(),v.kN.on("page.data.refresh",(()=>this.initForm()))}))},data(){return{locale:{},loading:!1,success:!1,itemId:!1,optionsRate:[],optionsBased:[{value:"1",label:this.$tr("icommerce.cms.options.taxRateBased.shippingAddress")},{value:"2",label:this.$tr("icommerce.cms.options.taxRateBased.paymentAddress")},{value:"3",label:this.$tr("icommerce.cms.options.taxRateBased.storeAddress")}]}},computed:{dataLocale(){return{fields:{rates:[]},fieldsTranslatable:{description:"",name:""}}},defaultRate(){return{taxRateId:"",based:"2",priority:"0"}}},methods:{async initForm(){this.loading=!0,this.success=!1,this.locale=this.$clone(this.dataLocale),this.itemId=this.$route.params.id,this.locale.success&&this.$refs.localeComponent.vReset(),await this.getData(),this.success=!0,this.loading=!1},async getData(){return new Promise(((e,t)=>{const a=this.$clone(this.itemId);if(a){let l="apiRoutes.qcommerce.taxClasses",s={refresh:!0,params:{include:"rates",filter:{allTranslations:!0}}};this.$crud.show(l,a,s).then((t=>{this.orderDataItemToLocale(t.data),e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest")}),this.loading=!1,t(!1)}))}))}else e(!0)}))},deleteRateItem(e){this.locale.formTemplate.rates.splice(e,1)},orderDataItemToLocale(e){let t=this.$clone(e);this.locale.form=this.$clone(t),setTimeout((()=>{this.locale.form.rates=t.rates}),1e3)},async updateItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qcommerce.taxClasses";this.$crud.update(e,this.itemId,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.$router.push({name:"qcommerce.admin.taxClasses"}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")})}))}},async createItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qcommerce.taxClasses";this.$crud.create(e,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordCreated")}`}),this.$router.push({name:"qcommerce.admin.taxClasses"}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")})}))}},getDataForm(){let e=this.locale.form;for(var t in e){let a=e[t];null!=a&&void 0!=a&&0!==a.length||delete e[t]}return e}}};var q=a(68716),V=a(41628),Q=a(14288),R=a(20540),T=a(69452),x=a(85664),I=a(99140),k=a(90111),C=a(36008),D=a(60352),w=a(95252),E=a.n(w);const A=(0,q.c)(y,[["render",b]]),U=A;E()(y,"components",{QLayout:V.c,QForm:Q.c,QInput:R.c,QField:T.c,QEditor:x.c,QBtn:I.c,QTooltip:k.c,QSelect:C.c,QPageSticky:D.c})}}]);