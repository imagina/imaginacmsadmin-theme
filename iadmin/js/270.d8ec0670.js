"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[270,29,7934],{18513:(e,o,l)=>{l.r(o),l.d(o,{default:()=>A});var t=l(61758),a=l(58790);const s={id:"pageId",class:"q-layout-page layout-padding location-form"},i={class:"relative-position q-mb-lg backend-page"},r={key:0,class:"box"},n={class:"col-12"},c={class:"row q-col-gutter-md"},d={class:"col-12"},m={class:"input-title"},u={class:"q-py-sm"},p={class:"text-right"},h={class:"row q-col-gutter-sm"},f={class:"col-3"},g={class:"col-3"},b={class:"col-4"},v={class:"col-2"};function $(e,o,l,$,y,k){const z=(0,t.g2)("locales"),I=(0,t.g2)("q-input"),q=(0,t.g2)("q-editor"),V=(0,t.g2)("q-field"),F=(0,t.g2)("q-btn"),T=(0,t.g2)("dynamic-field"),C=(0,t.g2)("q-page-sticky"),L=(0,t.g2)("q-form"),w=(0,t.g2)("inner-loading");return(0,t.uX)(),(0,t.CE)("div",s,[(0,t.Lk)("div",i,[y.success?((0,t.uX)(),(0,t.CE)("div",r,[(0,t.Lk)("div",n,[(0,t.bF)(z,{modelValue:y.locale,"onUpdate:modelValue":o[0]||(o[0]=e=>y.locale=e),ref:"localeComponent",form:e.$refs.formContent},null,8,["modelValue","form"])]),y.locale.success?((0,t.uX)(),(0,t.Wv)(L,{key:0,autocorrect:"off",autocomplete:"off",ref:"formContent",class:"full-width q-my-sm",onSubmit:o[4]||(o[4]=e=>y.itemId?k.updateItem():k.createItem()),onValidationError:o[5]||(o[5]=o=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,t.k6)((()=>[(0,t.Lk)("div",c,[(0,t.Lk)("div",d,[(0,t.bF)(I,{outlined:"",dense:"",modelValue:y.locale.formTemplate.name,"onUpdate:modelValue":o[1]||(o[1]=e=>y.locale.formTemplate.name=e),label:`${e.$tr("isite.cms.form.name")}*`,rules:[o=>!!o||e.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","rules"]),(0,t.Lk)("div",m,(0,a.v_)(`${e.$tr("isite.cms.form.description")}*`),1),(0,t.bF)(V,{borderless:"",modelValue:y.locale.formTemplate.description,"onUpdate:modelValue":o[3]||(o[3]=e=>y.locale.formTemplate.description=e),rules:[o=>!!o||e.$tr("isite.cms.message.fieldRequired")]},{default:(0,t.k6)((()=>[(0,t.bF)(q,{class:"full-width",modelValue:y.locale.formTemplate.description,"onUpdate:modelValue":o[2]||(o[2]=e=>y.locale.formTemplate.description=e)},null,8,["modelValue"])])),_:1},8,["modelValue","rules"])])]),(0,t.Lk)("div",u,[(0,t.Lk)("div",p,[(0,t.bF)(F,{color:"positive",icon:"fas fa-plus",onClick:k.addGeozonables},null,8,["onClick"])]),((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(y.locale.form.zonesToGeozone,((o,l)=>((0,t.uX)(),(0,t.CE)("div",null,[(0,t.Lk)("div",h,[(0,t.Lk)("div",f,[(0,t.bF)(T,{modelValue:o.countryId,"onUpdate:modelValue":e=>o.countryId=e,field:{value:"",type:"select",loadOptions:{apiRoute:"apiRoutes.qlocations.countries",select:{label:"name",id:"id"}},props:{clearable:!0,label:`${e.$tr("ilocations.cms.form.country")}*`,rules:[o=>!!o||e.$tr("isite.cms.message.fieldRequired")]}}},null,8,["modelValue","onUpdate:modelValue","field"])]),(0,t.Lk)("div",g,[o.countryId>0?((0,t.uX)(),(0,t.Wv)(T,{key:0,modelValue:o.provinceId,"onUpdate:modelValue":e=>o.provinceId=e,field:{value:"0",type:"select",loadOptions:{apiRoute:"apiRoutes.qlocations.provinces",requestParams:{filter:{country:o.countryId}},select:{label:"name",id:"id"}},props:{clearable:!0,label:`${e.$tr("ilocations.cms.form.province")}*`,options:[{label:e.$trp("isite.cms.label.all"),value:"0"}]}}},null,8,["modelValue","onUpdate:modelValue","field"])):(0,t.Q3)("",!0)]),(0,t.Lk)("div",b,[o.provinceId>0?((0,t.uX)(),(0,t.Wv)(T,{key:0,modelValue:o.cityId,"onUpdate:modelValue":e=>o.cityId=e,field:{value:"0",type:"select",loadOptions:{apiRoute:"apiRoutes.qlocations.cities",requestParams:{filter:{provinceId:o.provinceId}},select:{label:"name",id:"id"}},props:{clearable:!0,label:`${e.$tr("ilocations.cms.form.city")}*`,options:[{label:e.$trp("isite.cms.label.all"),value:"0"}]}}},null,8,["modelValue","onUpdate:modelValue","field"])):(0,t.Q3)("",!0)]),(0,t.Lk)("div",v,[(0,t.bF)(F,{color:"red",icon:"fas fa-trash",onClick:e=>k.deleteGeozonable(l)},null,8,["onClick"])])])])))),256))]),(0,t.bF)(C,{position:"bottom-right",offset:[18,18]},{default:(0,t.k6)((()=>[e.$route.params.id?((0,t.uX)(),(0,t.Wv)(F,{key:0,color:"positive",loading:y.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.update"),type:"submit"},null,8,["loading","label"])):((0,t.uX)(),(0,t.Wv)(F,{key:1,color:"positive",loading:y.loading,icon:"fas fa-edit",label:e.$tr("isite.cms.label.create"),type:"submit"},null,8,["loading","label"]))])),_:1})])),_:1},512)):(0,t.Q3)("",!0)])):(0,t.Q3)("",!0),(0,t.bF)(w,{visible:y.loading},null,8,["visible"])])])}l(10239);var y=l(8e3),k=l(99474),z=l(49696),I=l(71915);const q={components:{cityForm:y["default"],polygonForm:k["default"],neighborhoodForm:z["default"]},watch:{$route(e,o){this.initForm()}},mounted(){this.$nextTick((function(){this.initForm(),I.Bt.on("page.data.refresh",(()=>this.initForm()))}))},data(){return{locale:{},loading:!1,success:!1,itemId:!1,showCityCreate:!1,showPolygonCreate:!1,showNeighborhoodCreate:!1,geozonables:[]}},props:{id:{default:null}},computed:{dataLocale(){return{fields:{name:"",description:"",countries:[],provinces:[],cities:[],polygons:[],neighborhoods:[],zonesToGeozone:[]},fieldsTranslatable:{}}},defaultGeozonable(){return{countryId:"",provinceId:"0",cityId:"0"}}},methods:{async initForm(){this.loading=!0,this.success=!1,this.locale=this.$clone(this.dataLocale),this.itemId=null!==this.id?this.id:this.$route.params.id,this.locale.success&&this.$refs.localeComponent.vReset(),await this.getData(),this.success=!0,this.loading=!1},getData(){return new Promise(((e,o)=>{const l=this.$clone(this.itemId);if(l){let t="apiRoutes.qlocations.geozones",a={refresh:!0,params:{include:"zonesToGeozone,zonesToGeozone.province,zonesToGeozone.country,zonesToGeozone.city",filter:{allTranslations:!0}}};this.$crud.show(t,l,a).then((o=>{this.orderDataItemToLocale(o.data);this.$clone(o.data.zonesToGeozone);e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{console.error(e),this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1,o(!1)}))}))}else e(!0)}))},orderDataItemToLocale(e){let o=this.$clone(e);this.locale.form=this.$clone(o)},async updateItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qlocations.geozones";this.$crud.update(e,this.itemId,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},async createItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qlocations.geozones";this.$crud.create(e,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordCreated")}`}),this.$router.push({name:"qlocations.admin.geozones.index"}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},getDataForm(){let e=this.locale.form;for(var o in e){let l=e[o];null!=l&&void 0!=l||delete e[o]}return e.selectable=JSON.stringify(e.selectable),e},addGeozonables(){this.locale.form.zonesToGeozone.push(this.defaultGeozonable)},deleteGeozonable(e){this.locale.form.zonesToGeozone.splice(e,1)}}};var V=l(12807),F=l(83333),T=l(21565),C=l(78020),L=l(51225),w=l(94192),G=l(69001),R=l(70918),U=l(98582),Q=l.n(U);const X=(0,V.A)(q,[["render",$]]),A=X;Q()(q,"components",{QLayout:F.A,QForm:T.A,QInput:C.A,QField:L.A,QEditor:w.A,QBtn:G.A,QPageSticky:R.A})}}]);