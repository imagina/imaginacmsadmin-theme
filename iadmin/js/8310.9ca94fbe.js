"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[8310],{88310:(e,t,s)=>{s.r(t),s.d(t,{default:()=>te});var l=s(61758);const a={class:"backend-page row q-col-gutter-x-md"},o={class:"col-md-5"},i={class:"box"},r={class:"col-md-7"},n={class:"box"};function m(e,t,s,m,d,c){const u=(0,l.g2)("formMenu"),h=(0,l.g2)("indexItemsByMenu");return(0,l.uX)(),(0,l.CE)("div",a,[(0,l.Lk)("div",o,[(0,l.Lk)("div",i,[(0,l.bF)(u)])]),(0,l.Lk)("div",r,[(0,l.Lk)("div",n,[(0,l.bF)(h)])])])}const d={key:0,class:"row gutter-x-sm relative-position"},c={class:"col-12 q-mb-md"},u={key:0};function h(e,t,s,a,o,i){const r=(0,l.g2)("locales"),n=(0,l.g2)("q-input"),m=(0,l.g2)("q-select"),h=(0,l.g2)("q-btn"),g=(0,l.g2)("q-form"),p=(0,l.g2)("inner-loading");return o.success?((0,l.uX)(),(0,l.CE)("div",d,[(0,l.bF)(g,{autocorrect:"off",autocomplete:"off",ref:"formContent",class:"full-width q-my-sm",onSubmit:t[5]||(t[5]=e=>i.updateItem()),onValidationError:t[6]||(t[6]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,l.k6)((()=>[(0,l.Lk)("div",c,[(0,l.bF)(r,{modelValue:o.locale,"onUpdate:modelValue":t[0]||(t[0]=e=>o.locale=e),ref:"localeComponent",form:e.$refs.formContent},null,8,["modelValue","form"])]),o.locale.success?((0,l.uX)(),(0,l.CE)("div",u,[(0,l.bF)(n,{outlined:"",dense:"",modelValue:o.locale.formTemplate.name,"onUpdate:modelValue":t[1]||(t[1]=e=>o.locale.formTemplate.name=e),label:`${e.$tr("isite.cms.form.name")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","rules"]),(0,l.bF)(n,{outlined:"",dense:"",modelValue:o.locale.formTemplate.title,"onUpdate:modelValue":t[2]||(t[2]=e=>o.locale.formTemplate.title=e),label:`${e.$tr("isite.cms.form.title")} (${o.locale.language})*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]},null,8,["modelValue","label","rules"]),(0,l.bF)(m,{label:`${e.$tr("isite.cms.form.status")} (${o.locale.language})`,modelValue:o.locale.formTemplate.status,"onUpdate:modelValue":t[3]||(t[3]=e=>o.locale.formTemplate.status=e),options:[{label:this.$tr("isite.cms.label.enabled"),value:"1"},{label:this.$tr("isite.cms.label.disabled"),value:"0"}],outlined:"",dense:"","emit-value":"","map-options":""},null,8,["label","modelValue","options"]),(0,l.bF)(m,{label:e.$tr("isite.cms.form.default"),modelValue:o.locale.formTemplate.isDefault,"onUpdate:modelValue":t[4]||(t[4]=e=>o.locale.formTemplate.isDefault=e),options:[{label:this.$tr("isite.cms.label.yes"),value:"1"},{label:this.$tr("isite.cms.label.no"),value:"0"}],outlined:"",dense:"","emit-value":"","map-options":""},null,8,["label","modelValue","options"]),o.itemId?((0,l.uX)(),(0,l.Wv)(h,{key:0,class:"float-right",color:"green",loading:o.loading,unelevated:"",icon:"fas fa-save",label:e.$tr("isite.cms.label.save"),type:"submit",rounded:""},null,8,["loading","label"])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)])),_:1},512),(0,l.bF)(p,{visible:o.loading},null,8,["visible"])])):(0,l.Q3)("",!0)}const g={components:{},watch:{$route(e,t){this.initForm()}},mounted(){this.$nextTick((function(){this.initForm()}))},data(){return{locale:{},loading:!1,success:!1,itemId:!1}},computed:{dataLocale(){return{fields:{name:"",isDefault:"0"},fieldsTranslatable:{title:"",status:"1"}}}},methods:{async initForm(){this.loading=!0,this.success=!1,this.locale=this.$clone(this.dataLocale),this.itemId=this.$route.params.id,this.locale.success&&this.$refs.localeComponent.vReset(),await this.getData(),this.success=!0,this.loading=!1},getData(){return new Promise(((e,t)=>{const s=this.$clone(this.itemId);if(s){let l="apiRoutes.qmenu.menus",a={refresh:!0,params:{filter:{allTranslations:!0}}};this.$crud.show(l,s,a).then((t=>{this.orderDataItemToLocale(t.data),e(!0)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1,t(!1)}))}))}else e(!0)}))},orderDataItemToLocale(e){let t=this.$clone(e);this.locale.form=this.$clone(t)},async updateItem(){if(await this.$refs.localeComponent.validateForm()){this.loading=!0;let e="apiRoutes.qmenu.menus";this.$crud.update(e,this.itemId,this.getDataForm()).then((e=>{this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`}),this.loading=!1})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated"),pos:"bottom"})}))}},getDataForm(){let e=this.locale.form;for(var t in e){let s=e[t];null!=s&&void 0!=s||delete e[t]}return e.selectable=JSON.stringify(e.selectable),e}}};var p=s(12807),b=s(21565),f=s(78020),$=s(833),v=s(69001),I=s(98582),k=s.n(I);const q=(0,p.A)(g,[["render",h]]),F=q;k()(g,"components",{QForm:b.A,QInput:f.A,QSelect:$.A,QBtn:v.A});var y=s(58790);const T={class:"row gutter-y-sm relative-position"},C={class:"col-md-12"},D={class:"float-right"},A={class:"col-12 q-mt-sm"},x={class:"col-12 text-right q-mt-sm"};function V(e,t,s,a,o,i){const r=(0,l.g2)("q-btn"),n=(0,l.g2)("q-tooltip"),m=(0,l.g2)("nestedMenuItems"),d=(0,l.g2)("inner-loading");return(0,l.uX)(),(0,l.CE)("div",T,[(0,l.Lk)("div",C,[(0,l.Lk)("div",D,[(0,l.bF)(r,{to:{name:"qmenu.admin.menu.create",params:{menuId:e.$route.params.id}},icon:"fas fa-plus-circle",label:e.$tr("menu.cms.newItem"),color:"green",class:"q-ml-xs",rounded:"",outline:""},null,8,["to","label"]),(0,l.bF)(r,{onClick:t[0]||(t[0]=e=>i.getItems(!0)),icon:"fas fa-sync-alt",color:"blue-grey",class:"q-ml-xs",round:"",outline:""},{default:(0,l.k6)((()=>[(0,l.bF)(n,{delay:300},{default:(0,l.k6)((()=>[(0,l.eW)((0,y.v_)(e.$tr("isite.cms.label.refresh")),1)])),_:1})])),_:1})])]),(0,l.Lk)("div",A,[(0,l.bF)(m,{menuItems:o.menuItems,onUpdated:t[1]||(t[1]=e=>i.getItems(!0))},null,8,["menuItems"])]),(0,l.Lk)("div",x,[o.menuItems.length?((0,l.uX)(),(0,l.Wv)(r,{key:0,onClick:i.updateOrder,icon:"fas fa-save",label:e.$tr("isite.cms.label.save"),color:"green",class:"q-ml-xs",rounded:"",unelevated:""},null,8,["onClick","label"])):(0,l.Q3)("",!0)]),(0,l.bF)(d,{visible:o.loading},null,8,["visible"])])}s(10239);const L={class:"row justify-between q-mb-xs q-mt-xs"},w={class:"col-6 q-py-xs"},Q={class:"col-6 text-right q-py-xs relative-position"},R={class:"col-12"},U={class:"q-ma-none text-red"};function _(e,t,s,a,o,i){const r=(0,l.g2)("q-icon"),n=(0,l.g2)("q-btn"),m=(0,l.g2)("q-separator"),d=(0,l.g2)("nestedDraggable"),c=(0,l.g2)("draggable"),u=(0,l.g2)("q-card-section"),h=(0,l.g2)("q-card-actions"),g=(0,l.g2)("q-card"),p=(0,l.g2)("q-dialog");return(0,l.uX)(),(0,l.CE)("div",null,[(0,l.bF)(c,(0,l.v6)({tag:"div"},i.dragOptions,{list:s.menuItems,group:{name:"g1"},"item-key":"id"}),{item:(0,l.k6)((({element:t})=>[((0,l.uX)(),(0,l.CE)("div",{class:"list-group-item",key:t.id},[(0,l.Lk)("div",L,[(0,l.Lk)("div",w,[(0,l.bF)(r,{class:"cursor-pointer",name:"fas fa-arrows-alt"}),(0,l.eW)(" "+(0,y.v_)(t.title),1)]),(0,l.Lk)("div",Q,[(0,l.bF)(n,{to:{name:"qmenu.admin.menu.update",params:{menuId:e.$route.params.id,id:t.id}},icon:"fas fa-pen",size:"xs",class:"q-mr-sm",rounded:"",unelevated:"",color:"green"},null,8,["to"]),(0,l.bF)(n,{onClick:e=>{o.dialogDeleteItem=!0,o.itemIdToDelete=t},icon:"fas fa-trash-alt",size:"xs",rounded:"",unelevated:"",color:"red"},null,8,["onClick"])]),(0,l.Lk)("div",R,[(0,l.bF)(m)])]),(0,l.bF)(d,{class:(0,y.C4)(`${t.children.length} ?: q-mb-xs`),menuItems:t.children},null,8,["class","menuItems"])]))])),_:1},16,["list"]),(0,l.bF)(p,{modelValue:o.dialogDeleteItem,"onUpdate:modelValue":t[2]||(t[2]=e=>o.dialogDeleteItem=e)},{default:(0,l.k6)((()=>[(0,l.bF)(g,{class:"backend-page"},{default:(0,l.k6)((()=>[(0,l.bF)(u,null,{default:(0,l.k6)((()=>[(0,l.Lk)("h5",U,(0,y.v_)(o.itemIdToDelete.label),1),(0,l.eW)(" "+(0,y.v_)(e.$tr("isite.cms.message.deleteRecord")),1)])),_:1}),(0,l.bF)(h,{align:"right"},{default:(0,l.k6)((()=>[(0,l.bF)(n,{color:"blue-grey",label:"Cancel",onClick:t[0]||(t[0]=e=>o.dialogDeleteItem=!1)}),(0,l.bF)(n,{color:"red",icon:"fas fa-trash-alt",label:"Delete",onClick:t[1]||(t[1]=e=>i.deleteItem())})])),_:1})])),_:1})])),_:1},8,["modelValue"])])}var E=s(10057),M=s.n(E);const X={name:"nestedDraggable",components:{draggable:M()},props:{menuItems:{required:!0,type:Array}},emits:["updated"],data(){return{dialogDeleteItem:!1,itemIdToDelete:{}}},computed:{dragOptions(){return{animation:200,group:"description",disabled:!1,ghostClass:"ghost"}}},methods:{deleteItem(){this.$crud.delete("apiRoutes.qmenu.menuItems",this.itemIdToDelete.id).then((e=>{this.$alert.success({message:this.$tr("isite.cms.message.recordDeleted")}),this.dialogDeleteItem=!1,this.$emit("updated")})).catch((e=>{this.$alert.error({message:this.$tr("isite.cms.message.recordNoDeleted"),pos:"bottom"})}))}}};var B=s(24609),O=s(37015),S=s(57201),W=s(97569),N=s(27066),z=s(16334);const j=(0,p.A)(X,[["render",_]]),J=j;k()(X,"components",{QIcon:B.A,QBtn:v.A,QSeparator:O.A,QDialog:S.A,QCard:W.A,QCardSection:N.A,QCardActions:z.A});var P=s(71915);const G={components:{nestedMenuItems:J},data(){return{loading:!1,menuItems:[],modalNewItem:!1,modalUpdateItem:!1,itemUpdate:{},itemDelete:{}}},created(){this.$nextTick((()=>{this.getItems(),P.Bt.on("updateMenuItems",this.handlerUpdateMenuItems)}))},methods:{getItems(e=!1){this.loading=!0;let t=this.$route.params.id,s={refresh:e,params:{include:"menuitems"}};this.$crud.show("apiRoutes.qmenu.menus",t,s).then((e=>{this.menuItems=this.arrayToTree(e.data.menuitems),this.loading=!1})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"}),this.loading=!1}))}))},updateOrder(){let e=[];this.treeToArray(this.menuItems,e),this.loading=!0,this.$crud.create("apiRoutes.qmenu.menuItemsOrdener",{menuitems:e}).then((e=>{this.loading=!1,this.$alert.success({message:`${this.$tr("isite.cms.message.recordUpdated")}`})})).catch((e=>{this.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.errorRequest"),pos:"bottom"})}))},arrayToTree(e,t=0){return e.filter((s=>{if(s.parentId==t)return s["children"]=this.arrayToTree(e,s.id)}))},treeToArray(e,t,s=null){let l=[...e];l.forEach(((e,l)=>{e.position=l,e.parentId=s,t.push(e),e.children.length&&this.treeToArray(e.children,t,e.id)}))},handlerUpdateMenuItems(e){this.getItems()}}};var H=s(78151);const K=(0,p.A)(G,[["render",V]]),Y=K;k()(G,"components",{QBtn:v.A,QTooltip:H.A});const Z={components:{formMenu:F,indexItemsByMenu:Y}},ee=(0,p.A)(Z,[["render",m]]),te=ee}}]);