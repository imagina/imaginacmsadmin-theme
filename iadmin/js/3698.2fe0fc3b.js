"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[3698],{93698:(e,t,i)=>{i.r(t),i.d(t,{default:()=>C});var s=i(61758),a=i(58790);const n={id:"mySubscriptionsPage"},r={id:"content",class:"relative-position"},l={class:"box box-auto-height q-mb-md"},c={key:0,id:"otherPlans",class:"box box-auto-height"},o={class:"row q-col-gutter-md"},d={class:"plan-card"},p={class:"plan-card__name"},u=["innerHTML"],h={class:"plan-card__bottom row justify-between items-center"},m={class:"plan-card__price"},b={class:"plan-card__price text-caption"},g={key:0,class:"plan-card__label-current bg-green text-white q-pa-sm"},v={key:1,class:"box row items-center justify-center"};function k(e,t,i,k,$,_){const f=(0,s.g2)("page-actions"),y=(0,s.g2)("q-separator"),L=(0,s.g2)("q-btn"),q=(0,s.g2)("not-result"),w=(0,s.g2)("inner-loading");return(0,s.uX)(),(0,s.CE)("div",n,[(0,s.Lk)("div",r,[(0,s.Lk)("div",l,[(0,s.bF)(f,{title:e.$tr(e.$route.meta.title),onRefresh:t[0]||(t[0]=e=>_.getData(!0))},null,8,["title"])]),$.plans.length?((0,s.uX)(),(0,s.CE)("div",c,[(0,s.Lk)("div",o,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(_.plansData,((t,i)=>((0,s.uX)(),(0,s.CE)("div",{key:i,class:"col-12 col-md-4"},[(0,s.Lk)("div",d,[(0,s.Lk)("div",p,(0,a.v_)(t.name),1),(0,s.Lk)("div",{class:"plan-card__description",innerHTML:t.description},null,8,u),(0,s.bF)(y,{inset:""}),(0,s.Lk)("div",h,[(0,s.Lk)("div",null,[(0,s.Lk)("div",m,[(0,s.Lk)("b",null,(0,a.v_)(t.priceFormat),1)]),(0,s.Lk)("div",b,(0,a.v_)(t.frequency),1)]),(0,s.Lk)("div",null,[t.current?((0,s.uX)(),(0,s.CE)("div",g," ยก"+(0,a.v_)(e.$tr("isite.cms.label.currentPlan"))+"! ",1)):((0,s.uX)(),(0,s.Wv)(L,{key:1,label:e.$tr("isite.cms.label.select"),rounded:"",color:"green",unelevated:"",outline:"","no-caps":"",size:"12px",onClick:e=>_.buySubscription(t)},null,8,["label","onClick"]))])])])])))),128))])])):$.loading?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",v,[(0,s.bF)(q)])),(0,s.bF)(w,{visible:$.loading},null,8,["visible"])])])}const $={props:{},components:{},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,subscription:null,plans:[]}},computed:{plansData(){let e=this.$clone(this.plans),t=this.$clone(this.subscription);return e=e.map((e=>({id:e.id,name:e.name,description:e.description,price:e.product?.price||0,priceFormat:e.priceFormat,frequency:e.frequency}))),e.sort((function(e,t){return e.price>t.price?1:e.price<t.price?-1:0})),t&&t.planId&&this.$clone(e).forEach(((i,s)=>{parseInt(i.id)==parseInt(t.planId)&&e.unshift({...e.splice(s,1)[0],current:!0})})),e}},methods:{init(){this.getData()},async getData(e=!1){this.loading=!0,await Promise.all([this.getSubscription(e),this.getPlans(e)]),this.loading=!1},getSubscription(e=!1){return new Promise(((t,i)=>{let s=this.$store.state.quserAuth.userId,a={refresh:e,params:{filter:{field:"entity_id",entity:"Modules\\User\\Entities\\Sentinel\\User"}}};this.$crud.show("apiRoutes.qplan.subscriptions",s,a).then((e=>{this.subscription=e.data,t(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{t(e)}))}))}))},getPlans(e=!1){return new Promise(((t,i)=>{this.loading=!0;let s={refresh:e,params:{include:"product"}};this.$crud.index("apiRoutes.qplan.plans",s).then((e=>{this.plans=e.data,t(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{t(e)}))}))}))},buySubscription(e){return new Promise((t=>{this.loading=!0;let i={planId:e.id};this.$crud.create("apiRoutes.qplan.buy",i).then((e=>{this.$alert.info({message:`${this.$tr("isite.cms.message.recordCreated")}`}),this.getData(!0),e.data&&e.data.redirectTo&&this.$helper.openExternalURL(e.data.redirectTo,!0),this.loading=!1,t(e.data)})).catch((e=>{this.$alert.error({message:`${this.$tr("isite.cms.message.recordNoCreated")}`}),this.loading=!1,t(e)}))}))}}};var _=i(12807),f=i(37015),y=i(69001),L=i(98582),q=i.n(L);const w=(0,_.A)($,[["render",k]]),C=w;q()($,"components",{QSeparator:f.A,QBtn:y.A})}}]);