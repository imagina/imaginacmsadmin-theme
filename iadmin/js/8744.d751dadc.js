"use strict";(globalThis["webpackChunkimagina_cms"]=globalThis["webpackChunkimagina_cms"]||[]).push([[8744],{88744:(e,t,l)=>{l.r(t),l.d(t,{default:()=>de});var o=l(92444);const i={id:"contentConfig",class:"row q-col-gutter-y-xl"},a={id:"contentProviders",class:"col-12"},s={class:"box box-auto-height q-mb-md"};function r(e,t,l,r,n,d){const m=(0,o.E1)("page-actions"),c=(0,o.E1)("providers"),u=((0,o.E1)("q-icon"),(0,o.E1)("q-separator"),(0,o.E1)("rules"),(0,o.E1)("q-page"));return(0,o.Wz)(),(0,o.Az)(u,{id:"notificationsConfigPage"},{default:(0,o.Ql)((()=>[(0,o.QD)("div",i,[(0,o.QD)("div",a,[(0,o.QD)("div",s,[(0,o.K2)(m,{title:e.$trp("isite.cms.label.provider")},null,8,["title"])]),(0,o.K2)(c)]),(0,o.g1)("",!0)])])),_:1})}var n=l(74044);const d={id:"providersAdminPage"},m={id:"contentProviders",class:"relative-position"},c={class:"row q-col-gutter-md"};function u(e,t,l,i,a,s){const r=(0,o.E1)("q-icon"),u=(0,o.E1)("q-card-section"),p=(0,o.E1)("q-space"),f=(0,o.E1)("q-btn"),v=(0,o.E1)("q-card-actions"),h=(0,o.E1)("q-card"),g=(0,o.E1)("q-toolbar-title"),b=(0,o.E1)("q-toolbar"),Q=(0,o.E1)("dynamic-field"),y=(0,o.E1)("q-form"),$=(0,o.E1)("inner-loading"),q=(0,o.E1)("q-dialog"),k=(0,o.iS)("close-popup");return(0,o.Wz)(),(0,o.An)("div",d,[(0,o.QD)("div",m,[(0,o.QD)("div",c,[((0,o.Wz)(!0),(0,o.An)(o.ae,null,(0,o.mi)(a.providers,((t,l)=>((0,o.Wz)(),(0,o.An)("div",{class:"col-12 col-sm-6 col-md-4 col-lg-3",key:l},[(0,o.K2)(h,{class:"my-card box box-auto-height",style:{padding:"0"}},{default:(0,o.Ql)((()=>[(0,o.K2)(u,{class:"text-h5 text-white row items-center q-py-lg",style:(0,n.MN)(`background-color: ${t.color}`)},{default:(0,o.Ql)((()=>[(0,o.K2)(r,{name:t.icon,class:"q-mr-md"},null,8,["name"]),(0,o.QD)("label",null,(0,n.WA)(t.name),1)])),_:2},1032,["style"]),(0,o.K2)(v,null,{default:(0,o.Ql)((()=>[(0,o.QD)("label",{class:(0,n.WN)(`text-${s.providerStatus(t).color}`)},(0,n.WA)(s.providerStatus(t).label),3),(0,o.K2)(p),(0,o.K2)(f,{outline:"",color:"primary",rounded:"",dense:"","no-caps":"",label:e.$tr("isite.cms.label.setup"),onClick:e=>(a.modal.provider=t,a.modal.show=!0)},null,8,["label","onClick"])])),_:2},1024)])),_:2},1024)])))),128))]),(0,o.K2)(q,{modelValue:a.modal.show,"onUpdate:modelValue":t[5]||(t[5]=e=>a.modal.show=e),"no-esc-dismiss":"","no-backdrop-dismiss":"",onHide:t[6]||(t[6]=e=>a.modal.form={})},{default:(0,o.Ql)((()=>[(0,o.K2)(h,{class:"bg-grey-1 backend-page row relative-position"},{default:(0,o.Ql)((()=>[(0,o.K2)(b,{class:"text-white",style:(0,n.MN)(`background-color: ${a.modal.provider.color}`)},{default:(0,o.Ql)((()=>[(0,o.K2)(g,null,{default:(0,o.Ql)((()=>[(0,o.K2)(r,{name:a.modal.provider.icon,class:"q-mr-md"},null,8,["name"]),(0,o.QD)("label",null,(0,n.WA)(a.modal.provider.name),1)])),_:1}),(0,o.wt)((0,o.K2)(f,{flat:"",icon:"fas fa-times"},null,512),[[k]])])),_:1},8,["style"]),(0,o.K2)(u,{class:"relative-position col-12"},{default:(0,o.Ql)((()=>[(0,o.K2)(y,{autocorrect:"off",autocomplete:"off",ref:"formProviderConfig",onSubmit:t[2]||(t[2]=e=>s.saveProviderConfig()),onValidationError:t[3]||(t[3]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,o.Ql)((()=>[((0,o.Wz)(!0),(0,o.An)(o.ae,null,(0,o.mi)(s.providerFields,((l,i)=>((0,o.Wz)(),(0,o.An)(o.ae,{key:i},[l?.isFakeField?((0,o.Wz)(),(0,o.Az)(Q,{key:1,field:l,onEnter:t[1]||(t[1]=t=>e.$refs.formProviderConfig.submit()),modelValue:a.modal.form[s.getNameFakeField(l)][l.name||i],"onUpdate:modelValue":e=>a.modal.form[s.getNameFakeField(l)][l.name||i]=e},null,8,["field","modelValue","onUpdate:modelValue"])):((0,o.Wz)(),(0,o.Az)(Q,{key:0,field:l,modelValue:a.modal.form[l.name||i],"onUpdate:modelValue":e=>a.modal.form[l.name||i]=e,onEnter:t[0]||(t[0]=t=>e.$refs.formProviderConfig.submit())},null,8,["field","modelValue","onUpdate:modelValue"]))],64)))),128))])),_:1},512)])),_:1}),(0,o.K2)(b,{class:"q-pa-md"},{default:(0,o.Ql)((()=>[(0,o.K2)(g),(0,o.K2)(f,{icon:"fas fa-save",color:"positive",rounded:"",unelevated:"",label:e.$tr("isite.cms.label.save"),onClick:t[4]||(t[4]=t=>e.$refs.formProviderConfig.submit())},null,8,["label"])])),_:1}),(0,o.K2)($,{visible:a.modal.loading},null,8,["visible"])])),_:1})])),_:1},8,["modelValue"]),(0,o.K2)($,{visible:a.loading},null,8,["visible"])])])}var p=l(8932);const f={beforeUnmount(){p.kN.off("page.data.refresh")},props:{},components:{},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,providers:[],modal:{show:!1,loading:!1,provider:!1,form:{}}}},computed:{providerFields(){let e=this.modal.provider.fields||{},t=this.modal.provider.data||{};for(var l in e){let o=e[l];if(o?.isFakeField){let i=this.getNameFakeField(o);this.modal.form[i]||(this.modal.form[i]={}),t[i]&&void 0!==t[i][l]&&(e[l].value=t[i][l])}else e[l].value=t[l]||o.value||null}return e}},methods:{init(){this.getProviders(),p.kN.on("page.data.refresh",(()=>this.getProviders(!0)))},getProviders(e=!1){return new Promise(((t,l)=>{this.loading=!0;let o={refresh:e};this.$crud.index("apiRoutes.qnotification.providers",o).then((e=>{this.providers=e.data,this.loading=!1,t(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{this.loading=!1,l(e)}))}))}))},getNameFakeField(e){return"string"==typeof e?.isFakeField?e?.isFakeField:"options"},providerStatus(e){let t={color:"red",label:this.$tr("isite.cms.label.disabled")};return e&&e.data&&parseInt(e.data.status)&&(t={color:"green",label:this.$tr("isite.cms.label.enabled")}),t},saveProviderConfig(){this.modal.loading=!0;let e=this.$clone(this.modal.provider),t=this.$clone({...this.modal.form,systemName:e.systemName,name:e.name}),l=!(!e.data||!e.data.id)&&e.data.id;const o=()=>{this.getProviders(!0),this.modal.show=!1,this.modal.loading=!1};l?this.$crud.update("apiRoutes.qnotification.providers",l,t).then((e=>{o(),this.$alert.info({message:this.$tr("isite.cms.message.recordCreated")})})).catch((e=>{this.modal.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoUpdated")})})):this.$crud.create("apiRoutes.qnotification.providers",t).then((e=>{o(),this.$alert.info({message:this.$tr("isite.cms.message.recordCreated")})})).catch((e=>{this.modal.loading=!1,this.$alert.error({message:this.$tr("isite.cms.message.recordNoCreated")})}))}}};var v=l(68716),h=l(70608),g=l(71008),b=l(58120),Q=l(66480),y=l(73456),$=l(99140),q=l(30852),k=l(6536),E=l(36524),A=l(14288),z=l(81020),W=l(95252),C=l.n(W);const K=(0,v.c)(f,[["render",u]]),N=K;C()(f,"components",{QCard:h.c,QCardSection:g.c,QIcon:b.c,QCardActions:Q.c,QSpace:y.c,QBtn:$.c,QDialog:q.c,QToolbar:k.c,QToolbarTitle:E.c,QForm:A.c}),C()(f,"directives",{ClosePopup:z.c});const w={id:"notificationsRulesComponent"},V={id:"contentRulesConfig"},D={key:0},F={key:1},P={class:"row col-12 q-col-gutter-md"},x={class:"col-12"},R={class:"q-mb-sm"},_={class:"text-caption text-grey-8"},U={class:"q-gutter-sm q-mb-sm"},S={class:"col-12"},T={class:"q-mb-sm"},O={class:"text-caption text-grey-8"},I={class:"row col-12 q-col-gutter-md"},M={class:"text-caption"},j={class:"col-12"},B={class:"q-mb-sm"},Y={class:"q-gutter-sm q-mb-sm"},H={class:"row col-12 q-col-gutter-md"};function L(e,t,i,a,s,r){const d=(0,o.E1)("crud"),m=(0,o.E1)("q-toolbar-title"),c=(0,o.E1)("q-btn"),u=(0,o.E1)("q-toolbar"),p=(0,o.E1)("dynamic-field"),f=(0,o.E1)("q-separator"),v=(0,o.E1)("q-checkbox"),h=(0,o.E1)("q-item-section"),g=(0,o.E1)("q-item"),b=(0,o.E1)("q-scroll-area"),Q=(0,o.E1)("q-form"),y=(0,o.E1)("q-card-section"),$=(0,o.E1)("q-card"),q=(0,o.E1)("q-dialog"),k=(0,o.iS)("close-popup"),E=(0,o.iS)("ripple");return(0,o.Wz)(),(0,o.An)("div",w,[(0,o.QD)("div",V,[(0,o.K2)(d,{"crud-data":l.e(8576).then(l.bind(l,28576)),onCreate:t[0]||(t[0]=e=>r.openForm()),onUpdate:r.openForm},null,8,["crud-data","onUpdate"])]),(0,o.K2)(q,{id:"modalFormRulesConfig",class:"modal-form-notification-rules",modelValue:s.modal.show,"onUpdate:modelValue":t[6]||(t[6]=e=>s.modal.show=e),"no-esc-dismiss":"","no-backdrop-dismiss":"",onShow:t[7]||(t[7]=e=>r.resetModal())},{default:(0,o.Ql)((()=>[(0,o.K2)($,null,{default:(0,o.Ql)((()=>[(0,o.K2)(u,{class:"bg-primary text-white"},{default:(0,o.Ql)((()=>[(0,o.K2)(m,null,{default:(0,o.Ql)((()=>[s.modal.item?((0,o.Wz)(),(0,o.An)("label",F,(0,n.WA)(e.$tr("notification.cms.updateRule"))+" ID: "+(0,n.WA)(s.modal.item.id),1)):((0,o.Wz)(),(0,o.An)("label",D,(0,n.WA)(e.$tr("notification.cms.newRule")),1))])),_:1}),(0,o.wt)((0,o.K2)(c,{flat:"",icon:"fas fa-times"},null,512),[[k]])])),_:1}),(0,o.K2)(y,null,{default:(0,o.Ql)((()=>[(0,o.K2)(Q,{autocorrect:"off",autocomplete:"off",ref:"formRules",class:"row",onSubmit:t[2]||(t[2]=e=>s.modal.item?r.updateRule():r.createRule()),onValidationError:t[3]||(t[3]=t=>e.$alert.error(e.$tr("isite.cms.message.formInvalid")))},{default:(0,o.Ql)((()=>[(0,o.QD)("div",P,[((0,o.Wz)(!0),(0,o.An)(o.ae,null,(0,o.mi)(r.formFields,((e,t)=>((0,o.Wz)(),(0,o.Az)(p,{key:t,modelValue:s.form[e.name||t],"onUpdate:modelValue":l=>s.form[e.name||t]=l,field:e,class:"col-12 col-md-6"},null,8,["modelValue","onUpdate:modelValue","field"])))),128))]),(0,o.K2)(f,{class:"q-mb-md"}),(0,o.QD)("div",x,[(0,o.QD)("div",R,[(0,o.mY)((0,n.WA)(e.$tr("notification.cms.label.event"))+" ",1),(0,o.QD)("div",_,(0,n.WA)(e.$tr("notification.cms.message.chooseEventCategory")),1)]),(0,o.QD)("div",U,[((0,o.Wz)(!0),(0,o.An)(o.ae,null,(0,o.mi)(r.entitiesOptions,((e,t)=>((0,o.Wz)(),(0,o.Az)(c,{key:t,padding:"xs sm","no-caps":"",unelevated:"",label:e.label,onClick:t=>(s.form.entityName=e.value,s.form.eventPath=[]),color:s.form.entityName==e.value?"primary":"grey-7",outline:s.form.entityName!=e.value},null,8,["label","onClick","color","outline"])))),128))]),(0,o.K2)(b,{id:"eventsContent",style:{height:"100px",width:"100%"},visible:""},{default:(0,o.Ql)((()=>[((0,o.Wz)(!0),(0,o.An)(o.ae,null,(0,o.mi)(r.eventsOptions,((e,l)=>(0,o.wt)(((0,o.Wz)(),(0,o.Az)(g,{key:l},{default:(0,o.Ql)((()=>[(0,o.K2)(h,null,{default:(0,o.Ql)((()=>[(0,o.K2)(v,{modelValue:s.form.eventPath,"onUpdate:modelValue":t[1]||(t[1]=e=>s.form.eventPath=e),val:e.value,label:e.label,size:"xs"},null,8,["modelValue","val","label"])])),_:2},1024)])),_:2},1024)),[[E]]))),128))])),_:1})]),(0,o.K2)(f,{class:"q-my-md"}),(0,o.QD)("div",S,[(0,o.QD)("div",T,[(0,o.mY)((0,n.WA)(e.$trp("notification.cms.label.condition"))+" ",1),(0,o.QD)("div",O,(0,n.WA)(e.$tr("notification.cms.message.conditions")),1)]),(0,o.QD)("div",I,[((0,o.Wz)(!0),(0,o.An)(o.ae,null,(0,o.mi)(r.conditionsFields,((e,t)=>((0,o.Wz)(),(0,o.An)("div",{class:"col-12 col-sm-6 col-md-3",key:t},[(0,o.QD)("div",M,[(0,o.QD)("b",null,(0,n.WA)(e.props?e.props.label:""),1)]),e.children?((0,o.Wz)(!0),(0,o.An)(o.ae,{key:1},(0,o.mi)(e.children,((l,i)=>((0,o.Wz)(),(0,o.Az)(p,{key:i,modelValue:s.form.conditions[e.name||t][l.name|i],"onUpdate:modelValue":o=>s.form.conditions[e.name||t][l.name|i]=o,field:l},null,8,["modelValue","onUpdate:modelValue","field"])))),128)):((0,o.Wz)(),(0,o.Az)(p,{key:0,field:e,modelValue:s.form.conditions[e.name||t],"onUpdate:modelValue":l=>s.form.conditions[e.name||t]=l},null,8,["field","modelValue","onUpdate:modelValue"]))])))),128))])]),(0,o.K2)(f,{class:"q-my-md"}),(0,o.QD)("div",j,[(0,o.QD)("div",B,(0,n.WA)(e.$trp("notification.cms.message.settingProviders")),1),(0,o.QD)("div",Y,[((0,o.Wz)(!0),(0,o.An)(o.ae,null,(0,o.mi)(r.providersOptions,((e,t)=>((0,o.Wz)(),(0,o.Az)(c,{key:t,padding:"xs sm","no-caps":"",unelevated:"",label:e.label,onClick:t=>s.form.providerName=e.value,color:s.form.providerName==e.value?"primary":"grey-7",outline:s.form.providerName!=e.value},null,8,["label","onClick","color","outline"])))),128))]),(0,o.QD)("div",H,[((0,o.Wz)(!0),(0,o.An)(o.ae,null,(0,o.mi)(r.providersFields,((e,t)=>((0,o.Wz)(),(0,o.Az)(p,{key:t,field:e,modelValue:s.form.settings[s.form.providerName][e.name||t],"onUpdate:modelValue":l=>s.form.settings[s.form.providerName][e.name||t]=l,class:"col-12 col-md-6"},null,8,["field","modelValue","onUpdate:modelValue"])))),128))])])])),_:1},512)])),_:1}),(0,o.K2)(u,{class:"q-pa-md"},{default:(0,o.Ql)((()=>[(0,o.K2)(m),s.modal.item?((0,o.Wz)(),(0,o.Az)(c,{key:1,label:e.$tr("isite.cms.label.update"),icon:"fas fa-pen",color:"positive",rounded:"",unelevated:"",onClick:t[5]||(t[5]=t=>e.$refs.formRules.submit())},null,8,["label"])):((0,o.Wz)(),(0,o.Az)(c,{key:0,icon:"fas fa-save",color:"positive",rounded:"",unelevated:"",label:e.$tr("isite.cms.label.save"),onClick:t[4]||(t[4]=t=>e.$refs.formRules.submit())},null,8,["label"]))])),_:1})])),_:1})])),_:1},8,["modelValue"])])}l(23816);const G={props:{},components:{},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,events:[],providers:[],modal:{item:!1,show:!1,loading:!1},form:{}}},computed:{defaultDataForm(){return this.$clone({name:null,status:!0,entityName:null,eventPath:[],conditions:{},settings:{},providerName:null})},formFields(){return{name:{value:null,type:"input",props:{label:`${this.$tr("isite.cms.form.name")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")]}},status:{value:"1",type:"select",props:{label:`${this.$tr("isite.cms.form.status")}*`,rules:[e=>!!e||this.$tr("isite.cms.message.fieldRequired")],options:[{label:this.$tr("isite.cms.label.enabled"),value:"1"},{label:this.$tr("isite.cms.label.disabled"),value:"0"}]}}}},selectedEntity(){return!!this.form.entityName&&this.events.find((e=>e.entityName==this.form.entityName))},entitiesOptions(){return this.events.map((e=>({label:e.title,value:e.entityName})))},eventsOptions(){return this.selectedEntity?this.selectedEntity.events.map((e=>({label:e.title,value:e.path}))):[]},conditionsFields(){if(!this.selectedEntity)return{};for(var e in this.selectedEntity.conditions){let t=this.selectedEntity.conditions[e];t.children&&(this.form.conditions[e]={})}return this.selectedEntity.conditions},providersOptions(){let e=[];return Object.values(this.providers).forEach((t=>{e.push({label:t.name,value:t.systemName}),this.form.settings[t.systemName]={}})),e},providersFields(){if(!this.form.providerName)return[];let e=Object.values(this.providers).find((e=>e.systemName==this.form.providerName));return e?e.settings:[]}},methods:{init(){this.form=this.$clone(this.defaultDataForm),this.getData(),p.kN.on("page.data.refresh",(()=>this.getData(!0)))},getData(e=!1){return new Promise((async(t,l)=>{this.loading=!0,await Promise.all([this.getEvents(e),this.getProviders(e)]),this.loading=!1}))},getEvents(e=!1){return new Promise(((t,l)=>{let o={refresh:e};this.$crud.index("apiRoutes.qnotification.rulesConfig",o).then((e=>{this.events=e.data,t(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{l(e)}))}))}))},getProviders(e=!1){return new Promise(((t,l)=>{let o={refresh:e};this.$crud.index("apiRoutes.qnotification.providers",o).then((e=>{this.providers=e.data,t(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{l(e)}))}))}))},resetModal(){this.modal.item=!1,this.form=this.$clone(this.defaultDataForm),this.form.entityName=this.events?this.events[0].entityName:null,this.form.providerName=this.providers?Object.values(this.providers)[0].systemName:null},openForm(e=!1){this.modal.item=e??!1,this.modal.show=!0},createRule(){},updateRule(){}}};var J=l(70880),X=l(94380),Z=l(84884),ee=l(11032),te=l(78488),le=l(41628),oe=l(85220);const ie=(0,v.c)(G,[["render",L]]),ae=ie;C()(G,"components",{QDialog:q.c,QCard:h.c,QToolbar:k.c,QToolbarTitle:E.c,QBtn:$.c,QCardSection:g.c,QForm:A.c,QSeparator:J.c,QScrollArea:X.c,QItem:Z.c,QItemSection:ee.c,QCheckbox:te.c,QLayout:le.c}),C()(G,"directives",{ClosePopup:z.c,Ripple:oe.c});const se={props:{},components:{providers:N,rules:ae},watch:{},mounted(){this.$nextTick((function(){}))},data(){return{}},computed:{},methods:{}};var re=l(9440);const ne=(0,v.c)(se,[["render",r]]),de=ne;C()(se,"components",{QPage:re.c,QIcon:b.c,QSeparator:J.c})}}]);