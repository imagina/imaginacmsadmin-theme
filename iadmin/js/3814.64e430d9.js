"use strict";(globalThis["webpackChunkadmin_quasar"]=globalThis["webpackChunkadmin_quasar"]||[]).push([[3814],{73814:(t,e,a)=>{a.r(e),a.d(e,{default:()=>S});var i=a(61758),o=a(58790);const s={id:"walletPage"},l={class:"box box-auto-height q-mb-md"},n={class:"row q-col-gutter-x-md"},r={class:"col-6 col-sm-3"},m={class:"box box-auto-height q-mb-md bg-blue text-white"},d={class:"text-weight-bold"},c={class:"col-6 col-sm-3"},u={class:"box box-auto-height q-mb-md bg-green text-white"},h={class:"text-weight-bold"},g={class:"col-6 col-sm-3"},b={class:"box box-auto-height q-mb-md bg-red-4 text-white"},p={class:"text-weight-bold"},f={class:"col-6 col-sm-3"},v={class:"box box-auto-height q-mb-md bg-amber text-white"},y={class:"text-weight-bold"},w={class:"box box-auto-height"},$={key:1,class:"text-red-4"};function x(t,e,x,k,P,q){const A=(0,i.g2)("page-actions"),F=(0,i.g2)("payout-config"),L=(0,i.g2)("q-icon"),_=(0,i.g2)("crud"),C=(0,i.g2)("dynamic-field"),R=(0,i.g2)("master-modal");return(0,i.uX)(),(0,i.CE)("div",s,[(0,i.Lk)("div",l,[(0,i.bF)(A,{icon:"fas fa-wallet",title:t.$tr("icredit.cms.label.wallet"),ref:"pageActions","extra-actions":q.extraPageActions,onRefresh:e[0]||(e[0]=e=>{q.getSummary(!0),t.$refs.payoutConfig.loadPage()})},null,8,["title","extra-actions"])]),(0,i.bF)(F,{class:"q-mb-md",ref:"payoutConfig"},null,512),(0,i.Lk)("div",n,[(0,i.Lk)("div",r,[(0,i.Lk)("div",m,[(0,i.Lk)("div",d,[(0,i.bF)(L,{name:"fas fa-dollar-sign"}),(0,i.eW)(" "+(0,o.v_)(this.$tr("isite.cms.label.available")),1)]),(0,i.eW)(" "+(0,o.v_)(t.$trn(this.summary.amount)),1)])]),(0,i.Lk)("div",c,[(0,i.Lk)("div",u,[(0,i.Lk)("div",h,[(0,i.bF)(L,{name:"fas fa-caret-up"}),(0,i.eW)(" "+(0,o.v_)(this.$tr("isite.cms.label.inbound")),1)]),(0,i.eW)(" "+(0,o.v_)(t.$trn(this.summary.amountIn)),1)])]),(0,i.Lk)("div",g,[(0,i.Lk)("div",b,[(0,i.Lk)("div",p,[(0,i.bF)(L,{name:"fa-solid fa-caret-down"}),(0,i.eW)(" "+(0,o.v_)(this.$tr("isite.cms.label.outbound")),1)]),(0,i.eW)(" "+(0,o.v_)(t.$trn(this.summary.amountOut)),1)])]),(0,i.Lk)("div",f,[(0,i.Lk)("div",v,[(0,i.Lk)("div",y,[(0,i.bF)(L,{name:"fas fa-history"}),(0,i.eW)(" "+(0,o.v_)(this.$tr("isite.cms.label.pending")),1)]),(0,i.eW)(" "+(0,o.v_)(t.$trn(this.summary.amountPending)),1)])])]),(0,i.bF)(_,{"crud-data":a.e(3886).then(a.bind(a,63886))},null,8,["crud-data"]),(0,i.bF)(R,(0,i.v6)({modelValue:P.modal.show,"onUpdate:modelValue":e[2]||(e[2]=t=>P.modal.show=t)},q.modalConfig.props),{default:(0,i.k6)((()=>[(0,i.Lk)("div",w,[q.modalConfig.amountAvailable?((0,i.uX)(),(0,i.Wv)(C,{key:0,modelValue:P.modal.amount,"onUpdate:modelValue":e[1]||(e[1]=t=>P.modal.amount=t),field:q.modalConfig.amountField},null,8,["modelValue","field"])):((0,i.uX)(),(0,i.CE)("div",$,(0,o.v_)(t.$tr("icredit.cms.message.notAmountAvailable"))+"... ",1))])])),_:1},16,["modelValue"])])}const k={id:"payoutComponent"},P={class:"box box-auto-height relative-position",style:{padding:"0"}};function q(t,e,a,o,s,l){const n=(0,i.g2)("btn-menu"),r=(0,i.g2)("q-td"),m=(0,i.g2)("q-table"),d=((0,i.g2)("q-icon"),(0,i.g2)("q-btn"),(0,i.g2)("q-banner"),(0,i.g2)("dynamic-form")),c=(0,i.g2)("master-modal"),u=(0,i.g2)("inner-loading");return(0,i.uX)(),(0,i.CE)("div",k,[(0,i.Lk)("div",P,[(0,i.bF)(m,(0,i.v6)({id:"tablePayout"},l.payoutTableProps),{"body-cell-actions":(0,i.k6)((t=>[(0,i.bF)(r,{props:t},{default:(0,i.k6)((()=>[(0,i.bF)(n,{actions:t.value},null,8,["actions"])])),_:2},1032,["props"])])),_:1},16),(0,i.Q3)("",!0),(0,i.bF)(c,{modelValue:s.modal.show,"onUpdate:modelValue":e[2]||(e[2]=t=>s.modal.show=t),title:s.modal.title,"custom-position":""},{default:(0,i.k6)((()=>[(0,i.bF)(d,{modelValue:s.form,"onUpdate:modelValue":e[1]||(e[1]=t=>s.form=t),"form-type":"grid","form-id":s.paymentMethod.formId,onSubmit:l.connectPayout},null,8,["modelValue","form-id","onSubmit"])])),_:1},8,["modelValue","title"]),(0,i.bF)(u,{visible:s.loading},null,8,["visible"])])])}const A={props:{},components:{},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{loading:!1,paymentMethod:!1,account:!1,form:{},modal:{show:!1,title:""}}},computed:{payoutTableProps(){return{hidePagination:!0,columns:[{name:"title",label:this.$tr("isite.cms.label.payOut"),field:"title",align:"left"},{name:"account",label:this.$tr("isite.cms.label.account"),field:"account",align:"left"},{name:"actions",label:this.$trp("isite.cms.label.action"),field:"actions"}],rows:[{title:"Stripe",account:this.account?this.account.payoutsEnabled?this.account.email:this.account.urlPanelMsj:this.$tr("isite.cms.message.noRegistered"),actions:[{label:this.$tr("isite.cms.label.configuration"),icon:"fas fa-cog",action:t=>{this.modal.show=!0,this.modal.title=`${this.$tr("isite.cms.label.payOut")} | Stripe`}},{label:this.$tr("qcredit.layout.message.showPanel"),icon:"fab fa-cc-stripe",vIf:this.account&&this.account.payoutsEnabled,action:t=>{this.$helper.openExternalURL(this.account.urlPanel)}}]}]}}},methods:{init(){this.loadPage()},async loadPage(){this.loading=!0,await Promise.all([this.getPaymentMethod(),this.getPayoutData()]),this.loading=!1},getPaymentMethod(){return new Promise((t=>{let e={refresh:!0,params:{filter:{field:"name"}}};this.$crud.show("apiRoutes.qcommerce.paymentMethods","icommercestripe",e).then((e=>{this.paymentMethod=e.data,t(e.data)})).catch((e=>{this.$apiResponse.handleError(e,(()=>{t(e)}))}))}))},getPayoutData(){return new Promise(((t,e)=>{this.$crud.get("apiRoutes.qcommerce.stripe.accountUser",{refresh:!0}).then((e=>{e.data&&e.data.email&&(this.account=e.data,this.form.email=this.$clone(e.data.email)),t(e)})).catch((e=>{this.form={},this.account=!1,t(!1)}))}))},connectPayout(){return new Promise(((t,e)=>{this.loading=!0,this.$crud.create("apiRoutes.qcommerce.stripe.connect",this.form).then((t=>{this.$alert.info({mode:"modal",message:this.$tr("isite.cms.message.finishRegister"),actions:[{label:this.$tr("isite.cms.label.next"),color:"green",handler:()=>{this.$helper.openExternalURL(t.data.accountRegisterLink),this.loadPage()}}]}),this.loading=!1})).catch((t=>{this.loading=!1}))}))}}};var F=a(12807),L=a(18383),_=a(77109),C=a(38222),R=a(24609),V=a(69001),I=a(98582),E=a.n(I);const W=(0,F.A)(A,[["render",q]]),T=W;E()(A,"components",{QTable:L.A,QTd:_.A,QBanner:C.A,QIcon:R.A,QBtn:V.A});const M={props:{},components:{payoutConfig:T},watch:{},mounted(){this.$nextTick((function(){this.init()}))},data(){return{summary:{amount:0,amountIn:0,amountOut:0,amountPending:0},customerId:this.$store.state.quserAuth.userId,modal:{loading:!1,show:!1,amount:null}}},computed:{extraPageActions(){return[{props:{label:this.$tr("icredit.cms.label.withdrawal"),rounded:!0,round:!1,color:"green",padding:"3px 15px"},action:()=>{this.modal.show=!0}}]},modalConfig(){let t=parseFloat(this.summary.amount)>0;return{amountAvailable:t,props:{title:this.$tr("icredit.cms.label.withdrawal"),loading:this.modal.loading,actions:t?[{props:{label:this.$tr("isite.cms.label.send"),color:"green"},action:this.withdraw}]:[]},amountField:{value:null,type:"input",props:{label:this.$tr("isite.cms.label.amount"),type:"number"}}}}},methods:{async init(){this.getSummary()},getSummary(t=!1){return new Promise((e=>{let a={refresh:t,params:{filter:{customerId:this.customerId,amountAvailable:!0}}};this.$crud.index("/icredit/v1/credits",a).then((t=>{this.summary=t.data.length?t.data[0]:{amount:0,amountIn:0,amountOut:0,amountPending:0},e(e.data)})).catch((t=>{this.$apiResponse.handleError(error,(()=>{e(!1)}))}))}))},withdraw(){let t=parseFloat(this.summary.amount);if(this.modal.amount<0||this.modal.amount>t)this.$alert.warning(this.$tr("icredit.cms.message.invalidAmount"));else{this.modal.loading=!0;let t={amount:this.modal.amount};this.$crud.create("apiRoutes.qcredit.withdrawalFunds",t).then((t=>{this.$alert.info({message:`${this.$tr("isite.cms.message.recordCreated")}`}),this.modal={loading:!1,show:!1,amount:null},this.$refs.pageActions.emitRefresh()})).catch((t=>{this.modal.loading=!1}))}}}},Q=(0,F.A)(M,[["render",x]]),S=Q;E()(M,"components",{QIcon:R.A})}}]);